var Ys=Object.defineProperty;var Ks=(F,at,vt)=>at in F?Ys(F,at,{enumerable:!0,configurable:!0,writable:!0,value:vt}):F[at]=vt;var p=(F,at,vt)=>(Ks(F,typeof at!="symbol"?at+"":at,vt),vt);(function(){"use strict";var F=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function at(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function vt(r){if(r.__esModule)return r;var t=r.default;if(typeof t=="function"){var e=function n(){if(this instanceof n){var s=[null];s.push.apply(s,arguments);var i=Function.bind.apply(t,s);return new i}return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),e}var Ke={},nt={},Ct={};Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.DefaultSerializer=Ct.extendSerializer=void 0;function Pn(r,t){const e=r.deserialize.bind(r),n=r.serialize.bind(r);return{deserialize(s){return t.deserialize(s,e)},serialize(s){return t.serialize(s,n)}}}Ct.extendSerializer=Pn;const $e={deserialize(r){return Object.assign(Error(r.message),{name:r.name,stack:r.stack})},serialize(r){return{__error_marker:"$$error",message:r.message,name:r.name,stack:r.stack}}},Dn=r=>r&&typeof r=="object"&&"__error_marker"in r&&r.__error_marker==="$$error";Ct.DefaultSerializer={deserialize(r){return Dn(r)?$e.deserialize(r):r},serialize(r){return r instanceof Error?$e.serialize(r):r}},Object.defineProperty(nt,"__esModule",{value:!0}),nt.serialize=nt.deserialize=nt.registerSerializer=void 0;const Xe=Ct;let ie=Xe.DefaultSerializer;function Fn(r){ie=Xe.extendSerializer(ie,r)}nt.registerSerializer=Fn;function Hn(r){return ie.deserialize(r)}nt.deserialize=Hn;function Gn(r){return ie.serialize(r)}nt.serialize=Gn;var Ze={},ft={},Ht={};Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.getBundleURL=Ht.getBaseURL=void 0;let be;function Bn(){return be||(be=Vn()),be}Ht.getBundleURL=Bn;function Vn(){try{throw new Error}catch(r){const t=(""+r.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(t)return qe(t[0])}return"/"}function qe(r){return(""+r).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)?\/[^/]+(?:\?.*)?$/,"$1")+"/"}Ht.getBaseURL=qe,Object.defineProperty(ft,"__esModule",{value:!0}),ft.isWorkerRuntime=ft.getWorkerImplementation=ft.defaultPoolSize=void 0;const Qe=Ht;ft.defaultPoolSize=typeof navigator<"u"&&navigator.hardwareConcurrency?navigator.hardwareConcurrency:4;const Je=r=>/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(r);function tn(r){const t=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(t)}function Un(){if(typeof Worker>"u")return class{constructor(){throw Error("No web worker implementation available. You might have tried to spawn a worker within a worker in a browser that doesn't support workers in workers.")}};class r extends Worker{constructor(n,s){var i,a;typeof n=="string"&&s&&s._baseURL?n=new URL(n,s._baseURL):typeof n=="string"&&!Je(n)&&Qe.getBundleURL().match(/^file:\/\//i)&&(n=new URL(n,Qe.getBundleURL().replace(/\/[^\/]+$/,"/")),(!((i=s==null?void 0:s.CORSWorkaround)!==null&&i!==void 0)||i)&&(n=tn(`importScripts(${JSON.stringify(n)});`))),typeof n=="string"&&Je(n)&&(!((a=s==null?void 0:s.CORSWorkaround)!==null&&a!==void 0)||a)&&(n=tn(`importScripts(${JSON.stringify(n)});`)),super(n,s)}}class t extends r{constructor(n,s){const i=window.URL.createObjectURL(n);super(i,s)}static fromText(n,s){const i=new window.Blob([n],{type:"text/javascript"});return new t(i,s)}}return{blob:t,default:r}}let Me;function jn(){return Me||(Me=Un()),Me}ft.getWorkerImplementation=jn;function Wn(){const r=typeof self<"u"&&typeof Window<"u"&&self instanceof Window;return!!(typeof self<"u"&&self.postMessage&&!r)}ft.isWorkerRuntime=Wn;var en={},Gt={},Yn={get exports(){return Gt},set exports(r){Gt=r}},Se,nn;function Kn(){if(nn)return Se;nn=1;var r=1e3,t=r*60,e=t*60,n=e*24,s=n*7,i=n*365.25;Se=function(o,c){c=c||{};var d=typeof o;if(d==="string"&&o.length>0)return a(o);if(d==="number"&&isFinite(o))return c.long?h(o):u(o);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(o))};function a(o){if(o=String(o),!(o.length>100)){var c=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(o);if(c){var d=parseFloat(c[1]),f=(c[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return d*i;case"weeks":case"week":case"w":return d*s;case"days":case"day":case"d":return d*n;case"hours":case"hour":case"hrs":case"hr":case"h":return d*e;case"minutes":case"minute":case"mins":case"min":case"m":return d*t;case"seconds":case"second":case"secs":case"sec":case"s":return d*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return d;default:return}}}}function u(o){var c=Math.abs(o);return c>=n?Math.round(o/n)+"d":c>=e?Math.round(o/e)+"h":c>=t?Math.round(o/t)+"m":c>=r?Math.round(o/r)+"s":o+"ms"}function h(o){var c=Math.abs(o);return c>=n?l(o,c,n,"day"):c>=e?l(o,c,e,"hour"):c>=t?l(o,c,t,"minute"):c>=r?l(o,c,r,"second"):o+" ms"}function l(o,c,d,f){var _=c>=d*1.5;return Math.round(o/d)+" "+f+(_?"s":"")}return Se}function $n(r){e.debug=e,e.default=e,e.coerce=h,e.disable=i,e.enable=s,e.enabled=a,e.humanize=Kn(),e.destroy=l,Object.keys(r).forEach(o=>{e[o]=r[o]}),e.names=[],e.skips=[],e.formatters={};function t(o){let c=0;for(let d=0;d<o.length;d++)c=(c<<5)-c+o.charCodeAt(d),c|=0;return e.colors[Math.abs(c)%e.colors.length]}e.selectColor=t;function e(o){let c,d=null,f,_;function x(...w){if(!x.enabled)return;const b=x,g=Number(new Date),E=g-(c||g);b.diff=E,b.prev=c,b.curr=g,c=g,w[0]=e.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");let T=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,(y,I)=>{if(y==="%%")return"%";T++;const C=e.formatters[I];if(typeof C=="function"){const m=w[T];y=C.call(b,m),w.splice(T,1),T--}return y}),e.formatArgs.call(b,w),(b.log||e.log).apply(b,w)}return x.namespace=o,x.useColors=e.useColors(),x.color=e.selectColor(o),x.extend=n,x.destroy=e.destroy,Object.defineProperty(x,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(f!==e.namespaces&&(f=e.namespaces,_=e.enabled(o)),_),set:w=>{d=w}}),typeof e.init=="function"&&e.init(x),x}function n(o,c){const d=e(this.namespace+(typeof c>"u"?":":c)+o);return d.log=this.log,d}function s(o){e.save(o),e.namespaces=o,e.names=[],e.skips=[];let c;const d=(typeof o=="string"?o:"").split(/[\s,]+/),f=d.length;for(c=0;c<f;c++)d[c]&&(o=d[c].replace(/\*/g,".*?"),o[0]==="-"?e.skips.push(new RegExp("^"+o.slice(1)+"$")):e.names.push(new RegExp("^"+o+"$")))}function i(){const o=[...e.names.map(u),...e.skips.map(u).map(c=>"-"+c)].join(",");return e.enable(""),o}function a(o){if(o[o.length-1]==="*")return!0;let c,d;for(c=0,d=e.skips.length;c<d;c++)if(e.skips[c].test(o))return!1;for(c=0,d=e.names.length;c<d;c++)if(e.names[c].test(o))return!0;return!1}function u(o){return o.toString().substring(2,o.toString().length-2).replace(/\.\*\?$/,"*")}function h(o){return o instanceof Error?o.stack||o.message:o}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var Xn=$n;(function(r,t){t.formatArgs=n,t.save=s,t.load=i,t.useColors=e,t.storage=a(),t.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;h.splice(1,0,l,"color: inherit");let o=0,c=0;h[0].replace(/%[a-zA-Z%]/g,d=>{d!=="%%"&&(o++,d==="%c"&&(c=o))}),h.splice(c,0,l)}t.log=console.debug||console.log||(()=>{});function s(h){try{h?t.storage.setItem("debug",h):t.storage.removeItem("debug")}catch{}}function i(){let h;try{h=t.storage.getItem("debug")}catch{}return!h&&typeof process<"u"&&"env"in process&&(h={}.DEBUG),h}function a(){try{return localStorage}catch{}}r.exports=Xn(t);const{formatters:u}=r.exports;u.j=function(h){try{return JSON.stringify(h)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}})(Yn,Gt);var Zn=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})};class oe{constructor(t){this._baseObserver=t,this._pendingPromises=new Set}complete(){Promise.all(this._pendingPromises).then(()=>this._baseObserver.complete()).catch(t=>this._baseObserver.error(t))}error(t){this._baseObserver.error(t)}schedule(t){const e=Promise.all(this._pendingPromises),n=[],s=a=>n.push(a),i=Promise.resolve().then(()=>Zn(this,void 0,void 0,function*(){yield e,yield t(s),this._pendingPromises.delete(i);for(const a of n)this._baseObserver.next(a)})).catch(a=>{this._pendingPromises.delete(i),this._baseObserver.error(a)});this._pendingPromises.add(i)}}const rn=()=>typeof Symbol=="function",Xt=r=>rn()&&!!Symbol[r],we=r=>Xt(r)?Symbol[r]:"@@"+r;Xt("asyncIterator")||(Symbol.asyncIterator=Symbol.asyncIterator||Symbol.for("Symbol.asyncIterator"));const qn=we("iterator"),Te=we("observable"),sn=we("species");function ae(r,t){const e=r[t];if(e!=null){if(typeof e!="function")throw new TypeError(e+" is not a function");return e}}function Zt(r){let t=r.constructor;return t!==void 0&&(t=t[sn],t===null&&(t=void 0)),t!==void 0?t:rt}function Qn(r){return r instanceof rt}function Bt(r){Bt.log?Bt.log(r):setTimeout(()=>{throw r},0)}function ce(r){Promise.resolve().then(()=>{try{r()}catch(t){Bt(t)}})}function on(r){const t=r._cleanup;if(t!==void 0&&(r._cleanup=void 0,!!t))try{if(typeof t=="function")t();else{const e=ae(t,"unsubscribe");e&&e.call(t)}}catch(e){Bt(e)}}function xe(r){r._observer=void 0,r._queue=void 0,r._state="closed"}function Jn(r){const t=r._queue;if(t){r._queue=void 0,r._state="ready";for(const e of t)if(an(r,e.type,e.value),r._state==="closed")break}}function an(r,t,e){r._state="running";const n=r._observer;try{const s=n?ae(n,t):void 0;switch(t){case"next":s&&s.call(n,e);break;case"error":if(xe(r),s)s.call(n,e);else throw e;break;case"complete":xe(r),s&&s.call(n);break}}catch(s){Bt(s)}r._state==="closed"?on(r):r._state==="running"&&(r._state="ready")}function Ae(r,t,e){if(r._state!=="closed"){if(r._state==="buffering"){r._queue=r._queue||[],r._queue.push({type:t,value:e});return}if(r._state!=="ready"){r._state="buffering",r._queue=[{type:t,value:e}],ce(()=>Jn(r));return}an(r,t,e)}}class tr{constructor(t,e){this._cleanup=void 0,this._observer=t,this._queue=void 0,this._state="initializing";const n=new er(this);try{this._cleanup=e.call(void 0,n)}catch(s){n.error(s)}this._state==="initializing"&&(this._state="ready")}get closed(){return this._state==="closed"}unsubscribe(){this._state!=="closed"&&(xe(this),on(this))}}class er{constructor(t){this._subscription=t}get closed(){return this._subscription._state==="closed"}next(t){Ae(this._subscription,"next",t)}error(t){Ae(this._subscription,"error",t)}complete(){Ae(this._subscription,"complete")}}class rt{constructor(t){if(!(this instanceof rt))throw new TypeError("Observable cannot be called as a function");if(typeof t!="function")throw new TypeError("Observable initializer must be a function");this._subscriber=t}subscribe(t,e,n){return(typeof t!="object"||t===null)&&(t={next:t,error:e,complete:n}),new tr(t,this._subscriber)}pipe(t,...e){let n=this;for(const s of[t,...e])n=s(n);return n}tap(t,e,n){const s=typeof t!="object"||t===null?{next:t,error:e,complete:n}:t;return new rt(i=>this.subscribe({next(a){s.next&&s.next(a),i.next(a)},error(a){s.error&&s.error(a),i.error(a)},complete(){s.complete&&s.complete(),i.complete()},start(a){s.start&&s.start(a)}}))}forEach(t){return new Promise((e,n)=>{if(typeof t!="function"){n(new TypeError(t+" is not a function"));return}function s(){i.unsubscribe(),e(void 0)}const i=this.subscribe({next(a){try{t(a,s)}catch(u){n(u),i.unsubscribe()}},error(a){n(a)},complete(){e(void 0)}})})}map(t){if(typeof t!="function")throw new TypeError(t+" is not a function");const e=Zt(this);return new e(n=>this.subscribe({next(s){let i=s;try{i=t(s)}catch(a){return n.error(a)}n.next(i)},error(s){n.error(s)},complete(){n.complete()}}))}filter(t){if(typeof t!="function")throw new TypeError(t+" is not a function");const e=Zt(this);return new e(n=>this.subscribe({next(s){try{if(!t(s))return}catch(i){return n.error(i)}n.next(s)},error(s){n.error(s)},complete(){n.complete()}}))}reduce(t,e){if(typeof t!="function")throw new TypeError(t+" is not a function");const n=Zt(this),s=arguments.length>1;let i=!1,a=e;return new n(u=>this.subscribe({next(h){const l=!i;if(i=!0,!l||s)try{a=t(a,h)}catch(o){return u.error(o)}else a=h},error(h){u.error(h)},complete(){if(!i&&!s)return u.error(new TypeError("Cannot reduce an empty sequence"));u.next(a),u.complete()}}))}concat(...t){const e=Zt(this);return new e(n=>{let s,i=0;function a(u){s=u.subscribe({next(h){n.next(h)},error(h){n.error(h)},complete(){i===t.length?(s=void 0,n.complete()):a(e.from(t[i++]))}})}return a(this),()=>{s&&(s.unsubscribe(),s=void 0)}})}flatMap(t){if(typeof t!="function")throw new TypeError(t+" is not a function");const e=Zt(this);return new e(n=>{const s=[],i=this.subscribe({next(u){let h;if(t)try{h=t(u)}catch(o){return n.error(o)}else h=u;const l=e.from(h).subscribe({next(o){n.next(o)},error(o){n.error(o)},complete(){const o=s.indexOf(l);o>=0&&s.splice(o,1),a()}});s.push(l)},error(u){n.error(u)},complete(){a()}});function a(){i.closed&&s.length===0&&n.complete()}return()=>{s.forEach(u=>u.unsubscribe()),i.unsubscribe()}})}[Te](){return this}static from(t){const e=typeof this=="function"?this:rt;if(t==null)throw new TypeError(t+" is not an object");const n=ae(t,Te);if(n){const s=n.call(t);if(Object(s)!==s)throw new TypeError(s+" is not an object");return Qn(s)&&s.constructor===e?s:new e(i=>s.subscribe(i))}if(Xt("iterator")){const s=ae(t,qn);if(s)return new e(i=>{ce(()=>{if(!i.closed){for(const a of s.call(t))if(i.next(a),i.closed)return;i.complete()}})})}if(Array.isArray(t))return new e(s=>{ce(()=>{if(!s.closed){for(const i of t)if(s.next(i),s.closed)return;s.complete()}})});throw new TypeError(t+" is not observable")}static of(...t){const e=typeof this=="function"?this:rt;return new e(n=>{ce(()=>{if(!n.closed){for(const s of t)if(n.next(s),n.closed)return;n.complete()}})})}static get[sn](){return this}}rn()&&Object.defineProperty(rt,Symbol("extensions"),{value:{symbol:Te,hostReportError:Bt},configurable:!0});var Lt=rt;function kt(r){typeof r=="function"?r():r&&typeof r.unsubscribe=="function"&&r.unsubscribe()}var nr=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})};function rr(r){return t=>new Lt(e=>{const n=new oe(e),s=t.subscribe({complete(){n.complete()},error(i){n.error(i)},next(i){n.schedule(a=>nr(this,void 0,void 0,function*(){(yield r(i))&&a(i)}))}});return()=>kt(s)})}function sr(r){return r&&Xt("asyncIterator")&&r[Symbol.asyncIterator]}function ir(r){return r&&Xt("iterator")&&r[Symbol.iterator]}var or=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})},ar=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=r[Symbol.asyncIterator],e;return t?t.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(i){e[i]=r[i]&&function(a){return new Promise(function(u,h){a=r[i](a),s(u,h,a.done,a.value)})}}function s(i,a,u,h){Promise.resolve(h).then(function(l){i({value:l,done:u})},a)}};function cr(r){return t=>new Lt(e=>{const n=new oe(e),s=t.subscribe({complete(){n.complete()},error(i){n.error(i)},next(i){n.schedule(a=>or(this,void 0,void 0,function*(){var u,h;const l=yield r(i);if(ir(l)||sr(l))try{for(var o=ar(l),c;c=yield o.next(),!c.done;){const d=c.value;a(d)}}catch(d){u={error:d}}finally{try{c&&!c.done&&(h=o.return)&&(yield h.call(o))}finally{if(u)throw u.error}}else l.map(d=>a(d))}))}});return()=>kt(s)})}function ur(r){return new rt(t=>{let e=0;const n=setInterval(()=>{t.next(e++)},r);return()=>clearInterval(n)})}var lr=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})};function hr(r){return t=>new Lt(e=>{const n=new oe(e),s=t.subscribe({complete(){n.complete()},error(i){n.error(i)},next(i){n.schedule(a=>lr(this,void 0,void 0,function*(){const u=yield r(i);a(u)}))}});return()=>kt(s)})}function dr(...r){return r.length===0?rt.from([]):new rt(t=>{let e=0;const n=r.map(i=>i.subscribe({error(a){t.error(a),s()},next(a){t.next(a)},complete(){++e===r.length&&(t.complete(),s())}})),s=()=>{n.forEach(i=>kt(i))};return s})}class fr extends Lt{constructor(){super(t=>(this._observers.add(t),()=>this._observers.delete(t))),this._observers=new Set}next(t){for(const e of this._observers)e.next(t)}error(t){for(const e of this._observers)e.error(t)}complete(){for(const t of this._observers)t.complete()}}var cn=fr;function mr(r){const t=new cn;let e,n=0;return new Lt(s=>{e||(e=r.subscribe(t));const i=t.subscribe(s);return n++,()=>{n--,i.unsubscribe(),n===0&&(kt(e),e=void 0)}})}var pr=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})};function _r(r,t){return e=>new Lt(n=>{let s,i=0;const a=new oe(n),u=e.subscribe({complete(){a.complete()},error(h){a.error(h)},next(h){a.schedule(l=>pr(this,void 0,void 0,function*(){s=yield r(i===0?typeof t>"u"?h:t:s,h,i++),l(s)}))}});return()=>kt(u)})}var yr=Object.freeze({__proto__:null,Observable:Lt,Subject:cn,filter:rr,flatMap:cr,interval:ur,map:hr,merge:dr,multicast:mr,scan:_r,unsubscribe:kt}),ue=vt(yr),le={};Object.defineProperty(le,"__esModule",{value:!0}),le.allSettled=void 0;function Er(r){return Promise.all(r.map(t=>{const e=i=>({status:"fulfilled",value:i}),n=i=>({status:"rejected",reason:i}),s=Promise.resolve(t);try{return s.then(e,n)}catch(i){return Promise.reject(i)}}))}le.allSettled=Er;var un={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.PoolEventType=void 0,function(t){t.initialized="initialized",t.taskCanceled="taskCanceled",t.taskCompleted="taskCompleted",t.taskFailed="taskFailed",t.taskQueued="taskQueued",t.taskQueueDrained="taskQueueDrained",t.taskStart="taskStart",t.terminated="terminated"}(r.PoolEventType||(r.PoolEventType={}))})(un);var qt={},Z={};Object.defineProperty(Z,"__esModule",{value:!0}),Z.$worker=Z.$transferable=Z.$terminate=Z.$events=Z.$errors=void 0,Z.$errors=Symbol("thread.errors"),Z.$events=Symbol("thread.events"),Z.$terminate=Symbol("thread.terminate"),Z.$transferable=Symbol("thread.transferable"),Z.$worker=Symbol("thread.worker"),Object.defineProperty(qt,"__esModule",{value:!0}),qt.Thread=void 0;const Ie=Z;function ln(r){throw Error(r)}qt.Thread={errors(r){return r[Ie.$errors]||ln("Error observable not found. Make sure to pass a thread instance as returned by the spawn() promise.")},events(r){return r[Ie.$events]||ln("Events observable not found. Make sure to pass a thread instance as returned by the spawn() promise.")},terminate(r){return r[Ie.$terminate]()}},function(r){var t=F&&F.__awaiter||function(b,g,E,T){function M(y){return y instanceof E?y:new E(function(I){I(y)})}return new(E||(E=Promise))(function(y,I){function C(A){try{S(T.next(A))}catch(v){I(v)}}function m(A){try{S(T.throw(A))}catch(v){I(v)}}function S(A){A.done?y(A.value):M(A.value).then(C,m)}S((T=T.apply(b,g||[])).next())})},e=F&&F.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(r,"__esModule",{value:!0}),r.Pool=r.Thread=r.PoolEventType=void 0;const n=e(Gt),s=ue,i=le,a=ft,u=un;Object.defineProperty(r,"PoolEventType",{enumerable:!0,get:function(){return u.PoolEventType}});const h=qt;Object.defineProperty(r,"Thread",{enumerable:!0,get:function(){return h.Thread}});let l=1;function o(b){const g=[];for(let E=0;E<b;E++)g.push(E);return g}function c(b){return new Promise(g=>setTimeout(g,b))}function d(b,g){return b.reduce((E,T)=>[...E,...g(T)],[])}function f(b){return b.replace(/\W/g," ").trim().replace(/\s+/g,"-")}function _(b,g){return o(g).map(()=>({init:b(),runningTasks:[]}))}class x{constructor(g,E){this.eventSubject=new s.Subject,this.initErrors=[],this.isClosing=!1,this.nextTaskID=1,this.taskQueue=[];const T=typeof E=="number"?{size:E}:E||{},{size:M=a.defaultPoolSize}=T;this.debug=n.default(`threads:pool:${f(T.name||String(l++))}`),this.options=T,this.workers=_(g,M),this.eventObservable=s.multicast(s.Observable.from(this.eventSubject)),Promise.all(this.workers.map(y=>y.init)).then(()=>this.eventSubject.next({type:u.PoolEventType.initialized,size:this.workers.length}),y=>{this.debug("Error while initializing pool worker:",y),this.eventSubject.error(y),this.initErrors.push(y)})}findIdlingWorker(){const{concurrency:g=1}=this.options;return this.workers.find(E=>E.runningTasks.length<g)}runPoolTask(g,E){return t(this,void 0,void 0,function*(){const T=this.workers.indexOf(g)+1;this.debug(`Running task #${E.id} on worker #${T}...`),this.eventSubject.next({type:u.PoolEventType.taskStart,taskID:E.id,workerID:T});try{const M=yield E.run(yield g.init);this.debug(`Task #${E.id} completed successfully`),this.eventSubject.next({type:u.PoolEventType.taskCompleted,returnValue:M,taskID:E.id,workerID:T})}catch(M){this.debug(`Task #${E.id} failed`),this.eventSubject.next({type:u.PoolEventType.taskFailed,taskID:E.id,error:M,workerID:T})}})}run(g,E){return t(this,void 0,void 0,function*(){const T=(()=>t(this,void 0,void 0,function*(){const M=()=>{g.runningTasks=g.runningTasks.filter(y=>y!==T)};yield c(0);try{yield this.runPoolTask(g,E)}finally{M(),this.isClosing||this.scheduleWork()}}))();g.runningTasks.push(T)})}scheduleWork(){this.debug("Attempt de-queueing a task in order to run it...");const g=this.findIdlingWorker();if(!g)return;const E=this.taskQueue.shift();if(!E){this.debug("Task queue is empty"),this.eventSubject.next({type:u.PoolEventType.taskQueueDrained});return}this.run(g,E)}taskCompletion(g){return new Promise((E,T)=>{const M=this.events().subscribe(y=>{y.type===u.PoolEventType.taskCompleted&&y.taskID===g?(M.unsubscribe(),E(y.returnValue)):y.type===u.PoolEventType.taskFailed&&y.taskID===g?(M.unsubscribe(),T(y.error)):y.type===u.PoolEventType.terminated&&(M.unsubscribe(),T(Error("Pool has been terminated before task was run.")))})})}settled(g=!1){return t(this,void 0,void 0,function*(){const E=()=>d(this.workers,y=>y.runningTasks),T=[],M=this.eventObservable.subscribe(y=>{y.type===u.PoolEventType.taskFailed&&T.push(y.error)});return this.initErrors.length>0?Promise.reject(this.initErrors[0]):g&&this.taskQueue.length===0?(yield i.allSettled(E()),T):(yield new Promise((y,I)=>{const C=this.eventObservable.subscribe({next(m){m.type===u.PoolEventType.taskQueueDrained&&(C.unsubscribe(),y(void 0))},error:I})}),yield i.allSettled(E()),M.unsubscribe(),T)})}completed(g=!1){return t(this,void 0,void 0,function*(){const E=this.settled(g),T=new Promise((y,I)=>{const C=this.eventObservable.subscribe({next(m){m.type===u.PoolEventType.taskQueueDrained?(C.unsubscribe(),y(E)):m.type===u.PoolEventType.taskFailed&&(C.unsubscribe(),I(m.error))},error:I})}),M=yield Promise.race([E,T]);if(M.length>0)throw M[0]})}events(){return this.eventObservable}queue(g){const{maxQueuedJobs:E=1/0}=this.options;if(this.isClosing)throw Error("Cannot schedule pool tasks after terminate() has been called.");if(this.initErrors.length>0)throw this.initErrors[0];const T=this.nextTaskID++,M=this.taskCompletion(T);M.catch(I=>{this.debug(`Task #${T} errored:`,I)});const y={id:T,run:g,cancel:()=>{this.taskQueue.indexOf(y)!==-1&&(this.taskQueue=this.taskQueue.filter(I=>I!==y),this.eventSubject.next({type:u.PoolEventType.taskCanceled,taskID:y.id}))},then:M.then.bind(M)};if(this.taskQueue.length>=E)throw Error(`Maximum number of pool tasks queued. Refusing to queue another one.
This usually happens for one of two reasons: We are either at peak workload right now or some tasks just won't finish, thus blocking the pool.`);return this.debug(`Queueing task #${y.id}...`),this.taskQueue.push(y),this.eventSubject.next({type:u.PoolEventType.taskQueued,taskID:y.id}),this.scheduleWork(),y}terminate(g){return t(this,void 0,void 0,function*(){this.isClosing=!0,g||(yield this.completed(!0)),this.eventSubject.next({type:u.PoolEventType.terminated,remainingQueue:[...this.taskQueue]}),this.eventSubject.complete(),yield Promise.all(this.workers.map(E=>t(this,void 0,void 0,function*(){return h.Thread.terminate(yield E.init)})))})}}x.EventType=u.PoolEventType;function w(b,g){return new x(b,g)}w.EventType=u.PoolEventType,r.Pool=w}(en);var he={},de={};Object.defineProperty(de,"__esModule",{value:!0}),de.createPromiseWithResolver=void 0;const gr=()=>{};function br(){let r=!1,t,e=gr;return[new Promise(i=>{r?i(t):e=i}),i=>{r=!0,t=i,e(t)}]}de.createPromiseWithResolver=br;var hn={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WorkerEventType=void 0,function(t){t.internalError="internalError",t.message="message",t.termination="termination"}(r.WorkerEventType||(r.WorkerEventType={}))})(hn);var Vt={},fe={};Object.defineProperty(fe,"__esModule",{value:!0}),fe.ObservablePromise=void 0;const Mr=ue,Sr=()=>{},wr=r=>r,dn=r=>Promise.resolve().then(r);function Tr(r){throw r}function xr(r){return r&&typeof r.then=="function"}class Ne extends Mr.Observable{constructor(t){super(e=>{const n=this,s=Object.assign(Object.assign({},e),{complete(){e.complete(),n.onCompletion()},error(i){e.error(i),n.onError(i)},next(i){e.next(i),n.onNext(i)}});try{return this.initHasRun=!0,t(s)}catch(i){s.error(i)}}),this.initHasRun=!1,this.fulfillmentCallbacks=[],this.rejectionCallbacks=[],this.firstValueSet=!1,this.state="pending"}onNext(t){this.firstValueSet||(this.firstValue=t,this.firstValueSet=!0)}onError(t){this.state="rejected",this.rejection=t;for(const e of this.rejectionCallbacks)dn(()=>e(t))}onCompletion(){this.state="fulfilled";for(const t of this.fulfillmentCallbacks)dn(()=>t(this.firstValue))}then(t,e){const n=t||wr,s=e||Tr;let i=!1;return new Promise((a,u)=>{const h=o=>{if(!i){i=!0;try{a(s(o))}catch(c){u(c)}}},l=o=>{try{a(n(o))}catch(c){h(c)}};if(this.initHasRun||this.subscribe({error:h}),this.state==="fulfilled")return a(n(this.firstValue));if(this.state==="rejected")return i=!0,a(s(this.rejection));this.fulfillmentCallbacks.push(l),this.rejectionCallbacks.push(h)})}catch(t){return this.then(void 0,t)}finally(t){const e=t||Sr;return this.then(n=>(e(),n),()=>e())}static from(t){return xr(t)?new Ne(e=>{const n=i=>{e.next(i),e.complete()},s=i=>{e.error(i)};t.then(n,s)}):super.from(t)}}fe.ObservablePromise=Ne;var mt={};Object.defineProperty(mt,"__esModule",{value:!0}),mt.Transfer=mt.isTransferDescriptor=void 0;const fn=Z;function Ar(r){return!(!r||typeof r!="object")}function Ir(r){return r&&typeof r=="object"&&r[fn.$transferable]}mt.isTransferDescriptor=Ir;function Nr(r,t){if(!t){if(!Ar(r))throw Error();t=[r]}return{[fn.$transferable]:!0,send:r,transferables:t}}mt.Transfer=Nr;var ve={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WorkerMessageType=r.MasterMessageType=void 0,function(t){t.cancel="cancel",t.run="run"}(r.MasterMessageType||(r.MasterMessageType={})),function(t){t.error="error",t.init="init",t.result="result",t.running="running",t.uncaughtError="uncaughtError"}(r.WorkerMessageType||(r.WorkerMessageType={}))})(ve);var vr=F&&F.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.createProxyModule=Vt.createProxyFunction=void 0;const Cr=vr(Gt),mn=ue,Qt=nt,pn=fe,Lr=mt,Jt=ve,_n=Cr.default("threads:master:messages");let kr=1;const Or=r=>Array.from(new Set(r)),Rr=r=>r&&r.type===Jt.WorkerMessageType.error,zr=r=>r&&r.type===Jt.WorkerMessageType.result,Pr=r=>r&&r.type===Jt.WorkerMessageType.running;function Dr(r,t){return new mn.Observable(e=>{let n;const s=i=>{if(_n("Message from worker:",i.data),!(!i.data||i.data.uid!==t)){if(Pr(i.data))n=i.data.resultType;else if(zr(i.data))n==="promise"?(typeof i.data.payload<"u"&&e.next(Qt.deserialize(i.data.payload)),e.complete(),r.removeEventListener("message",s)):(i.data.payload&&e.next(Qt.deserialize(i.data.payload)),i.data.complete&&(e.complete(),r.removeEventListener("message",s)));else if(Rr(i.data)){const a=Qt.deserialize(i.data.error);e.error(a),r.removeEventListener("message",s)}}};return r.addEventListener("message",s),()=>{if(n==="observable"||!n){const i={type:Jt.MasterMessageType.cancel,uid:t};r.postMessage(i)}r.removeEventListener("message",s)}})}function Fr(r){if(r.length===0)return{args:[],transferables:[]};const t=[],e=[];for(const n of r)Lr.isTransferDescriptor(n)?(t.push(Qt.serialize(n.send)),e.push(...n.transferables)):t.push(Qt.serialize(n));return{args:t,transferables:e.length===0?e:Or(e)}}function yn(r,t){return(...e)=>{const n=kr++,{args:s,transferables:i}=Fr(e),a={type:Jt.MasterMessageType.run,uid:n,method:t,args:s};_n("Sending command to run function to worker:",a);try{r.postMessage(a,i)}catch(u){return pn.ObservablePromise.from(Promise.reject(u))}return pn.ObservablePromise.from(mn.multicast(Dr(r,n)))}}Vt.createProxyFunction=yn;function Hr(r,t){const e={};for(const n of t)e[n]=yn(r,n);return e}Vt.createProxyModule=Hr;var Ce=F&&F.__awaiter||function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})},Gr=F&&F.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(he,"__esModule",{value:!0}),he.spawn=void 0;const Le=Gr(Gt),Br=ue,Vr=nt,Ur=de,me=Z,pe=hn,En=Vt,jr=Le.default("threads:master:messages"),Wr=Le.default("threads:master:spawn"),gn=Le.default("threads:master:thread-utils"),Yr=r=>r&&r.type==="init",Kr=r=>r&&r.type==="uncaughtError",$r=typeof process<"u"&&{}.THREADS_WORKER_INIT_TIMEOUT?Number.parseInt({}.THREADS_WORKER_INIT_TIMEOUT,10):1e4;function Xr(r,t,e){return Ce(this,void 0,void 0,function*(){let n;const s=new Promise((a,u)=>{n=setTimeout(()=>u(Error(e)),t)}),i=yield Promise.race([r,s]);return clearTimeout(n),i})}function Zr(r){return new Promise((t,e)=>{const n=s=>{jr("Message from worker before finishing initialization:",s.data),Yr(s.data)?(r.removeEventListener("message",n),t(s.data)):Kr(s.data)&&(r.removeEventListener("message",n),e(Vr.deserialize(s.data.error)))};r.addEventListener("message",n)})}function qr(r,t){return new Br.Observable(e=>{const n=i=>{const a={type:pe.WorkerEventType.message,data:i.data};e.next(a)},s=i=>{gn("Unhandled promise rejection event in thread:",i);const a={type:pe.WorkerEventType.internalError,error:Error(i.reason)};e.next(a)};r.addEventListener("message",n),r.addEventListener("unhandledrejection",s),t.then(()=>{const i={type:pe.WorkerEventType.termination};r.removeEventListener("message",n),r.removeEventListener("unhandledrejection",s),e.next(i),e.complete()})})}function Qr(r){const[t,e]=Ur.createPromiseWithResolver();return{terminate:()=>Ce(this,void 0,void 0,function*(){gn("Terminating worker"),yield r.terminate(),e()}),termination:t}}function bn(r,t,e,n){const s=e.filter(i=>i.type===pe.WorkerEventType.internalError).map(i=>i.error);return Object.assign(r,{[me.$errors]:s,[me.$events]:e,[me.$terminate]:n,[me.$worker]:t})}function Jr(r,t){return Ce(this,void 0,void 0,function*(){Wr("Initializing new thread");const e=t&&t.timeout?t.timeout:$r,s=(yield Xr(Zr(r),e,`Timeout: Did not receive an init message from worker after ${e}ms. Make sure the worker calls expose().`)).exposed,{termination:i,terminate:a}=Qr(r),u=qr(r,i);if(s.type==="function"){const h=En.createProxyFunction(r);return bn(h,r,u,a)}else if(s.type==="module"){const h=En.createProxyModule(r,s.methods);return bn(h,r,u,a)}else{const h=s.type;throw Error(`Worker init message states unexpected type of expose(): ${h}`)}})}he.spawn=Jr,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.Worker=r.BlobWorker=r.isWorkerRuntime=r.Thread=r.spawn=r.Pool=void 0;const t=ft;Object.defineProperty(r,"isWorkerRuntime",{enumerable:!0,get:function(){return t.isWorkerRuntime}});var e=en;Object.defineProperty(r,"Pool",{enumerable:!0,get:function(){return e.Pool}});var n=he;Object.defineProperty(r,"spawn",{enumerable:!0,get:function(){return n.spawn}});var s=qt;Object.defineProperty(r,"Thread",{enumerable:!0,get:function(){return s.Thread}}),r.BlobWorker=t.getWorkerImplementation().blob,r.Worker=t.getWorkerImplementation().default}(Ze);var ke={},ts=r=>r?typeof Symbol.observable=="symbol"&&typeof r[Symbol.observable]=="function"?r===r[Symbol.observable]():typeof r["@@observable"]=="function"?r===r["@@observable"]():!1:!1,Oe={};Object.defineProperty(Oe,"__esModule",{value:!0});const es=function(){const t=typeof self<"u"&&typeof Window<"u"&&self instanceof Window;return!!(typeof self<"u"&&self.postMessage&&!t)},ns=function(t,e){self.postMessage(t,e)},rs=function(t){const e=s=>{t(s.data)},n=()=>{self.removeEventListener("message",e)};return self.addEventListener("message",e),n};Oe.default={isWorkerRuntime:es,postMessageToMaster:ns,subscribeToMasterMessages:rs},function(r){var t=F&&F.__awaiter||function(m,S,A,v){function k(O){return O instanceof A?O:new A(function(z){z(O)})}return new(A||(A=Promise))(function(O,z){function U(Y){try{et(v.next(Y))}catch($){z($)}}function j(Y){try{et(v.throw(Y))}catch($){z($)}}function et(Y){Y.done?O(Y.value):k(Y.value).then(U,j)}et((v=v.apply(m,S||[])).next())})},e=F&&F.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};Object.defineProperty(r,"__esModule",{value:!0}),r.expose=r.isWorkerRuntime=r.Transfer=r.registerSerializer=void 0;const n=e(ts),s=nt,i=mt,a=ve,u=e(Oe);var h=nt;Object.defineProperty(r,"registerSerializer",{enumerable:!0,get:function(){return h.registerSerializer}});var l=mt;Object.defineProperty(r,"Transfer",{enumerable:!0,get:function(){return l.Transfer}}),r.isWorkerRuntime=u.default.isWorkerRuntime;let o=!1;const c=new Map,d=m=>m&&m.type===a.MasterMessageType.cancel,f=m=>m&&m.type===a.MasterMessageType.run,_=m=>n.default(m)||x(m);function x(m){return m&&typeof m=="object"&&typeof m.subscribe=="function"}function w(m){return i.isTransferDescriptor(m)?{payload:m.send,transferables:m.transferables}:{payload:m,transferables:void 0}}function b(){const m={type:a.WorkerMessageType.init,exposed:{type:"function"}};u.default.postMessageToMaster(m)}function g(m){const S={type:a.WorkerMessageType.init,exposed:{type:"module",methods:m}};u.default.postMessageToMaster(S)}function E(m,S){const{payload:A,transferables:v}=w(S),k={type:a.WorkerMessageType.error,uid:m,error:s.serialize(A)};u.default.postMessageToMaster(k,v)}function T(m,S,A){const{payload:v,transferables:k}=w(A),O={type:a.WorkerMessageType.result,uid:m,complete:S?!0:void 0,payload:v};u.default.postMessageToMaster(O,k)}function M(m,S){const A={type:a.WorkerMessageType.running,uid:m,resultType:S};u.default.postMessageToMaster(A)}function y(m){try{const S={type:a.WorkerMessageType.uncaughtError,error:s.serialize(m)};u.default.postMessageToMaster(S)}catch(S){console.error(`Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.
Latest error:`,S,`
Original error:`,m)}}function I(m,S,A){return t(this,void 0,void 0,function*(){let v;try{v=S(...A)}catch(O){return E(m,O)}const k=_(v)?"observable":"promise";if(M(m,k),_(v)){const O=v.subscribe(z=>T(m,!1,s.serialize(z)),z=>{E(m,s.serialize(z)),c.delete(m)},()=>{T(m,!0),c.delete(m)});c.set(m,O)}else try{const O=yield v;T(m,!0,s.serialize(O))}catch(O){E(m,s.serialize(O))}})}function C(m){if(!u.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(o)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(o=!0,typeof m=="function")u.default.subscribeToMasterMessages(S=>{f(S)&&!S.method&&I(S.uid,m,S.args.map(s.deserialize))}),b();else if(typeof m=="object"&&m){u.default.subscribeToMasterMessages(A=>{f(A)&&A.method&&I(A.uid,m[A.method],A.args.map(s.deserialize))});const S=Object.keys(m).filter(A=>typeof m[A]=="function");g(S)}else throw Error(`Invalid argument passed to expose(). Expected a function or an object, got: ${m}`);u.default.subscribeToMasterMessages(S=>{if(d(S)){const A=S.uid,v=c.get(A);v&&(v.unsubscribe(),c.delete(A))}})}r.expose=C,typeof self<"u"&&typeof self.addEventListener=="function"&&u.default.isWorkerRuntime()&&(self.addEventListener("error",m=>{setTimeout(()=>y(m.error||m),250)}),self.addEventListener("unhandledrejection",m=>{const S=m.reason;S&&typeof S.message=="string"&&setTimeout(()=>y(S),250)})),typeof process<"u"&&typeof process.on=="function"&&u.default.isWorkerRuntime()&&(process.on("uncaughtException",m=>{setTimeout(()=>y(m),250)}),process.on("unhandledRejection",m=>{m&&typeof m.message=="string"&&setTimeout(()=>y(m),250)}))}(ke);var Re=at(ke);(function(r){var t=F&&F.__createBinding||(Object.create?function(u,h,l,o){o===void 0&&(o=l),Object.defineProperty(u,o,{enumerable:!0,get:function(){return h[l]}})}:function(u,h,l,o){o===void 0&&(o=l),u[o]=h[l]}),e=F&&F.__exportStar||function(u,h){for(var l in u)l!=="default"&&!Object.prototype.hasOwnProperty.call(h,l)&&t(h,u,l)};Object.defineProperty(r,"__esModule",{value:!0}),r.Transfer=r.DefaultSerializer=r.expose=r.registerSerializer=void 0;var n=nt;Object.defineProperty(r,"registerSerializer",{enumerable:!0,get:function(){return n.registerSerializer}}),e(Ze,r);var s=ke;Object.defineProperty(r,"expose",{enumerable:!0,get:function(){return s.expose}});var i=Ct;Object.defineProperty(r,"DefaultSerializer",{enumerable:!0,get:function(){return i.DefaultSerializer}});var a=mt;Object.defineProperty(r,"Transfer",{enumerable:!0,get:function(){return a.Transfer}})})(Ke);var gt=at(Ke);gt.registerSerializer,gt.spawn,gt.BlobWorker,gt.DefaultSerializer,gt.Pool,gt.Thread;const ss=gt.Transfer;gt.Worker;const is=Re.expose;Re.registerSerializer,Re.Transfer;/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Mn="148",K=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Sn=1234567;const wn=Math.PI/180,Tn=180/Math.PI;function os(){const r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(K[r&255]+K[r>>8&255]+K[r>>16&255]+K[r>>24&255]+"-"+K[t&255]+K[t>>8&255]+"-"+K[t>>16&15|64]+K[t>>24&255]+"-"+K[e&63|128]+K[e>>8&255]+"-"+K[e>>16&255]+K[e>>24&255]+K[n&255]+K[n>>8&255]+K[n>>16&255]+K[n>>24&255]).toLowerCase()}function ze(r,t,e){return Math.max(t,Math.min(e,r))}function xn(r,t){return(r%t+t)%t}function as(r,t,e,n,s){return n+(r-t)*(s-n)/(e-t)}function cs(r,t,e){return r!==t?(e-r)/(t-r):0}function An(r,t,e){return(1-e)*r+e*t}function us(r,t,e,n){return An(r,t,1-Math.exp(-e*n))}function ls(r,t=1){return t-Math.abs(xn(r,t*2)-t)}function hs(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*(3-2*r))}function ds(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*r*(r*(r*6-15)+10))}function fs(r,t){return r+Math.floor(Math.random()*(t-r+1))}function ms(r,t){return r+Math.random()*(t-r)}function ps(r){return r*(.5-Math.random())}function _s(r){r!==void 0&&(Sn=r);let t=Sn+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function ys(r){return r*wn}function Es(r){return r*Tn}function gs(r){return(r&r-1)===0&&r!==0}function bs(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Ms(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function Ss(r,t,e,n,s){const i=Math.cos,a=Math.sin,u=i(e/2),h=a(e/2),l=i((t+n)/2),o=a((t+n)/2),c=i((t-n)/2),d=a((t-n)/2),f=i((n-t)/2),_=a((n-t)/2);switch(s){case"XYX":r.set(u*o,h*c,h*d,u*l);break;case"YZY":r.set(h*d,u*o,h*c,u*l);break;case"ZXZ":r.set(h*c,h*d,u*o,u*l);break;case"XZX":r.set(u*o,h*_,h*f,u*l);break;case"YXY":r.set(h*f,u*o,h*_,u*l);break;case"ZYZ":r.set(h*_,h*f,u*o,u*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function ws(r,t){switch(t.constructor){case Float32Array:return r;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function Ts(r,t){switch(t.constructor){case Float32Array:return r;case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}var Pe=Object.freeze({__proto__:null,DEG2RAD:wn,RAD2DEG:Tn,generateUUID:os,clamp:ze,euclideanModulo:xn,mapLinear:as,inverseLerp:cs,lerp:An,damp:us,pingpong:ls,smoothstep:hs,smootherstep:ds,randInt:fs,randFloat:ms,randFloatSpread:ps,seededRandom:_s,degToRad:ys,radToDeg:Es,isPowerOfTwo:gs,ceilPowerOfTwo:bs,floorPowerOfTwo:Ms,setQuaternionFromProperEuler:Ss,normalize:Ts,denormalize:ws});class xs{constructor(t=0,e=0,n=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=s}static slerpFlat(t,e,n,s,i,a,u){let h=n[s+0],l=n[s+1],o=n[s+2],c=n[s+3];const d=i[a+0],f=i[a+1],_=i[a+2],x=i[a+3];if(u===0){t[e+0]=h,t[e+1]=l,t[e+2]=o,t[e+3]=c;return}if(u===1){t[e+0]=d,t[e+1]=f,t[e+2]=_,t[e+3]=x;return}if(c!==x||h!==d||l!==f||o!==_){let w=1-u;const b=h*d+l*f+o*_+c*x,g=b>=0?1:-1,E=1-b*b;if(E>Number.EPSILON){const M=Math.sqrt(E),y=Math.atan2(M,b*g);w=Math.sin(w*y)/M,u=Math.sin(u*y)/M}const T=u*g;if(h=h*w+d*T,l=l*w+f*T,o=o*w+_*T,c=c*w+x*T,w===1-u){const M=1/Math.sqrt(h*h+l*l+o*o+c*c);h*=M,l*=M,o*=M,c*=M}}t[e]=h,t[e+1]=l,t[e+2]=o,t[e+3]=c}static multiplyQuaternionsFlat(t,e,n,s,i,a){const u=n[s],h=n[s+1],l=n[s+2],o=n[s+3],c=i[a],d=i[a+1],f=i[a+2],_=i[a+3];return t[e]=u*_+o*c+h*f-l*d,t[e+1]=h*_+o*d+l*c-u*f,t[e+2]=l*_+o*f+u*d-h*c,t[e+3]=o*_-u*c-h*d-l*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,s){return this._x=t,this._y=e,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const n=t._x,s=t._y,i=t._z,a=t._order,u=Math.cos,h=Math.sin,l=u(n/2),o=u(s/2),c=u(i/2),d=h(n/2),f=h(s/2),_=h(i/2);switch(a){case"XYZ":this._x=d*o*c+l*f*_,this._y=l*f*c-d*o*_,this._z=l*o*_+d*f*c,this._w=l*o*c-d*f*_;break;case"YXZ":this._x=d*o*c+l*f*_,this._y=l*f*c-d*o*_,this._z=l*o*_-d*f*c,this._w=l*o*c+d*f*_;break;case"ZXY":this._x=d*o*c-l*f*_,this._y=l*f*c+d*o*_,this._z=l*o*_+d*f*c,this._w=l*o*c-d*f*_;break;case"ZYX":this._x=d*o*c-l*f*_,this._y=l*f*c+d*o*_,this._z=l*o*_-d*f*c,this._w=l*o*c+d*f*_;break;case"YZX":this._x=d*o*c+l*f*_,this._y=l*f*c+d*o*_,this._z=l*o*_-d*f*c,this._w=l*o*c-d*f*_;break;case"XZY":this._x=d*o*c-l*f*_,this._y=l*f*c-d*o*_,this._z=l*o*_+d*f*c,this._w=l*o*c+d*f*_;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,s=Math.sin(n);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],s=e[4],i=e[8],a=e[1],u=e[5],h=e[9],l=e[2],o=e[6],c=e[10],d=n+u+c;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(o-h)*f,this._y=(i-l)*f,this._z=(a-s)*f}else if(n>u&&n>c){const f=2*Math.sqrt(1+n-u-c);this._w=(o-h)/f,this._x=.25*f,this._y=(s+a)/f,this._z=(i+l)/f}else if(u>c){const f=2*Math.sqrt(1+u-n-c);this._w=(i-l)/f,this._x=(s+a)/f,this._y=.25*f,this._z=(h+o)/f}else{const f=2*Math.sqrt(1+c-n-u);this._w=(a-s)/f,this._x=(i+l)/f,this._y=(h+o)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ze(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(n===0)return this;const s=Math.min(1,e/n);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,s=t._y,i=t._z,a=t._w,u=e._x,h=e._y,l=e._z,o=e._w;return this._x=n*o+a*u+s*l-i*h,this._y=s*o+a*h+i*u-n*l,this._z=i*o+a*l+n*h-s*u,this._w=a*o-n*u-s*h-i*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const n=this._x,s=this._y,i=this._z,a=this._w;let u=a*t._w+n*t._x+s*t._y+i*t._z;if(u<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,u=-u):this.copy(t),u>=1)return this._w=a,this._x=n,this._y=s,this._z=i,this;const h=1-u*u;if(h<=Number.EPSILON){const f=1-e;return this._w=f*a+e*this._w,this._x=f*n+e*this._x,this._y=f*s+e*this._y,this._z=f*i+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(h),o=Math.atan2(l,u),c=Math.sin((1-e)*o)/l,d=Math.sin(e*o)/l;return this._w=a*c+this._w*d,this._x=n*c+this._x*d,this._y=s*c+this._y*d,this._z=i*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),s=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(e*Math.cos(s),n*Math.sin(i),n*Math.cos(i),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class P{constructor(t=0,e=0,n=0){P.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(In.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(In.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,s=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*s,this.y=i[1]*e+i[4]*n+i[7]*s,this.z=i[2]*e+i[5]*n+i[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,s=this.z,i=t.elements,a=1/(i[3]*e+i[7]*n+i[11]*s+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*s+i[12])*a,this.y=(i[1]*e+i[5]*n+i[9]*s+i[13])*a,this.z=(i[2]*e+i[6]*n+i[10]*s+i[14])*a,this}applyQuaternion(t){const e=this.x,n=this.y,s=this.z,i=t.x,a=t.y,u=t.z,h=t.w,l=h*e+a*s-u*n,o=h*n+u*e-i*s,c=h*s+i*n-a*e,d=-i*e-a*n-u*s;return this.x=l*h+d*-i+o*-u-c*-a,this.y=o*h+d*-a+c*-i-l*-u,this.z=c*h+d*-u+l*-a-o*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,s=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*s,this.y=i[1]*e+i[5]*n+i[9]*s,this.z=i[2]*e+i[6]*n+i[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,s=t.y,i=t.z,a=e.x,u=e.y,h=e.z;return this.x=s*h-i*u,this.y=i*a-n*h,this.z=n*u-s*a,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return De.copy(this).projectOnVector(t),this.sub(De)}reflect(t){return this.sub(De.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(ze(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,s=this.z-t.z;return e*e+n*n+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const s=Math.sin(e)*t;return this.x=s*Math.sin(n),this.y=Math.cos(e)*t,this.z=s*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const De=new P,In=new xs;class Nn{constructor(t=new P(1/0,1/0,1/0),e=new P(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,s=1/0,i=-1/0,a=-1/0,u=-1/0;for(let h=0,l=t.length;h<l;h+=3){const o=t[h],c=t[h+1],d=t[h+2];o<e&&(e=o),c<n&&(n=c),d<s&&(s=d),o>i&&(i=o),c>a&&(a=c),d>u&&(u=d)}return this.min.set(e,n,s),this.max.set(i,a,u),this}setFromBufferAttribute(t){let e=1/0,n=1/0,s=1/0,i=-1/0,a=-1/0,u=-1/0;for(let h=0,l=t.count;h<l;h++){const o=t.getX(h),c=t.getY(h),d=t.getZ(h);o<e&&(e=o),c<n&&(n=c),d<s&&(s=d),o>i&&(i=o),c>a&&(a=c),d>u&&(u=d)}return this.min.set(e,n,s),this.max.set(i,a,u),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Ot.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(n!==void 0)if(e&&n.attributes!=null&&n.attributes.position!==void 0){const i=n.attributes.position;for(let a=0,u=i.count;a<u;a++)Ot.fromBufferAttribute(i,a).applyMatrix4(t.matrixWorld),this.expandByPoint(Ot)}else n.boundingBox===null&&n.computeBoundingBox(),Fe.copy(n.boundingBox),Fe.applyMatrix4(t.matrixWorld),this.union(Fe);const s=t.children;for(let i=0,a=s.length;i<a;i++)this.expandByObject(s[i],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Ot),Ot.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(te),_e.subVectors(this.max,te),Ut.subVectors(t.a,te),jt.subVectors(t.b,te),Wt.subVectors(t.c,te),bt.subVectors(jt,Ut),Mt.subVectors(Wt,jt),Rt.subVectors(Ut,Wt);let e=[0,-bt.z,bt.y,0,-Mt.z,Mt.y,0,-Rt.z,Rt.y,bt.z,0,-bt.x,Mt.z,0,-Mt.x,Rt.z,0,-Rt.x,-bt.y,bt.x,0,-Mt.y,Mt.x,0,-Rt.y,Rt.x,0];return!He(e,Ut,jt,Wt,_e)||(e=[1,0,0,0,1,0,0,0,1],!He(e,Ut,jt,Wt,_e))?!1:(ye.crossVectors(bt,Mt),e=[ye.x,ye.y,ye.z],He(e,Ut,jt,Wt,_e))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Ot.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(Ot).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(pt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),pt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),pt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),pt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),pt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),pt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),pt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),pt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(pt),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const pt=[new P,new P,new P,new P,new P,new P,new P,new P],Ot=new P,Fe=new Nn,Ut=new P,jt=new P,Wt=new P,bt=new P,Mt=new P,Rt=new P,te=new P,_e=new P,ye=new P,zt=new P;function He(r,t,e,n,s){for(let i=0,a=r.length-3;i<=a;i+=3){zt.fromArray(r,i);const u=s.x*Math.abs(zt.x)+s.y*Math.abs(zt.y)+s.z*Math.abs(zt.z),h=t.dot(zt),l=e.dot(zt),o=n.dot(zt);if(Math.max(-Math.max(h,l,o),Math.min(h,l,o))>u)return!1}return!0}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Mn}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Mn);const H=class{static getList(t){return t?t.split(",").map(e=>e.trim()):[]}static getBoolean(t,e){return t?t==="true":e}static getNumber(t){return parseFloat(t)}static getOptionalNumber(t){if(t)return parseFloat(t)}};let L=H;p(L,"LOG_LEVELS",H.getList({}.VITE_LOG_LEVELS)),p(L,"LOG_KEYS",H.getList({}.VITE_LOG_KEYS)),p(L,"JUMP_START",H.getBoolean({}.VITE_JUMP_START,!0)),p(L,"FOG_ENABLED",H.getBoolean({}.VITE_FOG_ENABLED,!0)),p(L,"EDITING_ENABLED",H.getBoolean({}.VITE_EDITING_ENABLED,!0)),p(L,"SHOW_INITIAL_TERRAIN_GENERATION",H.getBoolean({}.VITE_SHOW_INITIAL_TERRAIN_GENERATION,!1)),p(L,"SHOW_DEBUG_INFO",H.getBoolean({}.VITE_SHOW_DEBUG_UI,!1)),p(L,"SHOW_WINDOW_CLOSE_ALERT",H.getBoolean({}.VITE_SHOW_WINDOW_CLOSE_ALERT,!0)),p(L,"PLAYER_DEFAULT_PHYSICS_MODE",{}.VITE_PLAYER_DEFAULT_PHYSICS_MODE),p(L,"PLAYER_SHOW_BOUNDING_BOX",H.getBoolean({}.VITE_PLAYER_SHOW_BOUNDING_BOX,!1)),p(L,"CHUNK_WIDTH",H.getNumber({}.VITE_TERRAIN_CHUNK_WIDTH||20)),p(L,"CHUNK_HEIGHT",H.getNumber({}.VITE_TERRAIN_CHUNK_HEIGHT||6)),p(L,"CUSTOM_SEED",{}.VITE_CUSTOM_SEED||"map2"),p(L,"TERRAIN_GENERATION_ENABLED",H.getBoolean({}.VITE_TERRAIN_GENERATION_ENABLED,!0)),p(L,"TERRAIN_OPTIMIZATION_ENABLED",H.getBoolean({}.VITE_TERRAIN_OPTIMIZATION_ENABLED,!0)),p(L,"TREE_GENERATION_ENABLED",H.getBoolean({}.VITE_TREE_GENERATION_ENABLED,!0)),p(L,"DEFAULT_HORIZONTAL_RENDER_DISTANCE_IN_CHUNKS",H.getNumber({}.VITE_DEFAULT_HORIZONTAL_RENDER_DISTANCE_IN_CHUNKS)),p(L,"TOP_RENDER_DISTANCE_IN_CHUNKS",H.getNumber({}.VITE_TOP_RENDER_DISTANCE_IN_CHUNKS||8)),p(L,"BOTTOM_RENDER_DISTANCE_IN_CHUNKS",H.getNumber({}.VITE_BOTTOM_RENDER_DISTANCE_IN_CHUNKS||4)),p(L,"TESTING_MAP_ENABLED",H.getBoolean({}.VITE_TESTING_MAP_ENABLED,!1)),p(L,"TESTING_MAP_EROSION",H.getOptionalNumber({}.VITE_TESTING_MAP_EROSION)),p(L,"TESTING_MAP_CONTINENTALNESS",H.getOptionalNumber({}.VITE_TESTING_MAP_CONTINENTALNESS)),p(L,"TESTING_MAP_PV",H.getOptionalNumber({}.VITE_TESTING_MAP_PV)),p(L,"STARTING_INVENTORY_ITEMS",H.getList({}.VITE_STARTING_INVENTORY_ITEMS).map(t=>Number(t))),p(L,"STARTING_HOTBAR_ITEMS",H.getList({}.VITE_STARTING_HOTBAR_ITEMS).map(t=>Number(t)));const We=class{static debug(t,...e){}static info(t,...e){}static warn(t){}static error(t){}static shouldLog(t,...e){const n=We.LOG_LEVELS.includes(t);return e.some(i=>this.LOG_KEYS.includes(i))&&n}};let W=We;p(W,"LOG_LEVELS",L.LOG_LEVELS??["silent"]),p(W,"LOG_KEYS",L.LOG_KEYS),p(W,"GAME_LOOP_KEY","gameloop"),p(W,"SCENE_KEY","scene"),p(W,"AUDIO_KEY","audio"),p(W,"DATA_KEY","data"),p(W,"INPUT_KEY","input"),p(W,"MAP_KEY","map"),p(W,"COLLISION_KEY","collision"),p(W,"PLAYER_KEY","player"),p(W,"TERRAIN_KEY","terrain"),p(W,"CHUNK_KEY","chunk"),p(W,"INIT_KEY","init"),p(W,"LOADING_KEY","load"),p(W,"DISPOSE_KEY","dispose");const Pt={left:[-1,0,0],right:[1,0,0],top:[0,1,0],bottom:[0,-1,0],front:[0,0,1],back:[0,0,-1]},vn={left:{normal:Pt.left,vertices:[{pos:[0,1,0],uv:[0,1],ao:{corner:[-.5,-.5,.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}},{pos:[0,0,0],uv:[0,0],ao:{corner:[-.5,-.5,.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}},{pos:[0,1,1],uv:[1,1],ao:{corner:[-.5,.5,-.5],side1:[-.5,.5,.5],side2:[-.5,-.5,.5]}},{pos:[0,0,1],uv:[1,0],ao:{corner:[-.5,-.5,-.5],side1:[-.5,.5,.5],side2:[-.5,-.5,.5]}}]},right:{normal:Pt.right,vertices:[{pos:[1,1,1],uv:[0,1],ao:{corner:[.5,.5,-.5],side1:[.5,.5,.5],side2:[.5,-.5,.5]}},{pos:[1,0,1],uv:[0,0],ao:{corner:[.5,-.5,-.5],side1:[.5,.5,.5],side2:[.5,-.5,.5]}},{pos:[1,1,0],uv:[1,1],ao:{corner:[.5,.5,.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}},{pos:[1,0,0],uv:[1,0],ao:{corner:[.5,-.5,.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}}]},top:{normal:Pt.top,vertices:[{pos:[0,1,1],uv:[1,1],ao:{corner:[-.5,.5,.5],side1:[.5,.5,.5],side2:[-.5,.5,-.5]}},{pos:[1,1,1],uv:[0,1],ao:{corner:[.5,.5,.5],side1:[-.5,.5,.5],side2:[.5,.5,-.5]}},{pos:[0,1,0],uv:[1,0],ao:{corner:[-.5,.5,-.5],side1:[.5,.5,-.5],side2:[-.5,.5,.5]}},{pos:[1,1,0],uv:[0,0],ao:{corner:[.5,.5,-.5],side1:[-.5,.5,-.5],side2:[.5,.5,.5]}}]},bottom:{normal:Pt.bottom,vertices:[{pos:[1,0,1],uv:[1,0],ao:{corner:[.5,-.5,.5],side1:[-.5,-.5,.5],side2:[.5,-.5,-.5]}},{pos:[0,0,1],uv:[0,0],ao:{corner:[-.5,-.5,.5],side1:[.5,-.5,.5],side2:[-.5,-.5,.5]}},{pos:[1,0,0],uv:[1,1],ao:{corner:[.5,-.5,-.5],side1:[.5,-.5,.5],side2:[-.5,-.5,-.5]}},{pos:[0,0,0],uv:[0,1],ao:{corner:[-.5,-.5,-.5],side1:[.5,-.5,-.5],side2:[-.5,-.5,.5]}}]},front:{normal:Pt.front,vertices:[{pos:[0,0,1],uv:[0,0],ao:{corner:[.5,-.5,.5],side1:[-.5,.5,.5],side2:[-.5,-.5,.5]}},{pos:[1,0,1],uv:[1,0],ao:{corner:[-.5,-.5,.5],side1:[.5,.5,.5],side2:[.5,-.5,.5]}},{pos:[0,1,1],uv:[0,1],ao:{corner:[.5,.5,.5],side1:[-.5,-.5,.5],side2:[-.5,.5,.5]}},{pos:[1,1,1],uv:[1,1],ao:{corner:[-.5,.5,.5],side1:[.5,-.5,.5],side2:[.5,.5,.5]}}]},back:{normal:Pt.back,vertices:[{pos:[1,0,0],uv:[0,0],ao:{corner:[-.5,-.5,-.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}},{pos:[0,0,0],uv:[1,0],ao:{corner:[.5,-.5,-.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}},{pos:[1,1,0],uv:[0,1],ao:{corner:[-.5,.5,-.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}},{pos:[0,1,0],uv:[1,1],ao:{corner:[.5,.5,-.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}}]}},Cn=16,As=256,Is=256;var V=(r=>(r[r.AIR=0]="AIR",r[r.CLOUD=1]="CLOUD",r[r.STONE=2]="STONE",r[r.COBBLESTONE=3]="COBBLESTONE",r[r.DIRT=4]="DIRT",r[r.GRASS=5]="GRASS",r[r.GRASS_SNOW=6]="GRASS_SNOW",r[r.WATER=7]="WATER",r[r.SAND=8]="SAND",r[r.GLASS=9]="GLASS",r[r.OAK_LOG=10]="OAK_LOG",r[r.OAK_LEAVES=11]="OAK_LEAVES",r[r.PLANKS=12]="PLANKS",r[r.COAL_ORE=13]="COAL_ORE",r[r.VENT=14]="VENT",r[r.VENT_2=15]="VENT_2",r[r.METAL_FLOOR_1=16]="METAL_FLOOR_1",r[r.METAL_FLOOR_2=17]="METAL_FLOOR_2",r[r.METAL_FLOOR_3=18]="METAL_FLOOR_3",r[r.METAL_PLATE_1=19]="METAL_PLATE_1",r[r.METAL_PLATE_2=20]="METAL_PLATE_2",r[r.METAL_PLATE_3=21]="METAL_PLATE_3",r[r.VENT_3=22]="VENT_3",r[r.METAL_FLOOR_4=23]="METAL_FLOOR_4",r[r.METAL_FLOOR_5=24]="METAL_FLOOR_5",r[r.METAL_FLOOR_RUSTY_1=25]="METAL_FLOOR_RUSTY_1",r[r.METAL_FLOOR_RUSTY_2=26]="METAL_FLOOR_RUSTY_2",r[r.METAL_FLOOR_RUSTY_3=27]="METAL_FLOOR_RUSTY_3",r[r.CARPET_GREEN=28]="CARPET_GREEN",r[r.CARPET_BLUE=29]="CARPET_BLUE",r[r.CARPET_PURPLE=30]="CARPET_PURPLE",r[r.CARPET_GREEN_BLUE=31]="CARPET_GREEN_BLUE",r[r.CRATE_1=32]="CRATE_1",r[r.METAL_WALL_1=33]="METAL_WALL_1",r[r.METAL_WALL_2=34]="METAL_WALL_2",r[r.GLASS_PURPLE=35]="GLASS_PURPLE",r[r.GLASS_PINK=36]="GLASS_PINK",r[r.GLASS_RED=37]="GLASS_RED",r[r.GLASS_BLUE=38]="GLASS_BLUE",r[r.METAL_FLOOR_6=39]="METAL_FLOOR_6",r[r.NONE=40]="NONE",r))(V||{});class D{static AddSolidBlock(t,e,n,s,i,a,u,h,l){return{name:e,isTransparent:!1,isSolid:!0,drop:h,icon:a||{row:-1,col:-1},texture:{top:n,bottom:s||n,side:i||n},color:u,sounds:l}}static AddTransparentBlock(t,e,n,s,i,a,u,h,l){return{name:e,isTransparent:!0,isSolid:!0,drop:h,icon:a||{row:-1,col:-1},texture:{top:n,bottom:s||n,side:i||n},color:u,sounds:l}}}const R={[40]:{name:"_none",isTransparent:!0,isSolid:!1,icon:{row:-1,col:-1},texture:{top:{row:-1,col:-1},bottom:{row:-1,col:-1},side:{row:-1,col:-1}}},[0]:{name:"_air",isTransparent:!0,isSolid:!1,icon:{row:-1,col:-1},texture:{top:{row:-1,col:-1},bottom:{row:-1,col:-1},side:{row:-1,col:-1}}},[1]:{name:"cloud",isTransparent:!0,isSolid:!1,icon:{row:-1,col:-1},texture:{top:{row:2,col:5},bottom:{row:2,col:5},side:{row:2,col:5}},color:[1,1,1,.4]},[2]:{name:"Stone",isTransparent:!1,isSolid:!0,drop:3,icon:{row:18,col:12},texture:{top:{row:0,col:5},bottom:{row:0,col:5},side:{row:0,col:5}}},[3]:{name:"Cobblestone",isTransparent:!1,isSolid:!0,drop:3,icon:{row:8,col:31},texture:{top:{row:0,col:4},bottom:{row:0,col:4},side:{row:0,col:4}}},[5]:{name:"Grass",isTransparent:!1,isSolid:!0,drop:4,icon:{row:16,col:27},texture:{top:{row:0,col:1},bottom:{row:0,col:2},side:{row:0,col:0}}},[6]:{name:"Snow",isTransparent:!1,isSolid:!0,drop:4,icon:{row:13,col:18},texture:{top:{row:2,col:5},bottom:{row:0,col:2},side:{row:2,col:4}}},[4]:{name:"Dirt",isTransparent:!1,isSolid:!0,drop:4,icon:{row:13,col:18},texture:{top:{row:0,col:2},bottom:{row:0,col:2},side:{row:0,col:2}}},[10]:{name:"Oak_Log",isTransparent:!1,isSolid:!0,drop:10,icon:{row:25,col:9},texture:{top:{row:1,col:2},bottom:{row:1,col:2},side:{row:1,col:3}}},[11]:{name:"Oak_Leaves",isTransparent:!0,isSolid:!0,icon:{row:25,col:8},texture:{top:{row:1,col:5},bottom:{row:1,col:5},side:{row:1,col:5}}},[12]:{name:"Planks",isTransparent:!1,isSolid:!0,drop:12,icon:{row:25,col:10},texture:{top:{row:1,col:4},bottom:{row:1,col:4},side:{row:1,col:4}}},[8]:{name:"Sand",isTransparent:!1,isSolid:!0,drop:8,icon:{row:32,col:6},texture:{top:{row:1,col:6},bottom:{row:1,col:6},side:{row:1,col:6}}},[7]:{name:"Water",isTransparent:!0,isSolid:!1,icon:{row:37,col:28},texture:{side:{row:1,col:7},top:{row:1,col:7},bottom:{row:1,col:7}}},[9]:{name:"Glass",isTransparent:!0,isSolid:!0,icon:{row:15,col:26},texture:{side:{row:2,col:0},top:{row:2,col:0},bottom:{row:2,col:0}}},[13]:{name:"Coal_Ore",isTransparent:!1,isSolid:!0,drop:13,icon:{row:8,col:25},texture:{side:{row:0,col:6},top:{row:0,col:6},bottom:{row:0,col:6}}}};R[14]=D.AddSolidBlock(14,"VENT",{row:0,col:9},void 0,void 0),R[15]=D.AddSolidBlock(15,"VENT_2",{row:5,col:10},void 0,void 0),R[22]=D.AddSolidBlock(22,"VENT_3",{row:5,col:14},void 0,void 0),R[16]=D.AddSolidBlock(16,"METAL_FLOOR_1",{row:2,col:11},void 0,void 0),R[17]=D.AddSolidBlock(17,"METAL_FLOOR_2",{row:1,col:9},void 0,void 0),R[18]=D.AddSolidBlock(18,"METAL_FLOOR_3",{row:1,col:11},void 0,void 0),R[23]=D.AddSolidBlock(23,"METAL_FLOOR_4",{row:5,col:15},void 0,void 0),R[24]=D.AddSolidBlock(24,"METAL_FLOOR_5",{row:0,col:15},void 0,void 0),R[39]=D.AddSolidBlock(39,"METAL_FLOOR_6",{row:0,col:10},void 0,void 0),R[25]=D.AddSolidBlock(25,"METAL_FLOOR_RUSTY_1",{row:6,col:12},{row:6,col:12},{row:6,col:11}),R[26]=D.AddSolidBlock(26,"METAL_FLOOR_RUSTY_2",{row:1,col:10},void 0,void 0),R[27]=D.AddSolidBlock(27,"METAL_FLOOR_RUSTY_3",{row:2,col:8},void 0,void 0),R[19]=D.AddSolidBlock(19,"METAL_PLATE_1",{row:4,col:12},void 0,void 0),R[20]=D.AddSolidBlock(20,"METAL_PLATE_2",{row:4,col:15},void 0,void 0),R[21]=D.AddSolidBlock(21,"METAL_PLATE_3",{row:5,col:9},void 0,void 0),R[28]=D.AddSolidBlock(28,"CARPET_GREEN",{row:0,col:13},void 0,void 0),R[29]=D.AddSolidBlock(29,"CARPET_BLUE",{row:0,col:14},void 0,void 0),R[30]=D.AddSolidBlock(30,"CARPET_PURPLE",{row:2,col:13},void 0,void 0),R[31]=D.AddSolidBlock(31,"CARPET_GREEN_BLUE",{row:5,col:13},void 0,void 0),R[32]=D.AddSolidBlock(32,"CRATE_1",{row:2,col:9},void 0,void 0),R[33]=D.AddSolidBlock(33,"METAL_WALL_1",{row:2,col:15},{row:2,col:15},{row:1,col:15}),R[34]=D.AddSolidBlock(34,"METAL_WALL_2",{row:5,col:8},void 0,void 0),R[35]=D.AddTransparentBlock(35,"GLASS_PURPLE",{row:3,col:0},void 0,void 0),R[36]=D.AddTransparentBlock(36,"GLASS_PINK",{row:3,col:2},void 0,void 0),R[37]=D.AddTransparentBlock(37,"GLASS_RED",{row:3,col:1},void 0,void 0),R[38]=D.AddTransparentBlock(38,"GLASS_BLUE",{row:4,col:1},void 0,void 0);const Ns={top:"top",bottom:"bottom",left:"side",right:"side",front:"side",back:"side"},vs=[[0,0,0],[0,1,0],[0,-1,0],[-1,0,0],[-1,1,0],[-1,-1,0],[1,0,0],[1,1,0],[1,-1,0],[0,0,1],[0,1,1],[0,-1,1],[-1,0,1],[-1,1,1],[-1,-1,1],[1,0,1],[1,1,1],[1,-1,1],[0,0,-1],[0,1,-1],[0,-1,-1],[-1,0,-1],[-1,1,-1],[-1,-1,-1],[1,0,-1],[1,1,-1],[1,-1,-1]],yt=class{static isVisibleBlock(t){return t!=null&&t!==V.AIR}static getBlockFaces(){return Object.keys(vn)}static getBlockFaceGeometry(t){return vn[t]}static getNeighbourBlockOffsets(){return vs}static getBlockMetadata(t){return R[t]}static getBlockColor(t){return R[t].color}static getBlockUVCoordinates(t,e,[n,s]){const i=Ns[e],{row:a,col:u}=R[t].texture[i];return{u:(u+n)*Cn/As,v:1-(a+1-s)*Cn/Is}}static getBlockFaceFromNormal(t){for(const[e,n]of Object.entries(Pt))if(new P().fromArray(n).equals(t))return e;return null}static getBlockBoundingBoxFromPosition(t){return yt.getBlockBoundingBox(yt.getBlockOriginFromPosition(t))}static getBlockBoundingBox(t){return new Nn(t,t.clone().addScalar(yt.SIZE))}static getBlockOriginFromPosition(t){return new P(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}static toBlockCenterCoord(t){return Math.floor(t/yt.SIZE)*yt.SIZE+yt.SIZE/2}static getBlockNormalFromPosition(t,e){const n=new P(t.x+.5,t.y+.5,t.z+.5),s=Math.abs(e.x-n.x),i=Math.abs(e.y-n.y),a=Math.abs(e.z-n.z),u=new P;return s>i&&s>a?u.set(e.x>n.x?1:-1,0,0):i>a?u.set(0,e.y>n.y?1:-1,0):u.set(0,0,e.z>n.z?1:-1),u}static raycast(t,e,n){let s=e.x-t.x,i=e.y-t.y,a=e.z-t.z;const u=s*s+i*i+a*a,h=Math.sqrt(u);s/=h,i/=h,a/=h;let l=0,o=Math.floor(t.x),c=Math.floor(t.y),d=Math.floor(t.z);const f=s>0?1:-1,_=i>0?1:-1,x=a>0?1:-1,w=Math.abs(1/s),b=Math.abs(1/i),g=Math.abs(1/a),E=f>0?o+1-t.x:t.x-o,T=_>0?c+1-t.y:t.y-c,M=x>0?d+1-t.z:t.z-d;let y=w<1/0?w*E:1/0,I=b<1/0?b*T:1/0,C=g<1/0?g*M:1/0,m=-1;for(;l<=h;){const S=n.getBlock({x:o,y:c,z:d});if(yt.isVisibleBlock(S==null?void 0:S.type))return{position:[t.x+l*s,t.y+l*i,t.z+l*a],normal:[m===0?-f:0,m===1?-_:0,m===2?-x:0],block:S};const v=Math.min(y,I,C);v===y?(o+=f,l=y,y+=w,m=0):v===I?(c+=_,l=I,I+=b,m=1):(d+=x,l=C,C+=g,m=2)}return null}};let St=yt;p(St,"SIZE",1);const G=class{constructor(t,e){p(this,"chunkId");p(this,"worldOriginPosition");p(this,"blocks");p(this,"isDirt");this.chunkId=t,this.worldOriginPosition=G.getChunkOriginPosition(t),this.isDirt=!1,this.blocks=e??new Uint8Array(G.HEIGHT*G.WIDTH*G.WIDTH)}getBlock(t){if(!this.isBlockInChunk(t))return null;const e=this.computeBlockIndex(t),n=this.blocks[e];return{type:n,...R[n]}}setBlock(t,e){if(!this.isBlockInChunk(t))return;const n=this.computeBlockIndex(t);this.blocks[n]=e}isBlockInChunk(t){return G.getChunkIdFromPosition(t)===this.chunkId}decorateChunk(t,e){const{x:n,y:s,z:i}=this.getWorldOriginPosition(),a=n+G.WIDTH,u=s+G.HEIGHT,h=i+G.WIDTH,l=new Map;for(let o=s;o<u;o++)for(let c=i;c<h;c++)for(let d=n;d<a;d++){const f={x:d,y:o,z:c},_=t.generateBlock(d,o,c,e);_&&this.setBlock(f,_)}l.forEach((o,c)=>{for(let d=18;d<=o.y;d++)this.setBlock({x:o.x,y:d,z:o.z},V.OAK_LOG)})}computeBlockIndex({x:t,y:e,z:n}){const[s,i,a]=this.getBlockLocalCoordinates(t,e,n);return i*G.WIDTH*G.WIDTH+a*G.WIDTH+s}getBlockLocalCoordinates(t,e,n){const s=Pe.euclideanModulo(t,G.WIDTH)|0,i=Pe.euclideanModulo(e,G.HEIGHT)|0,a=Pe.euclideanModulo(n,G.WIDTH)|0;return[s,i,a]}static buildChunkId({x:t,y:e,z:n}){return`${t},${e},${n}`}static chunkIdAsCoordinate(t){const e=t.match(/^([^,]+),([^,]+),(.+)$/);if(!e)throw new Error("Invalid chunkId");const[n,s,i,a]=e;return{x:Number(s),y:Number(i),z:Number(a)}}static getChunkIdFromPosition({x:t,y:e,z:n}){const s=Math.floor(t/G.WIDTH),i=Math.floor(e/G.HEIGHT),a=Math.floor(n/G.WIDTH);return G.buildChunkId({x:s,y:i,z:a})}static getChunkOriginPosition(t){const{x:e,y:n,z:s}=G.chunkIdAsCoordinate(t),i=e*G.WIDTH,a=n*G.HEIGHT,u=s*G.WIDTH;return{x:i,y:a,z:u}}markAsDirt(){this.isDirt=!0}isDirty(){return this.isDirt}getId(){return this.chunkId}getWorldOriginPosition(){return this.worldOriginPosition}getBlocks(){return this.blocks}_debug(){W.debug(JSON.stringify(this.blocks),W.TERRAIN_KEY)}};let ct=G;p(ct,"WIDTH",L.CHUNK_WIDTH),p(ct,"HEIGHT",L.CHUNK_HEIGHT);const Ye=class{};let _t=Ye;p(_t,"RADIUS",2),p(_t,"TRUNK_HEIGHT",2),p(_t,"MAX_HEIGHT",Ye.TRUNK_HEIGHT+2);class st{constructor(t){p(this,"seed");this.seed=t}getSeed(){return this.seed}}p(st,"getContinentalMapSeed",t=>t+"_continental"),p(st,"getErosionMapSeed",t=>t+"_erosion"),p(st,"getPvMapSeed",t=>t+"_pv"),p(st,"getHeightMapSeed",t=>t+"_height"),p(st,"getDensityMapSeed",t=>t+"_density"),p(st,"getTreeMapSeed",t=>t+"_tree");const ot=class{static generateSeed(){return Math.random().toString(36).substring(2,15)}};let N=ot;p(N,"ORIGIN",new P(0,0,0)),p(N,"CONTINENTALNESS_NOISE_SCALE",2500),p(N,"EROSION_NOISE_SCALE",1024),p(N,"PV_BASE_SCALE",180),p(N,"DENSITY_NOISE_SCALE",12),p(N,"MAX_WORLD_HEIGHT",L.TOP_RENDER_DISTANCE_IN_CHUNKS*L.CHUNK_HEIGHT),p(N,"MIN_WORLD_HEIGHT",L.BOTTOM_RENDER_DISTANCE_IN_CHUNKS*-L.CHUNK_HEIGHT),p(N,"MIN_EROSION",0),p(N,"MAX_EROSION",8),p(N,"MIN_CONTINENTALNESS_HEIGHT",0),p(N,"MAX_CONTINENTALNESS_HEIGHT",25),p(N,"MIN_DENSITY_HEIGHT",ot.MIN_CONTINENTALNESS_HEIGHT-40),p(N,"MAX_DENSITY_HEIGHT",ot.MAX_WORLD_HEIGHT),p(N,"LARGE_CAVES_HEIGHT",0),p(N,"MAX_SURFACE_HEIGHT",ot.MAX_CONTINENTALNESS_HEIGHT+ot.MAX_EROSION),p(N,"MIN_SURFACE_HEIGHT",ot.MIN_CONTINENTALNESS_HEIGHT-ot.MAX_EROSION),p(N,"CLOUD_LEVEL",ot.MAX_SURFACE_HEIGHT-25),p(N,"SNOW_LEVEL",ot.MAX_CONTINENTALNESS_HEIGHT),p(N,"SEA_LEVEL",ot.MIN_CONTINENTALNESS_HEIGHT+15),p(N,"SAND_LEVEL",ot.SEA_LEVEL+6),p(N,"BEDROCK_LEVEL",0),p(N,"CLOUD_WIDTH",10),p(N,"CLOUD_DEPTH",5);const Cs=.5*(Math.sqrt(3)-1),ee=(3-Math.sqrt(3))/6,Ls=1/3,ut=1/6,ne=r=>Math.floor(r)|0,Ln=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),Ge=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function ks(r=Math.random){const t=kn(r),e=new Float64Array(t).map(s=>Ln[s%12*2]),n=new Float64Array(t).map(s=>Ln[s%12*2+1]);return function(i,a){let u=0,h=0,l=0;const o=(i+a)*Cs,c=ne(i+o),d=ne(a+o),f=(c+d)*ee,_=c-f,x=d-f,w=i-_,b=a-x;let g,E;w>b?(g=1,E=0):(g=0,E=1);const T=w-g+ee,M=b-E+ee,y=w-1+2*ee,I=b-1+2*ee,C=c&255,m=d&255;let S=.5-w*w-b*b;if(S>=0){const k=C+t[m],O=e[k],z=n[k];S*=S,u=S*S*(O*w+z*b)}let A=.5-T*T-M*M;if(A>=0){const k=C+g+t[m+E],O=e[k],z=n[k];A*=A,h=A*A*(O*T+z*M)}let v=.5-y*y-I*I;if(v>=0){const k=C+1+t[m+1],O=e[k],z=n[k];v*=v,l=v*v*(O*y+z*I)}return 70*(u+h+l)}}function Os(r=Math.random){const t=kn(r),e=new Float64Array(t).map(i=>Ge[i%12*3]),n=new Float64Array(t).map(i=>Ge[i%12*3+1]),s=new Float64Array(t).map(i=>Ge[i%12*3+2]);return function(a,u,h){let l,o,c,d;const f=(a+u+h)*Ls,_=ne(a+f),x=ne(u+f),w=ne(h+f),b=(_+x+w)*ut,g=_-b,E=x-b,T=w-b,M=a-g,y=u-E,I=h-T;let C,m,S,A,v,k;M>=y?y>=I?(C=1,m=0,S=0,A=1,v=1,k=0):M>=I?(C=1,m=0,S=0,A=1,v=0,k=1):(C=0,m=0,S=1,A=1,v=0,k=1):y<I?(C=0,m=0,S=1,A=0,v=1,k=1):M<I?(C=0,m=1,S=0,A=0,v=1,k=1):(C=0,m=1,S=0,A=1,v=1,k=0);const O=M-C+ut,z=y-m+ut,U=I-S+ut,j=M-A+2*ut,et=y-v+2*ut,Y=I-k+2*ut,$=M-1+3*ut,At=y-1+3*ut,It=I-1+3*ut,q=_&255,X=x&255,lt=w&255;let ht=.6-M*M-y*y-I*I;if(ht<0)l=0;else{const B=q+t[X+t[lt]];ht*=ht,l=ht*ht*(e[B]*M+n[B]*y+s[B]*I)}let Et=.6-O*O-z*z-U*U;if(Et<0)o=0;else{const B=q+C+t[X+m+t[lt+S]];Et*=Et,o=Et*Et*(e[B]*O+n[B]*z+s[B]*U)}let dt=.6-j*j-et*et-Y*Y;if(dt<0)c=0;else{const B=q+A+t[X+v+t[lt+k]];dt*=dt,c=dt*dt*(e[B]*j+n[B]*et+s[B]*Y)}let Q=.6-$*$-At*At-It*It;if(Q<0)d=0;else{const B=q+1+t[X+1+t[lt+1]];Q*=Q,d=Q*Q*(e[B]*$+n[B]*At+s[B]*It)}return 32*(l+o+c+d)}}function kn(r){const e=new Uint8Array(512);for(let n=0;n<512/2;n++)e[n]=n;for(let n=0;n<512/2-1;n++){const s=n+~~(r()*(256-n)),i=e[n];e[n]=e[s],e[s]=i}for(let n=256;n<512;n++)e[n]=e[n-256];return e}var Be={},Rs={get exports(){return Be},set exports(r){Be=r}};(function(r,t){(function(e,n){r.exports=n()})(F,function(){return e.importState=function(s){var i=new e;return i.importState(s),i},e;function e(){return function(s){var i=0,a=0,u=0,h=1;s.length==0&&(s=[+new Date]);var l=n();i=l(" "),a=l(" "),u=l(" ");for(var o=0;o<s.length;o++)i-=l(s[o]),i<0&&(i+=1),a-=l(s[o]),a<0&&(a+=1),u-=l(s[o]),u<0&&(u+=1);l=null;var c=function(){var d=2091639*i+h*23283064365386963e-26;return i=a,a=u,u=d-(h=d|0)};return c.next=c,c.uint32=function(){return c()*4294967296},c.fract53=function(){return c()+(c()*2097152|0)*11102230246251565e-32},c.version="Alea 0.9",c.args=s,c.exportState=function(){return[i,a,u,h]},c.importState=function(d){i=+d[0]||0,a=+d[1]||0,u=+d[2]||0,h=+d[3]||0},c}(Array.prototype.slice.call(arguments))}function n(){var s=4022871197,i=function(a){a=a.toString();for(var u=0;u<a.length;u++){s+=a.charCodeAt(u);var h=.02519603282416938*s;s=h>>>0,h-=s,h*=s,s=h>>>0,h-=s,s+=h*4294967296}return(s>>>0)*23283064365386963e-26};return i.version="Mash 0.9",i}})})(Rs);class Ve{constructor(t){p(this,"seed");p(this,"prng");this.seed=t,this.prng=Be(t)}getSeed(){return this.seed}}class Yt extends Ve{constructor(e){super(e);p(this,"data");this.data=new Map}getMapData(){return this.data}setMapData(e){this.data=e}getPointData(e,n){const s=Yt.computeKey(e,n);return this.data.get(s)}setPointData(e,n,s){const i=Yt.computeKey(e,n);return this.data.set(i,s),s}static computeKey(e,n){return`${Math.floor(e)}_${Math.floor(n)}`}}class Ue extends Yt{constructor(e){super(e);p(this,"noise2D");this.noise2D=ks(this.prng)}}class J{}p(J,"ENABLED",L.TESTING_MAP_ENABLED),p(J,"CONTINENTALNESS",L.TESTING_MAP_CONTINENTALNESS),p(J,"EROSION",L.TESTING_MAP_EROSION),p(J,"PV",L.TESTING_MAP_PV);const $t=class extends Ue{constructor(t){super(t)}setValueAt(t,e,n){return this.setPointData(t,e,n)}getValueAt(t,e){return this.getContinentalnessAt(t,e)}getContinentalnessAt(t,e){if(J.ENABLED&&J.CONTINENTALNESS!=null)return J.CONTINENTALNESS;const n=this.getPointData(t,e);if(n!=null)return n;const s=this.noise2D(t/N.CONTINENTALNESS_NOISE_SCALE,e/N.CONTINENTALNESS_NOISE_SCALE);return this.setPointData(t,e,s),s}static getType(t){return t<=$t.NoiseRange.Ocean.max?"Ocean":t<=$t.NoiseRange.Coast.max?"Coast":t<=$t.NoiseRange.Near_Inland.max?"Near_Inland":t<=$t.NoiseRange.Inland.max?"Inland":"Far_Inland"}};let it=$t;p(it,"NoiseRange",{Ocean:{min:-1,max:-.7},Coast:{min:-.7,max:-.4},Near_Inland:{min:-.4,max:0},Inland:{min:0,max:.6},Far_Inland:{min:.6,max:1}});class Ee extends Ve{constructor(e){super(e);p(this,"data");this.data=new Map}getMapData(){return this.data}setMapData(e){this.data=e}getPointData(e,n,s){const i=Ee.computeKey(e,n,s);return this.data.get(i)}setPointData(e,n,s,i){const a=Ee.computeKey(e,n,s);return this.data.set(a,i),i}static computeKey(e,n,s){return`${Math.floor(e)}_${Math.floor(n)}_${Math.floor(s)}`}}class zs extends Ee{constructor(e){super(e);p(this,"noise3D");this.noise3D=Os(this.prng)}}const xt=class extends Ue{constructor(t){super(t)}setValueAt(t,e,n){return this.setPointData(t,e,n)}getValueAt(t,e){return this.getErosionAt(t,e)}getErosionAt(t,e){if(J.ENABLED&&J.EROSION!=null)return J.EROSION;const n=this.getPointData(t,e);if(n!=null)return n;const s=this.noise2D(t/N.EROSION_NOISE_SCALE,e/N.EROSION_NOISE_SCALE);return this.setPointData(t,e,s),s}static getType(t){return t<=xt.NoiseRange.VeryLow.max?"VeryLow":t<=xt.NoiseRange.Low.max?"Low":t<=xt.NoiseRange.Mid.max?"Mid":t<=xt.NoiseRange.MidSpike.max?"MidSpike":t<=xt.NoiseRange.MidLow.max?"MidLow":t<=xt.NoiseRange.FlatSpike.max?"FlatSpike":"Flat"}};let wt=xt;p(wt,"NoiseRange",{VeryLow:{min:-1,max:-.5},Low:{min:-.5,max:-.1},Mid:{min:-.1,max:.3},MidSpike:{min:.3,max:.4},MidLow:{min:.4,max:.7},FlatSpike:{min:.7,max:.8},Flat:{min:.8,max:1}});const Dt=class extends Ue{constructor(t){super(t)}setValueAt(t,e,n){return this.setPointData(t,e,n)}getValueAt(t,e){return this.getPVAt(t,e)}getPVAt(t,e){if(J.ENABLED&&J.PV!=null)return J.PV;const n=this.getPointData(t,e);if(n!=null)return n;const s=4,i=.5,a=N.PV_BASE_SCALE;let u=0,h=0;for(let l=0;l<s;l++){const o=Math.pow(2,l),c=Math.pow(i,l);h+=c,u+=this.noise2D(t/a*o,e/a*o)*c}return u/=h,this.setPointData(t,e,u),u}static getType(t){return t<=Dt.NoiseRange.Valley.max?"Valley":t<=Dt.NoiseRange.Low.max?"Low":t<=Dt.NoiseRange.Plateau.max?"Plateau":t<=Dt.NoiseRange.Mid.max?"Mid":t<=Dt.NoiseRange.High.max?"High":"Peak"}};let Tt=Dt;p(Tt,"NoiseRange",{Valley:{min:-1,max:-.7},Low:{min:-.7,max:-.4},Plateau:{min:-.4,max:-.1},Mid:{min:-.1,max:.4},High:{min:.4,max:.8},Peak:{min:.8,max:1}});class Ps extends zs{constructor(e,n,s){super(e);p(this,"SOLID",1);p(this,"AIR",-1);p(this,"erosionMap");p(this,"pvMap");this.erosionMap=n,this.pvMap=s}setValueAt(e,n,s,i){return this.setPointData(e,n,s,i)}getValueAt(e,n,s){return this.getDensityAt(e,n,s)}getDensityAt(e,n,s){const{AIR:i,SOLID:a}=this;if(n<N.MIN_DENSITY_HEIGHT)return a;if(n>N.MAX_DENSITY_HEIGHT)return i;const u=1,h=1;return this.noise3D(e/u,n/u,s/u)+h}getScaleFactorAt(e,n,s){return n<N.LARGE_CAVES_HEIGHT?256:36}getSquashingFactorAt(e,n,s){const i=this.erosionMap.getValueAt(e,s),a=this.pvMap.getValueAt(e,s),u=wt.getType(i),h=a>=Tt.NoiseRange.Mid.min;switch(u){case"VeryLow":return h?.6:.8;case"Low":return h?.8:.9;case"MidLow":return .9;default:return 1}}}function tt(r,t,e){return Math.round(r+(t-r)*e)}function Ds(r){return Math.random()<=r}function ge(r,t,e){return r>=t&&r<=e}class Fs extends Yt{constructor(e,n,s,i){super(e);p(this,"continentalMap");p(this,"erosionMap");p(this,"pvMap");this.continentalMap=n,this.erosionMap=s,this.pvMap=i}setValueAt(e,n,s){return this.setPointData(e,n,s)}getValueAt(e,n){return this.getSurfaceHeightAt(e,n)}getSurfaceHeightAt(e,n){const s=this.getPointData(e,n);if(s!=null)return s;const i=this.getContinentalness(e,n),a=this.getBaseHeight(i),u=this.getErosion(e,n),h=this.getErosionFactor(u),l=this.getPV(e,n),o=this.getPvHeight(l,h),c=a+o;return this.setPointData(e,n,c),c}getBaseHeight(e){const n=it.getType(e);if(n==="Ocean")return N.MIN_CONTINENTALNESS_HEIGHT;if(n==="Coast"){const s=it.NoiseRange.Coast.min,i=it.NoiseRange.Coast.max,a=(e-s)/(i-s);return tt(N.SEA_LEVEL,N.SEA_LEVEL+2,a)}if(n==="Near_Inland"||n==="Inland"){const s=it.NoiseRange.Near_Inland.min,i=it.NoiseRange.Inland.max,a=(e-s)/(i-s);return tt(N.SEA_LEVEL+2,N.SEA_LEVEL+15,a)}if(n==="Far_Inland"){const s=it.NoiseRange.Far_Inland.min,i=it.NoiseRange.Far_Inland.max,a=(e-s)/(i-s);return tt(N.SEA_LEVEL+15,N.MAX_CONTINENTALNESS_HEIGHT,a)}return N.MAX_CONTINENTALNESS_HEIGHT}getErosionFactor(e){const n=N.MIN_EROSION,s=N.MAX_EROSION,i=Math.floor(s*(1/2)),a=n+6,u=a*2,h=u*2,l=wt.getType(e),{min:o,max:c}=wt.NoiseRange[l],d=(e-o)/(c-o),f=(c-e)/(c-o);switch(l){case"Flat":return tt(n,a,f);case"FlatSpike":return tt(a,i,f);case"MidLow":return i;case"MidSpike":return tt(a,i,d);case"Mid":return tt(a,u,f);case"Low":return tt(u,h,f);case"VeryLow":return tt(h,s,f)}}getPvHeight(e,n){const s=Math.round(-n*.6666666666666666),i=Math.round(-n/4),a=n,u=Math.round(a*(1/2)),h=Tt.getType(e),{min:l,max:o}=Tt.NoiseRange[h],c=(e-l)/(o-l);switch(h){case"Valley":return s;case"Low":return tt(s,i,c);case"Plateau":return tt(i,i+2,c);case"Mid":return tt(i+2,u,c);case"High":return tt(u,a,c);case"Peak":return a}}getContinentalness(e,n){return this.continentalMap.getValueAt(e,n)}getErosion(e,n){return this.erosionMap.getValueAt(e,n)}getPV(e,n){return this.pvMap.getValueAt(e,n)}}class Hs extends Ve{constructor(e,n,s,i,a,u){super(e);p(this,"continentalMap");p(this,"erosionMap");p(this,"pvMap");p(this,"heightMap");p(this,"densityMap");this.continentalMap=n,this.erosionMap=s,this.pvMap=i,this.heightMap=a,this.densityMap=u}getSurfaceHeightAt(e,n){return Math.floor(this.heightMap.getValueAt(e,n)*.25)}getContinentalnessAt(e,n){return this.continentalMap.getValueAt(e,n)}getErosionAt(e,n){return this.erosionMap.getValueAt(e,n)}getPVAt(e,n){return this.pvMap.getValueAt(e,n)}getDensityAt(e,n,s){return this.densityMap.getValueAt(e,n,s)}getHeightMap(){return this.heightMap}}var re=(r=>(r[r.EMPTY=0]="EMPTY",r[r.TRUNK=1]="TRUNK",r[r.LEAF=2]="LEAF",r))(re||{});class Kt{static encode(t){let e=0;return e=this.setType(e,t.type),e=this.setTrunkHeight(e,t.trunkHeight),e=this.setTrunkSurfaceY(e,t.trunkSurfaceY),e=this.setTrunkDistance(e,t.trunkDistance),e}static decode(t){return{type:this.getType(t),trunkHeight:this.getTrunkHeight(t),trunkSurfaceY:this.getTrunkSurfaceY(t),trunkDistance:this.getTrunkDistance(t)}}static getType(t){return(t&this.TYPE_MASK)>>14}static setType(t,e){return t|=e<<14&this.TYPE_MASK}static getTrunkHeight(t){return(t&this.TRUNK_HEIGHT_MASK)>>10}static setTrunkHeight(t,e){return t|=e<<10&this.TRUNK_HEIGHT_MASK}static getTrunkSurfaceY(t){return(t&this.TRUNK_SURFACE_HEIGHT_MASK)>>2}static setTrunkSurfaceY(t,e){return t|=e<<2&this.TRUNK_SURFACE_HEIGHT_MASK}static getTrunkDistance(t){return t&this.TRUNK_DISTANCE_MASK}static setTrunkDistance(t,e){return t|=e&this.TRUNK_DISTANCE_MASK}}p(Kt,"TYPE_MASK",49152),p(Kt,"TRUNK_HEIGHT_MASK",15360),p(Kt,"TRUNK_SURFACE_HEIGHT_MASK",1020),p(Kt,"TRUNK_DISTANCE_MASK",3);class se extends Yt{constructor(e){super(e);p(this,"enabled");this.enabled=L.TREE_GENERATION_ENABLED}shouldSpawnTreeLeafAt(e,n,s){if(!this.enabled)return!1;const i=this.getTreeMapValueAt(e,s);if(i==null)return!1;const{type:a,trunkDistance:u,trunkHeight:h,trunkSurfaceY:l}=Kt.decode(i),o=l+h,c=n-o;if(a===re.TRUNK){if(c===2)return Ds(.5);if(c===1)return!0}return!!(a===re.LEAF&&(u===2&&ge(c,-1,0)||u===1&&ge(c,-1,1)))}shouldSpawnTreeTrunkAt(e,n,s,i){if(!this.enabled)return!1;const a=this.getTreeMapTypeAt(e,s);return n<i||n>i+_t.TRUNK_HEIGHT||a==null?!1:a===re.TRUNK}getTreeMapTypeAt(e,n){const s=this.getTreeMapValueAt(e,n);return s!=null?Kt.getType(s):null}getTreeMapValueAt(e,n){return this.getPointData(e,n)}static getTreeSeedAt(e,n,s){return`${e}_${n}_${s}`}setValueAt(e,n,s){return this.setPointData(e,n,s)}getValueAt(e,n){return this.getPointData(e,n)??re.EMPTY}}p(se,"MAP_SIZE",ct.WIDTH+_t.RADIUS*2);class Gs extends st{constructor(t){super(t)}getTerrainMap(){const{seed:t}=this,e=new it(st.getContinentalMapSeed(t)),n=new wt(st.getErosionMapSeed(t)),s=new Tt(st.getPvMapSeed(t)),i=new Fs(st.getHeightMapSeed(t),e,n,s),a=new Ps(st.getDensityMapSeed(t),n,s);return new Hs(t,e,n,s,i,a)}getTreeMapFromBuffer(t,e){const{x:n,z:s}=ct.getChunkOriginPosition(t),i=new se(this.seed),a=new Map,u=n-_t.RADIUS,h=s-_t.RADIUS;for(let l=0;l<e.length;l++){const o=Math.floor(l/se.MAP_SIZE)+u,c=l%se.MAP_SIZE+h,d=se.computeKey(o,c);a.set(d,e[l])}return i.setMapData(a),i}}class On{constructor(t){p(this,"terrainMap");this.terrainMap=t}getSurfaceHeightAt(t,e){return this.terrainMap.getSurfaceHeightAt(t,e)}getContinentalTypeAt(t,e){const n=this.terrainMap.getContinentalnessAt(t,e);return it.getType(n)}getPvTypeAt(t,e){const n=this.terrainMap.getPVAt(t,e);return Tt.getType(n)}getErosionTypeAt(t,e){const n=this.terrainMap.getErosionAt(t,e);return wt.getType(n)}}class Bs extends On{constructor(e,n){super(e);p(this,"treeMap");this.treeMap=n}generateBlock(e,n,s){if(!(Math.abs(e-0)<100&&Math.abs(s-0)<100))return null;const o=this.getSurfaceHeightAt(e,s);return n<o?null:this.shouldSpawnWater(e,n,s)?V.WATER:this.treeMap.shouldSpawnTreeTrunkAt(e,n,s,o)?V.OAK_LOG:this.treeMap.shouldSpawnTreeLeafAt(e,n,s)?V.OAK_LEAVES:this.shouldSpawnCloud(e,n,s)?V.CLOUD:V.AIR}shouldSpawnWater(e,n,s){return n<N.SEA_LEVEL}shouldSpawnCloud(e,n,s){const i=Math.floor(Math.random()*6)+1,a=n>N.CLOUD_LEVEL&&n<=N.CLOUD_LEVEL+1,u=Math.ceil(e/N.CLOUD_WIDTH)%i===0&&Math.ceil(s/N.CLOUD_DEPTH)%i===0;return a&&u}}var je={},Vs={get exports(){return je},set exports(r){je=r}};(function(r){(function(t){function e(l){function o(c,d,f){this.x=c,this.y=d,this.z=f}o.prototype.dot2=function(c,d){return this.x*c+this.y*d},o.prototype.dot3=function(c,d,f){return this.x*c+this.y*d+this.z*f},this.grad3=[new o(1,1,0),new o(-1,1,0),new o(1,-1,0),new o(-1,-1,0),new o(1,0,1),new o(-1,0,1),new o(1,0,-1),new o(-1,0,-1),new o(0,1,1),new o(0,-1,1),new o(0,1,-1),new o(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.seed(l||0)}e.prototype.seed=function(l){l>0&&l<1&&(l*=65536),l=Math.floor(l),l<256&&(l|=l<<8);for(var o=this.p,c=0;c<256;c++){var d;c&1?d=o[c]^l&255:d=o[c]^l>>8&255;var f=this.perm,_=this.gradP;f[c]=f[c+256]=d,_[c]=_[c+256]=this.grad3[d%12]}};var n=.5*(Math.sqrt(3)-1),s=(3-Math.sqrt(3))/6,i=1/3,a=1/6;e.prototype.simplex2=function(l,o){var c,d,f,_=(l+o)*n,x=Math.floor(l+_),w=Math.floor(o+_),b=(x+w)*s,g=l-x+b,E=o-w+b,T,M;g>E?(T=1,M=0):(T=0,M=1);var y=g-T+s,I=E-M+s,C=g-1+2*s,m=E-1+2*s;x&=255,w&=255;var S=this.perm,A=this.gradP,v=A[x+S[w]],k=A[x+T+S[w+M]],O=A[x+1+S[w+1]],z=.5-g*g-E*E;z<0?c=0:(z*=z,c=z*z*v.dot2(g,E));var U=.5-y*y-I*I;U<0?d=0:(U*=U,d=U*U*k.dot2(y,I));var j=.5-C*C-m*m;return j<0?f=0:(j*=j,f=j*j*O.dot2(C,m)),70*(c+d+f)},e.prototype.simplex3=function(l,o,c){var d,f,_,x,w=(l+o+c)*i,b=Math.floor(l+w),g=Math.floor(o+w),E=Math.floor(c+w),T=(b+g+E)*a,M=l-b+T,y=o-g+T,I=c-E+T,C,m,S,A,v,k;M>=y?y>=I?(C=1,m=0,S=0,A=1,v=1,k=0):M>=I?(C=1,m=0,S=0,A=1,v=0,k=1):(C=0,m=0,S=1,A=1,v=0,k=1):y<I?(C=0,m=0,S=1,A=0,v=1,k=1):M<I?(C=0,m=1,S=0,A=0,v=1,k=1):(C=0,m=1,S=0,A=1,v=1,k=0);var O=M-C+a,z=y-m+a,U=I-S+a,j=M-A+2*a,et=y-v+2*a,Y=I-k+2*a,$=M-1+3*a,At=y-1+3*a,It=I-1+3*a;b&=255,g&=255,E&=255;var q=this.perm,X=this.gradP,lt=X[b+q[g+q[E]]],ht=X[b+C+q[g+m+q[E+S]]],Et=X[b+A+q[g+v+q[E+k]]],dt=X[b+1+q[g+1+q[E+1]]],Q=.5-M*M-y*y-I*I;Q<0?d=0:(Q*=Q,d=Q*Q*lt.dot3(M,y,I));var B=.5-O*O-z*z-U*U;B<0?f=0:(B*=B,f=B*B*ht.dot3(O,z,U));var Nt=.5-j*j-et*et-Y*Y;Nt<0?_=0:(Nt*=Nt,_=Nt*Nt*Et.dot3(j,et,Y));var Ft=.5-$*$-At*At-It*It;return Ft<0?x=0:(Ft*=Ft,x=Ft*Ft*dt.dot3($,At,It)),32*(d+f+_+x)};function u(l){return l*l*l*(l*(l*6-15)+10)}function h(l,o,c){return(1-c)*l+c*o}e.prototype.perlin2=function(l,o){var c=Math.floor(l),d=Math.floor(o);l=l-c,o=o-d,c=c&255,d=d&255;var f=this.perm,_=this.gradP,x=_[c+f[d]].dot2(l,o),w=_[c+f[d+1]].dot2(l,o-1),b=_[c+1+f[d]].dot2(l-1,o),g=_[c+1+f[d+1]].dot2(l-1,o-1),E=u(l);return h(h(x,b,E),h(w,g,E),u(o))},e.prototype.perlin3=function(l,o,c){var d=Math.floor(l),f=Math.floor(o),_=Math.floor(c);l=l-d,o=o-f,c=c-_,d=d&255,f=f&255,_=_&255;var x=this.perm,w=this.gradP,b=w[d+x[f+x[_]]].dot3(l,o,c),g=w[d+x[f+x[_+1]]].dot3(l,o,c-1),E=w[d+x[f+1+x[_]]].dot3(l,o-1,c),T=w[d+x[f+1+x[_+1]]].dot3(l,o-1,c-1),M=w[d+1+x[f+x[_]]].dot3(l-1,o,c),y=w[d+1+x[f+x[_+1]]].dot3(l-1,o,c-1),I=w[d+1+x[f+1+x[_]]].dot3(l-1,o-1,c),C=w[d+1+x[f+1+x[_+1]]].dot3(l-1,o-1,c-1),m=u(l),S=u(o),A=u(c);return h(h(h(b,M,m),h(g,y,m),A),h(h(E,I,m),h(T,C,m),A),S)},t.Noise=e})(r.exports)})(Vs);class Rn extends On{constructor(t){super(t)}generateBlock(t,e,n,s){if(Math.hypot(t-0,n-0)>s)return V.AIR;const h=this.getSurfaceHeightAt(t,n);if(this.terrainMap.getDensityAt(t,e,n)<0||e>=h)return V.AIR;const o=Math.abs(e-h);switch(this.getDepthLevel(e,o)){case"Surface":return this.getSurfaceBlockType(t,e,n);case"Subsurface":return this.getSubSurfaceBlockType(t,e,n);case"Mid":return this.getMidBlockType(t,e,n,o);default:return V.STONE}}getMidBlockType(t,e,n,s){return V.STONE}getSurfaceBlockType(t,e,n){return this.shouldSpawnSnow(t,e,n)?V.GRASS_SNOW:this.shouldSpawnSand(t,e,n)?V.SAND:e<N.SEA_LEVEL-1?V.DIRT:this.shouldSpawnSurfaceStone(t,e,n)?V.STONE:V.GRASS}getSubSurfaceBlockType(t,e,n){return this.shouldSpawnSurfaceStone(t,e,n)?V.STONE:V.DIRT}shouldSpawnSand(t,e,n){const s=this.getContinentalTypeAt(t,n);return e<=N.SAND_LEVEL&&(s==="Coast"||s==="Ocean")}shouldSpawnSurfaceStone(t,e,n){const s=this.getPvTypeAt(t,n),i=this.getContinentalTypeAt(t,n),a=this.getErosionTypeAt(t,n),u=i==="Far_Inland",h=i==="Inland",l=a==="Flat",o=a==="VeryLow"||a==="Low",c=a==="VeryLow",d=s==="Valley",f=s==="Valley"||s==="Low";return u&&c&&f||u&&o&&d||(h||u)&&l&&f}shouldSpawnCoal(t,e,n,s){const i=this.terrainMap.getDensityAt(t,e,n),a=ge(i,.05,.07);return ge(s,5,20)&&a}shouldSpawnSnow(t,e,n){const i=this.getContinentalTypeAt(t,n)==="Far_Inland",a=e>=N.SNOW_LEVEL;return i&&a}getDepthLevel(t,e){return e<=1?"Surface":e<=3?"Subsurface":t<=N.BEDROCK_LEVEL?"BedRock":t<=N.MIN_SURFACE_HEIGHT-5?"Deep":"Mid"}}p(Rn,"noise",new je.Noise(1));var zn=(r=>(r[r.TERRAIN=0]="TERRAIN",r[r.FEATURES=1]="FEATURES",r))(zn||{});class Us{constructor(t,e){p(this,"terrainGenerator");p(this,"featuresGenerator");this.terrainGenerator=new Rn(t),this.featuresGenerator=new Bs(t,e)}getBlockGenerator(t){switch(t){case 0:return this.terrainGenerator;case 1:return this.featuresGenerator}}}class js{constructor(t){p(this,"DEFAULT_BLOCK_COLOR_RGBA",[1,1,1,1]);p(this,"AO_INTENSITY_LEVEL",[0,.2,.3,.4]);p(this,"terrainMap");this.terrainMap=t}buildChunkGeometry(t,e){const{x:n,y:s,z:i}=e,a=[],u=[],h=[],l=[],o=[],c=[],d=[],f=[],_=[],x=[];for(let w=0;w<ct.HEIGHT;++w){const b=s+w;for(let g=0;g<ct.WIDTH;++g){const E=i+g;for(let T=0;T<ct.WIDTH;++T){const M=n+T,y={x:M,y:b,z:E},I=t.getBlock(y),C=St.isVisibleBlock(I==null?void 0:I.type);if(I&&C){const m=I.isTransparent,S=I.type===V.WATER;if(S&&this.canSkipWaterBlockRendering(b))continue;const A=m?c:a,v=m?d:u,k=m?f:h,O=m?_:l,z=m?x:o;for(const U of St.getBlockFaces()){if(S&&U!=="top")continue;const{normal:j,vertices:et}=St.getBlockFaceGeometry(U),Y={x:M+j[0],y:b+j[1],z:E+j[2]},$=t.getBlock(Y);if(L.TERRAIN_OPTIMIZATION_ENABLED&&!$&&this.canCullEdgeBlockFace(y,U,Y))continue;if(!$||$.isTransparent&&$.type!==V.CLOUD){const X=A.length/3;for(const{pos:lt,uv:ht,ao:Et}of et){const dt=M+lt[0],Q=b+lt[1],B=E+lt[2];A.push(dt,Q,B),v.push(...j);const Nt=St.getBlockUVCoordinates(I.type,U,[ht[0],ht[1]]);O.push(Nt.u,Nt.v);const Ft=this.calculateVertexColor({x:dt,y:Q,z:B},I,Et,t);z.push(...Ft)}k.push(X,X+1,X+2,X+2,X+1,X+3)}}}}}}return{solid:{positions:a,normals:u,indices:h,uvs:l,colors:o},transparent:{positions:c,normals:d,indices:f,uvs:_,colors:x}}}canCullEdgeBlockFace(t,e,n){const{terrainMap:s}=this,{x:i,y:a,z:u}=t,{x:h,y:l,z:o}=n,c=s.getSurfaceHeightAt(h,o);if(!(a<c-(e==="top"?1:0)))return!1;const f=s.getDensityAt(i,a,u),_=s.getDensityAt(h,l,o);return Math.sign(f)===Math.sign(_)}calculateVertexColor(t,e,n,s){const i=St.getBlockColor(e.type)??this.DEFAULT_BLOCK_COLOR_RGBA,a=this.computeVertexAO(t,n,s);return[i[0]-a,i[1]-a,i[2]-a,i[3]]}computeVertexAO(t,{corner:e,side1:n,side2:s},i){let a=0;for(const u of[e,n,s])this.isSideOccluded(t,u,i)&&(a+=1);return this.AO_INTENSITY_LEVEL[a]}isSideOccluded({x:t,y:e,z:n},s,i){const{terrainMap:a}=this,[u,h,l]=s,o=i.getBlock({x:t+u,y:e+h,z:n+l});if(o&&!o.isTransparent)return!0;if(!o){const c=Math.floor(t+u),d=Math.floor(e+h),f=Math.floor(n+l),_=a.getSurfaceHeightAt(c,f),x=a.getDensityAt(c,d,f),w=Math.sign(x)>0,b=Math.sign(h)>0,g=Math.sign(h)<0,E=e<_,T=Math.abs(e-_)===0;if(w)return b&&E||g&&T}return!1}canSkipWaterBlockRendering(t){return t!==N.SEA_LEVEL-1}static extractBufferGeometryDataFromGeometry(t){var u,h;const e=Array.from(t.getAttribute("position").array),n=Array.from(t.getAttribute("normal").array),s=Array.from(t.getAttribute("uv").array),i=Array.from(((u=t.getAttribute("color"))==null?void 0:u.array)??[]),a=Array.from(((h=t.index)==null?void 0:h.array)??[]);return{positions:e,normals:n,uvs:s,indices:a,colors:i}}}function Ws(r,t,e,n){const s=new ct(r),i=new Gs(t),a=i.getTerrainMap(),u=i.getTreeMapFromBuffer(r,new Uint16Array(e)),l=new Us(a,u).getBlockGenerator(zn.TERRAIN);s.decorateChunk(l,n);const o=s.getBlocks(),c=new js(a),{solid:d,transparent:f}=c.buildChunkGeometry(s,s.getWorldOriginPosition());return{solidGeometry:d,transparentGeometry:f,blocksBuffer:ss(o.buffer)}}is(Ws)})();
