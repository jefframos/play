var Ws=Object.defineProperty;var js=(L,tt,xt)=>tt in L?Ws(L,tt,{enumerable:!0,configurable:!0,writable:!0,value:xt}):L[tt]=xt;var f=(L,tt,xt)=>(js(L,typeof tt!="symbol"?tt+"":tt,xt),xt);(function(){"use strict";var L=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tt(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function xt(r){if(r.__esModule)return r;var t=r.default;if(typeof t=="function"){var e=function n(){if(this instanceof n){var s=[null];s.push.apply(s,arguments);var i=Function.bind.apply(t,s);return new i}return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),e}var je={},Y={},Mt={};Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.DefaultSerializer=Mt.extendSerializer=void 0;function vn(r,t){const e=r.deserialize.bind(r),n=r.serialize.bind(r);return{deserialize(s){return t.deserialize(s,e)},serialize(s){return t.serialize(s,n)}}}Mt.extendSerializer=vn;const Ue={deserialize(r){return Object.assign(Error(r.message),{name:r.name,stack:r.stack})},serialize(r){return{__error_marker:"$$error",message:r.message,name:r.name,stack:r.stack}}},On=r=>r&&typeof r=="object"&&"__error_marker"in r&&r.__error_marker==="$$error";Mt.DefaultSerializer={deserialize(r){return On(r)?Ue.deserialize(r):r},serialize(r){return r instanceof Error?Ue.serialize(r):r}},Object.defineProperty(Y,"__esModule",{value:!0}),Y.serialize=Y.deserialize=Y.registerSerializer=void 0;const $e=Mt;let Jt=$e.DefaultSerializer;function Rn(r){Jt=$e.extendSerializer(Jt,r)}Y.registerSerializer=Rn;function Ln(r){return Jt.deserialize(r)}Y.deserialize=Ln;function Dn(r){return Jt.serialize(r)}Y.serialize=Dn;var Ye={},it={},vt={};Object.defineProperty(vt,"__esModule",{value:!0}),vt.getBundleURL=vt.getBaseURL=void 0;let _e;function Pn(){return _e||(_e=Fn()),_e}vt.getBundleURL=Pn;function Fn(){try{throw new Error}catch(r){const t=(""+r.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(t)return Ke(t[0])}return"/"}function Ke(r){return(""+r).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)?\/[^/]+(?:\?.*)?$/,"$1")+"/"}vt.getBaseURL=Ke,Object.defineProperty(it,"__esModule",{value:!0}),it.isWorkerRuntime=it.getWorkerImplementation=it.defaultPoolSize=void 0;const Xe=vt;it.defaultPoolSize=typeof navigator<"u"&&navigator.hardwareConcurrency?navigator.hardwareConcurrency:4;const Ze=r=>/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(r);function qe(r){const t=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(t)}function Hn(){if(typeof Worker>"u")return class{constructor(){throw Error("No web worker implementation available. You might have tried to spawn a worker within a worker in a browser that doesn't support workers in workers.")}};class r extends Worker{constructor(n,s){var i,o;typeof n=="string"&&s&&s._baseURL?n=new URL(n,s._baseURL):typeof n=="string"&&!Ze(n)&&Xe.getBundleURL().match(/^file:\/\//i)&&(n=new URL(n,Xe.getBundleURL().replace(/\/[^\/]+$/,"/")),(!((i=s==null?void 0:s.CORSWorkaround)!==null&&i!==void 0)||i)&&(n=qe(`importScripts(${JSON.stringify(n)});`))),typeof n=="string"&&Ze(n)&&(!((o=s==null?void 0:s.CORSWorkaround)!==null&&o!==void 0)||o)&&(n=qe(`importScripts(${JSON.stringify(n)});`)),super(n,s)}}class t extends r{constructor(n,s){const i=window.URL.createObjectURL(n);super(i,s)}static fromText(n,s){const i=new window.Blob([n],{type:"text/javascript"});return new t(i,s)}}return{blob:t,default:r}}let ye;function Gn(){return ye||(ye=Hn()),ye}it.getWorkerImplementation=Gn;function Bn(){const r=typeof self<"u"&&typeof Window<"u"&&self instanceof Window;return!!(typeof self<"u"&&self.postMessage&&!r)}it.isWorkerRuntime=Bn;var Qe={},Ot={},Vn={get exports(){return Ot},set exports(r){Ot=r}},be,Je;function Wn(){if(Je)return be;Je=1;var r=1e3,t=r*60,e=t*60,n=e*24,s=n*7,i=n*365.25;be=function(a,u){u=u||{};var d=typeof a;if(d==="string"&&a.length>0)return o(a);if(d==="number"&&isFinite(a))return u.long?l(a):c(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))};function o(a){if(a=String(a),!(a.length>100)){var u=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(a);if(u){var d=parseFloat(u[1]),g=(u[2]||"ms").toLowerCase();switch(g){case"years":case"year":case"yrs":case"yr":case"y":return d*i;case"weeks":case"week":case"w":return d*s;case"days":case"day":case"d":return d*n;case"hours":case"hour":case"hrs":case"hr":case"h":return d*e;case"minutes":case"minute":case"mins":case"min":case"m":return d*t;case"seconds":case"second":case"secs":case"sec":case"s":return d*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return d;default:return}}}}function c(a){var u=Math.abs(a);return u>=n?Math.round(a/n)+"d":u>=e?Math.round(a/e)+"h":u>=t?Math.round(a/t)+"m":u>=r?Math.round(a/r)+"s":a+"ms"}function l(a){var u=Math.abs(a);return u>=n?h(a,u,n,"day"):u>=e?h(a,u,e,"hour"):u>=t?h(a,u,t,"minute"):u>=r?h(a,u,r,"second"):a+" ms"}function h(a,u,d,g){var _=u>=d*1.5;return Math.round(a/d)+" "+g+(_?"s":"")}return be}function jn(r){e.debug=e,e.default=e,e.coerce=l,e.disable=i,e.enable=s,e.enabled=o,e.humanize=Wn(),e.destroy=h,Object.keys(r).forEach(a=>{e[a]=r[a]}),e.names=[],e.skips=[],e.formatters={};function t(a){let u=0;for(let d=0;d<a.length;d++)u=(u<<5)-u+a.charCodeAt(d),u|=0;return e.colors[Math.abs(u)%e.colors.length]}e.selectColor=t;function e(a){let u,d=null,g,_;function k(...I){if(!k.enabled)return;const S=k,y=Number(new Date),b=y-(u||y);S.diff=b,S.prev=u,S.curr=y,u=y,I[0]=e.coerce(I[0]),typeof I[0]!="string"&&I.unshift("%O");let E=0;I[0]=I[0].replace(/%([a-zA-Z%])/g,(p,A)=>{if(p==="%%")return"%";E++;const z=e.formatters[A];if(typeof z=="function"){const m=I[E];p=z.call(S,m),I.splice(E,1),E--}return p}),e.formatArgs.call(S,I),(S.log||e.log).apply(S,I)}return k.namespace=a,k.useColors=e.useColors(),k.color=e.selectColor(a),k.extend=n,k.destroy=e.destroy,Object.defineProperty(k,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(g!==e.namespaces&&(g=e.namespaces,_=e.enabled(a)),_),set:I=>{d=I}}),typeof e.init=="function"&&e.init(k),k}function n(a,u){const d=e(this.namespace+(typeof u>"u"?":":u)+a);return d.log=this.log,d}function s(a){e.save(a),e.namespaces=a,e.names=[],e.skips=[];let u;const d=(typeof a=="string"?a:"").split(/[\s,]+/),g=d.length;for(u=0;u<g;u++)d[u]&&(a=d[u].replace(/\*/g,".*?"),a[0]==="-"?e.skips.push(new RegExp("^"+a.slice(1)+"$")):e.names.push(new RegExp("^"+a+"$")))}function i(){const a=[...e.names.map(c),...e.skips.map(c).map(u=>"-"+u)].join(",");return e.enable(""),a}function o(a){if(a[a.length-1]==="*")return!0;let u,d;for(u=0,d=e.skips.length;u<d;u++)if(e.skips[u].test(a))return!1;for(u=0,d=e.names.length;u<d;u++)if(e.names[u].test(a))return!0;return!1}function c(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}function l(a){return a instanceof Error?a.stack||a.message:a}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var Un=jn;(function(r,t){t.formatArgs=n,t.save=s,t.load=i,t.useColors=e,t.storage=o(),t.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;l.splice(1,0,h,"color: inherit");let a=0,u=0;l[0].replace(/%[a-zA-Z%]/g,d=>{d!=="%%"&&(a++,d==="%c"&&(u=a))}),l.splice(u,0,h)}t.log=console.debug||console.log||(()=>{});function s(l){try{l?t.storage.setItem("debug",l):t.storage.removeItem("debug")}catch{}}function i(){let l;try{l=t.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l={}.DEBUG),l}function o(){try{return localStorage}catch{}}r.exports=Un(t);const{formatters:c}=r.exports;c.j=function(l){try{return JSON.stringify(l)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}})(Vn,Ot);var $n=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function c(a){try{h(n.next(a))}catch(u){o(u)}}function l(a){try{h(n.throw(a))}catch(u){o(u)}}function h(a){a.done?i(a.value):s(a.value).then(c,l)}h((n=n.apply(r,t||[])).next())})};class te{constructor(t){this._baseObserver=t,this._pendingPromises=new Set}complete(){Promise.all(this._pendingPromises).then(()=>this._baseObserver.complete()).catch(t=>this._baseObserver.error(t))}error(t){this._baseObserver.error(t)}schedule(t){const e=Promise.all(this._pendingPromises),n=[],s=o=>n.push(o),i=Promise.resolve().then(()=>$n(this,void 0,void 0,function*(){yield e,yield t(s),this._pendingPromises.delete(i);for(const o of n)this._baseObserver.next(o)})).catch(o=>{this._pendingPromises.delete(i),this._baseObserver.error(o)});this._pendingPromises.add(i)}}const tn=()=>typeof Symbol=="function",Vt=r=>tn()&&!!Symbol[r],Ee=r=>Vt(r)?Symbol[r]:"@@"+r;Vt("asyncIterator")||(Symbol.asyncIterator=Symbol.asyncIterator||Symbol.for("Symbol.asyncIterator"));const Yn=Ee("iterator"),Se=Ee("observable"),en=Ee("species");function ee(r,t){const e=r[t];if(e!=null){if(typeof e!="function")throw new TypeError(e+" is not a function");return e}}function Wt(r){let t=r.constructor;return t!==void 0&&(t=t[en],t===null&&(t=void 0)),t!==void 0?t:K}function Kn(r){return r instanceof K}function Rt(r){Rt.log?Rt.log(r):setTimeout(()=>{throw r},0)}function ne(r){Promise.resolve().then(()=>{try{r()}catch(t){Rt(t)}})}function nn(r){const t=r._cleanup;if(t!==void 0&&(r._cleanup=void 0,!!t))try{if(typeof t=="function")t();else{const e=ee(t,"unsubscribe");e&&e.call(t)}}catch(e){Rt(e)}}function xe(r){r._observer=void 0,r._queue=void 0,r._state="closed"}function Xn(r){const t=r._queue;if(t){r._queue=void 0,r._state="ready";for(const e of t)if(rn(r,e.type,e.value),r._state==="closed")break}}function rn(r,t,e){r._state="running";const n=r._observer;try{const s=n?ee(n,t):void 0;switch(t){case"next":s&&s.call(n,e);break;case"error":if(xe(r),s)s.call(n,e);else throw e;break;case"complete":xe(r),s&&s.call(n);break}}catch(s){Rt(s)}r._state==="closed"?nn(r):r._state==="running"&&(r._state="ready")}function Me(r,t,e){if(r._state!=="closed"){if(r._state==="buffering"){r._queue=r._queue||[],r._queue.push({type:t,value:e});return}if(r._state!=="ready"){r._state="buffering",r._queue=[{type:t,value:e}],ne(()=>Xn(r));return}rn(r,t,e)}}class Zn{constructor(t,e){this._cleanup=void 0,this._observer=t,this._queue=void 0,this._state="initializing";const n=new qn(this);try{this._cleanup=e.call(void 0,n)}catch(s){n.error(s)}this._state==="initializing"&&(this._state="ready")}get closed(){return this._state==="closed"}unsubscribe(){this._state!=="closed"&&(xe(this),nn(this))}}class qn{constructor(t){this._subscription=t}get closed(){return this._subscription._state==="closed"}next(t){Me(this._subscription,"next",t)}error(t){Me(this._subscription,"error",t)}complete(){Me(this._subscription,"complete")}}class K{constructor(t){if(!(this instanceof K))throw new TypeError("Observable cannot be called as a function");if(typeof t!="function")throw new TypeError("Observable initializer must be a function");this._subscriber=t}subscribe(t,e,n){return(typeof t!="object"||t===null)&&(t={next:t,error:e,complete:n}),new Zn(t,this._subscriber)}pipe(t,...e){let n=this;for(const s of[t,...e])n=s(n);return n}tap(t,e,n){const s=typeof t!="object"||t===null?{next:t,error:e,complete:n}:t;return new K(i=>this.subscribe({next(o){s.next&&s.next(o),i.next(o)},error(o){s.error&&s.error(o),i.error(o)},complete(){s.complete&&s.complete(),i.complete()},start(o){s.start&&s.start(o)}}))}forEach(t){return new Promise((e,n)=>{if(typeof t!="function"){n(new TypeError(t+" is not a function"));return}function s(){i.unsubscribe(),e(void 0)}const i=this.subscribe({next(o){try{t(o,s)}catch(c){n(c),i.unsubscribe()}},error(o){n(o)},complete(){e(void 0)}})})}map(t){if(typeof t!="function")throw new TypeError(t+" is not a function");const e=Wt(this);return new e(n=>this.subscribe({next(s){let i=s;try{i=t(s)}catch(o){return n.error(o)}n.next(i)},error(s){n.error(s)},complete(){n.complete()}}))}filter(t){if(typeof t!="function")throw new TypeError(t+" is not a function");const e=Wt(this);return new e(n=>this.subscribe({next(s){try{if(!t(s))return}catch(i){return n.error(i)}n.next(s)},error(s){n.error(s)},complete(){n.complete()}}))}reduce(t,e){if(typeof t!="function")throw new TypeError(t+" is not a function");const n=Wt(this),s=arguments.length>1;let i=!1,o=e;return new n(c=>this.subscribe({next(l){const h=!i;if(i=!0,!h||s)try{o=t(o,l)}catch(a){return c.error(a)}else o=l},error(l){c.error(l)},complete(){if(!i&&!s)return c.error(new TypeError("Cannot reduce an empty sequence"));c.next(o),c.complete()}}))}concat(...t){const e=Wt(this);return new e(n=>{let s,i=0;function o(c){s=c.subscribe({next(l){n.next(l)},error(l){n.error(l)},complete(){i===t.length?(s=void 0,n.complete()):o(e.from(t[i++]))}})}return o(this),()=>{s&&(s.unsubscribe(),s=void 0)}})}flatMap(t){if(typeof t!="function")throw new TypeError(t+" is not a function");const e=Wt(this);return new e(n=>{const s=[],i=this.subscribe({next(c){let l;if(t)try{l=t(c)}catch(a){return n.error(a)}else l=c;const h=e.from(l).subscribe({next(a){n.next(a)},error(a){n.error(a)},complete(){const a=s.indexOf(h);a>=0&&s.splice(a,1),o()}});s.push(h)},error(c){n.error(c)},complete(){o()}});function o(){i.closed&&s.length===0&&n.complete()}return()=>{s.forEach(c=>c.unsubscribe()),i.unsubscribe()}})}[Se](){return this}static from(t){const e=typeof this=="function"?this:K;if(t==null)throw new TypeError(t+" is not an object");const n=ee(t,Se);if(n){const s=n.call(t);if(Object(s)!==s)throw new TypeError(s+" is not an object");return Kn(s)&&s.constructor===e?s:new e(i=>s.subscribe(i))}if(Vt("iterator")){const s=ee(t,Yn);if(s)return new e(i=>{ne(()=>{if(!i.closed){for(const o of s.call(t))if(i.next(o),i.closed)return;i.complete()}})})}if(Array.isArray(t))return new e(s=>{ne(()=>{if(!s.closed){for(const i of t)if(s.next(i),s.closed)return;s.complete()}})});throw new TypeError(t+" is not observable")}static of(...t){const e=typeof this=="function"?this:K;return new e(n=>{ne(()=>{if(!n.closed){for(const s of t)if(n.next(s),n.closed)return;n.complete()}})})}static get[en](){return this}}tn()&&Object.defineProperty(K,Symbol("extensions"),{value:{symbol:Se,hostReportError:Rt},configurable:!0});var Tt=K;function wt(r){typeof r=="function"?r():r&&typeof r.unsubscribe=="function"&&r.unsubscribe()}var Qn=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function c(a){try{h(n.next(a))}catch(u){o(u)}}function l(a){try{h(n.throw(a))}catch(u){o(u)}}function h(a){a.done?i(a.value):s(a.value).then(c,l)}h((n=n.apply(r,t||[])).next())})};function Jn(r){return t=>new Tt(e=>{const n=new te(e),s=t.subscribe({complete(){n.complete()},error(i){n.error(i)},next(i){n.schedule(o=>Qn(this,void 0,void 0,function*(){(yield r(i))&&o(i)}))}});return()=>wt(s)})}function tr(r){return r&&Vt("asyncIterator")&&r[Symbol.asyncIterator]}function er(r){return r&&Vt("iterator")&&r[Symbol.iterator]}var nr=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function c(a){try{h(n.next(a))}catch(u){o(u)}}function l(a){try{h(n.throw(a))}catch(u){o(u)}}function h(a){a.done?i(a.value):s(a.value).then(c,l)}h((n=n.apply(r,t||[])).next())})},rr=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=r[Symbol.asyncIterator],e;return t?t.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(i){e[i]=r[i]&&function(o){return new Promise(function(c,l){o=r[i](o),s(c,l,o.done,o.value)})}}function s(i,o,c,l){Promise.resolve(l).then(function(h){i({value:h,done:c})},o)}};function sr(r){return t=>new Tt(e=>{const n=new te(e),s=t.subscribe({complete(){n.complete()},error(i){n.error(i)},next(i){n.schedule(o=>nr(this,void 0,void 0,function*(){var c,l;const h=yield r(i);if(er(h)||tr(h))try{for(var a=rr(h),u;u=yield a.next(),!u.done;){const d=u.value;o(d)}}catch(d){c={error:d}}finally{try{u&&!u.done&&(l=a.return)&&(yield l.call(a))}finally{if(c)throw c.error}}else h.map(d=>o(d))}))}});return()=>wt(s)})}function ir(r){return new K(t=>{let e=0;const n=setInterval(()=>{t.next(e++)},r);return()=>clearInterval(n)})}var or=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function c(a){try{h(n.next(a))}catch(u){o(u)}}function l(a){try{h(n.throw(a))}catch(u){o(u)}}function h(a){a.done?i(a.value):s(a.value).then(c,l)}h((n=n.apply(r,t||[])).next())})};function ar(r){return t=>new Tt(e=>{const n=new te(e),s=t.subscribe({complete(){n.complete()},error(i){n.error(i)},next(i){n.schedule(o=>or(this,void 0,void 0,function*(){const c=yield r(i);o(c)}))}});return()=>wt(s)})}function cr(...r){return r.length===0?K.from([]):new K(t=>{let e=0;const n=r.map(i=>i.subscribe({error(o){t.error(o),s()},next(o){t.next(o)},complete(){++e===r.length&&(t.complete(),s())}})),s=()=>{n.forEach(i=>wt(i))};return s})}class ur extends Tt{constructor(){super(t=>(this._observers.add(t),()=>this._observers.delete(t))),this._observers=new Set}next(t){for(const e of this._observers)e.next(t)}error(t){for(const e of this._observers)e.error(t)}complete(){for(const t of this._observers)t.complete()}}var sn=ur;function lr(r){const t=new sn;let e,n=0;return new Tt(s=>{e||(e=r.subscribe(t));const i=t.subscribe(s);return n++,()=>{n--,i.unsubscribe(),n===0&&(wt(e),e=void 0)}})}var hr=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function c(a){try{h(n.next(a))}catch(u){o(u)}}function l(a){try{h(n.throw(a))}catch(u){o(u)}}function h(a){a.done?i(a.value):s(a.value).then(c,l)}h((n=n.apply(r,t||[])).next())})};function dr(r,t){return e=>new Tt(n=>{let s,i=0;const o=new te(n),c=e.subscribe({complete(){o.complete()},error(l){o.error(l)},next(l){o.schedule(h=>hr(this,void 0,void 0,function*(){s=yield r(i===0?typeof t>"u"?l:t:s,l,i++),h(s)}))}});return()=>wt(c)})}var fr=Object.freeze({__proto__:null,Observable:Tt,Subject:sn,filter:Jn,flatMap:sr,interval:ir,map:ar,merge:cr,multicast:lr,scan:dr,unsubscribe:wt}),re=xt(fr),se={};Object.defineProperty(se,"__esModule",{value:!0}),se.allSettled=void 0;function gr(r){return Promise.all(r.map(t=>{const e=i=>({status:"fulfilled",value:i}),n=i=>({status:"rejected",reason:i}),s=Promise.resolve(t);try{return s.then(e,n)}catch(i){return Promise.reject(i)}}))}se.allSettled=gr;var on={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.PoolEventType=void 0,function(t){t.initialized="initialized",t.taskCanceled="taskCanceled",t.taskCompleted="taskCompleted",t.taskFailed="taskFailed",t.taskQueued="taskQueued",t.taskQueueDrained="taskQueueDrained",t.taskStart="taskStart",t.terminated="terminated"}(r.PoolEventType||(r.PoolEventType={}))})(on);var jt={},W={};Object.defineProperty(W,"__esModule",{value:!0}),W.$worker=W.$transferable=W.$terminate=W.$events=W.$errors=void 0,W.$errors=Symbol("thread.errors"),W.$events=Symbol("thread.events"),W.$terminate=Symbol("thread.terminate"),W.$transferable=Symbol("thread.transferable"),W.$worker=Symbol("thread.worker"),Object.defineProperty(jt,"__esModule",{value:!0}),jt.Thread=void 0;const Te=W;function an(r){throw Error(r)}jt.Thread={errors(r){return r[Te.$errors]||an("Error observable not found. Make sure to pass a thread instance as returned by the spawn() promise.")},events(r){return r[Te.$events]||an("Events observable not found. Make sure to pass a thread instance as returned by the spawn() promise.")},terminate(r){return r[Te.$terminate]()}},function(r){var t=L&&L.__awaiter||function(S,y,b,E){function T(p){return p instanceof b?p:new b(function(A){A(p)})}return new(b||(b=Promise))(function(p,A){function z(w){try{x(E.next(w))}catch(N){A(N)}}function m(w){try{x(E.throw(w))}catch(N){A(N)}}function x(w){w.done?p(w.value):T(w.value).then(z,m)}x((E=E.apply(S,y||[])).next())})},e=L&&L.__importDefault||function(S){return S&&S.__esModule?S:{default:S}};Object.defineProperty(r,"__esModule",{value:!0}),r.Pool=r.Thread=r.PoolEventType=void 0;const n=e(Ot),s=re,i=se,o=it,c=on;Object.defineProperty(r,"PoolEventType",{enumerable:!0,get:function(){return c.PoolEventType}});const l=jt;Object.defineProperty(r,"Thread",{enumerable:!0,get:function(){return l.Thread}});let h=1;function a(S){const y=[];for(let b=0;b<S;b++)y.push(b);return y}function u(S){return new Promise(y=>setTimeout(y,S))}function d(S,y){return S.reduce((b,E)=>[...b,...y(E)],[])}function g(S){return S.replace(/\W/g," ").trim().replace(/\s+/g,"-")}function _(S,y){return a(y).map(()=>({init:S(),runningTasks:[]}))}class k{constructor(y,b){this.eventSubject=new s.Subject,this.initErrors=[],this.isClosing=!1,this.nextTaskID=1,this.taskQueue=[];const E=typeof b=="number"?{size:b}:b||{},{size:T=o.defaultPoolSize}=E;this.debug=n.default(`threads:pool:${g(E.name||String(h++))}`),this.options=E,this.workers=_(y,T),this.eventObservable=s.multicast(s.Observable.from(this.eventSubject)),Promise.all(this.workers.map(p=>p.init)).then(()=>this.eventSubject.next({type:c.PoolEventType.initialized,size:this.workers.length}),p=>{this.debug("Error while initializing pool worker:",p),this.eventSubject.error(p),this.initErrors.push(p)})}findIdlingWorker(){const{concurrency:y=1}=this.options;return this.workers.find(b=>b.runningTasks.length<y)}runPoolTask(y,b){return t(this,void 0,void 0,function*(){const E=this.workers.indexOf(y)+1;this.debug(`Running task #${b.id} on worker #${E}...`),this.eventSubject.next({type:c.PoolEventType.taskStart,taskID:b.id,workerID:E});try{const T=yield b.run(yield y.init);this.debug(`Task #${b.id} completed successfully`),this.eventSubject.next({type:c.PoolEventType.taskCompleted,returnValue:T,taskID:b.id,workerID:E})}catch(T){this.debug(`Task #${b.id} failed`),this.eventSubject.next({type:c.PoolEventType.taskFailed,taskID:b.id,error:T,workerID:E})}})}run(y,b){return t(this,void 0,void 0,function*(){const E=(()=>t(this,void 0,void 0,function*(){const T=()=>{y.runningTasks=y.runningTasks.filter(p=>p!==E)};yield u(0);try{yield this.runPoolTask(y,b)}finally{T(),this.isClosing||this.scheduleWork()}}))();y.runningTasks.push(E)})}scheduleWork(){this.debug("Attempt de-queueing a task in order to run it...");const y=this.findIdlingWorker();if(!y)return;const b=this.taskQueue.shift();if(!b){this.debug("Task queue is empty"),this.eventSubject.next({type:c.PoolEventType.taskQueueDrained});return}this.run(y,b)}taskCompletion(y){return new Promise((b,E)=>{const T=this.events().subscribe(p=>{p.type===c.PoolEventType.taskCompleted&&p.taskID===y?(T.unsubscribe(),b(p.returnValue)):p.type===c.PoolEventType.taskFailed&&p.taskID===y?(T.unsubscribe(),E(p.error)):p.type===c.PoolEventType.terminated&&(T.unsubscribe(),E(Error("Pool has been terminated before task was run.")))})})}settled(y=!1){return t(this,void 0,void 0,function*(){const b=()=>d(this.workers,p=>p.runningTasks),E=[],T=this.eventObservable.subscribe(p=>{p.type===c.PoolEventType.taskFailed&&E.push(p.error)});return this.initErrors.length>0?Promise.reject(this.initErrors[0]):y&&this.taskQueue.length===0?(yield i.allSettled(b()),E):(yield new Promise((p,A)=>{const z=this.eventObservable.subscribe({next(m){m.type===c.PoolEventType.taskQueueDrained&&(z.unsubscribe(),p(void 0))},error:A})}),yield i.allSettled(b()),T.unsubscribe(),E)})}completed(y=!1){return t(this,void 0,void 0,function*(){const b=this.settled(y),E=new Promise((p,A)=>{const z=this.eventObservable.subscribe({next(m){m.type===c.PoolEventType.taskQueueDrained?(z.unsubscribe(),p(b)):m.type===c.PoolEventType.taskFailed&&(z.unsubscribe(),A(m.error))},error:A})}),T=yield Promise.race([b,E]);if(T.length>0)throw T[0]})}events(){return this.eventObservable}queue(y){const{maxQueuedJobs:b=1/0}=this.options;if(this.isClosing)throw Error("Cannot schedule pool tasks after terminate() has been called.");if(this.initErrors.length>0)throw this.initErrors[0];const E=this.nextTaskID++,T=this.taskCompletion(E);T.catch(A=>{this.debug(`Task #${E} errored:`,A)});const p={id:E,run:y,cancel:()=>{this.taskQueue.indexOf(p)!==-1&&(this.taskQueue=this.taskQueue.filter(A=>A!==p),this.eventSubject.next({type:c.PoolEventType.taskCanceled,taskID:p.id}))},then:T.then.bind(T)};if(this.taskQueue.length>=b)throw Error(`Maximum number of pool tasks queued. Refusing to queue another one.
This usually happens for one of two reasons: We are either at peak workload right now or some tasks just won't finish, thus blocking the pool.`);return this.debug(`Queueing task #${p.id}...`),this.taskQueue.push(p),this.eventSubject.next({type:c.PoolEventType.taskQueued,taskID:p.id}),this.scheduleWork(),p}terminate(y){return t(this,void 0,void 0,function*(){this.isClosing=!0,y||(yield this.completed(!0)),this.eventSubject.next({type:c.PoolEventType.terminated,remainingQueue:[...this.taskQueue]}),this.eventSubject.complete(),yield Promise.all(this.workers.map(b=>t(this,void 0,void 0,function*(){return l.Thread.terminate(yield b.init)})))})}}k.EventType=c.PoolEventType;function I(S,y){return new k(S,y)}I.EventType=c.PoolEventType,r.Pool=I}(Qe);var ie={},oe={};Object.defineProperty(oe,"__esModule",{value:!0}),oe.createPromiseWithResolver=void 0;const mr=()=>{};function pr(){let r=!1,t,e=mr;return[new Promise(i=>{r?i(t):e=i}),i=>{r=!0,t=i,e(t)}]}oe.createPromiseWithResolver=pr;var cn={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WorkerEventType=void 0,function(t){t.internalError="internalError",t.message="message",t.termination="termination"}(r.WorkerEventType||(r.WorkerEventType={}))})(cn);var Lt={},ae={};Object.defineProperty(ae,"__esModule",{value:!0}),ae.ObservablePromise=void 0;const _r=re,yr=()=>{},br=r=>r,un=r=>Promise.resolve().then(r);function Er(r){throw r}function Sr(r){return r&&typeof r.then=="function"}class we extends _r.Observable{constructor(t){super(e=>{const n=this,s=Object.assign(Object.assign({},e),{complete(){e.complete(),n.onCompletion()},error(i){e.error(i),n.onError(i)},next(i){e.next(i),n.onNext(i)}});try{return this.initHasRun=!0,t(s)}catch(i){s.error(i)}}),this.initHasRun=!1,this.fulfillmentCallbacks=[],this.rejectionCallbacks=[],this.firstValueSet=!1,this.state="pending"}onNext(t){this.firstValueSet||(this.firstValue=t,this.firstValueSet=!0)}onError(t){this.state="rejected",this.rejection=t;for(const e of this.rejectionCallbacks)un(()=>e(t))}onCompletion(){this.state="fulfilled";for(const t of this.fulfillmentCallbacks)un(()=>t(this.firstValue))}then(t,e){const n=t||br,s=e||Er;let i=!1;return new Promise((o,c)=>{const l=a=>{if(!i){i=!0;try{o(s(a))}catch(u){c(u)}}},h=a=>{try{o(n(a))}catch(u){l(u)}};if(this.initHasRun||this.subscribe({error:l}),this.state==="fulfilled")return o(n(this.firstValue));if(this.state==="rejected")return i=!0,o(s(this.rejection));this.fulfillmentCallbacks.push(h),this.rejectionCallbacks.push(l)})}catch(t){return this.then(void 0,t)}finally(t){const e=t||yr;return this.then(n=>(e(),n),()=>e())}static from(t){return Sr(t)?new we(e=>{const n=i=>{e.next(i),e.complete()},s=i=>{e.error(i)};t.then(n,s)}):super.from(t)}}ae.ObservablePromise=we;var ot={};Object.defineProperty(ot,"__esModule",{value:!0}),ot.Transfer=ot.isTransferDescriptor=void 0;const ln=W;function xr(r){return!(!r||typeof r!="object")}function Mr(r){return r&&typeof r=="object"&&r[ln.$transferable]}ot.isTransferDescriptor=Mr;function Tr(r,t){if(!t){if(!xr(r))throw Error();t=[r]}return{[ln.$transferable]:!0,send:r,transferables:t}}ot.Transfer=Tr;var Ie={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WorkerMessageType=r.MasterMessageType=void 0,function(t){t.cancel="cancel",t.run="run"}(r.MasterMessageType||(r.MasterMessageType={})),function(t){t.error="error",t.init="init",t.result="result",t.running="running",t.uncaughtError="uncaughtError"}(r.WorkerMessageType||(r.WorkerMessageType={}))})(Ie);var wr=L&&L.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.createProxyModule=Lt.createProxyFunction=void 0;const Ir=wr(Ot),hn=re,Ut=Y,dn=ae,Ar=ot,$t=Ie,fn=Ir.default("threads:master:messages");let Cr=1;const Nr=r=>Array.from(new Set(r)),kr=r=>r&&r.type===$t.WorkerMessageType.error,zr=r=>r&&r.type===$t.WorkerMessageType.result,vr=r=>r&&r.type===$t.WorkerMessageType.running;function Or(r,t){return new hn.Observable(e=>{let n;const s=i=>{if(fn("Message from worker:",i.data),!(!i.data||i.data.uid!==t)){if(vr(i.data))n=i.data.resultType;else if(zr(i.data))n==="promise"?(typeof i.data.payload<"u"&&e.next(Ut.deserialize(i.data.payload)),e.complete(),r.removeEventListener("message",s)):(i.data.payload&&e.next(Ut.deserialize(i.data.payload)),i.data.complete&&(e.complete(),r.removeEventListener("message",s)));else if(kr(i.data)){const o=Ut.deserialize(i.data.error);e.error(o),r.removeEventListener("message",s)}}};return r.addEventListener("message",s),()=>{if(n==="observable"||!n){const i={type:$t.MasterMessageType.cancel,uid:t};r.postMessage(i)}r.removeEventListener("message",s)}})}function Rr(r){if(r.length===0)return{args:[],transferables:[]};const t=[],e=[];for(const n of r)Ar.isTransferDescriptor(n)?(t.push(Ut.serialize(n.send)),e.push(...n.transferables)):t.push(Ut.serialize(n));return{args:t,transferables:e.length===0?e:Nr(e)}}function gn(r,t){return(...e)=>{const n=Cr++,{args:s,transferables:i}=Rr(e),o={type:$t.MasterMessageType.run,uid:n,method:t,args:s};fn("Sending command to run function to worker:",o);try{r.postMessage(o,i)}catch(c){return dn.ObservablePromise.from(Promise.reject(c))}return dn.ObservablePromise.from(hn.multicast(Or(r,n)))}}Lt.createProxyFunction=gn;function Lr(r,t){const e={};for(const n of t)e[n]=gn(r,n);return e}Lt.createProxyModule=Lr;var Ae=L&&L.__awaiter||function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function c(a){try{h(n.next(a))}catch(u){o(u)}}function l(a){try{h(n.throw(a))}catch(u){o(u)}}function h(a){a.done?i(a.value):s(a.value).then(c,l)}h((n=n.apply(r,t||[])).next())})},Dr=L&&L.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ie,"__esModule",{value:!0}),ie.spawn=void 0;const Ce=Dr(Ot),Pr=re,Fr=Y,Hr=oe,ce=W,ue=cn,mn=Lt,Gr=Ce.default("threads:master:messages"),Br=Ce.default("threads:master:spawn"),pn=Ce.default("threads:master:thread-utils"),Vr=r=>r&&r.type==="init",Wr=r=>r&&r.type==="uncaughtError",jr=typeof process<"u"&&{}.THREADS_WORKER_INIT_TIMEOUT?Number.parseInt({}.THREADS_WORKER_INIT_TIMEOUT,10):1e4;function Ur(r,t,e){return Ae(this,void 0,void 0,function*(){let n;const s=new Promise((o,c)=>{n=setTimeout(()=>c(Error(e)),t)}),i=yield Promise.race([r,s]);return clearTimeout(n),i})}function $r(r){return new Promise((t,e)=>{const n=s=>{Gr("Message from worker before finishing initialization:",s.data),Vr(s.data)?(r.removeEventListener("message",n),t(s.data)):Wr(s.data)&&(r.removeEventListener("message",n),e(Fr.deserialize(s.data.error)))};r.addEventListener("message",n)})}function Yr(r,t){return new Pr.Observable(e=>{const n=i=>{const o={type:ue.WorkerEventType.message,data:i.data};e.next(o)},s=i=>{pn("Unhandled promise rejection event in thread:",i);const o={type:ue.WorkerEventType.internalError,error:Error(i.reason)};e.next(o)};r.addEventListener("message",n),r.addEventListener("unhandledrejection",s),t.then(()=>{const i={type:ue.WorkerEventType.termination};r.removeEventListener("message",n),r.removeEventListener("unhandledrejection",s),e.next(i),e.complete()})})}function Kr(r){const[t,e]=Hr.createPromiseWithResolver();return{terminate:()=>Ae(this,void 0,void 0,function*(){pn("Terminating worker"),yield r.terminate(),e()}),termination:t}}function _n(r,t,e,n){const s=e.filter(i=>i.type===ue.WorkerEventType.internalError).map(i=>i.error);return Object.assign(r,{[ce.$errors]:s,[ce.$events]:e,[ce.$terminate]:n,[ce.$worker]:t})}function Xr(r,t){return Ae(this,void 0,void 0,function*(){Br("Initializing new thread");const e=t&&t.timeout?t.timeout:jr,s=(yield Ur($r(r),e,`Timeout: Did not receive an init message from worker after ${e}ms. Make sure the worker calls expose().`)).exposed,{termination:i,terminate:o}=Kr(r),c=Yr(r,i);if(s.type==="function"){const l=mn.createProxyFunction(r);return _n(l,r,c,o)}else if(s.type==="module"){const l=mn.createProxyModule(r,s.methods);return _n(l,r,c,o)}else{const l=s.type;throw Error(`Worker init message states unexpected type of expose(): ${l}`)}})}ie.spawn=Xr,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.Worker=r.BlobWorker=r.isWorkerRuntime=r.Thread=r.spawn=r.Pool=void 0;const t=it;Object.defineProperty(r,"isWorkerRuntime",{enumerable:!0,get:function(){return t.isWorkerRuntime}});var e=Qe;Object.defineProperty(r,"Pool",{enumerable:!0,get:function(){return e.Pool}});var n=ie;Object.defineProperty(r,"spawn",{enumerable:!0,get:function(){return n.spawn}});var s=jt;Object.defineProperty(r,"Thread",{enumerable:!0,get:function(){return s.Thread}}),r.BlobWorker=t.getWorkerImplementation().blob,r.Worker=t.getWorkerImplementation().default}(Ye);var Ne={},Zr=r=>r?typeof Symbol.observable=="symbol"&&typeof r[Symbol.observable]=="function"?r===r[Symbol.observable]():typeof r["@@observable"]=="function"?r===r["@@observable"]():!1:!1,ke={};Object.defineProperty(ke,"__esModule",{value:!0});const qr=function(){const t=typeof self<"u"&&typeof Window<"u"&&self instanceof Window;return!!(typeof self<"u"&&self.postMessage&&!t)},Qr=function(t,e){self.postMessage(t,e)},Jr=function(t){const e=s=>{t(s.data)},n=()=>{self.removeEventListener("message",e)};return self.addEventListener("message",e),n};ke.default={isWorkerRuntime:qr,postMessageToMaster:Qr,subscribeToMasterMessages:Jr},function(r){var t=L&&L.__awaiter||function(m,x,w,N){function O(R){return R instanceof w?R:new w(function(H){H(R)})}return new(w||(w=Promise))(function(R,H){function rt(j){try{lt(N.next(j))}catch(Q){H(Q)}}function st(j){try{lt(N.throw(j))}catch(Q){H(Q)}}function lt(j){j.done?R(j.value):O(j.value).then(rt,st)}lt((N=N.apply(m,x||[])).next())})},e=L&&L.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};Object.defineProperty(r,"__esModule",{value:!0}),r.expose=r.isWorkerRuntime=r.Transfer=r.registerSerializer=void 0;const n=e(Zr),s=Y,i=ot,o=Ie,c=e(ke);var l=Y;Object.defineProperty(r,"registerSerializer",{enumerable:!0,get:function(){return l.registerSerializer}});var h=ot;Object.defineProperty(r,"Transfer",{enumerable:!0,get:function(){return h.Transfer}}),r.isWorkerRuntime=c.default.isWorkerRuntime;let a=!1;const u=new Map,d=m=>m&&m.type===o.MasterMessageType.cancel,g=m=>m&&m.type===o.MasterMessageType.run,_=m=>n.default(m)||k(m);function k(m){return m&&typeof m=="object"&&typeof m.subscribe=="function"}function I(m){return i.isTransferDescriptor(m)?{payload:m.send,transferables:m.transferables}:{payload:m,transferables:void 0}}function S(){const m={type:o.WorkerMessageType.init,exposed:{type:"function"}};c.default.postMessageToMaster(m)}function y(m){const x={type:o.WorkerMessageType.init,exposed:{type:"module",methods:m}};c.default.postMessageToMaster(x)}function b(m,x){const{payload:w,transferables:N}=I(x),O={type:o.WorkerMessageType.error,uid:m,error:s.serialize(w)};c.default.postMessageToMaster(O,N)}function E(m,x,w){const{payload:N,transferables:O}=I(w),R={type:o.WorkerMessageType.result,uid:m,complete:x?!0:void 0,payload:N};c.default.postMessageToMaster(R,O)}function T(m,x){const w={type:o.WorkerMessageType.running,uid:m,resultType:x};c.default.postMessageToMaster(w)}function p(m){try{const x={type:o.WorkerMessageType.uncaughtError,error:s.serialize(m)};c.default.postMessageToMaster(x)}catch(x){console.error(`Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.
Latest error:`,x,`
Original error:`,m)}}function A(m,x,w){return t(this,void 0,void 0,function*(){let N;try{N=x(...w)}catch(R){return b(m,R)}const O=_(N)?"observable":"promise";if(T(m,O),_(N)){const R=N.subscribe(H=>E(m,!1,s.serialize(H)),H=>{b(m,s.serialize(H)),u.delete(m)},()=>{E(m,!0),u.delete(m)});u.set(m,R)}else try{const R=yield N;E(m,!0,s.serialize(R))}catch(R){b(m,s.serialize(R))}})}function z(m){if(!c.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(a)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(a=!0,typeof m=="function")c.default.subscribeToMasterMessages(x=>{g(x)&&!x.method&&A(x.uid,m,x.args.map(s.deserialize))}),S();else if(typeof m=="object"&&m){c.default.subscribeToMasterMessages(w=>{g(w)&&w.method&&A(w.uid,m[w.method],w.args.map(s.deserialize))});const x=Object.keys(m).filter(w=>typeof m[w]=="function");y(x)}else throw Error(`Invalid argument passed to expose(). Expected a function or an object, got: ${m}`);c.default.subscribeToMasterMessages(x=>{if(d(x)){const w=x.uid,N=u.get(w);N&&(N.unsubscribe(),u.delete(w))}})}r.expose=z,typeof self<"u"&&typeof self.addEventListener=="function"&&c.default.isWorkerRuntime()&&(self.addEventListener("error",m=>{setTimeout(()=>p(m.error||m),250)}),self.addEventListener("unhandledrejection",m=>{const x=m.reason;x&&typeof x.message=="string"&&setTimeout(()=>p(x),250)})),typeof process<"u"&&typeof process.on=="function"&&c.default.isWorkerRuntime()&&(process.on("uncaughtException",m=>{setTimeout(()=>p(m),250)}),process.on("unhandledRejection",m=>{m&&typeof m.message=="string"&&setTimeout(()=>p(m),250)}))}(Ne);var ze=tt(Ne);(function(r){var t=L&&L.__createBinding||(Object.create?function(c,l,h,a){a===void 0&&(a=h),Object.defineProperty(c,a,{enumerable:!0,get:function(){return l[h]}})}:function(c,l,h,a){a===void 0&&(a=h),c[a]=l[h]}),e=L&&L.__exportStar||function(c,l){for(var h in c)h!=="default"&&!Object.prototype.hasOwnProperty.call(l,h)&&t(l,c,h)};Object.defineProperty(r,"__esModule",{value:!0}),r.Transfer=r.DefaultSerializer=r.expose=r.registerSerializer=void 0;var n=Y;Object.defineProperty(r,"registerSerializer",{enumerable:!0,get:function(){return n.registerSerializer}}),e(Ye,r);var s=Ne;Object.defineProperty(r,"expose",{enumerable:!0,get:function(){return s.expose}});var i=Mt;Object.defineProperty(r,"DefaultSerializer",{enumerable:!0,get:function(){return i.DefaultSerializer}});var o=ot;Object.defineProperty(r,"Transfer",{enumerable:!0,get:function(){return o.Transfer}})})(je);var ht=tt(je);ht.registerSerializer,ht.spawn,ht.BlobWorker,ht.DefaultSerializer,ht.Pool,ht.Thread;const ts=ht.Transfer;ht.Worker;const es=ze.expose;ze.registerSerializer,ze.Transfer;/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const yn="148",V=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let bn=1234567;const En=Math.PI/180,Sn=180/Math.PI;function ns(){const r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(V[r&255]+V[r>>8&255]+V[r>>16&255]+V[r>>24&255]+"-"+V[t&255]+V[t>>8&255]+"-"+V[t>>16&15|64]+V[t>>24&255]+"-"+V[e&63|128]+V[e>>8&255]+"-"+V[e>>16&255]+V[e>>24&255]+V[n&255]+V[n>>8&255]+V[n>>16&255]+V[n>>24&255]).toLowerCase()}function ve(r,t,e){return Math.max(t,Math.min(e,r))}function xn(r,t){return(r%t+t)%t}function rs(r,t,e,n,s){return n+(r-t)*(s-n)/(e-t)}function ss(r,t,e){return r!==t?(e-r)/(t-r):0}function Mn(r,t,e){return(1-e)*r+e*t}function is(r,t,e,n){return Mn(r,t,1-Math.exp(-e*n))}function os(r,t=1){return t-Math.abs(xn(r,t*2)-t)}function as(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*(3-2*r))}function cs(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*r*(r*(r*6-15)+10))}function us(r,t){return r+Math.floor(Math.random()*(t-r+1))}function ls(r,t){return r+Math.random()*(t-r)}function hs(r){return r*(.5-Math.random())}function ds(r){r!==void 0&&(bn=r);let t=bn+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function fs(r){return r*En}function gs(r){return r*Sn}function ms(r){return(r&r-1)===0&&r!==0}function ps(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function _s(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function ys(r,t,e,n,s){const i=Math.cos,o=Math.sin,c=i(e/2),l=o(e/2),h=i((t+n)/2),a=o((t+n)/2),u=i((t-n)/2),d=o((t-n)/2),g=i((n-t)/2),_=o((n-t)/2);switch(s){case"XYX":r.set(c*a,l*u,l*d,c*h);break;case"YZY":r.set(l*d,c*a,l*u,c*h);break;case"ZXZ":r.set(l*u,l*d,c*a,c*h);break;case"XZX":r.set(c*a,l*_,l*g,c*h);break;case"YXY":r.set(l*g,c*a,l*_,c*h);break;case"ZYZ":r.set(l*_,l*g,c*a,c*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function bs(r,t){switch(t.constructor){case Float32Array:return r;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function Es(r,t){switch(t.constructor){case Float32Array:return r;case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}var Oe=Object.freeze({__proto__:null,DEG2RAD:En,RAD2DEG:Sn,generateUUID:ns,clamp:ve,euclideanModulo:xn,mapLinear:rs,inverseLerp:ss,lerp:Mn,damp:is,pingpong:os,smoothstep:as,smootherstep:cs,randInt:us,randFloat:ls,randFloatSpread:hs,seededRandom:ds,degToRad:fs,radToDeg:gs,isPowerOfTwo:ms,ceilPowerOfTwo:ps,floorPowerOfTwo:_s,setQuaternionFromProperEuler:ys,normalize:Es,denormalize:bs});class Ss{constructor(t=0,e=0,n=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=s}static slerpFlat(t,e,n,s,i,o,c){let l=n[s+0],h=n[s+1],a=n[s+2],u=n[s+3];const d=i[o+0],g=i[o+1],_=i[o+2],k=i[o+3];if(c===0){t[e+0]=l,t[e+1]=h,t[e+2]=a,t[e+3]=u;return}if(c===1){t[e+0]=d,t[e+1]=g,t[e+2]=_,t[e+3]=k;return}if(u!==k||l!==d||h!==g||a!==_){let I=1-c;const S=l*d+h*g+a*_+u*k,y=S>=0?1:-1,b=1-S*S;if(b>Number.EPSILON){const T=Math.sqrt(b),p=Math.atan2(T,S*y);I=Math.sin(I*p)/T,c=Math.sin(c*p)/T}const E=c*y;if(l=l*I+d*E,h=h*I+g*E,a=a*I+_*E,u=u*I+k*E,I===1-c){const T=1/Math.sqrt(l*l+h*h+a*a+u*u);l*=T,h*=T,a*=T,u*=T}}t[e]=l,t[e+1]=h,t[e+2]=a,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,s,i,o){const c=n[s],l=n[s+1],h=n[s+2],a=n[s+3],u=i[o],d=i[o+1],g=i[o+2],_=i[o+3];return t[e]=c*_+a*u+l*g-h*d,t[e+1]=l*_+a*d+h*u-c*g,t[e+2]=h*_+a*g+c*d-l*u,t[e+3]=a*_-c*u-l*d-h*g,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,s){return this._x=t,this._y=e,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const n=t._x,s=t._y,i=t._z,o=t._order,c=Math.cos,l=Math.sin,h=c(n/2),a=c(s/2),u=c(i/2),d=l(n/2),g=l(s/2),_=l(i/2);switch(o){case"XYZ":this._x=d*a*u+h*g*_,this._y=h*g*u-d*a*_,this._z=h*a*_+d*g*u,this._w=h*a*u-d*g*_;break;case"YXZ":this._x=d*a*u+h*g*_,this._y=h*g*u-d*a*_,this._z=h*a*_-d*g*u,this._w=h*a*u+d*g*_;break;case"ZXY":this._x=d*a*u-h*g*_,this._y=h*g*u+d*a*_,this._z=h*a*_+d*g*u,this._w=h*a*u-d*g*_;break;case"ZYX":this._x=d*a*u-h*g*_,this._y=h*g*u+d*a*_,this._z=h*a*_-d*g*u,this._w=h*a*u+d*g*_;break;case"YZX":this._x=d*a*u+h*g*_,this._y=h*g*u+d*a*_,this._z=h*a*_-d*g*u,this._w=h*a*u-d*g*_;break;case"XZY":this._x=d*a*u-h*g*_,this._y=h*g*u-d*a*_,this._z=h*a*_+d*g*u,this._w=h*a*u+d*g*_;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,s=Math.sin(n);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],s=e[4],i=e[8],o=e[1],c=e[5],l=e[9],h=e[2],a=e[6],u=e[10],d=n+c+u;if(d>0){const g=.5/Math.sqrt(d+1);this._w=.25/g,this._x=(a-l)*g,this._y=(i-h)*g,this._z=(o-s)*g}else if(n>c&&n>u){const g=2*Math.sqrt(1+n-c-u);this._w=(a-l)/g,this._x=.25*g,this._y=(s+o)/g,this._z=(i+h)/g}else if(c>u){const g=2*Math.sqrt(1+c-n-u);this._w=(i-h)/g,this._x=(s+o)/g,this._y=.25*g,this._z=(l+a)/g}else{const g=2*Math.sqrt(1+u-n-c);this._w=(o-s)/g,this._x=(i+h)/g,this._y=(l+a)/g,this._z=.25*g}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ve(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(n===0)return this;const s=Math.min(1,e/n);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,s=t._y,i=t._z,o=t._w,c=e._x,l=e._y,h=e._z,a=e._w;return this._x=n*a+o*c+s*h-i*l,this._y=s*a+o*l+i*c-n*h,this._z=i*a+o*h+n*l-s*c,this._w=o*a-n*c-s*l-i*h,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const n=this._x,s=this._y,i=this._z,o=this._w;let c=o*t._w+n*t._x+s*t._y+i*t._z;if(c<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,c=-c):this.copy(t),c>=1)return this._w=o,this._x=n,this._y=s,this._z=i,this;const l=1-c*c;if(l<=Number.EPSILON){const g=1-e;return this._w=g*o+e*this._w,this._x=g*n+e*this._x,this._y=g*s+e*this._y,this._z=g*i+e*this._z,this.normalize(),this._onChangeCallback(),this}const h=Math.sqrt(l),a=Math.atan2(h,c),u=Math.sin((1-e)*a)/h,d=Math.sin(e*a)/h;return this._w=o*u+this._w*d,this._x=n*u+this._x*d,this._y=s*u+this._y*d,this._z=i*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),s=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(e*Math.cos(s),n*Math.sin(i),n*Math.cos(i),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class v{constructor(t=0,e=0,n=0){v.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Tn.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Tn.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,s=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*s,this.y=i[1]*e+i[4]*n+i[7]*s,this.z=i[2]*e+i[5]*n+i[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,s=this.z,i=t.elements,o=1/(i[3]*e+i[7]*n+i[11]*s+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*s+i[12])*o,this.y=(i[1]*e+i[5]*n+i[9]*s+i[13])*o,this.z=(i[2]*e+i[6]*n+i[10]*s+i[14])*o,this}applyQuaternion(t){const e=this.x,n=this.y,s=this.z,i=t.x,o=t.y,c=t.z,l=t.w,h=l*e+o*s-c*n,a=l*n+c*e-i*s,u=l*s+i*n-o*e,d=-i*e-o*n-c*s;return this.x=h*l+d*-i+a*-c-u*-o,this.y=a*l+d*-o+u*-i-h*-c,this.z=u*l+d*-c+h*-o-a*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,s=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*s,this.y=i[1]*e+i[5]*n+i[9]*s,this.z=i[2]*e+i[6]*n+i[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,s=t.y,i=t.z,o=e.x,c=e.y,l=e.z;return this.x=s*l-i*c,this.y=i*o-n*l,this.z=n*c-s*o,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Re.copy(this).projectOnVector(t),this.sub(Re)}reflect(t){return this.sub(Re.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(ve(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,s=this.z-t.z;return e*e+n*n+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const s=Math.sin(e)*t;return this.x=s*Math.sin(n),this.y=Math.cos(e)*t,this.z=s*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Re=new v,Tn=new Ss;class wn{constructor(t=new v(1/0,1/0,1/0),e=new v(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,s=1/0,i=-1/0,o=-1/0,c=-1/0;for(let l=0,h=t.length;l<h;l+=3){const a=t[l],u=t[l+1],d=t[l+2];a<e&&(e=a),u<n&&(n=u),d<s&&(s=d),a>i&&(i=a),u>o&&(o=u),d>c&&(c=d)}return this.min.set(e,n,s),this.max.set(i,o,c),this}setFromBufferAttribute(t){let e=1/0,n=1/0,s=1/0,i=-1/0,o=-1/0,c=-1/0;for(let l=0,h=t.count;l<h;l++){const a=t.getX(l),u=t.getY(l),d=t.getZ(l);a<e&&(e=a),u<n&&(n=u),d<s&&(s=d),a>i&&(i=a),u>o&&(o=u),d>c&&(c=d)}return this.min.set(e,n,s),this.max.set(i,o,c),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=It.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(n!==void 0)if(e&&n.attributes!=null&&n.attributes.position!==void 0){const i=n.attributes.position;for(let o=0,c=i.count;o<c;o++)It.fromBufferAttribute(i,o).applyMatrix4(t.matrixWorld),this.expandByPoint(It)}else n.boundingBox===null&&n.computeBoundingBox(),Le.copy(n.boundingBox),Le.applyMatrix4(t.matrixWorld),this.union(Le);const s=t.children;for(let i=0,o=s.length;i<o;i++)this.expandByObject(s[i],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,It),It.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Yt),le.subVectors(this.max,Yt),Dt.subVectors(t.a,Yt),Pt.subVectors(t.b,Yt),Ft.subVectors(t.c,Yt),dt.subVectors(Pt,Dt),ft.subVectors(Ft,Pt),At.subVectors(Dt,Ft);let e=[0,-dt.z,dt.y,0,-ft.z,ft.y,0,-At.z,At.y,dt.z,0,-dt.x,ft.z,0,-ft.x,At.z,0,-At.x,-dt.y,dt.x,0,-ft.y,ft.x,0,-At.y,At.x,0];return!De(e,Dt,Pt,Ft,le)||(e=[1,0,0,0,1,0,0,0,1],!De(e,Dt,Pt,Ft,le))?!1:(he.crossVectors(dt,ft),e=[he.x,he.y,he.z],De(e,Dt,Pt,Ft,le))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return It.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(It).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(at[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),at[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),at[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),at[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),at[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),at[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),at[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),at[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(at),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const at=[new v,new v,new v,new v,new v,new v,new v,new v],It=new v,Le=new wn,Dt=new v,Pt=new v,Ft=new v,dt=new v,ft=new v,At=new v,Yt=new v,le=new v,he=new v,Ct=new v;function De(r,t,e,n,s){for(let i=0,o=r.length-3;i<=o;i+=3){Ct.fromArray(r,i);const c=s.x*Math.abs(Ct.x)+s.y*Math.abs(Ct.y)+s.z*Math.abs(Ct.z),l=t.dot(Ct),h=e.dot(Ct),a=n.dot(Ct);if(Math.max(-Math.max(l,h,a),Math.min(l,h,a))>c)return!1}return!0}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:yn}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=yn);const D=class{static getList(t){return t?t.split(",").map(e=>e.trim()):[]}static getBoolean(t,e){return t?t==="true":e}static getNumber(t){return parseFloat(t)}static getOptionalNumber(t){if(t)return parseFloat(t)}};let C=D;f(C,"LOG_LEVELS",D.getList({}.VITE_LOG_LEVELS)),f(C,"LOG_KEYS",D.getList({}.VITE_LOG_KEYS)),f(C,"JUMP_START",D.getBoolean({}.VITE_JUMP_START,!0)),f(C,"FOG_ENABLED",D.getBoolean({}.VITE_FOG_ENABLED,!0)),f(C,"EDITING_ENABLED",D.getBoolean({}.VITE_EDITING_ENABLED,!0)),f(C,"SHOW_INITIAL_TERRAIN_GENERATION",D.getBoolean({}.VITE_SHOW_INITIAL_TERRAIN_GENERATION,!1)),f(C,"SHOW_DEBUG_INFO",D.getBoolean({}.VITE_SHOW_DEBUG_UI,!1)),f(C,"SHOW_WINDOW_CLOSE_ALERT",D.getBoolean({}.VITE_SHOW_WINDOW_CLOSE_ALERT,!0)),f(C,"PLAYER_DEFAULT_PHYSICS_MODE",{}.VITE_PLAYER_DEFAULT_PHYSICS_MODE),f(C,"PLAYER_SHOW_BOUNDING_BOX",D.getBoolean({}.VITE_PLAYER_SHOW_BOUNDING_BOX,!1)),f(C,"CHUNK_WIDTH",D.getNumber({}.VITE_TERRAIN_CHUNK_WIDTH||10)),f(C,"CHUNK_HEIGHT",D.getNumber({}.VITE_TERRAIN_CHUNK_HEIGHT||2)),f(C,"CUSTOM_SEED",{}.VITE_CUSTOM_SEED||"map1"),f(C,"TERRAIN_GENERATION_ENABLED",D.getBoolean({}.VITE_TERRAIN_GENERATION_ENABLED,!0)),f(C,"TERRAIN_OPTIMIZATION_ENABLED",D.getBoolean({}.VITE_TERRAIN_OPTIMIZATION_ENABLED,!0)),f(C,"TREE_GENERATION_ENABLED",D.getBoolean({}.VITE_TREE_GENERATION_ENABLED,!1)),f(C,"DEFAULT_HORIZONTAL_RENDER_DISTANCE_IN_CHUNKS",D.getNumber({}.VITE_DEFAULT_HORIZONTAL_RENDER_DISTANCE_IN_CHUNKS)),f(C,"TOP_RENDER_DISTANCE_IN_CHUNKS",D.getNumber({}.VITE_TOP_RENDER_DISTANCE_IN_CHUNKS||8)),f(C,"BOTTOM_RENDER_DISTANCE_IN_CHUNKS",D.getNumber({}.VITE_BOTTOM_RENDER_DISTANCE_IN_CHUNKS||4)),f(C,"TESTING_MAP_ENABLED",D.getBoolean({}.VITE_TESTING_MAP_ENABLED,!1)),f(C,"TESTING_MAP_EROSION",D.getOptionalNumber({}.VITE_TESTING_MAP_EROSION)),f(C,"TESTING_MAP_CONTINENTALNESS",D.getOptionalNumber({}.VITE_TESTING_MAP_CONTINENTALNESS)),f(C,"TESTING_MAP_PV",D.getOptionalNumber({}.VITE_TESTING_MAP_PV)),f(C,"STARTING_INVENTORY_ITEMS",D.getList({}.VITE_STARTING_INVENTORY_ITEMS).map(t=>Number(t))),f(C,"STARTING_HOTBAR_ITEMS",D.getList({}.VITE_STARTING_HOTBAR_ITEMS).map(t=>Number(t)));const Ve=class{static debug(t,...e){}static info(t,...e){}static warn(t){}static error(t){}static shouldLog(t,...e){const n=Ve.LOG_LEVELS.includes(t);return e.some(i=>this.LOG_KEYS.includes(i))&&n}};let G=Ve;f(G,"LOG_LEVELS",C.LOG_LEVELS??["silent"]),f(G,"LOG_KEYS",C.LOG_KEYS),f(G,"GAME_LOOP_KEY","gameloop"),f(G,"SCENE_KEY","scene"),f(G,"AUDIO_KEY","audio"),f(G,"DATA_KEY","data"),f(G,"INPUT_KEY","input"),f(G,"MAP_KEY","map"),f(G,"COLLISION_KEY","collision"),f(G,"PLAYER_KEY","player"),f(G,"TERRAIN_KEY","terrain"),f(G,"CHUNK_KEY","chunk"),f(G,"INIT_KEY","init"),f(G,"LOADING_KEY","load"),f(G,"DISPOSE_KEY","dispose");const Nt={left:[-1,0,0],right:[1,0,0],top:[0,1,0],bottom:[0,-1,0],front:[0,0,1],back:[0,0,-1]},In={left:{normal:Nt.left,vertices:[{pos:[0,1,0],uv:[0,1],ao:{corner:[-.5,-.5,.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}},{pos:[0,0,0],uv:[0,0],ao:{corner:[-.5,-.5,.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}},{pos:[0,1,1],uv:[1,1],ao:{corner:[-.5,.5,-.5],side1:[-.5,.5,.5],side2:[-.5,-.5,.5]}},{pos:[0,0,1],uv:[1,0],ao:{corner:[-.5,-.5,-.5],side1:[-.5,.5,.5],side2:[-.5,-.5,.5]}}]},right:{normal:Nt.right,vertices:[{pos:[1,1,1],uv:[0,1],ao:{corner:[.5,.5,-.5],side1:[.5,.5,.5],side2:[.5,-.5,.5]}},{pos:[1,0,1],uv:[0,0],ao:{corner:[.5,-.5,-.5],side1:[.5,.5,.5],side2:[.5,-.5,.5]}},{pos:[1,1,0],uv:[1,1],ao:{corner:[.5,.5,.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}},{pos:[1,0,0],uv:[1,0],ao:{corner:[.5,-.5,.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}}]},top:{normal:Nt.top,vertices:[{pos:[0,1,1],uv:[1,1],ao:{corner:[-.5,.5,.5],side1:[.5,.5,.5],side2:[-.5,.5,-.5]}},{pos:[1,1,1],uv:[0,1],ao:{corner:[.5,.5,.5],side1:[-.5,.5,.5],side2:[.5,.5,-.5]}},{pos:[0,1,0],uv:[1,0],ao:{corner:[-.5,.5,-.5],side1:[.5,.5,-.5],side2:[-.5,.5,.5]}},{pos:[1,1,0],uv:[0,0],ao:{corner:[.5,.5,-.5],side1:[-.5,.5,-.5],side2:[.5,.5,.5]}}]},bottom:{normal:Nt.bottom,vertices:[{pos:[1,0,1],uv:[1,0],ao:{corner:[.5,-.5,.5],side1:[-.5,-.5,.5],side2:[.5,-.5,-.5]}},{pos:[0,0,1],uv:[0,0],ao:{corner:[-.5,-.5,.5],side1:[.5,-.5,.5],side2:[-.5,-.5,.5]}},{pos:[1,0,0],uv:[1,1],ao:{corner:[.5,-.5,-.5],side1:[.5,-.5,.5],side2:[-.5,-.5,-.5]}},{pos:[0,0,0],uv:[0,1],ao:{corner:[-.5,-.5,-.5],side1:[.5,-.5,-.5],side2:[-.5,-.5,.5]}}]},front:{normal:Nt.front,vertices:[{pos:[0,0,1],uv:[0,0],ao:{corner:[.5,-.5,.5],side1:[-.5,.5,.5],side2:[-.5,-.5,.5]}},{pos:[1,0,1],uv:[1,0],ao:{corner:[-.5,-.5,.5],side1:[.5,.5,.5],side2:[.5,-.5,.5]}},{pos:[0,1,1],uv:[0,1],ao:{corner:[.5,.5,.5],side1:[-.5,-.5,.5],side2:[-.5,.5,.5]}},{pos:[1,1,1],uv:[1,1],ao:{corner:[-.5,.5,.5],side1:[.5,-.5,.5],side2:[.5,.5,.5]}}]},back:{normal:Nt.back,vertices:[{pos:[1,0,0],uv:[0,0],ao:{corner:[-.5,-.5,-.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}},{pos:[0,0,0],uv:[1,0],ao:{corner:[.5,-.5,-.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}},{pos:[1,1,0],uv:[0,1],ao:{corner:[-.5,.5,-.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}},{pos:[0,1,0],uv:[1,1],ao:{corner:[.5,.5,-.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}}]}},An=16,xs=128,Ms=128;var F=(r=>(r[r.AIR=0]="AIR",r[r.CLOUD=1]="CLOUD",r[r.STONE=2]="STONE",r[r.COBBLESTONE=3]="COBBLESTONE",r[r.DIRT=4]="DIRT",r[r.GRASS=5]="GRASS",r[r.GRASS_SNOW=6]="GRASS_SNOW",r[r.WATER=7]="WATER",r[r.SAND=8]="SAND",r[r.GLASS=9]="GLASS",r[r.OAK_LOG=10]="OAK_LOG",r[r.OAK_LEAVES=11]="OAK_LEAVES",r[r.PLANKS=12]="PLANKS",r[r.COAL_ORE=13]="COAL_ORE",r))(F||{});const de={[0]:{name:"_air",isTransparent:!0,isSolid:!1,icon:{row:-1,col:-1},texture:{top:{row:-1,col:-1},bottom:{row:-1,col:-1},side:{row:-1,col:-1}}},[1]:{name:"cloud",isTransparent:!0,isSolid:!1,icon:{row:-1,col:-1},texture:{top:{row:2,col:5},bottom:{row:2,col:5},side:{row:2,col:5}},color:[1,1,1,.4]},[2]:{name:"Stone",isTransparent:!1,isSolid:!0,drop:3,icon:{row:18,col:12},texture:{top:{row:0,col:5},bottom:{row:0,col:5},side:{row:0,col:5}},sounds:{place:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"],broken:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"],hit:["Stone_hit1.ogg","Stone_hit2.ogg","Stone_hit3.ogg","Stone_hit4.ogg","Stone_hit5.ogg","Stone_hit6.ogg"]}},[3]:{name:"Cobblestone",isTransparent:!1,isSolid:!0,drop:3,icon:{row:8,col:31},texture:{top:{row:0,col:4},bottom:{row:0,col:4},side:{row:0,col:4}},sounds:{place:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"],broken:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"],hit:["Stone_hit1.ogg","Stone_hit2.ogg","Stone_hit3.ogg","Stone_hit4.ogg","Stone_hit5.ogg","Stone_hit6.ogg"]}},[5]:{name:"Grass",isTransparent:!1,isSolid:!0,drop:4,icon:{row:16,col:27},texture:{top:{row:0,col:1},bottom:{row:0,col:2},side:{row:0,col:0}},sounds:{place:["Grass_dig1.ogg","Grass_dig2.ogg","Grass_dig3.ogg","Grass_dig4.ogg"],broken:["Grass_dig1.ogg","Grass_dig2.ogg","Grass_dig3.ogg","Grass_dig4.ogg"],hit:["Grass_hit1.ogg","Grass_hit2.ogg","Grass_hit3.ogg","Grass_hit4.ogg","Grass_hit5.ogg","Grass_hit6.ogg"]}},[6]:{name:"Snow",isTransparent:!1,isSolid:!0,drop:4,icon:{row:13,col:18},texture:{top:{row:2,col:5},bottom:{row:0,col:2},side:{row:2,col:4}}},[4]:{name:"Dirt",isTransparent:!1,isSolid:!0,drop:4,icon:{row:13,col:18},texture:{top:{row:0,col:2},bottom:{row:0,col:2},side:{row:0,col:2}},sounds:{place:["Gravel_dig1.ogg","Gravel_dig2.ogg","Gravel_dig3.ogg","Gravel_dig4.ogg"],broken:["Gravel_dig1.ogg","Gravel_dig2.ogg","Gravel_dig3.ogg","Gravel_dig4.ogg"],hit:["Gravel_hit1.ogg","Gravel_hit2.ogg","Gravel_hit3.ogg","Gravel_hit4.ogg"]}},[10]:{name:"Oak_Log",isTransparent:!1,isSolid:!0,drop:10,icon:{row:25,col:9},texture:{top:{row:1,col:2},bottom:{row:1,col:2},side:{row:1,col:3}},sounds:{place:["Wood_dig1.ogg","Wood_dig2.ogg","Wood_dig3.ogg","Wood_dig4.ogg"],broken:["Wood_dig1.ogg","Wood_dig2.ogg","Wood_dig3.ogg","Wood_dig4.ogg"],hit:["Wood_hit1.ogg","Wood_hit2.ogg","Wood_hit3.ogg","Wood_hit4.ogg","Wood_hit5.ogg","Wood_hit6.ogg"]}},[11]:{name:"Oak_Leaves",isTransparent:!0,isSolid:!0,icon:{row:25,col:8},texture:{top:{row:1,col:5},bottom:{row:1,col:5},side:{row:1,col:5}},sounds:{place:["Grass_dig1.ogg","Grass_dig2.ogg","Grass_dig3.ogg","Grass_dig4.ogg"],broken:["Grass_dig1.ogg","Grass_dig2.ogg","Grass_dig3.ogg","Grass_dig4.ogg"],hit:["Grass_hit1.ogg","Grass_hit2.ogg","Grass_hit3.ogg","Grass_hit4.ogg","Grass_hit5.ogg","Grass_hit6.ogg"]}},[12]:{name:"Planks",isTransparent:!1,isSolid:!0,drop:12,icon:{row:25,col:10},texture:{top:{row:1,col:4},bottom:{row:1,col:4},side:{row:1,col:4}},sounds:{place:["Wood_dig1.ogg","Wood_dig2.ogg","Wood_dig3.ogg","Wood_dig4.ogg"],broken:["Wood_dig1.ogg","Wood_dig2.ogg","Wood_dig3.ogg","Wood_dig4.ogg"],hit:["Wood_hit1.ogg","Wood_hit2.ogg","Wood_hit3.ogg","Wood_hit4.ogg","Wood_hit5.ogg","Wood_hit6.ogg"]}},[8]:{name:"Sand",isTransparent:!1,isSolid:!0,drop:8,icon:{row:32,col:6},texture:{top:{row:1,col:6},bottom:{row:1,col:6},side:{row:1,col:6}},sounds:{place:["Sand_dig1.ogg","Sand_dig2.ogg","Sand_dig3.ogg","Sand_dig4.ogg"],broken:["Sand_dig1.ogg","Sand_dig2.ogg","Sand_dig3.ogg","Sand_dig4.ogg"],hit:["Sand_hit1.ogg","Sand_hit2.ogg","Sand_hit3.ogg","Sand_hit4.ogg","Sand_hit5.ogg"]}},[7]:{name:"Water",isTransparent:!0,isSolid:!1,icon:{row:37,col:28},texture:{side:{row:1,col:7},top:{row:1,col:7},bottom:{row:1,col:7}}},[9]:{name:"Glass",isTransparent:!0,isSolid:!0,icon:{row:15,col:26},texture:{side:{row:2,col:0},top:{row:2,col:0},bottom:{row:2,col:0}},sounds:{place:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"],broken:["Glass_dig1.ogg","Glass_dig2.ogg","Glass_dig3.ogg"],hit:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"]}},[13]:{name:"Coal_Ore",isTransparent:!1,isSolid:!0,drop:13,icon:{row:8,col:25},texture:{side:{row:0,col:6},top:{row:0,col:6},bottom:{row:0,col:6}},sounds:{place:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"],broken:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"],hit:["Stone_hit1.ogg","Stone_hit2.ogg","Stone_hit3.ogg","Stone_hit4.ogg","Stone_hit5.ogg","Stone_hit6.ogg"]}}},Ts={top:"top",bottom:"bottom",left:"side",right:"side",front:"side",back:"side"},ws=[[0,0,0],[0,1,0],[0,-1,0],[-1,0,0],[-1,1,0],[-1,-1,0],[1,0,0],[1,1,0],[1,-1,0],[0,0,1],[0,1,1],[0,-1,1],[-1,0,1],[-1,1,1],[-1,-1,1],[1,0,1],[1,1,1],[1,-1,1],[0,0,-1],[0,1,-1],[0,-1,-1],[-1,0,-1],[-1,1,-1],[-1,-1,-1],[1,0,-1],[1,1,-1],[1,-1,-1]],ut=class{static isVisibleBlock(t){return t!=null&&t!==F.AIR}static getBlockFaces(){return Object.keys(In)}static getBlockFaceGeometry(t){return In[t]}static getNeighbourBlockOffsets(){return ws}static getBlockMetadata(t){return de[t]}static getBlockColor(t){return de[t].color}static getBlockUVCoordinates(t,e,[n,s]){const i=Ts[e],{row:o,col:c}=de[t].texture[i];return{u:(c+n)*An/xs,v:1-(o+1-s)*An/Ms}}static getBlockFaceFromNormal(t){for(const[e,n]of Object.entries(Nt))if(new v().fromArray(n).equals(t))return e;return null}static getBlockBoundingBoxFromPosition(t){return ut.getBlockBoundingBox(ut.getBlockOriginFromPosition(t))}static getBlockBoundingBox(t){return new wn(t,t.clone().addScalar(ut.SIZE))}static getBlockOriginFromPosition(t){return new v(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}static toBlockCenterCoord(t){return Math.floor(t/ut.SIZE)*ut.SIZE+ut.SIZE/2}static getBlockNormalFromPosition(t,e){const n=new v(t.x+.5,t.y+.5,t.z+.5),s=Math.abs(e.x-n.x),i=Math.abs(e.y-n.y),o=Math.abs(e.z-n.z),c=new v;return s>i&&s>o?c.set(e.x>n.x?1:-1,0,0):i>o?c.set(0,e.y>n.y?1:-1,0):c.set(0,0,e.z>n.z?1:-1),c}static raycast(t,e,n){let s=e.x-t.x,i=e.y-t.y,o=e.z-t.z;const c=s*s+i*i+o*o,l=Math.sqrt(c);s/=l,i/=l,o/=l;let h=0,a=Math.floor(t.x),u=Math.floor(t.y),d=Math.floor(t.z);const g=s>0?1:-1,_=i>0?1:-1,k=o>0?1:-1,I=Math.abs(1/s),S=Math.abs(1/i),y=Math.abs(1/o),b=g>0?a+1-t.x:t.x-a,E=_>0?u+1-t.y:t.y-u,T=k>0?d+1-t.z:t.z-d;let p=I<1/0?I*b:1/0,A=S<1/0?S*E:1/0,z=y<1/0?y*T:1/0,m=-1;for(;h<=l;){const x=n.getBlock({x:a,y:u,z:d});if(ut.isVisibleBlock(x==null?void 0:x.type))return{position:[t.x+h*s,t.y+h*i,t.z+h*o],normal:[m===0?-g:0,m===1?-_:0,m===2?-k:0],block:x};const N=Math.min(p,A,z);N===p?(a+=g,h=p,p+=I,m=0):N===A?(u+=_,h=A,A+=S,m=1):(d+=k,h=z,z+=y,m=2)}return null}};let gt=ut;f(gt,"SIZE",1);const P=class{constructor(t,e){f(this,"chunkId");f(this,"worldOriginPosition");f(this,"blocks");f(this,"isDirt");this.chunkId=t,this.worldOriginPosition=P.getChunkOriginPosition(t),this.isDirt=!1,this.blocks=e??new Uint8Array(P.HEIGHT*P.WIDTH*P.WIDTH)}getBlock(t){if(!this.isBlockInChunk(t))return null;const e=this.computeBlockIndex(t),n=this.blocks[e];return{type:n,...de[n]}}setBlock(t,e){if(!this.isBlockInChunk(t))return;const n=this.computeBlockIndex(t);this.blocks[n]=e}isBlockInChunk(t){return P.getChunkIdFromPosition(t)===this.chunkId}decorateChunk(t){const{x:e,y:n,z:s}=this.getWorldOriginPosition(),i=e+P.WIDTH,o=n+P.HEIGHT,c=s+P.WIDTH;for(let l=n;l<o;l++)for(let h=s;h<c;h++)for(let a=e;a<i;a++){const u={x:a,y:l,z:h},d=t.generateBlock(a,l,h);d&&this.setBlock(u,d)}}computeBlockIndex({x:t,y:e,z:n}){const[s,i,o]=this.getBlockLocalCoordinates(t,e,n);return i*P.WIDTH*P.WIDTH+o*P.WIDTH+s}getBlockLocalCoordinates(t,e,n){const s=Oe.euclideanModulo(t,P.WIDTH)|0,i=Oe.euclideanModulo(e,P.HEIGHT)|0,o=Oe.euclideanModulo(n,P.WIDTH)|0;return[s,i,o]}static buildChunkId({x:t,y:e,z:n}){return`${t},${e},${n}`}static chunkIdAsCoordinate(t){const e=t.match(/^([^,]+),([^,]+),(.+)$/);if(!e)throw new Error("Invalid chunkId");const[n,s,i,o]=e;return{x:Number(s),y:Number(i),z:Number(o)}}static getChunkIdFromPosition({x:t,y:e,z:n}){const s=Math.floor(t/P.WIDTH),i=Math.floor(e/P.HEIGHT),o=Math.floor(n/P.WIDTH);return P.buildChunkId({x:s,y:i,z:o})}static getChunkOriginPosition(t){const{x:e,y:n,z:s}=P.chunkIdAsCoordinate(t),i=e*P.WIDTH,o=n*P.HEIGHT,c=s*P.WIDTH;return{x:i,y:o,z:c}}markAsDirt(){this.isDirt=!0}isDirty(){return this.isDirt}getId(){return this.chunkId}getWorldOriginPosition(){return this.worldOriginPosition}getBlocks(){return this.blocks}_debug(){G.debug(JSON.stringify(this.blocks),G.TERRAIN_KEY)}};let et=P;f(et,"WIDTH",C.CHUNK_WIDTH),f(et,"HEIGHT",C.CHUNK_HEIGHT);const We=class{};let ct=We;f(ct,"RADIUS",2),f(ct,"TRUNK_HEIGHT",4),f(ct,"MAX_HEIGHT",We.TRUNK_HEIGHT+2);class X{constructor(t){f(this,"seed");this.seed=t}getSeed(){return this.seed}}f(X,"getContinentalMapSeed",t=>t+"_continental"),f(X,"getErosionMapSeed",t=>t+"_erosion"),f(X,"getPvMapSeed",t=>t+"_pv"),f(X,"getHeightMapSeed",t=>t+"_height"),f(X,"getDensityMapSeed",t=>t+"_density"),f(X,"getTreeMapSeed",t=>t+"_tree");const q=class{static generateSeed(){return Math.random().toString(36).substring(2,15)}};let M=q;f(M,"ORIGIN",new v(0,0,0)),f(M,"CONTINENTALNESS_NOISE_SCALE",2500),f(M,"EROSION_NOISE_SCALE",1024),f(M,"PV_BASE_SCALE",180),f(M,"DENSITY_NOISE_SCALE",12),f(M,"MAX_WORLD_HEIGHT",C.TOP_RENDER_DISTANCE_IN_CHUNKS*C.CHUNK_HEIGHT),f(M,"MIN_WORLD_HEIGHT",C.BOTTOM_RENDER_DISTANCE_IN_CHUNKS*-C.CHUNK_HEIGHT),f(M,"MIN_EROSION",0),f(M,"MAX_EROSION",8),f(M,"MIN_CONTINENTALNESS_HEIGHT",0),f(M,"MAX_CONTINENTALNESS_HEIGHT",25),f(M,"MIN_DENSITY_HEIGHT",q.MIN_CONTINENTALNESS_HEIGHT-40),f(M,"MAX_DENSITY_HEIGHT",q.MAX_WORLD_HEIGHT),f(M,"LARGE_CAVES_HEIGHT",0),f(M,"MAX_SURFACE_HEIGHT",q.MAX_CONTINENTALNESS_HEIGHT+q.MAX_EROSION),f(M,"MIN_SURFACE_HEIGHT",q.MIN_CONTINENTALNESS_HEIGHT-q.MAX_EROSION),f(M,"CLOUD_LEVEL",q.MAX_SURFACE_HEIGHT-25),f(M,"SNOW_LEVEL",q.MAX_CONTINENTALNESS_HEIGHT),f(M,"SEA_LEVEL",q.MIN_CONTINENTALNESS_HEIGHT+15),f(M,"SAND_LEVEL",q.SEA_LEVEL+6),f(M,"BEDROCK_LEVEL",0),f(M,"CLOUD_WIDTH",10),f(M,"CLOUD_DEPTH",5);const Is=.5*(Math.sqrt(3)-1),Kt=(3-Math.sqrt(3))/6,As=1/3,nt=1/6,Xt=r=>Math.floor(r)|0,Cn=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),Pe=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function Cs(r=Math.random){const t=Nn(r),e=new Float64Array(t).map(s=>Cn[s%12*2]),n=new Float64Array(t).map(s=>Cn[s%12*2+1]);return function(i,o){let c=0,l=0,h=0;const a=(i+o)*Is,u=Xt(i+a),d=Xt(o+a),g=(u+d)*Kt,_=u-g,k=d-g,I=i-_,S=o-k;let y,b;I>S?(y=1,b=0):(y=0,b=1);const E=I-y+Kt,T=S-b+Kt,p=I-1+2*Kt,A=S-1+2*Kt,z=u&255,m=d&255;let x=.5-I*I-S*S;if(x>=0){const O=z+t[m],R=e[O],H=n[O];x*=x,c=x*x*(R*I+H*S)}let w=.5-E*E-T*T;if(w>=0){const O=z+y+t[m+b],R=e[O],H=n[O];w*=w,l=w*w*(R*E+H*T)}let N=.5-p*p-A*A;if(N>=0){const O=z+1+t[m+1],R=e[O],H=n[O];N*=N,h=N*N*(R*p+H*A)}return 70*(c+l+h)}}function Ns(r=Math.random){const t=Nn(r),e=new Float64Array(t).map(i=>Pe[i%12*3]),n=new Float64Array(t).map(i=>Pe[i%12*3+1]),s=new Float64Array(t).map(i=>Pe[i%12*3+2]);return function(o,c,l){let h,a,u,d;const g=(o+c+l)*As,_=Xt(o+g),k=Xt(c+g),I=Xt(l+g),S=(_+k+I)*nt,y=_-S,b=k-S,E=I-S,T=o-y,p=c-b,A=l-E;let z,m,x,w,N,O;T>=p?p>=A?(z=1,m=0,x=0,w=1,N=1,O=0):T>=A?(z=1,m=0,x=0,w=1,N=0,O=1):(z=0,m=0,x=1,w=1,N=0,O=1):p<A?(z=0,m=0,x=1,w=0,N=1,O=1):T<A?(z=0,m=1,x=0,w=0,N=1,O=1):(z=0,m=1,x=0,w=1,N=1,O=0);const R=T-z+nt,H=p-m+nt,rt=A-x+nt,st=T-w+2*nt,lt=p-N+2*nt,j=A-O+2*nt,Q=T-1+3*nt,me=p-1+3*nt,pe=A-1+3*nt,Qt=_&255,J=k&255,yt=I&255;let bt=.6-T*T-p*p-A*A;if(bt<0)h=0;else{const B=Qt+t[J+t[yt]];bt*=bt,h=bt*bt*(e[B]*T+n[B]*p+s[B]*A)}let zt=.6-R*R-H*H-rt*rt;if(zt<0)a=0;else{const B=Qt+z+t[J+m+t[yt+x]];zt*=zt,a=zt*zt*(e[B]*R+n[B]*H+s[B]*rt)}let Et=.6-st*st-lt*lt-j*j;if(Et<0)u=0;else{const B=Qt+w+t[J+N+t[yt+O]];Et*=Et,u=Et*Et*(e[B]*st+n[B]*lt+s[B]*j)}let St=.6-Q*Q-me*me-pe*pe;if(St<0)d=0;else{const B=Qt+1+t[J+1+t[yt+1]];St*=St,d=St*St*(e[B]*Q+n[B]*me+s[B]*pe)}return 32*(h+a+u+d)}}function Nn(r){const e=new Uint8Array(512);for(let n=0;n<512/2;n++)e[n]=n;for(let n=0;n<512/2-1;n++){const s=n+~~(r()*(256-n)),i=e[n];e[n]=e[s],e[s]=i}for(let n=256;n<512;n++)e[n]=e[n-256];return e}var Fe={},ks={get exports(){return Fe},set exports(r){Fe=r}};(function(r,t){(function(e,n){r.exports=n()})(L,function(){return e.importState=function(s){var i=new e;return i.importState(s),i},e;function e(){return function(s){var i=0,o=0,c=0,l=1;s.length==0&&(s=[+new Date]);var h=n();i=h(" "),o=h(" "),c=h(" ");for(var a=0;a<s.length;a++)i-=h(s[a]),i<0&&(i+=1),o-=h(s[a]),o<0&&(o+=1),c-=h(s[a]),c<0&&(c+=1);h=null;var u=function(){var d=2091639*i+l*23283064365386963e-26;return i=o,o=c,c=d-(l=d|0)};return u.next=u,u.uint32=function(){return u()*4294967296},u.fract53=function(){return u()+(u()*2097152|0)*11102230246251565e-32},u.version="Alea 0.9",u.args=s,u.exportState=function(){return[i,o,c,l]},u.importState=function(d){i=+d[0]||0,o=+d[1]||0,c=+d[2]||0,l=+d[3]||0},u}(Array.prototype.slice.call(arguments))}function n(){var s=4022871197,i=function(o){o=o.toString();for(var c=0;c<o.length;c++){s+=o.charCodeAt(c);var l=.02519603282416938*s;s=l>>>0,l-=s,l*=s,s=l>>>0,l-=s,s+=l*4294967296}return(s>>>0)*23283064365386963e-26};return i.version="Mash 0.9",i}})})(ks);class He{constructor(t){f(this,"seed");f(this,"prng");this.seed=t,this.prng=Fe(t)}getSeed(){return this.seed}}class Ht extends He{constructor(e){super(e);f(this,"data");this.data=new Map}getMapData(){return this.data}setMapData(e){this.data=e}getPointData(e,n){const s=Ht.computeKey(e,n);return this.data.get(s)}setPointData(e,n,s){const i=Ht.computeKey(e,n);return this.data.set(i,s),s}static computeKey(e,n){return`${Math.floor(e)}_${Math.floor(n)}`}}class Ge extends Ht{constructor(e){super(e);f(this,"noise2D");this.noise2D=Cs(this.prng)}}class U{}f(U,"ENABLED",C.TESTING_MAP_ENABLED),f(U,"CONTINENTALNESS",C.TESTING_MAP_CONTINENTALNESS),f(U,"EROSION",C.TESTING_MAP_EROSION),f(U,"PV",C.TESTING_MAP_PV);const Bt=class extends Ge{constructor(t){super(t)}setValueAt(t,e,n){return this.setPointData(t,e,n)}getValueAt(t,e){return this.getContinentalnessAt(t,e)}getContinentalnessAt(t,e){if(U.ENABLED&&U.CONTINENTALNESS!=null)return U.CONTINENTALNESS;const n=this.getPointData(t,e);if(n!=null)return n;const s=this.noise2D(t/M.CONTINENTALNESS_NOISE_SCALE,e/M.CONTINENTALNESS_NOISE_SCALE);return this.setPointData(t,e,s),s}static getType(t){return t<=Bt.NoiseRange.Ocean.max?"Ocean":t<=Bt.NoiseRange.Coast.max?"Coast":t<=Bt.NoiseRange.Near_Inland.max?"Near_Inland":t<=Bt.NoiseRange.Inland.max?"Inland":"Far_Inland"}};let Z=Bt;f(Z,"NoiseRange",{Ocean:{min:-1,max:-.7},Coast:{min:-.7,max:-.4},Near_Inland:{min:-.4,max:0},Inland:{min:0,max:.6},Far_Inland:{min:.6,max:1}});class fe extends He{constructor(e){super(e);f(this,"data");this.data=new Map}getMapData(){return this.data}setMapData(e){this.data=e}getPointData(e,n,s){const i=fe.computeKey(e,n,s);return this.data.get(i)}setPointData(e,n,s,i){const o=fe.computeKey(e,n,s);return this.data.set(o,i),i}static computeKey(e,n,s){return`${Math.floor(e)}_${Math.floor(n)}_${Math.floor(s)}`}}class zs extends fe{constructor(e){super(e);f(this,"noise3D");this.noise3D=Ns(this.prng)}}const _t=class extends Ge{constructor(t){super(t)}setValueAt(t,e,n){return this.setPointData(t,e,n)}getValueAt(t,e){return this.getErosionAt(t,e)}getErosionAt(t,e){if(U.ENABLED&&U.EROSION!=null)return U.EROSION;const n=this.getPointData(t,e);if(n!=null)return n;const s=this.noise2D(t/M.EROSION_NOISE_SCALE,e/M.EROSION_NOISE_SCALE);return this.setPointData(t,e,s),s}static getType(t){return t<=_t.NoiseRange.VeryLow.max?"VeryLow":t<=_t.NoiseRange.Low.max?"Low":t<=_t.NoiseRange.Mid.max?"Mid":t<=_t.NoiseRange.MidSpike.max?"MidSpike":t<=_t.NoiseRange.MidLow.max?"MidLow":t<=_t.NoiseRange.FlatSpike.max?"FlatSpike":"Flat"}};let mt=_t;f(mt,"NoiseRange",{VeryLow:{min:-1,max:-.5},Low:{min:-.5,max:-.1},Mid:{min:-.1,max:.3},MidSpike:{min:.3,max:.4},MidLow:{min:.4,max:.7},FlatSpike:{min:.7,max:.8},Flat:{min:.8,max:1}});const kt=class extends Ge{constructor(t){super(t)}setValueAt(t,e,n){return this.setPointData(t,e,n)}getValueAt(t,e){return this.getPVAt(t,e)}getPVAt(t,e){if(U.ENABLED&&U.PV!=null)return U.PV;const n=this.getPointData(t,e);if(n!=null)return n;const s=4,i=.5,o=M.PV_BASE_SCALE;let c=0,l=0;for(let h=0;h<s;h++){const a=Math.pow(2,h),u=Math.pow(i,h);l+=u,c+=this.noise2D(t/o*a,e/o*a)*u}return c/=l,this.setPointData(t,e,c),c}static getType(t){return t<=kt.NoiseRange.Valley.max?"Valley":t<=kt.NoiseRange.Low.max?"Low":t<=kt.NoiseRange.Plateau.max?"Plateau":t<=kt.NoiseRange.Mid.max?"Mid":t<=kt.NoiseRange.High.max?"High":"Peak"}};let pt=kt;f(pt,"NoiseRange",{Valley:{min:-1,max:-.7},Low:{min:-.7,max:-.4},Plateau:{min:-.4,max:-.1},Mid:{min:-.1,max:.4},High:{min:.4,max:.8},Peak:{min:.8,max:1}});class vs extends zs{constructor(e,n,s){super(e);f(this,"SOLID",1);f(this,"AIR",-1);f(this,"erosionMap");f(this,"pvMap");this.erosionMap=n,this.pvMap=s}setValueAt(e,n,s,i){return this.setPointData(e,n,s,i)}getValueAt(e,n,s){return this.getDensityAt(e,n,s)}getDensityAt(e,n,s){const{AIR:i,SOLID:o}=this;if(n<M.MIN_DENSITY_HEIGHT)return o;if(n>M.MAX_DENSITY_HEIGHT)return i;const c=1,l=1;return this.noise3D(e/c,n/c,s/c)+l}getScaleFactorAt(e,n,s){return n<M.LARGE_CAVES_HEIGHT?256:36}getSquashingFactorAt(e,n,s){const i=this.erosionMap.getValueAt(e,s),o=this.pvMap.getValueAt(e,s),c=mt.getType(i),l=o>=pt.NoiseRange.Mid.min;switch(c){case"VeryLow":return l?.6:.8;case"Low":return l?.8:.9;case"MidLow":return .9;default:return 1}}}function $(r,t,e){return Math.round(r+(t-r)*e)}function Os(r){return Math.random()<=r}function ge(r,t,e){return r>=t&&r<=e}class Rs extends Ht{constructor(e,n,s,i){super(e);f(this,"continentalMap");f(this,"erosionMap");f(this,"pvMap");this.continentalMap=n,this.erosionMap=s,this.pvMap=i}setValueAt(e,n,s){return this.setPointData(e,n,s)}getValueAt(e,n){return this.getSurfaceHeightAt(e,n)}getSurfaceHeightAt(e,n){const s=this.getPointData(e,n);if(s!=null)return s;const i=this.getContinentalness(e,n),o=this.getBaseHeight(i),c=this.getErosion(e,n),l=this.getErosionFactor(c),h=this.getPV(e,n),a=this.getPvHeight(h,l),u=o+a;return this.setPointData(e,n,u),u}getBaseHeight(e){const n=Z.getType(e);if(n==="Ocean")return M.MIN_CONTINENTALNESS_HEIGHT;if(n==="Coast"){const s=Z.NoiseRange.Coast.min,i=Z.NoiseRange.Coast.max,o=(e-s)/(i-s);return $(M.SEA_LEVEL,M.SEA_LEVEL+2,o)}if(n==="Near_Inland"||n==="Inland"){const s=Z.NoiseRange.Near_Inland.min,i=Z.NoiseRange.Inland.max,o=(e-s)/(i-s);return $(M.SEA_LEVEL+2,M.SEA_LEVEL+15,o)}if(n==="Far_Inland"){const s=Z.NoiseRange.Far_Inland.min,i=Z.NoiseRange.Far_Inland.max,o=(e-s)/(i-s);return $(M.SEA_LEVEL+15,M.MAX_CONTINENTALNESS_HEIGHT,o)}return M.MAX_CONTINENTALNESS_HEIGHT}getErosionFactor(e){const n=M.MIN_EROSION,s=M.MAX_EROSION,i=Math.floor(s*(1/2)),o=n+6,c=o*2,l=c*2,h=mt.getType(e),{min:a,max:u}=mt.NoiseRange[h],d=(e-a)/(u-a),g=(u-e)/(u-a);switch(h){case"Flat":return $(n,o,g);case"FlatSpike":return $(o,i,g);case"MidLow":return i;case"MidSpike":return $(o,i,d);case"Mid":return $(o,c,g);case"Low":return $(c,l,g);case"VeryLow":return $(l,s,g)}}getPvHeight(e,n){const s=Math.round(-n*.6666666666666666),i=Math.round(-n/4),o=n,c=Math.round(o*(1/2)),l=pt.getType(e),{min:h,max:a}=pt.NoiseRange[l],u=(e-h)/(a-h);switch(l){case"Valley":return s;case"Low":return $(s,i,u);case"Plateau":return $(i,i+2,u);case"Mid":return $(i+2,c,u);case"High":return $(c,o,u);case"Peak":return o}}getContinentalness(e,n){return this.continentalMap.getValueAt(e,n)}getErosion(e,n){return this.erosionMap.getValueAt(e,n)}getPV(e,n){return this.pvMap.getValueAt(e,n)}}class Ls extends He{constructor(e,n,s,i,o,c){super(e);f(this,"continentalMap");f(this,"erosionMap");f(this,"pvMap");f(this,"heightMap");f(this,"densityMap");this.continentalMap=n,this.erosionMap=s,this.pvMap=i,this.heightMap=o,this.densityMap=c}getSurfaceHeightAt(e,n){return this.heightMap.getValueAt(e,n)}getContinentalnessAt(e,n){return this.continentalMap.getValueAt(e,n)}getErosionAt(e,n){return this.erosionMap.getValueAt(e,n)}getPVAt(e,n){return this.pvMap.getValueAt(e,n)}getDensityAt(e,n,s){return this.densityMap.getValueAt(e,n,s)}getHeightMap(){return this.heightMap}}var Zt=(r=>(r[r.EMPTY=0]="EMPTY",r[r.TRUNK=1]="TRUNK",r[r.LEAF=2]="LEAF",r))(Zt||{});class Gt{static encode(t){let e=0;return e=this.setType(e,t.type),e=this.setTrunkHeight(e,t.trunkHeight),e=this.setTrunkSurfaceY(e,t.trunkSurfaceY),e=this.setTrunkDistance(e,t.trunkDistance),e}static decode(t){return{type:this.getType(t),trunkHeight:this.getTrunkHeight(t),trunkSurfaceY:this.getTrunkSurfaceY(t),trunkDistance:this.getTrunkDistance(t)}}static getType(t){return(t&this.TYPE_MASK)>>14}static setType(t,e){return t|=e<<14&this.TYPE_MASK}static getTrunkHeight(t){return(t&this.TRUNK_HEIGHT_MASK)>>10}static setTrunkHeight(t,e){return t|=e<<10&this.TRUNK_HEIGHT_MASK}static getTrunkSurfaceY(t){return(t&this.TRUNK_SURFACE_HEIGHT_MASK)>>2}static setTrunkSurfaceY(t,e){return t|=e<<2&this.TRUNK_SURFACE_HEIGHT_MASK}static getTrunkDistance(t){return t&this.TRUNK_DISTANCE_MASK}static setTrunkDistance(t,e){return t|=e&this.TRUNK_DISTANCE_MASK}}f(Gt,"TYPE_MASK",49152),f(Gt,"TRUNK_HEIGHT_MASK",15360),f(Gt,"TRUNK_SURFACE_HEIGHT_MASK",1020),f(Gt,"TRUNK_DISTANCE_MASK",3);class qt extends Ht{constructor(e){super(e);f(this,"enabled");this.enabled=C.TREE_GENERATION_ENABLED}shouldSpawnTreeLeafAt(e,n,s){if(!this.enabled)return!1;const i=this.getTreeMapValueAt(e,s);if(i==null)return!1;const{type:o,trunkDistance:c,trunkHeight:l,trunkSurfaceY:h}=Gt.decode(i),a=h+l,u=n-a;if(o===Zt.TRUNK){if(u===2)return Os(.5);if(u===1)return!0}return!!(o===Zt.LEAF&&(c===2&&ge(u,-1,0)||c===1&&ge(u,-1,1)))}shouldSpawnTreeTrunkAt(e,n,s,i){if(!this.enabled)return!1;const o=this.getTreeMapTypeAt(e,s);return n<i||n>i+ct.TRUNK_HEIGHT||o==null?!1:o===Zt.TRUNK}getTreeMapTypeAt(e,n){const s=this.getTreeMapValueAt(e,n);return s!=null?Gt.getType(s):null}getTreeMapValueAt(e,n){return this.getPointData(e,n)}static getTreeSeedAt(e,n,s){return`${e}_${n}_${s}`}setValueAt(e,n,s){return this.setPointData(e,n,s)}getValueAt(e,n){return this.getPointData(e,n)??Zt.EMPTY}}f(qt,"MAP_SIZE",et.WIDTH+ct.RADIUS*2);class Ds extends X{constructor(t){super(t)}getTerrainMap(){const{seed:t}=this,e=new Z(X.getContinentalMapSeed(t)),n=new mt(X.getErosionMapSeed(t)),s=new pt(X.getPvMapSeed(t)),i=new Rs(X.getHeightMapSeed(t),e,n,s),o=new vs(X.getDensityMapSeed(t),n,s);return new Ls(t,e,n,s,i,o)}getTreeMapFromBuffer(t,e){const{x:n,z:s}=et.getChunkOriginPosition(t),i=new qt(this.seed),o=new Map,c=n-ct.RADIUS,l=s-ct.RADIUS;for(let h=0;h<e.length;h++){const a=Math.floor(h/qt.MAP_SIZE)+c,u=h%qt.MAP_SIZE+l,d=qt.computeKey(a,u);o.set(d,e[h])}return i.setMapData(o),i}}class kn{constructor(t){f(this,"terrainMap");this.terrainMap=t}getSurfaceHeightAt(t,e){return this.terrainMap.getSurfaceHeightAt(t,e)}getContinentalTypeAt(t,e){const n=this.terrainMap.getContinentalnessAt(t,e);return Z.getType(n)}getPvTypeAt(t,e){const n=this.terrainMap.getPVAt(t,e);return pt.getType(n)}getErosionTypeAt(t,e){const n=this.terrainMap.getErosionAt(t,e);return mt.getType(n)}}class Ps extends kn{constructor(e,n){super(e);f(this,"treeMap");this.treeMap=n}generateBlock(e,n,s){const i=this.getSurfaceHeightAt(e,s);return n<i?null:this.shouldSpawnWater(e,n,s)?F.WATER:this.treeMap.shouldSpawnTreeTrunkAt(e,n,s,i)?F.OAK_LOG:this.treeMap.shouldSpawnTreeLeafAt(e,n,s)?F.OAK_LEAVES:this.shouldSpawnCloud(e,n,s)?F.CLOUD:F.AIR}shouldSpawnWater(e,n,s){return n<M.SEA_LEVEL}shouldSpawnCloud(e,n,s){const i=Math.floor(Math.random()*6)+1,o=n>M.CLOUD_LEVEL&&n<=M.CLOUD_LEVEL+1,c=Math.ceil(e/M.CLOUD_WIDTH)%i===0&&Math.ceil(s/M.CLOUD_DEPTH)%i===0;return o&&c}}class Fs extends kn{constructor(t){super(t)}generateBlock(t,e,n){const s=this.getSurfaceHeightAt(t,n);if(this.terrainMap.getDensityAt(t,e,n)<0||e>=s)return F.AIR;const o=Math.abs(e-s);switch(this.getDepthLevel(e,o)){case"Surface":return this.getSurfaceBlockType(t,e,n);case"Subsurface":return this.getSubSurfaceBlockType(t,e,n);case"Mid":return this.getMidBlockType(t,e,n,o);default:return F.STONE}}getMidBlockType(t,e,n,s){return this.shouldSpawnCoal(t,e,n,s)?F.COAL_ORE:F.STONE}getSurfaceBlockType(t,e,n){return this.shouldSpawnSnow(t,e,n)?F.GRASS_SNOW:this.shouldSpawnSand(t,e,n)?F.SAND:e<M.SEA_LEVEL-1?F.DIRT:this.shouldSpawnSurfaceStone(t,e,n)?F.STONE:F.GRASS}getSubSurfaceBlockType(t,e,n){return this.shouldSpawnSand(t,e,n)?F.SAND:this.shouldSpawnSurfaceStone(t,e,n)?F.STONE:F.DIRT}shouldSpawnSand(t,e,n){const s=this.getContinentalTypeAt(t,n);return e<=M.SAND_LEVEL&&(s==="Coast"||s==="Ocean")}shouldSpawnSurfaceStone(t,e,n){const s=this.getPvTypeAt(t,n),i=this.getContinentalTypeAt(t,n),o=this.getErosionTypeAt(t,n),c=i==="Far_Inland",l=i==="Inland",h=o==="Flat",a=o==="VeryLow"||o==="Low",u=o==="VeryLow",d=s==="Valley",g=s==="Valley"||s==="Low";return c&&u&&g||c&&a&&d||(l||c)&&h&&g}shouldSpawnCoal(t,e,n,s){const i=this.terrainMap.getDensityAt(t,e,n),o=ge(i,.05,.07);return ge(s,5,20)&&o}shouldSpawnSnow(t,e,n){const i=this.getContinentalTypeAt(t,n)==="Far_Inland",o=e>=M.SNOW_LEVEL;return i&&o}getDepthLevel(t,e){return e<=1?"Surface":e<=3?"Subsurface":t<=M.BEDROCK_LEVEL?"BedRock":t<=M.MIN_SURFACE_HEIGHT-5?"Deep":"Mid"}}var Be=(r=>(r[r.TERRAIN=0]="TERRAIN",r[r.FEATURES=1]="FEATURES",r))(Be||{});class Hs{constructor(t,e){f(this,"terrainGenerator");f(this,"featuresGenerator");this.terrainGenerator=new Fs(t),this.featuresGenerator=new Ps(t,e)}getBlockGenerator(t){switch(t){case 0:return this.terrainGenerator;case 1:return this.featuresGenerator}}}class Gs{constructor(t){f(this,"DEFAULT_BLOCK_COLOR_RGBA",[1,1,1,1]);f(this,"AO_INTENSITY_LEVEL",[0,.2,.3,.4]);f(this,"terrainMap");this.terrainMap=t}buildChunkGeometry(t,e){const{x:n,y:s,z:i}=e,o=[],c=[],l=[],h=[],a=[],u=[],d=[],g=[],_=[],k=[];for(let I=0;I<et.HEIGHT;++I){const S=s+I;for(let y=0;y<et.WIDTH;++y){const b=i+y;for(let E=0;E<et.WIDTH;++E){const T=n+E,p={x:T,y:S,z:b},A=t.getBlock(p),z=gt.isVisibleBlock(A==null?void 0:A.type);if(A&&z){const m=A.isTransparent,x=A.type===F.WATER;if(x&&this.canSkipWaterBlockRendering(S))continue;const w=m?u:o,N=m?d:c,O=m?g:l,R=m?_:h,H=m?k:a;for(const rt of gt.getBlockFaces()){if(x&&rt!=="top")continue;const{normal:st,vertices:lt}=gt.getBlockFaceGeometry(rt),j={x:T+st[0],y:S+st[1],z:b+st[2]},Q=t.getBlock(j);if(C.TERRAIN_OPTIMIZATION_ENABLED&&!Q&&this.canCullEdgeBlockFace(p,rt,j))continue;if(!Q||Q.isTransparent&&Q.type!==F.CLOUD){const J=w.length/3;for(const{pos:yt,uv:bt,ao:zt}of lt){const Et=T+yt[0],St=S+yt[1],B=b+yt[2];w.push(Et,St,B),N.push(...st);const zn=gt.getBlockUVCoordinates(A.type,rt,[bt[0],bt[1]]);R.push(zn.u,zn.v);const Vs=this.calculateVertexColor({x:Et,y:St,z:B},A,zt,t);H.push(...Vs)}O.push(J,J+1,J+2,J+2,J+1,J+3)}}}}}}return{solid:{positions:o,normals:c,indices:l,uvs:h,colors:a},transparent:{positions:u,normals:d,indices:g,uvs:_,colors:k}}}canCullEdgeBlockFace(t,e,n){const{terrainMap:s}=this,{x:i,y:o,z:c}=t,{x:l,y:h,z:a}=n,u=s.getSurfaceHeightAt(l,a);if(!(o<u-(e==="top"?1:0)))return!1;const g=s.getDensityAt(i,o,c),_=s.getDensityAt(l,h,a);return Math.sign(g)===Math.sign(_)}calculateVertexColor(t,e,n,s){const i=gt.getBlockColor(e.type)??this.DEFAULT_BLOCK_COLOR_RGBA,o=this.computeVertexAO(t,n,s);return[i[0]-o,i[1]-o,i[2]-o,i[3]]}computeVertexAO(t,{corner:e,side1:n,side2:s},i){let o=0;for(const c of[e,n,s])this.isSideOccluded(t,c,i)&&(o+=1);return this.AO_INTENSITY_LEVEL[o]}isSideOccluded({x:t,y:e,z:n},s,i){const{terrainMap:o}=this,[c,l,h]=s,a=i.getBlock({x:t+c,y:e+l,z:n+h});if(a&&!a.isTransparent)return!0;if(!a){const u=Math.floor(t+c),d=Math.floor(e+l),g=Math.floor(n+h),_=o.getSurfaceHeightAt(u,g),k=o.getDensityAt(u,d,g),I=Math.sign(k)>0,S=Math.sign(l)>0,y=Math.sign(l)<0,b=e<_,E=Math.abs(e-_)===0;if(I)return S&&b||y&&E}return!1}canSkipWaterBlockRendering(t){return t!==M.SEA_LEVEL-1}static extractBufferGeometryDataFromGeometry(t){var c,l;const e=Array.from(t.getAttribute("position").array),n=Array.from(t.getAttribute("normal").array),s=Array.from(t.getAttribute("uv").array),i=Array.from(((c=t.getAttribute("color"))==null?void 0:c.array)??[]),o=Array.from(((l=t.index)==null?void 0:l.array)??[]);return{positions:e,normals:n,uvs:s,indices:o,colors:i}}}function Bs(r,t,e){const n=new et(r),s=new Ds(t),i=s.getTerrainMap(),o=s.getTreeMapFromBuffer(r,new Uint16Array(e)),c=new Hs(i,o),l=c.getBlockGenerator(Be.TERRAIN),h=c.getBlockGenerator(Be.FEATURES);n.decorateChunk(l),n.decorateChunk(h);const a=n.getBlocks(),u=new Gs(i),{solid:d,transparent:g}=u.buildChunkGeometry(n,n.getWorldOriginPosition());return{solidGeometry:d,transparentGeometry:g,blocksBuffer:ts(a.buffer)}}es(Bs)})();
