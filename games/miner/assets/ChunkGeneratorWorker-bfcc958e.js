var Us=Object.defineProperty;var $s=(L,it,At)=>it in L?Us(L,it,{enumerable:!0,configurable:!0,writable:!0,value:At}):L[it]=At;var m=(L,it,At)=>($s(L,typeof it!="symbol"?it+"":it,At),At);(function(){"use strict";var L=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function it(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function At(r){if(r.__esModule)return r;var t=r.default;if(typeof t=="function"){var e=function n(){if(this instanceof n){var s=[null];s.push.apply(s,arguments);var i=Function.bind.apply(t,s);return new i}return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),e}var $e={},tt={},Nt={};Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.DefaultSerializer=Nt.extendSerializer=void 0;function Pn(r,t){const e=r.deserialize.bind(r),n=r.serialize.bind(r);return{deserialize(s){return t.deserialize(s,e)},serialize(s){return t.serialize(s,n)}}}Nt.extendSerializer=Pn;const Ye={deserialize(r){return Object.assign(Error(r.message),{name:r.name,stack:r.stack})},serialize(r){return{__error_marker:"$$error",message:r.message,name:r.name,stack:r.stack}}},Ln=r=>r&&typeof r=="object"&&"__error_marker"in r&&r.__error_marker==="$$error";Nt.DefaultSerializer={deserialize(r){return Ln(r)?Ye.deserialize(r):r},serialize(r){return r instanceof Error?Ye.serialize(r):r}},Object.defineProperty(tt,"__esModule",{value:!0}),tt.serialize=tt.deserialize=tt.registerSerializer=void 0;const Ke=Nt;let re=Ke.DefaultSerializer;function Dn(r){re=Ke.extendSerializer(re,r)}tt.registerSerializer=Dn;function Fn(r){return re.deserialize(r)}tt.deserialize=Fn;function Hn(r){return re.serialize(r)}tt.serialize=Hn;var Xe={},ht={},Dt={};Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.getBundleURL=Dt.getBaseURL=void 0;let be;function Gn(){return be||(be=Bn()),be}Dt.getBundleURL=Gn;function Bn(){try{throw new Error}catch(r){const t=(""+r.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(t)return Ze(t[0])}return"/"}function Ze(r){return(""+r).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)?\/[^/]+(?:\?.*)?$/,"$1")+"/"}Dt.getBaseURL=Ze,Object.defineProperty(ht,"__esModule",{value:!0}),ht.isWorkerRuntime=ht.getWorkerImplementation=ht.defaultPoolSize=void 0;const qe=Dt;ht.defaultPoolSize=typeof navigator<"u"&&navigator.hardwareConcurrency?navigator.hardwareConcurrency:4;const Qe=r=>/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(r);function Je(r){const t=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(t)}function Wn(){if(typeof Worker>"u")return class{constructor(){throw Error("No web worker implementation available. You might have tried to spawn a worker within a worker in a browser that doesn't support workers in workers.")}};class r extends Worker{constructor(n,s){var i,a;typeof n=="string"&&s&&s._baseURL?n=new URL(n,s._baseURL):typeof n=="string"&&!Qe(n)&&qe.getBundleURL().match(/^file:\/\//i)&&(n=new URL(n,qe.getBundleURL().replace(/\/[^\/]+$/,"/")),(!((i=s==null?void 0:s.CORSWorkaround)!==null&&i!==void 0)||i)&&(n=Je(`importScripts(${JSON.stringify(n)});`))),typeof n=="string"&&Qe(n)&&(!((a=s==null?void 0:s.CORSWorkaround)!==null&&a!==void 0)||a)&&(n=Je(`importScripts(${JSON.stringify(n)});`)),super(n,s)}}class t extends r{constructor(n,s){const i=window.URL.createObjectURL(n);super(i,s)}static fromText(n,s){const i=new window.Blob([n],{type:"text/javascript"});return new t(i,s)}}return{blob:t,default:r}}let Ee;function Vn(){return Ee||(Ee=Wn()),Ee}ht.getWorkerImplementation=Vn;function jn(){const r=typeof self<"u"&&typeof Window<"u"&&self instanceof Window;return!!(typeof self<"u"&&self.postMessage&&!r)}ht.isWorkerRuntime=jn;var tn={},Ft={},Un={get exports(){return Ft},set exports(r){Ft=r}},Se,en;function $n(){if(en)return Se;en=1;var r=1e3,t=r*60,e=t*60,n=e*24,s=n*7,i=n*365.25;Se=function(o,c){c=c||{};var d=typeof o;if(d==="string"&&o.length>0)return a(o);if(d==="number"&&isFinite(o))return c.long?h(o):u(o);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(o))};function a(o){if(o=String(o),!(o.length>100)){var c=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(o);if(c){var d=parseFloat(c[1]),f=(c[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return d*i;case"weeks":case"week":case"w":return d*s;case"days":case"day":case"d":return d*n;case"hours":case"hour":case"hrs":case"hr":case"h":return d*e;case"minutes":case"minute":case"mins":case"min":case"m":return d*t;case"seconds":case"second":case"secs":case"sec":case"s":return d*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return d;default:return}}}}function u(o){var c=Math.abs(o);return c>=n?Math.round(o/n)+"d":c>=e?Math.round(o/e)+"h":c>=t?Math.round(o/t)+"m":c>=r?Math.round(o/r)+"s":o+"ms"}function h(o){var c=Math.abs(o);return c>=n?l(o,c,n,"day"):c>=e?l(o,c,e,"hour"):c>=t?l(o,c,t,"minute"):c>=r?l(o,c,r,"second"):o+" ms"}function l(o,c,d,f){var p=c>=d*1.5;return Math.round(o/d)+" "+f+(p?"s":"")}return Se}function Yn(r){e.debug=e,e.default=e,e.coerce=h,e.disable=i,e.enable=s,e.enabled=a,e.humanize=$n(),e.destroy=l,Object.keys(r).forEach(o=>{e[o]=r[o]}),e.names=[],e.skips=[],e.formatters={};function t(o){let c=0;for(let d=0;d<o.length;d++)c=(c<<5)-c+o.charCodeAt(d),c|=0;return e.colors[Math.abs(c)%e.colors.length]}e.selectColor=t;function e(o){let c,d=null,f,p;function T(...M){if(!T.enabled)return;const E=T,b=Number(new Date),y=b-(c||b);E.diff=y,E.prev=c,E.curr=b,c=b,M[0]=e.coerce(M[0]),typeof M[0]!="string"&&M.unshift("%O");let w=0;M[0]=M[0].replace(/%([a-zA-Z%])/g,(_,A)=>{if(_==="%%")return"%";w++;const k=e.formatters[A];if(typeof k=="function"){const g=M[w];_=k.call(E,g),M.splice(w,1),w--}return _}),e.formatArgs.call(E,M),(E.log||e.log).apply(E,M)}return T.namespace=o,T.useColors=e.useColors(),T.color=e.selectColor(o),T.extend=n,T.destroy=e.destroy,Object.defineProperty(T,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(f!==e.namespaces&&(f=e.namespaces,p=e.enabled(o)),p),set:M=>{d=M}}),typeof e.init=="function"&&e.init(T),T}function n(o,c){const d=e(this.namespace+(typeof c>"u"?":":c)+o);return d.log=this.log,d}function s(o){e.save(o),e.namespaces=o,e.names=[],e.skips=[];let c;const d=(typeof o=="string"?o:"").split(/[\s,]+/),f=d.length;for(c=0;c<f;c++)d[c]&&(o=d[c].replace(/\*/g,".*?"),o[0]==="-"?e.skips.push(new RegExp("^"+o.slice(1)+"$")):e.names.push(new RegExp("^"+o+"$")))}function i(){const o=[...e.names.map(u),...e.skips.map(u).map(c=>"-"+c)].join(",");return e.enable(""),o}function a(o){if(o[o.length-1]==="*")return!0;let c,d;for(c=0,d=e.skips.length;c<d;c++)if(e.skips[c].test(o))return!1;for(c=0,d=e.names.length;c<d;c++)if(e.names[c].test(o))return!0;return!1}function u(o){return o.toString().substring(2,o.toString().length-2).replace(/\.\*\?$/,"*")}function h(o){return o instanceof Error?o.stack||o.message:o}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var Kn=Yn;(function(r,t){t.formatArgs=n,t.save=s,t.load=i,t.useColors=e,t.storage=a(),t.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;h.splice(1,0,l,"color: inherit");let o=0,c=0;h[0].replace(/%[a-zA-Z%]/g,d=>{d!=="%%"&&(o++,d==="%c"&&(c=o))}),h.splice(c,0,l)}t.log=console.debug||console.log||(()=>{});function s(h){try{h?t.storage.setItem("debug",h):t.storage.removeItem("debug")}catch{}}function i(){let h;try{h=t.storage.getItem("debug")}catch{}return!h&&typeof process<"u"&&"env"in process&&(h={}.DEBUG),h}function a(){try{return localStorage}catch{}}r.exports=Kn(t);const{formatters:u}=r.exports;u.j=function(h){try{return JSON.stringify(h)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}})(Un,Ft);var Xn=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})};class se{constructor(t){this._baseObserver=t,this._pendingPromises=new Set}complete(){Promise.all(this._pendingPromises).then(()=>this._baseObserver.complete()).catch(t=>this._baseObserver.error(t))}error(t){this._baseObserver.error(t)}schedule(t){const e=Promise.all(this._pendingPromises),n=[],s=a=>n.push(a),i=Promise.resolve().then(()=>Xn(this,void 0,void 0,function*(){yield e,yield t(s),this._pendingPromises.delete(i);for(const a of n)this._baseObserver.next(a)})).catch(a=>{this._pendingPromises.delete(i),this._baseObserver.error(a)});this._pendingPromises.add(i)}}const nn=()=>typeof Symbol=="function",Yt=r=>nn()&&!!Symbol[r],xe=r=>Yt(r)?Symbol[r]:"@@"+r;Yt("asyncIterator")||(Symbol.asyncIterator=Symbol.asyncIterator||Symbol.for("Symbol.asyncIterator"));const Zn=xe("iterator"),Me=xe("observable"),rn=xe("species");function ie(r,t){const e=r[t];if(e!=null){if(typeof e!="function")throw new TypeError(e+" is not a function");return e}}function Kt(r){let t=r.constructor;return t!==void 0&&(t=t[rn],t===null&&(t=void 0)),t!==void 0?t:et}function qn(r){return r instanceof et}function Ht(r){Ht.log?Ht.log(r):setTimeout(()=>{throw r},0)}function oe(r){Promise.resolve().then(()=>{try{r()}catch(t){Ht(t)}})}function sn(r){const t=r._cleanup;if(t!==void 0&&(r._cleanup=void 0,!!t))try{if(typeof t=="function")t();else{const e=ie(t,"unsubscribe");e&&e.call(t)}}catch(e){Ht(e)}}function we(r){r._observer=void 0,r._queue=void 0,r._state="closed"}function Qn(r){const t=r._queue;if(t){r._queue=void 0,r._state="ready";for(const e of t)if(on(r,e.type,e.value),r._state==="closed")break}}function on(r,t,e){r._state="running";const n=r._observer;try{const s=n?ie(n,t):void 0;switch(t){case"next":s&&s.call(n,e);break;case"error":if(we(r),s)s.call(n,e);else throw e;break;case"complete":we(r),s&&s.call(n);break}}catch(s){Ht(s)}r._state==="closed"?sn(r):r._state==="running"&&(r._state="ready")}function Te(r,t,e){if(r._state!=="closed"){if(r._state==="buffering"){r._queue=r._queue||[],r._queue.push({type:t,value:e});return}if(r._state!=="ready"){r._state="buffering",r._queue=[{type:t,value:e}],oe(()=>Qn(r));return}on(r,t,e)}}class Jn{constructor(t,e){this._cleanup=void 0,this._observer=t,this._queue=void 0,this._state="initializing";const n=new tr(this);try{this._cleanup=e.call(void 0,n)}catch(s){n.error(s)}this._state==="initializing"&&(this._state="ready")}get closed(){return this._state==="closed"}unsubscribe(){this._state!=="closed"&&(we(this),sn(this))}}class tr{constructor(t){this._subscription=t}get closed(){return this._subscription._state==="closed"}next(t){Te(this._subscription,"next",t)}error(t){Te(this._subscription,"error",t)}complete(){Te(this._subscription,"complete")}}class et{constructor(t){if(!(this instanceof et))throw new TypeError("Observable cannot be called as a function");if(typeof t!="function")throw new TypeError("Observable initializer must be a function");this._subscriber=t}subscribe(t,e,n){return(typeof t!="object"||t===null)&&(t={next:t,error:e,complete:n}),new Jn(t,this._subscriber)}pipe(t,...e){let n=this;for(const s of[t,...e])n=s(n);return n}tap(t,e,n){const s=typeof t!="object"||t===null?{next:t,error:e,complete:n}:t;return new et(i=>this.subscribe({next(a){s.next&&s.next(a),i.next(a)},error(a){s.error&&s.error(a),i.error(a)},complete(){s.complete&&s.complete(),i.complete()},start(a){s.start&&s.start(a)}}))}forEach(t){return new Promise((e,n)=>{if(typeof t!="function"){n(new TypeError(t+" is not a function"));return}function s(){i.unsubscribe(),e(void 0)}const i=this.subscribe({next(a){try{t(a,s)}catch(u){n(u),i.unsubscribe()}},error(a){n(a)},complete(){e(void 0)}})})}map(t){if(typeof t!="function")throw new TypeError(t+" is not a function");const e=Kt(this);return new e(n=>this.subscribe({next(s){let i=s;try{i=t(s)}catch(a){return n.error(a)}n.next(i)},error(s){n.error(s)},complete(){n.complete()}}))}filter(t){if(typeof t!="function")throw new TypeError(t+" is not a function");const e=Kt(this);return new e(n=>this.subscribe({next(s){try{if(!t(s))return}catch(i){return n.error(i)}n.next(s)},error(s){n.error(s)},complete(){n.complete()}}))}reduce(t,e){if(typeof t!="function")throw new TypeError(t+" is not a function");const n=Kt(this),s=arguments.length>1;let i=!1,a=e;return new n(u=>this.subscribe({next(h){const l=!i;if(i=!0,!l||s)try{a=t(a,h)}catch(o){return u.error(o)}else a=h},error(h){u.error(h)},complete(){if(!i&&!s)return u.error(new TypeError("Cannot reduce an empty sequence"));u.next(a),u.complete()}}))}concat(...t){const e=Kt(this);return new e(n=>{let s,i=0;function a(u){s=u.subscribe({next(h){n.next(h)},error(h){n.error(h)},complete(){i===t.length?(s=void 0,n.complete()):a(e.from(t[i++]))}})}return a(this),()=>{s&&(s.unsubscribe(),s=void 0)}})}flatMap(t){if(typeof t!="function")throw new TypeError(t+" is not a function");const e=Kt(this);return new e(n=>{const s=[],i=this.subscribe({next(u){let h;if(t)try{h=t(u)}catch(o){return n.error(o)}else h=u;const l=e.from(h).subscribe({next(o){n.next(o)},error(o){n.error(o)},complete(){const o=s.indexOf(l);o>=0&&s.splice(o,1),a()}});s.push(l)},error(u){n.error(u)},complete(){a()}});function a(){i.closed&&s.length===0&&n.complete()}return()=>{s.forEach(u=>u.unsubscribe()),i.unsubscribe()}})}[Me](){return this}static from(t){const e=typeof this=="function"?this:et;if(t==null)throw new TypeError(t+" is not an object");const n=ie(t,Me);if(n){const s=n.call(t);if(Object(s)!==s)throw new TypeError(s+" is not an object");return qn(s)&&s.constructor===e?s:new e(i=>s.subscribe(i))}if(Yt("iterator")){const s=ie(t,Zn);if(s)return new e(i=>{oe(()=>{if(!i.closed){for(const a of s.call(t))if(i.next(a),i.closed)return;i.complete()}})})}if(Array.isArray(t))return new e(s=>{oe(()=>{if(!s.closed){for(const i of t)if(s.next(i),s.closed)return;s.complete()}})});throw new TypeError(t+" is not observable")}static of(...t){const e=typeof this=="function"?this:et;return new e(n=>{oe(()=>{if(!n.closed){for(const s of t)if(n.next(s),n.closed)return;n.complete()}})})}static get[rn](){return this}}nn()&&Object.defineProperty(et,Symbol("extensions"),{value:{symbol:Me,hostReportError:Ht},configurable:!0});var Ct=et;function kt(r){typeof r=="function"?r():r&&typeof r.unsubscribe=="function"&&r.unsubscribe()}var er=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})};function nr(r){return t=>new Ct(e=>{const n=new se(e),s=t.subscribe({complete(){n.complete()},error(i){n.error(i)},next(i){n.schedule(a=>er(this,void 0,void 0,function*(){(yield r(i))&&a(i)}))}});return()=>kt(s)})}function rr(r){return r&&Yt("asyncIterator")&&r[Symbol.asyncIterator]}function sr(r){return r&&Yt("iterator")&&r[Symbol.iterator]}var ir=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})},or=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=r[Symbol.asyncIterator],e;return t?t.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(i){e[i]=r[i]&&function(a){return new Promise(function(u,h){a=r[i](a),s(u,h,a.done,a.value)})}}function s(i,a,u,h){Promise.resolve(h).then(function(l){i({value:l,done:u})},a)}};function ar(r){return t=>new Ct(e=>{const n=new se(e),s=t.subscribe({complete(){n.complete()},error(i){n.error(i)},next(i){n.schedule(a=>ir(this,void 0,void 0,function*(){var u,h;const l=yield r(i);if(sr(l)||rr(l))try{for(var o=or(l),c;c=yield o.next(),!c.done;){const d=c.value;a(d)}}catch(d){u={error:d}}finally{try{c&&!c.done&&(h=o.return)&&(yield h.call(o))}finally{if(u)throw u.error}}else l.map(d=>a(d))}))}});return()=>kt(s)})}function cr(r){return new et(t=>{let e=0;const n=setInterval(()=>{t.next(e++)},r);return()=>clearInterval(n)})}var ur=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})};function lr(r){return t=>new Ct(e=>{const n=new se(e),s=t.subscribe({complete(){n.complete()},error(i){n.error(i)},next(i){n.schedule(a=>ur(this,void 0,void 0,function*(){const u=yield r(i);a(u)}))}});return()=>kt(s)})}function hr(...r){return r.length===0?et.from([]):new et(t=>{let e=0;const n=r.map(i=>i.subscribe({error(a){t.error(a),s()},next(a){t.next(a)},complete(){++e===r.length&&(t.complete(),s())}})),s=()=>{n.forEach(i=>kt(i))};return s})}class dr extends Ct{constructor(){super(t=>(this._observers.add(t),()=>this._observers.delete(t))),this._observers=new Set}next(t){for(const e of this._observers)e.next(t)}error(t){for(const e of this._observers)e.error(t)}complete(){for(const t of this._observers)t.complete()}}var an=dr;function fr(r){const t=new an;let e,n=0;return new Ct(s=>{e||(e=r.subscribe(t));const i=t.subscribe(s);return n++,()=>{n--,i.unsubscribe(),n===0&&(kt(e),e=void 0)}})}var gr=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})};function mr(r,t){return e=>new Ct(n=>{let s,i=0;const a=new se(n),u=e.subscribe({complete(){a.complete()},error(h){a.error(h)},next(h){a.schedule(l=>gr(this,void 0,void 0,function*(){s=yield r(i===0?typeof t>"u"?h:t:s,h,i++),l(s)}))}});return()=>kt(u)})}var pr=Object.freeze({__proto__:null,Observable:Ct,Subject:an,filter:nr,flatMap:ar,interval:cr,map:lr,merge:hr,multicast:fr,scan:mr,unsubscribe:kt}),ae=At(pr),ce={};Object.defineProperty(ce,"__esModule",{value:!0}),ce.allSettled=void 0;function _r(r){return Promise.all(r.map(t=>{const e=i=>({status:"fulfilled",value:i}),n=i=>({status:"rejected",reason:i}),s=Promise.resolve(t);try{return s.then(e,n)}catch(i){return Promise.reject(i)}}))}ce.allSettled=_r;var cn={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.PoolEventType=void 0,function(t){t.initialized="initialized",t.taskCanceled="taskCanceled",t.taskCompleted="taskCompleted",t.taskFailed="taskFailed",t.taskQueued="taskQueued",t.taskQueueDrained="taskQueueDrained",t.taskStart="taskStart",t.terminated="terminated"}(r.PoolEventType||(r.PoolEventType={}))})(cn);var Xt={},K={};Object.defineProperty(K,"__esModule",{value:!0}),K.$worker=K.$transferable=K.$terminate=K.$events=K.$errors=void 0,K.$errors=Symbol("thread.errors"),K.$events=Symbol("thread.events"),K.$terminate=Symbol("thread.terminate"),K.$transferable=Symbol("thread.transferable"),K.$worker=Symbol("thread.worker"),Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.Thread=void 0;const Ie=K;function un(r){throw Error(r)}Xt.Thread={errors(r){return r[Ie.$errors]||un("Error observable not found. Make sure to pass a thread instance as returned by the spawn() promise.")},events(r){return r[Ie.$events]||un("Events observable not found. Make sure to pass a thread instance as returned by the spawn() promise.")},terminate(r){return r[Ie.$terminate]()}},function(r){var t=L&&L.__awaiter||function(E,b,y,w){function S(_){return _ instanceof y?_:new y(function(A){A(_)})}return new(y||(y=Promise))(function(_,A){function k(I){try{x(w.next(I))}catch(C){A(C)}}function g(I){try{x(w.throw(I))}catch(C){A(C)}}function x(I){I.done?_(I.value):S(I.value).then(k,g)}x((w=w.apply(E,b||[])).next())})},e=L&&L.__importDefault||function(E){return E&&E.__esModule?E:{default:E}};Object.defineProperty(r,"__esModule",{value:!0}),r.Pool=r.Thread=r.PoolEventType=void 0;const n=e(Ft),s=ae,i=ce,a=ht,u=cn;Object.defineProperty(r,"PoolEventType",{enumerable:!0,get:function(){return u.PoolEventType}});const h=Xt;Object.defineProperty(r,"Thread",{enumerable:!0,get:function(){return h.Thread}});let l=1;function o(E){const b=[];for(let y=0;y<E;y++)b.push(y);return b}function c(E){return new Promise(b=>setTimeout(b,E))}function d(E,b){return E.reduce((y,w)=>[...y,...b(w)],[])}function f(E){return E.replace(/\W/g," ").trim().replace(/\s+/g,"-")}function p(E,b){return o(b).map(()=>({init:E(),runningTasks:[]}))}class T{constructor(b,y){this.eventSubject=new s.Subject,this.initErrors=[],this.isClosing=!1,this.nextTaskID=1,this.taskQueue=[];const w=typeof y=="number"?{size:y}:y||{},{size:S=a.defaultPoolSize}=w;this.debug=n.default(`threads:pool:${f(w.name||String(l++))}`),this.options=w,this.workers=p(b,S),this.eventObservable=s.multicast(s.Observable.from(this.eventSubject)),Promise.all(this.workers.map(_=>_.init)).then(()=>this.eventSubject.next({type:u.PoolEventType.initialized,size:this.workers.length}),_=>{this.debug("Error while initializing pool worker:",_),this.eventSubject.error(_),this.initErrors.push(_)})}findIdlingWorker(){const{concurrency:b=1}=this.options;return this.workers.find(y=>y.runningTasks.length<b)}runPoolTask(b,y){return t(this,void 0,void 0,function*(){const w=this.workers.indexOf(b)+1;this.debug(`Running task #${y.id} on worker #${w}...`),this.eventSubject.next({type:u.PoolEventType.taskStart,taskID:y.id,workerID:w});try{const S=yield y.run(yield b.init);this.debug(`Task #${y.id} completed successfully`),this.eventSubject.next({type:u.PoolEventType.taskCompleted,returnValue:S,taskID:y.id,workerID:w})}catch(S){this.debug(`Task #${y.id} failed`),this.eventSubject.next({type:u.PoolEventType.taskFailed,taskID:y.id,error:S,workerID:w})}})}run(b,y){return t(this,void 0,void 0,function*(){const w=(()=>t(this,void 0,void 0,function*(){const S=()=>{b.runningTasks=b.runningTasks.filter(_=>_!==w)};yield c(0);try{yield this.runPoolTask(b,y)}finally{S(),this.isClosing||this.scheduleWork()}}))();b.runningTasks.push(w)})}scheduleWork(){this.debug("Attempt de-queueing a task in order to run it...");const b=this.findIdlingWorker();if(!b)return;const y=this.taskQueue.shift();if(!y){this.debug("Task queue is empty"),this.eventSubject.next({type:u.PoolEventType.taskQueueDrained});return}this.run(b,y)}taskCompletion(b){return new Promise((y,w)=>{const S=this.events().subscribe(_=>{_.type===u.PoolEventType.taskCompleted&&_.taskID===b?(S.unsubscribe(),y(_.returnValue)):_.type===u.PoolEventType.taskFailed&&_.taskID===b?(S.unsubscribe(),w(_.error)):_.type===u.PoolEventType.terminated&&(S.unsubscribe(),w(Error("Pool has been terminated before task was run.")))})})}settled(b=!1){return t(this,void 0,void 0,function*(){const y=()=>d(this.workers,_=>_.runningTasks),w=[],S=this.eventObservable.subscribe(_=>{_.type===u.PoolEventType.taskFailed&&w.push(_.error)});return this.initErrors.length>0?Promise.reject(this.initErrors[0]):b&&this.taskQueue.length===0?(yield i.allSettled(y()),w):(yield new Promise((_,A)=>{const k=this.eventObservable.subscribe({next(g){g.type===u.PoolEventType.taskQueueDrained&&(k.unsubscribe(),_(void 0))},error:A})}),yield i.allSettled(y()),S.unsubscribe(),w)})}completed(b=!1){return t(this,void 0,void 0,function*(){const y=this.settled(b),w=new Promise((_,A)=>{const k=this.eventObservable.subscribe({next(g){g.type===u.PoolEventType.taskQueueDrained?(k.unsubscribe(),_(y)):g.type===u.PoolEventType.taskFailed&&(k.unsubscribe(),A(g.error))},error:A})}),S=yield Promise.race([y,w]);if(S.length>0)throw S[0]})}events(){return this.eventObservable}queue(b){const{maxQueuedJobs:y=1/0}=this.options;if(this.isClosing)throw Error("Cannot schedule pool tasks after terminate() has been called.");if(this.initErrors.length>0)throw this.initErrors[0];const w=this.nextTaskID++,S=this.taskCompletion(w);S.catch(A=>{this.debug(`Task #${w} errored:`,A)});const _={id:w,run:b,cancel:()=>{this.taskQueue.indexOf(_)!==-1&&(this.taskQueue=this.taskQueue.filter(A=>A!==_),this.eventSubject.next({type:u.PoolEventType.taskCanceled,taskID:_.id}))},then:S.then.bind(S)};if(this.taskQueue.length>=y)throw Error(`Maximum number of pool tasks queued. Refusing to queue another one.
This usually happens for one of two reasons: We are either at peak workload right now or some tasks just won't finish, thus blocking the pool.`);return this.debug(`Queueing task #${_.id}...`),this.taskQueue.push(_),this.eventSubject.next({type:u.PoolEventType.taskQueued,taskID:_.id}),this.scheduleWork(),_}terminate(b){return t(this,void 0,void 0,function*(){this.isClosing=!0,b||(yield this.completed(!0)),this.eventSubject.next({type:u.PoolEventType.terminated,remainingQueue:[...this.taskQueue]}),this.eventSubject.complete(),yield Promise.all(this.workers.map(y=>t(this,void 0,void 0,function*(){return h.Thread.terminate(yield y.init)})))})}}T.EventType=u.PoolEventType;function M(E,b){return new T(E,b)}M.EventType=u.PoolEventType,r.Pool=M}(tn);var ue={},le={};Object.defineProperty(le,"__esModule",{value:!0}),le.createPromiseWithResolver=void 0;const yr=()=>{};function br(){let r=!1,t,e=yr;return[new Promise(i=>{r?i(t):e=i}),i=>{r=!0,t=i,e(t)}]}le.createPromiseWithResolver=br;var ln={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WorkerEventType=void 0,function(t){t.internalError="internalError",t.message="message",t.termination="termination"}(r.WorkerEventType||(r.WorkerEventType={}))})(ln);var Gt={},he={};Object.defineProperty(he,"__esModule",{value:!0}),he.ObservablePromise=void 0;const Er=ae,Sr=()=>{},xr=r=>r,hn=r=>Promise.resolve().then(r);function Mr(r){throw r}function wr(r){return r&&typeof r.then=="function"}class Ae extends Er.Observable{constructor(t){super(e=>{const n=this,s=Object.assign(Object.assign({},e),{complete(){e.complete(),n.onCompletion()},error(i){e.error(i),n.onError(i)},next(i){e.next(i),n.onNext(i)}});try{return this.initHasRun=!0,t(s)}catch(i){s.error(i)}}),this.initHasRun=!1,this.fulfillmentCallbacks=[],this.rejectionCallbacks=[],this.firstValueSet=!1,this.state="pending"}onNext(t){this.firstValueSet||(this.firstValue=t,this.firstValueSet=!0)}onError(t){this.state="rejected",this.rejection=t;for(const e of this.rejectionCallbacks)hn(()=>e(t))}onCompletion(){this.state="fulfilled";for(const t of this.fulfillmentCallbacks)hn(()=>t(this.firstValue))}then(t,e){const n=t||xr,s=e||Mr;let i=!1;return new Promise((a,u)=>{const h=o=>{if(!i){i=!0;try{a(s(o))}catch(c){u(c)}}},l=o=>{try{a(n(o))}catch(c){h(c)}};if(this.initHasRun||this.subscribe({error:h}),this.state==="fulfilled")return a(n(this.firstValue));if(this.state==="rejected")return i=!0,a(s(this.rejection));this.fulfillmentCallbacks.push(l),this.rejectionCallbacks.push(h)})}catch(t){return this.then(void 0,t)}finally(t){const e=t||Sr;return this.then(n=>(e(),n),()=>e())}static from(t){return wr(t)?new Ae(e=>{const n=i=>{e.next(i),e.complete()},s=i=>{e.error(i)};t.then(n,s)}):super.from(t)}}he.ObservablePromise=Ae;var dt={};Object.defineProperty(dt,"__esModule",{value:!0}),dt.Transfer=dt.isTransferDescriptor=void 0;const dn=K;function Tr(r){return!(!r||typeof r!="object")}function Ir(r){return r&&typeof r=="object"&&r[dn.$transferable]}dt.isTransferDescriptor=Ir;function Ar(r,t){if(!t){if(!Tr(r))throw Error();t=[r]}return{[dn.$transferable]:!0,send:r,transferables:t}}dt.Transfer=Ar;var Ne={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WorkerMessageType=r.MasterMessageType=void 0,function(t){t.cancel="cancel",t.run="run"}(r.MasterMessageType||(r.MasterMessageType={})),function(t){t.error="error",t.init="init",t.result="result",t.running="running",t.uncaughtError="uncaughtError"}(r.WorkerMessageType||(r.WorkerMessageType={}))})(Ne);var Nr=L&&L.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.createProxyModule=Gt.createProxyFunction=void 0;const Cr=Nr(Ft),fn=ae,Zt=tt,gn=he,kr=dt,qt=Ne,mn=Cr.default("threads:master:messages");let vr=1;const zr=r=>Array.from(new Set(r)),Or=r=>r&&r.type===qt.WorkerMessageType.error,Rr=r=>r&&r.type===qt.WorkerMessageType.result,Pr=r=>r&&r.type===qt.WorkerMessageType.running;function Lr(r,t){return new fn.Observable(e=>{let n;const s=i=>{if(mn("Message from worker:",i.data),!(!i.data||i.data.uid!==t)){if(Pr(i.data))n=i.data.resultType;else if(Rr(i.data))n==="promise"?(typeof i.data.payload<"u"&&e.next(Zt.deserialize(i.data.payload)),e.complete(),r.removeEventListener("message",s)):(i.data.payload&&e.next(Zt.deserialize(i.data.payload)),i.data.complete&&(e.complete(),r.removeEventListener("message",s)));else if(Or(i.data)){const a=Zt.deserialize(i.data.error);e.error(a),r.removeEventListener("message",s)}}};return r.addEventListener("message",s),()=>{if(n==="observable"||!n){const i={type:qt.MasterMessageType.cancel,uid:t};r.postMessage(i)}r.removeEventListener("message",s)}})}function Dr(r){if(r.length===0)return{args:[],transferables:[]};const t=[],e=[];for(const n of r)kr.isTransferDescriptor(n)?(t.push(Zt.serialize(n.send)),e.push(...n.transferables)):t.push(Zt.serialize(n));return{args:t,transferables:e.length===0?e:zr(e)}}function pn(r,t){return(...e)=>{const n=vr++,{args:s,transferables:i}=Dr(e),a={type:qt.MasterMessageType.run,uid:n,method:t,args:s};mn("Sending command to run function to worker:",a);try{r.postMessage(a,i)}catch(u){return gn.ObservablePromise.from(Promise.reject(u))}return gn.ObservablePromise.from(fn.multicast(Lr(r,n)))}}Gt.createProxyFunction=pn;function Fr(r,t){const e={};for(const n of t)e[n]=pn(r,n);return e}Gt.createProxyModule=Fr;var Ce=L&&L.__awaiter||function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})},Hr=L&&L.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ue,"__esModule",{value:!0}),ue.spawn=void 0;const ke=Hr(Ft),Gr=ae,Br=tt,Wr=le,de=K,fe=ln,_n=Gt,Vr=ke.default("threads:master:messages"),jr=ke.default("threads:master:spawn"),yn=ke.default("threads:master:thread-utils"),Ur=r=>r&&r.type==="init",$r=r=>r&&r.type==="uncaughtError",Yr=typeof process<"u"&&{}.THREADS_WORKER_INIT_TIMEOUT?Number.parseInt({}.THREADS_WORKER_INIT_TIMEOUT,10):1e4;function Kr(r,t,e){return Ce(this,void 0,void 0,function*(){let n;const s=new Promise((a,u)=>{n=setTimeout(()=>u(Error(e)),t)}),i=yield Promise.race([r,s]);return clearTimeout(n),i})}function Xr(r){return new Promise((t,e)=>{const n=s=>{Vr("Message from worker before finishing initialization:",s.data),Ur(s.data)?(r.removeEventListener("message",n),t(s.data)):$r(s.data)&&(r.removeEventListener("message",n),e(Br.deserialize(s.data.error)))};r.addEventListener("message",n)})}function Zr(r,t){return new Gr.Observable(e=>{const n=i=>{const a={type:fe.WorkerEventType.message,data:i.data};e.next(a)},s=i=>{yn("Unhandled promise rejection event in thread:",i);const a={type:fe.WorkerEventType.internalError,error:Error(i.reason)};e.next(a)};r.addEventListener("message",n),r.addEventListener("unhandledrejection",s),t.then(()=>{const i={type:fe.WorkerEventType.termination};r.removeEventListener("message",n),r.removeEventListener("unhandledrejection",s),e.next(i),e.complete()})})}function qr(r){const[t,e]=Wr.createPromiseWithResolver();return{terminate:()=>Ce(this,void 0,void 0,function*(){yn("Terminating worker"),yield r.terminate(),e()}),termination:t}}function bn(r,t,e,n){const s=e.filter(i=>i.type===fe.WorkerEventType.internalError).map(i=>i.error);return Object.assign(r,{[de.$errors]:s,[de.$events]:e,[de.$terminate]:n,[de.$worker]:t})}function Qr(r,t){return Ce(this,void 0,void 0,function*(){jr("Initializing new thread");const e=t&&t.timeout?t.timeout:Yr,s=(yield Kr(Xr(r),e,`Timeout: Did not receive an init message from worker after ${e}ms. Make sure the worker calls expose().`)).exposed,{termination:i,terminate:a}=qr(r),u=Zr(r,i);if(s.type==="function"){const h=_n.createProxyFunction(r);return bn(h,r,u,a)}else if(s.type==="module"){const h=_n.createProxyModule(r,s.methods);return bn(h,r,u,a)}else{const h=s.type;throw Error(`Worker init message states unexpected type of expose(): ${h}`)}})}ue.spawn=Qr,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.Worker=r.BlobWorker=r.isWorkerRuntime=r.Thread=r.spawn=r.Pool=void 0;const t=ht;Object.defineProperty(r,"isWorkerRuntime",{enumerable:!0,get:function(){return t.isWorkerRuntime}});var e=tn;Object.defineProperty(r,"Pool",{enumerable:!0,get:function(){return e.Pool}});var n=ue;Object.defineProperty(r,"spawn",{enumerable:!0,get:function(){return n.spawn}});var s=Xt;Object.defineProperty(r,"Thread",{enumerable:!0,get:function(){return s.Thread}}),r.BlobWorker=t.getWorkerImplementation().blob,r.Worker=t.getWorkerImplementation().default}(Xe);var ve={},Jr=r=>r?typeof Symbol.observable=="symbol"&&typeof r[Symbol.observable]=="function"?r===r[Symbol.observable]():typeof r["@@observable"]=="function"?r===r["@@observable"]():!1:!1,ze={};Object.defineProperty(ze,"__esModule",{value:!0});const ts=function(){const t=typeof self<"u"&&typeof Window<"u"&&self instanceof Window;return!!(typeof self<"u"&&self.postMessage&&!t)},es=function(t,e){self.postMessage(t,e)},ns=function(t){const e=s=>{t(s.data)},n=()=>{self.removeEventListener("message",e)};return self.addEventListener("message",e),n};ze.default={isWorkerRuntime:ts,postMessageToMaster:es,subscribeToMasterMessages:ns},function(r){var t=L&&L.__awaiter||function(g,x,I,C){function z(O){return O instanceof I?O:new I(function(R){R(O)})}return new(I||(I=Promise))(function(O,R){function B(j){try{J(C.next(j))}catch($){R($)}}function W(j){try{J(C.throw(j))}catch($){R($)}}function J(j){j.done?O(j.value):z(j.value).then(B,W)}J((C=C.apply(g,x||[])).next())})},e=L&&L.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(r,"__esModule",{value:!0}),r.expose=r.isWorkerRuntime=r.Transfer=r.registerSerializer=void 0;const n=e(Jr),s=tt,i=dt,a=Ne,u=e(ze);var h=tt;Object.defineProperty(r,"registerSerializer",{enumerable:!0,get:function(){return h.registerSerializer}});var l=dt;Object.defineProperty(r,"Transfer",{enumerable:!0,get:function(){return l.Transfer}}),r.isWorkerRuntime=u.default.isWorkerRuntime;let o=!1;const c=new Map,d=g=>g&&g.type===a.MasterMessageType.cancel,f=g=>g&&g.type===a.MasterMessageType.run,p=g=>n.default(g)||T(g);function T(g){return g&&typeof g=="object"&&typeof g.subscribe=="function"}function M(g){return i.isTransferDescriptor(g)?{payload:g.send,transferables:g.transferables}:{payload:g,transferables:void 0}}function E(){const g={type:a.WorkerMessageType.init,exposed:{type:"function"}};u.default.postMessageToMaster(g)}function b(g){const x={type:a.WorkerMessageType.init,exposed:{type:"module",methods:g}};u.default.postMessageToMaster(x)}function y(g,x){const{payload:I,transferables:C}=M(x),z={type:a.WorkerMessageType.error,uid:g,error:s.serialize(I)};u.default.postMessageToMaster(z,C)}function w(g,x,I){const{payload:C,transferables:z}=M(I),O={type:a.WorkerMessageType.result,uid:g,complete:x?!0:void 0,payload:C};u.default.postMessageToMaster(O,z)}function S(g,x){const I={type:a.WorkerMessageType.running,uid:g,resultType:x};u.default.postMessageToMaster(I)}function _(g){try{const x={type:a.WorkerMessageType.uncaughtError,error:s.serialize(g)};u.default.postMessageToMaster(x)}catch(x){console.error(`Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.
Latest error:`,x,`
Original error:`,g)}}function A(g,x,I){return t(this,void 0,void 0,function*(){let C;try{C=x(...I)}catch(O){return y(g,O)}const z=p(C)?"observable":"promise";if(S(g,z),p(C)){const O=C.subscribe(R=>w(g,!1,s.serialize(R)),R=>{y(g,s.serialize(R)),c.delete(g)},()=>{w(g,!0),c.delete(g)});c.set(g,O)}else try{const O=yield C;w(g,!0,s.serialize(O))}catch(O){y(g,s.serialize(O))}})}function k(g){if(!u.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(o)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(o=!0,typeof g=="function")u.default.subscribeToMasterMessages(x=>{f(x)&&!x.method&&A(x.uid,g,x.args.map(s.deserialize))}),E();else if(typeof g=="object"&&g){u.default.subscribeToMasterMessages(I=>{f(I)&&I.method&&A(I.uid,g[I.method],I.args.map(s.deserialize))});const x=Object.keys(g).filter(I=>typeof g[I]=="function");b(x)}else throw Error(`Invalid argument passed to expose(). Expected a function or an object, got: ${g}`);u.default.subscribeToMasterMessages(x=>{if(d(x)){const I=x.uid,C=c.get(I);C&&(C.unsubscribe(),c.delete(I))}})}r.expose=k,typeof self<"u"&&typeof self.addEventListener=="function"&&u.default.isWorkerRuntime()&&(self.addEventListener("error",g=>{setTimeout(()=>_(g.error||g),250)}),self.addEventListener("unhandledrejection",g=>{const x=g.reason;x&&typeof x.message=="string"&&setTimeout(()=>_(x),250)})),typeof process<"u"&&typeof process.on=="function"&&u.default.isWorkerRuntime()&&(process.on("uncaughtException",g=>{setTimeout(()=>_(g),250)}),process.on("unhandledRejection",g=>{g&&typeof g.message=="string"&&setTimeout(()=>_(g),250)}))}(ve);var Oe=it(ve);(function(r){var t=L&&L.__createBinding||(Object.create?function(u,h,l,o){o===void 0&&(o=l),Object.defineProperty(u,o,{enumerable:!0,get:function(){return h[l]}})}:function(u,h,l,o){o===void 0&&(o=l),u[o]=h[l]}),e=L&&L.__exportStar||function(u,h){for(var l in u)l!=="default"&&!Object.prototype.hasOwnProperty.call(h,l)&&t(h,u,l)};Object.defineProperty(r,"__esModule",{value:!0}),r.Transfer=r.DefaultSerializer=r.expose=r.registerSerializer=void 0;var n=tt;Object.defineProperty(r,"registerSerializer",{enumerable:!0,get:function(){return n.registerSerializer}}),e(Xe,r);var s=ve;Object.defineProperty(r,"expose",{enumerable:!0,get:function(){return s.expose}});var i=Nt;Object.defineProperty(r,"DefaultSerializer",{enumerable:!0,get:function(){return i.DefaultSerializer}});var a=dt;Object.defineProperty(r,"Transfer",{enumerable:!0,get:function(){return a.Transfer}})})($e);var _t=it($e);_t.registerSerializer,_t.spawn,_t.BlobWorker,_t.DefaultSerializer,_t.Pool,_t.Thread;const rs=_t.Transfer;_t.Worker;const ss=Oe.expose;Oe.registerSerializer,Oe.Transfer;/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const En="148",U=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Sn=1234567;const xn=Math.PI/180,Mn=180/Math.PI;function is(){const r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(U[r&255]+U[r>>8&255]+U[r>>16&255]+U[r>>24&255]+"-"+U[t&255]+U[t>>8&255]+"-"+U[t>>16&15|64]+U[t>>24&255]+"-"+U[e&63|128]+U[e>>8&255]+"-"+U[e>>16&255]+U[e>>24&255]+U[n&255]+U[n>>8&255]+U[n>>16&255]+U[n>>24&255]).toLowerCase()}function Re(r,t,e){return Math.max(t,Math.min(e,r))}function wn(r,t){return(r%t+t)%t}function os(r,t,e,n,s){return n+(r-t)*(s-n)/(e-t)}function as(r,t,e){return r!==t?(e-r)/(t-r):0}function Tn(r,t,e){return(1-e)*r+e*t}function cs(r,t,e,n){return Tn(r,t,1-Math.exp(-e*n))}function us(r,t=1){return t-Math.abs(wn(r,t*2)-t)}function ls(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*(3-2*r))}function hs(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*r*(r*(r*6-15)+10))}function ds(r,t){return r+Math.floor(Math.random()*(t-r+1))}function fs(r,t){return r+Math.random()*(t-r)}function gs(r){return r*(.5-Math.random())}function ms(r){r!==void 0&&(Sn=r);let t=Sn+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function ps(r){return r*xn}function _s(r){return r*Mn}function ys(r){return(r&r-1)===0&&r!==0}function bs(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Es(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function Ss(r,t,e,n,s){const i=Math.cos,a=Math.sin,u=i(e/2),h=a(e/2),l=i((t+n)/2),o=a((t+n)/2),c=i((t-n)/2),d=a((t-n)/2),f=i((n-t)/2),p=a((n-t)/2);switch(s){case"XYX":r.set(u*o,h*c,h*d,u*l);break;case"YZY":r.set(h*d,u*o,h*c,u*l);break;case"ZXZ":r.set(h*c,h*d,u*o,u*l);break;case"XZX":r.set(u*o,h*p,h*f,u*l);break;case"YXY":r.set(h*f,u*o,h*p,u*l);break;case"ZYZ":r.set(h*p,h*f,u*o,u*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function xs(r,t){switch(t.constructor){case Float32Array:return r;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function Ms(r,t){switch(t.constructor){case Float32Array:return r;case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}var Pe=Object.freeze({__proto__:null,DEG2RAD:xn,RAD2DEG:Mn,generateUUID:is,clamp:Re,euclideanModulo:wn,mapLinear:os,inverseLerp:as,lerp:Tn,damp:cs,pingpong:us,smoothstep:ls,smootherstep:hs,randInt:ds,randFloat:fs,randFloatSpread:gs,seededRandom:ms,degToRad:ps,radToDeg:_s,isPowerOfTwo:ys,ceilPowerOfTwo:bs,floorPowerOfTwo:Es,setQuaternionFromProperEuler:Ss,normalize:Ms,denormalize:xs});class ws{constructor(t=0,e=0,n=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=s}static slerpFlat(t,e,n,s,i,a,u){let h=n[s+0],l=n[s+1],o=n[s+2],c=n[s+3];const d=i[a+0],f=i[a+1],p=i[a+2],T=i[a+3];if(u===0){t[e+0]=h,t[e+1]=l,t[e+2]=o,t[e+3]=c;return}if(u===1){t[e+0]=d,t[e+1]=f,t[e+2]=p,t[e+3]=T;return}if(c!==T||h!==d||l!==f||o!==p){let M=1-u;const E=h*d+l*f+o*p+c*T,b=E>=0?1:-1,y=1-E*E;if(y>Number.EPSILON){const S=Math.sqrt(y),_=Math.atan2(S,E*b);M=Math.sin(M*_)/S,u=Math.sin(u*_)/S}const w=u*b;if(h=h*M+d*w,l=l*M+f*w,o=o*M+p*w,c=c*M+T*w,M===1-u){const S=1/Math.sqrt(h*h+l*l+o*o+c*c);h*=S,l*=S,o*=S,c*=S}}t[e]=h,t[e+1]=l,t[e+2]=o,t[e+3]=c}static multiplyQuaternionsFlat(t,e,n,s,i,a){const u=n[s],h=n[s+1],l=n[s+2],o=n[s+3],c=i[a],d=i[a+1],f=i[a+2],p=i[a+3];return t[e]=u*p+o*c+h*f-l*d,t[e+1]=h*p+o*d+l*c-u*f,t[e+2]=l*p+o*f+u*d-h*c,t[e+3]=o*p-u*c-h*d-l*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,s){return this._x=t,this._y=e,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const n=t._x,s=t._y,i=t._z,a=t._order,u=Math.cos,h=Math.sin,l=u(n/2),o=u(s/2),c=u(i/2),d=h(n/2),f=h(s/2),p=h(i/2);switch(a){case"XYZ":this._x=d*o*c+l*f*p,this._y=l*f*c-d*o*p,this._z=l*o*p+d*f*c,this._w=l*o*c-d*f*p;break;case"YXZ":this._x=d*o*c+l*f*p,this._y=l*f*c-d*o*p,this._z=l*o*p-d*f*c,this._w=l*o*c+d*f*p;break;case"ZXY":this._x=d*o*c-l*f*p,this._y=l*f*c+d*o*p,this._z=l*o*p+d*f*c,this._w=l*o*c-d*f*p;break;case"ZYX":this._x=d*o*c-l*f*p,this._y=l*f*c+d*o*p,this._z=l*o*p-d*f*c,this._w=l*o*c+d*f*p;break;case"YZX":this._x=d*o*c+l*f*p,this._y=l*f*c+d*o*p,this._z=l*o*p-d*f*c,this._w=l*o*c-d*f*p;break;case"XZY":this._x=d*o*c-l*f*p,this._y=l*f*c-d*o*p,this._z=l*o*p+d*f*c,this._w=l*o*c+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,s=Math.sin(n);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],s=e[4],i=e[8],a=e[1],u=e[5],h=e[9],l=e[2],o=e[6],c=e[10],d=n+u+c;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(o-h)*f,this._y=(i-l)*f,this._z=(a-s)*f}else if(n>u&&n>c){const f=2*Math.sqrt(1+n-u-c);this._w=(o-h)/f,this._x=.25*f,this._y=(s+a)/f,this._z=(i+l)/f}else if(u>c){const f=2*Math.sqrt(1+u-n-c);this._w=(i-l)/f,this._x=(s+a)/f,this._y=.25*f,this._z=(h+o)/f}else{const f=2*Math.sqrt(1+c-n-u);this._w=(a-s)/f,this._x=(i+l)/f,this._y=(h+o)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Re(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(n===0)return this;const s=Math.min(1,e/n);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,s=t._y,i=t._z,a=t._w,u=e._x,h=e._y,l=e._z,o=e._w;return this._x=n*o+a*u+s*l-i*h,this._y=s*o+a*h+i*u-n*l,this._z=i*o+a*l+n*h-s*u,this._w=a*o-n*u-s*h-i*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const n=this._x,s=this._y,i=this._z,a=this._w;let u=a*t._w+n*t._x+s*t._y+i*t._z;if(u<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,u=-u):this.copy(t),u>=1)return this._w=a,this._x=n,this._y=s,this._z=i,this;const h=1-u*u;if(h<=Number.EPSILON){const f=1-e;return this._w=f*a+e*this._w,this._x=f*n+e*this._x,this._y=f*s+e*this._y,this._z=f*i+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(h),o=Math.atan2(l,u),c=Math.sin((1-e)*o)/l,d=Math.sin(e*o)/l;return this._w=a*c+this._w*d,this._x=n*c+this._x*d,this._y=s*c+this._y*d,this._z=i*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),s=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(e*Math.cos(s),n*Math.sin(i),n*Math.cos(i),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class P{constructor(t=0,e=0,n=0){P.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(In.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(In.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,s=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*s,this.y=i[1]*e+i[4]*n+i[7]*s,this.z=i[2]*e+i[5]*n+i[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,s=this.z,i=t.elements,a=1/(i[3]*e+i[7]*n+i[11]*s+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*s+i[12])*a,this.y=(i[1]*e+i[5]*n+i[9]*s+i[13])*a,this.z=(i[2]*e+i[6]*n+i[10]*s+i[14])*a,this}applyQuaternion(t){const e=this.x,n=this.y,s=this.z,i=t.x,a=t.y,u=t.z,h=t.w,l=h*e+a*s-u*n,o=h*n+u*e-i*s,c=h*s+i*n-a*e,d=-i*e-a*n-u*s;return this.x=l*h+d*-i+o*-u-c*-a,this.y=o*h+d*-a+c*-i-l*-u,this.z=c*h+d*-u+l*-a-o*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,s=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*s,this.y=i[1]*e+i[5]*n+i[9]*s,this.z=i[2]*e+i[6]*n+i[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,s=t.y,i=t.z,a=e.x,u=e.y,h=e.z;return this.x=s*h-i*u,this.y=i*a-n*h,this.z=n*u-s*a,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Le.copy(this).projectOnVector(t),this.sub(Le)}reflect(t){return this.sub(Le.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Re(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,s=this.z-t.z;return e*e+n*n+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const s=Math.sin(e)*t;return this.x=s*Math.sin(n),this.y=Math.cos(e)*t,this.z=s*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Le=new P,In=new ws;class An{constructor(t=new P(1/0,1/0,1/0),e=new P(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,s=1/0,i=-1/0,a=-1/0,u=-1/0;for(let h=0,l=t.length;h<l;h+=3){const o=t[h],c=t[h+1],d=t[h+2];o<e&&(e=o),c<n&&(n=c),d<s&&(s=d),o>i&&(i=o),c>a&&(a=c),d>u&&(u=d)}return this.min.set(e,n,s),this.max.set(i,a,u),this}setFromBufferAttribute(t){let e=1/0,n=1/0,s=1/0,i=-1/0,a=-1/0,u=-1/0;for(let h=0,l=t.count;h<l;h++){const o=t.getX(h),c=t.getY(h),d=t.getZ(h);o<e&&(e=o),c<n&&(n=c),d<s&&(s=d),o>i&&(i=o),c>a&&(a=c),d>u&&(u=d)}return this.min.set(e,n,s),this.max.set(i,a,u),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=vt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(n!==void 0)if(e&&n.attributes!=null&&n.attributes.position!==void 0){const i=n.attributes.position;for(let a=0,u=i.count;a<u;a++)vt.fromBufferAttribute(i,a).applyMatrix4(t.matrixWorld),this.expandByPoint(vt)}else n.boundingBox===null&&n.computeBoundingBox(),De.copy(n.boundingBox),De.applyMatrix4(t.matrixWorld),this.union(De);const s=t.children;for(let i=0,a=s.length;i<a;i++)this.expandByObject(s[i],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,vt),vt.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Qt),ge.subVectors(this.max,Qt),Bt.subVectors(t.a,Qt),Wt.subVectors(t.b,Qt),Vt.subVectors(t.c,Qt),yt.subVectors(Wt,Bt),bt.subVectors(Vt,Wt),zt.subVectors(Bt,Vt);let e=[0,-yt.z,yt.y,0,-bt.z,bt.y,0,-zt.z,zt.y,yt.z,0,-yt.x,bt.z,0,-bt.x,zt.z,0,-zt.x,-yt.y,yt.x,0,-bt.y,bt.x,0,-zt.y,zt.x,0];return!Fe(e,Bt,Wt,Vt,ge)||(e=[1,0,0,0,1,0,0,0,1],!Fe(e,Bt,Wt,Vt,ge))?!1:(me.crossVectors(yt,bt),e=[me.x,me.y,me.z],Fe(e,Bt,Wt,Vt,ge))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return vt.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(vt).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(ft[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ft[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ft[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ft[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ft[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ft[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ft[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ft[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ft),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const ft=[new P,new P,new P,new P,new P,new P,new P,new P],vt=new P,De=new An,Bt=new P,Wt=new P,Vt=new P,yt=new P,bt=new P,zt=new P,Qt=new P,ge=new P,me=new P,Ot=new P;function Fe(r,t,e,n,s){for(let i=0,a=r.length-3;i<=a;i+=3){Ot.fromArray(r,i);const u=s.x*Math.abs(Ot.x)+s.y*Math.abs(Ot.y)+s.z*Math.abs(Ot.z),h=t.dot(Ot),l=e.dot(Ot),o=n.dot(Ot);if(Math.max(-Math.max(h,l,o),Math.min(h,l,o))>u)return!1}return!0}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:En}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=En);const D=class{static getList(t){return t?t.split(",").map(e=>e.trim()):[]}static getBoolean(t,e){return t?t==="true":e}static getNumber(t){return parseFloat(t)}static getOptionalNumber(t){if(t)return parseFloat(t)}};let v=D;m(v,"LOG_LEVELS",D.getList({}.VITE_LOG_LEVELS)),m(v,"LOG_KEYS",D.getList({}.VITE_LOG_KEYS)),m(v,"JUMP_START",D.getBoolean({}.VITE_JUMP_START,!0)),m(v,"FOG_ENABLED",D.getBoolean({}.VITE_FOG_ENABLED,!0)),m(v,"EDITING_ENABLED",D.getBoolean({}.VITE_EDITING_ENABLED,!0)),m(v,"SHOW_INITIAL_TERRAIN_GENERATION",D.getBoolean({}.VITE_SHOW_INITIAL_TERRAIN_GENERATION,!1)),m(v,"SHOW_DEBUG_INFO",D.getBoolean({}.VITE_SHOW_DEBUG_UI,!1)),m(v,"SHOW_WINDOW_CLOSE_ALERT",D.getBoolean({}.VITE_SHOW_WINDOW_CLOSE_ALERT,!0)),m(v,"PLAYER_DEFAULT_PHYSICS_MODE",{}.VITE_PLAYER_DEFAULT_PHYSICS_MODE),m(v,"PLAYER_SHOW_BOUNDING_BOX",D.getBoolean({}.VITE_PLAYER_SHOW_BOUNDING_BOX,!1)),m(v,"CHUNK_WIDTH",D.getNumber({}.VITE_TERRAIN_CHUNK_WIDTH||20)),m(v,"CHUNK_HEIGHT",D.getNumber({}.VITE_TERRAIN_CHUNK_HEIGHT||6)),m(v,"CUSTOM_SEED",{}.VITE_CUSTOM_SEED||"map2"),m(v,"TERRAIN_GENERATION_ENABLED",D.getBoolean({}.VITE_TERRAIN_GENERATION_ENABLED,!0)),m(v,"TERRAIN_OPTIMIZATION_ENABLED",D.getBoolean({}.VITE_TERRAIN_OPTIMIZATION_ENABLED,!0)),m(v,"TREE_GENERATION_ENABLED",D.getBoolean({}.VITE_TREE_GENERATION_ENABLED,!0)),m(v,"DEFAULT_HORIZONTAL_RENDER_DISTANCE_IN_CHUNKS",D.getNumber({}.VITE_DEFAULT_HORIZONTAL_RENDER_DISTANCE_IN_CHUNKS)),m(v,"TOP_RENDER_DISTANCE_IN_CHUNKS",D.getNumber({}.VITE_TOP_RENDER_DISTANCE_IN_CHUNKS||8)),m(v,"BOTTOM_RENDER_DISTANCE_IN_CHUNKS",D.getNumber({}.VITE_BOTTOM_RENDER_DISTANCE_IN_CHUNKS||4)),m(v,"TESTING_MAP_ENABLED",D.getBoolean({}.VITE_TESTING_MAP_ENABLED,!1)),m(v,"TESTING_MAP_EROSION",D.getOptionalNumber({}.VITE_TESTING_MAP_EROSION)),m(v,"TESTING_MAP_CONTINENTALNESS",D.getOptionalNumber({}.VITE_TESTING_MAP_CONTINENTALNESS)),m(v,"TESTING_MAP_PV",D.getOptionalNumber({}.VITE_TESTING_MAP_PV)),m(v,"STARTING_INVENTORY_ITEMS",D.getList({}.VITE_STARTING_INVENTORY_ITEMS).map(t=>Number(t))),m(v,"STARTING_HOTBAR_ITEMS",D.getList({}.VITE_STARTING_HOTBAR_ITEMS).map(t=>Number(t)));const je=class{static debug(t,...e){}static info(t,...e){}static warn(t){}static error(t){}static shouldLog(t,...e){const n=je.LOG_LEVELS.includes(t);return e.some(i=>this.LOG_KEYS.includes(i))&&n}};let V=je;m(V,"LOG_LEVELS",v.LOG_LEVELS??["silent"]),m(V,"LOG_KEYS",v.LOG_KEYS),m(V,"GAME_LOOP_KEY","gameloop"),m(V,"SCENE_KEY","scene"),m(V,"AUDIO_KEY","audio"),m(V,"DATA_KEY","data"),m(V,"INPUT_KEY","input"),m(V,"MAP_KEY","map"),m(V,"COLLISION_KEY","collision"),m(V,"PLAYER_KEY","player"),m(V,"TERRAIN_KEY","terrain"),m(V,"CHUNK_KEY","chunk"),m(V,"INIT_KEY","init"),m(V,"LOADING_KEY","load"),m(V,"DISPOSE_KEY","dispose");const Rt={left:[-1,0,0],right:[1,0,0],top:[0,1,0],bottom:[0,-1,0],front:[0,0,1],back:[0,0,-1]},Nn={left:{normal:Rt.left,vertices:[{pos:[0,1,0],uv:[0,1],ao:{corner:[-.5,-.5,.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}},{pos:[0,0,0],uv:[0,0],ao:{corner:[-.5,-.5,.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}},{pos:[0,1,1],uv:[1,1],ao:{corner:[-.5,.5,-.5],side1:[-.5,.5,.5],side2:[-.5,-.5,.5]}},{pos:[0,0,1],uv:[1,0],ao:{corner:[-.5,-.5,-.5],side1:[-.5,.5,.5],side2:[-.5,-.5,.5]}}]},right:{normal:Rt.right,vertices:[{pos:[1,1,1],uv:[0,1],ao:{corner:[.5,.5,-.5],side1:[.5,.5,.5],side2:[.5,-.5,.5]}},{pos:[1,0,1],uv:[0,0],ao:{corner:[.5,-.5,-.5],side1:[.5,.5,.5],side2:[.5,-.5,.5]}},{pos:[1,1,0],uv:[1,1],ao:{corner:[.5,.5,.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}},{pos:[1,0,0],uv:[1,0],ao:{corner:[.5,-.5,.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}}]},top:{normal:Rt.top,vertices:[{pos:[0,1,1],uv:[1,1],ao:{corner:[-.5,.5,.5],side1:[.5,.5,.5],side2:[-.5,.5,-.5]}},{pos:[1,1,1],uv:[0,1],ao:{corner:[.5,.5,.5],side1:[-.5,.5,.5],side2:[.5,.5,-.5]}},{pos:[0,1,0],uv:[1,0],ao:{corner:[-.5,.5,-.5],side1:[.5,.5,-.5],side2:[-.5,.5,.5]}},{pos:[1,1,0],uv:[0,0],ao:{corner:[.5,.5,-.5],side1:[-.5,.5,-.5],side2:[.5,.5,.5]}}]},bottom:{normal:Rt.bottom,vertices:[{pos:[1,0,1],uv:[1,0],ao:{corner:[.5,-.5,.5],side1:[-.5,-.5,.5],side2:[.5,-.5,-.5]}},{pos:[0,0,1],uv:[0,0],ao:{corner:[-.5,-.5,.5],side1:[.5,-.5,.5],side2:[-.5,-.5,.5]}},{pos:[1,0,0],uv:[1,1],ao:{corner:[.5,-.5,-.5],side1:[.5,-.5,.5],side2:[-.5,-.5,-.5]}},{pos:[0,0,0],uv:[0,1],ao:{corner:[-.5,-.5,-.5],side1:[.5,-.5,-.5],side2:[-.5,-.5,.5]}}]},front:{normal:Rt.front,vertices:[{pos:[0,0,1],uv:[0,0],ao:{corner:[.5,-.5,.5],side1:[-.5,.5,.5],side2:[-.5,-.5,.5]}},{pos:[1,0,1],uv:[1,0],ao:{corner:[-.5,-.5,.5],side1:[.5,.5,.5],side2:[.5,-.5,.5]}},{pos:[0,1,1],uv:[0,1],ao:{corner:[.5,.5,.5],side1:[-.5,-.5,.5],side2:[-.5,.5,.5]}},{pos:[1,1,1],uv:[1,1],ao:{corner:[-.5,.5,.5],side1:[.5,-.5,.5],side2:[.5,.5,.5]}}]},back:{normal:Rt.back,vertices:[{pos:[1,0,0],uv:[0,0],ao:{corner:[-.5,-.5,-.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}},{pos:[0,0,0],uv:[1,0],ao:{corner:[.5,-.5,-.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}},{pos:[1,1,0],uv:[0,1],ao:{corner:[-.5,.5,-.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}},{pos:[0,1,0],uv:[1,1],ao:{corner:[.5,.5,-.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}}]}},Cn=16,Ts=128,Is=128;var G=(r=>(r[r.AIR=0]="AIR",r[r.CLOUD=1]="CLOUD",r[r.STONE=2]="STONE",r[r.COBBLESTONE=3]="COBBLESTONE",r[r.DIRT=4]="DIRT",r[r.GRASS=5]="GRASS",r[r.GRASS_SNOW=6]="GRASS_SNOW",r[r.WATER=7]="WATER",r[r.SAND=8]="SAND",r[r.GLASS=9]="GLASS",r[r.OAK_LOG=10]="OAK_LOG",r[r.OAK_LEAVES=11]="OAK_LEAVES",r[r.PLANKS=12]="PLANKS",r[r.COAL_ORE=13]="COAL_ORE",r))(G||{});const pe={[0]:{name:"_air",isTransparent:!0,isSolid:!1,icon:{row:-1,col:-1},texture:{top:{row:-1,col:-1},bottom:{row:-1,col:-1},side:{row:-1,col:-1}}},[1]:{name:"cloud",isTransparent:!0,isSolid:!1,icon:{row:-1,col:-1},texture:{top:{row:2,col:5},bottom:{row:2,col:5},side:{row:2,col:5}},color:[1,1,1,.4]},[2]:{name:"Stone",isTransparent:!1,isSolid:!0,drop:3,icon:{row:18,col:12},texture:{top:{row:0,col:5},bottom:{row:0,col:5},side:{row:0,col:5}},sounds:{place:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"],broken:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"],hit:["Stone_hit1.ogg","Stone_hit2.ogg","Stone_hit3.ogg","Stone_hit4.ogg","Stone_hit5.ogg","Stone_hit6.ogg"]}},[3]:{name:"Cobblestone",isTransparent:!1,isSolid:!0,drop:3,icon:{row:8,col:31},texture:{top:{row:0,col:4},bottom:{row:0,col:4},side:{row:0,col:4}},sounds:{place:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"],broken:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"],hit:["Stone_hit1.ogg","Stone_hit2.ogg","Stone_hit3.ogg","Stone_hit4.ogg","Stone_hit5.ogg","Stone_hit6.ogg"]}},[5]:{name:"Grass",isTransparent:!1,isSolid:!0,drop:4,icon:{row:16,col:27},texture:{top:{row:0,col:1},bottom:{row:0,col:2},side:{row:0,col:0}},sounds:{place:["Grass_dig1.ogg","Grass_dig2.ogg","Grass_dig3.ogg","Grass_dig4.ogg"],broken:["Grass_dig1.ogg","Grass_dig2.ogg","Grass_dig3.ogg","Grass_dig4.ogg"],hit:["Grass_hit1.ogg","Grass_hit2.ogg","Grass_hit3.ogg","Grass_hit4.ogg","Grass_hit5.ogg","Grass_hit6.ogg"]}},[6]:{name:"Snow",isTransparent:!1,isSolid:!0,drop:4,icon:{row:13,col:18},texture:{top:{row:2,col:5},bottom:{row:0,col:2},side:{row:2,col:4}}},[4]:{name:"Dirt",isTransparent:!1,isSolid:!0,drop:4,icon:{row:13,col:18},texture:{top:{row:0,col:2},bottom:{row:0,col:2},side:{row:0,col:2}},sounds:{place:["Gravel_dig1.ogg","Gravel_dig2.ogg","Gravel_dig3.ogg","Gravel_dig4.ogg"],broken:["Gravel_dig1.ogg","Gravel_dig2.ogg","Gravel_dig3.ogg","Gravel_dig4.ogg"],hit:["Gravel_hit1.ogg","Gravel_hit2.ogg","Gravel_hit3.ogg","Gravel_hit4.ogg"]}},[10]:{name:"Oak_Log",isTransparent:!1,isSolid:!0,drop:10,icon:{row:25,col:9},texture:{top:{row:1,col:2},bottom:{row:1,col:2},side:{row:1,col:3}},sounds:{place:["Wood_dig1.ogg","Wood_dig2.ogg","Wood_dig3.ogg","Wood_dig4.ogg"],broken:["Wood_dig1.ogg","Wood_dig2.ogg","Wood_dig3.ogg","Wood_dig4.ogg"],hit:["Wood_hit1.ogg","Wood_hit2.ogg","Wood_hit3.ogg","Wood_hit4.ogg","Wood_hit5.ogg","Wood_hit6.ogg"]}},[11]:{name:"Oak_Leaves",isTransparent:!0,isSolid:!0,icon:{row:25,col:8},texture:{top:{row:1,col:5},bottom:{row:1,col:5},side:{row:1,col:5}},sounds:{place:["Grass_dig1.ogg","Grass_dig2.ogg","Grass_dig3.ogg","Grass_dig4.ogg"],broken:["Grass_dig1.ogg","Grass_dig2.ogg","Grass_dig3.ogg","Grass_dig4.ogg"],hit:["Grass_hit1.ogg","Grass_hit2.ogg","Grass_hit3.ogg","Grass_hit4.ogg","Grass_hit5.ogg","Grass_hit6.ogg"]}},[12]:{name:"Planks",isTransparent:!1,isSolid:!0,drop:12,icon:{row:25,col:10},texture:{top:{row:1,col:4},bottom:{row:1,col:4},side:{row:1,col:4}},sounds:{place:["Wood_dig1.ogg","Wood_dig2.ogg","Wood_dig3.ogg","Wood_dig4.ogg"],broken:["Wood_dig1.ogg","Wood_dig2.ogg","Wood_dig3.ogg","Wood_dig4.ogg"],hit:["Wood_hit1.ogg","Wood_hit2.ogg","Wood_hit3.ogg","Wood_hit4.ogg","Wood_hit5.ogg","Wood_hit6.ogg"]}},[8]:{name:"Sand",isTransparent:!1,isSolid:!0,drop:8,icon:{row:32,col:6},texture:{top:{row:1,col:6},bottom:{row:1,col:6},side:{row:1,col:6}},sounds:{place:["Sand_dig1.ogg","Sand_dig2.ogg","Sand_dig3.ogg","Sand_dig4.ogg"],broken:["Sand_dig1.ogg","Sand_dig2.ogg","Sand_dig3.ogg","Sand_dig4.ogg"],hit:["Sand_hit1.ogg","Sand_hit2.ogg","Sand_hit3.ogg","Sand_hit4.ogg","Sand_hit5.ogg"]}},[7]:{name:"Water",isTransparent:!0,isSolid:!1,icon:{row:37,col:28},texture:{side:{row:1,col:7},top:{row:1,col:7},bottom:{row:1,col:7}}},[9]:{name:"Glass",isTransparent:!0,isSolid:!0,icon:{row:15,col:26},texture:{side:{row:2,col:0},top:{row:2,col:0},bottom:{row:2,col:0}},sounds:{place:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"],broken:["Glass_dig1.ogg","Glass_dig2.ogg","Glass_dig3.ogg"],hit:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"]}},[13]:{name:"Coal_Ore",isTransparent:!1,isSolid:!0,drop:13,icon:{row:8,col:25},texture:{side:{row:0,col:6},top:{row:0,col:6},bottom:{row:0,col:6}},sounds:{place:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"],broken:["Stone_dig1.ogg","Stone_dig2.ogg","Stone_dig3.ogg","Stone_dig4.ogg"],hit:["Stone_hit1.ogg","Stone_hit2.ogg","Stone_hit3.ogg","Stone_hit4.ogg","Stone_hit5.ogg","Stone_hit6.ogg"]}}},As={top:"top",bottom:"bottom",left:"side",right:"side",front:"side",back:"side"},Ns=[[0,0,0],[0,1,0],[0,-1,0],[-1,0,0],[-1,1,0],[-1,-1,0],[1,0,0],[1,1,0],[1,-1,0],[0,0,1],[0,1,1],[0,-1,1],[-1,0,1],[-1,1,1],[-1,-1,1],[1,0,1],[1,1,1],[1,-1,1],[0,0,-1],[0,1,-1],[0,-1,-1],[-1,0,-1],[-1,1,-1],[-1,-1,-1],[1,0,-1],[1,1,-1],[1,-1,-1]],mt=class{static isVisibleBlock(t){return t!=null&&t!==G.AIR}static getBlockFaces(){return Object.keys(Nn)}static getBlockFaceGeometry(t){return Nn[t]}static getNeighbourBlockOffsets(){return Ns}static getBlockMetadata(t){return pe[t]}static getBlockColor(t){return pe[t].color}static getBlockUVCoordinates(t,e,[n,s]){const i=As[e],{row:a,col:u}=pe[t].texture[i];return{u:(u+n)*Cn/Ts,v:1-(a+1-s)*Cn/Is}}static getBlockFaceFromNormal(t){for(const[e,n]of Object.entries(Rt))if(new P().fromArray(n).equals(t))return e;return null}static getBlockBoundingBoxFromPosition(t){return mt.getBlockBoundingBox(mt.getBlockOriginFromPosition(t))}static getBlockBoundingBox(t){return new An(t,t.clone().addScalar(mt.SIZE))}static getBlockOriginFromPosition(t){return new P(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}static toBlockCenterCoord(t){return Math.floor(t/mt.SIZE)*mt.SIZE+mt.SIZE/2}static getBlockNormalFromPosition(t,e){const n=new P(t.x+.5,t.y+.5,t.z+.5),s=Math.abs(e.x-n.x),i=Math.abs(e.y-n.y),a=Math.abs(e.z-n.z),u=new P;return s>i&&s>a?u.set(e.x>n.x?1:-1,0,0):i>a?u.set(0,e.y>n.y?1:-1,0):u.set(0,0,e.z>n.z?1:-1),u}static raycast(t,e,n){let s=e.x-t.x,i=e.y-t.y,a=e.z-t.z;const u=s*s+i*i+a*a,h=Math.sqrt(u);s/=h,i/=h,a/=h;let l=0,o=Math.floor(t.x),c=Math.floor(t.y),d=Math.floor(t.z);const f=s>0?1:-1,p=i>0?1:-1,T=a>0?1:-1,M=Math.abs(1/s),E=Math.abs(1/i),b=Math.abs(1/a),y=f>0?o+1-t.x:t.x-o,w=p>0?c+1-t.y:t.y-c,S=T>0?d+1-t.z:t.z-d;let _=M<1/0?M*y:1/0,A=E<1/0?E*w:1/0,k=b<1/0?b*S:1/0,g=-1;for(;l<=h;){const x=n.getBlock({x:o,y:c,z:d});if(mt.isVisibleBlock(x==null?void 0:x.type))return{position:[t.x+l*s,t.y+l*i,t.z+l*a],normal:[g===0?-f:0,g===1?-p:0,g===2?-T:0],block:x};const C=Math.min(_,A,k);C===_?(o+=f,l=_,_+=M,g=0):C===A?(c+=p,l=A,A+=E,g=1):(d+=T,l=k,k+=b,g=2)}return null}};let Et=mt;m(Et,"SIZE",1);const F=class{constructor(t,e){m(this,"chunkId");m(this,"worldOriginPosition");m(this,"blocks");m(this,"isDirt");this.chunkId=t,this.worldOriginPosition=F.getChunkOriginPosition(t),this.isDirt=!1,this.blocks=e??new Uint8Array(F.HEIGHT*F.WIDTH*F.WIDTH)}getBlock(t){if(!this.isBlockInChunk(t))return null;const e=this.computeBlockIndex(t),n=this.blocks[e];return{type:n,...pe[n]}}setBlock(t,e){if(!this.isBlockInChunk(t))return;const n=this.computeBlockIndex(t);this.blocks[n]=e}isBlockInChunk(t){return F.getChunkIdFromPosition(t)===this.chunkId}decorateChunk(t){const{x:e,y:n,z:s}=this.getWorldOriginPosition(),i=e+F.WIDTH,a=n+F.HEIGHT,u=s+F.WIDTH,h=new Map;for(let l=n;l<a;l++)for(let o=s;o<u;o++)for(let c=e;c<i;c++){const d={x:c,y:l,z:o},f=t.generateBlock(c,l,o);f&&(this.setBlock(d,f),f==G.OAK_LOG&&(h.has(`${d.x}-${d.z}`)?h.get(`${d.x}-${d.z}`).y>d.y&&h.set(`${d.x}-${d.z}`,d):h.set(`${d.x}-${d.z}`,d)))}h.forEach((l,o)=>{for(let c=18;c<=l.y;c++)this.setBlock({x:l.x,y:c,z:l.z},G.OAK_LOG)})}computeBlockIndex({x:t,y:e,z:n}){const[s,i,a]=this.getBlockLocalCoordinates(t,e,n);return i*F.WIDTH*F.WIDTH+a*F.WIDTH+s}getBlockLocalCoordinates(t,e,n){const s=Pe.euclideanModulo(t,F.WIDTH)|0,i=Pe.euclideanModulo(e,F.HEIGHT)|0,a=Pe.euclideanModulo(n,F.WIDTH)|0;return[s,i,a]}static buildChunkId({x:t,y:e,z:n}){return`${t},${e},${n}`}static chunkIdAsCoordinate(t){const e=t.match(/^([^,]+),([^,]+),(.+)$/);if(!e)throw new Error("Invalid chunkId");const[n,s,i,a]=e;return{x:Number(s),y:Number(i),z:Number(a)}}static getChunkIdFromPosition({x:t,y:e,z:n}){const s=Math.floor(t/F.WIDTH),i=Math.floor(e/F.HEIGHT),a=Math.floor(n/F.WIDTH);return F.buildChunkId({x:s,y:i,z:a})}static getChunkOriginPosition(t){const{x:e,y:n,z:s}=F.chunkIdAsCoordinate(t),i=e*F.WIDTH,a=n*F.HEIGHT,u=s*F.WIDTH;return{x:i,y:a,z:u}}markAsDirt(){this.isDirt=!0}isDirty(){return this.isDirt}getId(){return this.chunkId}getWorldOriginPosition(){return this.worldOriginPosition}getBlocks(){return this.blocks}_debug(){V.debug(JSON.stringify(this.blocks),V.TERRAIN_KEY)}};let ot=F;m(ot,"WIDTH",v.CHUNK_WIDTH),m(ot,"HEIGHT",v.CHUNK_HEIGHT);const Ue=class{};let gt=Ue;m(gt,"RADIUS",2),m(gt,"TRUNK_HEIGHT",2),m(gt,"MAX_HEIGHT",Ue.TRUNK_HEIGHT+2);class nt{constructor(t){m(this,"seed");this.seed=t}getSeed(){return this.seed}}m(nt,"getContinentalMapSeed",t=>t+"_continental"),m(nt,"getErosionMapSeed",t=>t+"_erosion"),m(nt,"getPvMapSeed",t=>t+"_pv"),m(nt,"getHeightMapSeed",t=>t+"_height"),m(nt,"getDensityMapSeed",t=>t+"_density"),m(nt,"getTreeMapSeed",t=>t+"_tree");const st=class{static generateSeed(){return Math.random().toString(36).substring(2,15)}};let N=st;m(N,"ORIGIN",new P(0,0,0)),m(N,"CONTINENTALNESS_NOISE_SCALE",2500),m(N,"EROSION_NOISE_SCALE",1024),m(N,"PV_BASE_SCALE",180),m(N,"DENSITY_NOISE_SCALE",12),m(N,"MAX_WORLD_HEIGHT",v.TOP_RENDER_DISTANCE_IN_CHUNKS*v.CHUNK_HEIGHT),m(N,"MIN_WORLD_HEIGHT",v.BOTTOM_RENDER_DISTANCE_IN_CHUNKS*-v.CHUNK_HEIGHT),m(N,"MIN_EROSION",0),m(N,"MAX_EROSION",8),m(N,"MIN_CONTINENTALNESS_HEIGHT",0),m(N,"MAX_CONTINENTALNESS_HEIGHT",25),m(N,"MIN_DENSITY_HEIGHT",st.MIN_CONTINENTALNESS_HEIGHT-40),m(N,"MAX_DENSITY_HEIGHT",st.MAX_WORLD_HEIGHT),m(N,"LARGE_CAVES_HEIGHT",0),m(N,"MAX_SURFACE_HEIGHT",st.MAX_CONTINENTALNESS_HEIGHT+st.MAX_EROSION),m(N,"MIN_SURFACE_HEIGHT",st.MIN_CONTINENTALNESS_HEIGHT-st.MAX_EROSION),m(N,"CLOUD_LEVEL",st.MAX_SURFACE_HEIGHT-25),m(N,"SNOW_LEVEL",st.MAX_CONTINENTALNESS_HEIGHT),m(N,"SEA_LEVEL",st.MIN_CONTINENTALNESS_HEIGHT+15),m(N,"SAND_LEVEL",st.SEA_LEVEL+6),m(N,"BEDROCK_LEVEL",0),m(N,"CLOUD_WIDTH",10),m(N,"CLOUD_DEPTH",5);const Cs=.5*(Math.sqrt(3)-1),Jt=(3-Math.sqrt(3))/6,ks=1/3,at=1/6,te=r=>Math.floor(r)|0,kn=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),He=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function vs(r=Math.random){const t=vn(r),e=new Float64Array(t).map(s=>kn[s%12*2]),n=new Float64Array(t).map(s=>kn[s%12*2+1]);return function(i,a){let u=0,h=0,l=0;const o=(i+a)*Cs,c=te(i+o),d=te(a+o),f=(c+d)*Jt,p=c-f,T=d-f,M=i-p,E=a-T;let b,y;M>E?(b=1,y=0):(b=0,y=1);const w=M-b+Jt,S=E-y+Jt,_=M-1+2*Jt,A=E-1+2*Jt,k=c&255,g=d&255;let x=.5-M*M-E*E;if(x>=0){const z=k+t[g],O=e[z],R=n[z];x*=x,u=x*x*(O*M+R*E)}let I=.5-w*w-S*S;if(I>=0){const z=k+b+t[g+y],O=e[z],R=n[z];I*=I,h=I*I*(O*w+R*S)}let C=.5-_*_-A*A;if(C>=0){const z=k+1+t[g+1],O=e[z],R=n[z];C*=C,l=C*C*(O*_+R*A)}return 70*(u+h+l)}}function zs(r=Math.random){const t=vn(r),e=new Float64Array(t).map(i=>He[i%12*3]),n=new Float64Array(t).map(i=>He[i%12*3+1]),s=new Float64Array(t).map(i=>He[i%12*3+2]);return function(a,u,h){let l,o,c,d;const f=(a+u+h)*ks,p=te(a+f),T=te(u+f),M=te(h+f),E=(p+T+M)*at,b=p-E,y=T-E,w=M-E,S=a-b,_=u-y,A=h-w;let k,g,x,I,C,z;S>=_?_>=A?(k=1,g=0,x=0,I=1,C=1,z=0):S>=A?(k=1,g=0,x=0,I=1,C=0,z=1):(k=0,g=0,x=1,I=1,C=0,z=1):_<A?(k=0,g=0,x=1,I=0,C=1,z=1):S<A?(k=0,g=1,x=0,I=0,C=1,z=1):(k=0,g=1,x=0,I=1,C=1,z=0);const O=S-k+at,R=_-g+at,B=A-x+at,W=S-I+2*at,J=_-C+2*at,j=A-z+2*at,$=S-1+3*at,wt=_-1+3*at,Tt=A-1+3*at,X=p&255,Y=T&255,ct=M&255;let ut=.6-S*S-_*_-A*A;if(ut<0)l=0;else{const H=X+t[Y+t[ct]];ut*=ut,l=ut*ut*(e[H]*S+n[H]*_+s[H]*A)}let pt=.6-O*O-R*R-B*B;if(pt<0)o=0;else{const H=X+k+t[Y+g+t[ct+x]];pt*=pt,o=pt*pt*(e[H]*O+n[H]*R+s[H]*B)}let lt=.6-W*W-J*J-j*j;if(lt<0)c=0;else{const H=X+I+t[Y+C+t[ct+z]];lt*=lt,c=lt*lt*(e[H]*W+n[H]*J+s[H]*j)}let Z=.6-$*$-wt*wt-Tt*Tt;if(Z<0)d=0;else{const H=X+1+t[Y+1+t[ct+1]];Z*=Z,d=Z*Z*(e[H]*$+n[H]*wt+s[H]*Tt)}return 32*(l+o+c+d)}}function vn(r){const e=new Uint8Array(512);for(let n=0;n<512/2;n++)e[n]=n;for(let n=0;n<512/2-1;n++){const s=n+~~(r()*(256-n)),i=e[n];e[n]=e[s],e[s]=i}for(let n=256;n<512;n++)e[n]=e[n-256];return e}var Ge={},Os={get exports(){return Ge},set exports(r){Ge=r}};(function(r,t){(function(e,n){r.exports=n()})(L,function(){return e.importState=function(s){var i=new e;return i.importState(s),i},e;function e(){return function(s){var i=0,a=0,u=0,h=1;s.length==0&&(s=[+new Date]);var l=n();i=l(" "),a=l(" "),u=l(" ");for(var o=0;o<s.length;o++)i-=l(s[o]),i<0&&(i+=1),a-=l(s[o]),a<0&&(a+=1),u-=l(s[o]),u<0&&(u+=1);l=null;var c=function(){var d=2091639*i+h*23283064365386963e-26;return i=a,a=u,u=d-(h=d|0)};return c.next=c,c.uint32=function(){return c()*4294967296},c.fract53=function(){return c()+(c()*2097152|0)*11102230246251565e-32},c.version="Alea 0.9",c.args=s,c.exportState=function(){return[i,a,u,h]},c.importState=function(d){i=+d[0]||0,a=+d[1]||0,u=+d[2]||0,h=+d[3]||0},c}(Array.prototype.slice.call(arguments))}function n(){var s=4022871197,i=function(a){a=a.toString();for(var u=0;u<a.length;u++){s+=a.charCodeAt(u);var h=.02519603282416938*s;s=h>>>0,h-=s,h*=s,s=h>>>0,h-=s,s+=h*4294967296}return(s>>>0)*23283064365386963e-26};return i.version="Mash 0.9",i}})})(Os);class Be{constructor(t){m(this,"seed");m(this,"prng");this.seed=t,this.prng=Ge(t)}getSeed(){return this.seed}}class jt extends Be{constructor(e){super(e);m(this,"data");this.data=new Map}getMapData(){return this.data}setMapData(e){this.data=e}getPointData(e,n){const s=jt.computeKey(e,n);return this.data.get(s)}setPointData(e,n,s){const i=jt.computeKey(e,n);return this.data.set(i,s),s}static computeKey(e,n){return`${Math.floor(e)}_${Math.floor(n)}`}}class We extends jt{constructor(e){super(e);m(this,"noise2D");this.noise2D=vs(this.prng)}}class q{}m(q,"ENABLED",v.TESTING_MAP_ENABLED),m(q,"CONTINENTALNESS",v.TESTING_MAP_CONTINENTALNESS),m(q,"EROSION",v.TESTING_MAP_EROSION),m(q,"PV",v.TESTING_MAP_PV);const $t=class extends We{constructor(t){super(t)}setValueAt(t,e,n){return this.setPointData(t,e,n)}getValueAt(t,e){return this.getContinentalnessAt(t,e)}getContinentalnessAt(t,e){if(q.ENABLED&&q.CONTINENTALNESS!=null)return q.CONTINENTALNESS;const n=this.getPointData(t,e);if(n!=null)return n;const s=this.noise2D(t/N.CONTINENTALNESS_NOISE_SCALE,e/N.CONTINENTALNESS_NOISE_SCALE);return this.setPointData(t,e,s),s}static getType(t){return t<=$t.NoiseRange.Ocean.max?"Ocean":t<=$t.NoiseRange.Coast.max?"Coast":t<=$t.NoiseRange.Near_Inland.max?"Near_Inland":t<=$t.NoiseRange.Inland.max?"Inland":"Far_Inland"}};let rt=$t;m(rt,"NoiseRange",{Ocean:{min:-1,max:-.7},Coast:{min:-.7,max:-.4},Near_Inland:{min:-.4,max:0},Inland:{min:0,max:.6},Far_Inland:{min:.6,max:1}});class _e extends Be{constructor(e){super(e);m(this,"data");this.data=new Map}getMapData(){return this.data}setMapData(e){this.data=e}getPointData(e,n,s){const i=_e.computeKey(e,n,s);return this.data.get(i)}setPointData(e,n,s,i){const a=_e.computeKey(e,n,s);return this.data.set(a,i),i}static computeKey(e,n,s){return`${Math.floor(e)}_${Math.floor(n)}_${Math.floor(s)}`}}class Rs extends _e{constructor(e){super(e);m(this,"noise3D");this.noise3D=zs(this.prng)}}const Mt=class extends We{constructor(t){super(t)}setValueAt(t,e,n){return this.setPointData(t,e,n)}getValueAt(t,e){return this.getErosionAt(t,e)}getErosionAt(t,e){if(q.ENABLED&&q.EROSION!=null)return q.EROSION;const n=this.getPointData(t,e);if(n!=null)return n;const s=this.noise2D(t/N.EROSION_NOISE_SCALE,e/N.EROSION_NOISE_SCALE);return this.setPointData(t,e,s),s}static getType(t){return t<=Mt.NoiseRange.VeryLow.max?"VeryLow":t<=Mt.NoiseRange.Low.max?"Low":t<=Mt.NoiseRange.Mid.max?"Mid":t<=Mt.NoiseRange.MidSpike.max?"MidSpike":t<=Mt.NoiseRange.MidLow.max?"MidLow":t<=Mt.NoiseRange.FlatSpike.max?"FlatSpike":"Flat"}};let St=Mt;m(St,"NoiseRange",{VeryLow:{min:-1,max:-.5},Low:{min:-.5,max:-.1},Mid:{min:-.1,max:.3},MidSpike:{min:.3,max:.4},MidLow:{min:.4,max:.7},FlatSpike:{min:.7,max:.8},Flat:{min:.8,max:1}});const Pt=class extends We{constructor(t){super(t)}setValueAt(t,e,n){return this.setPointData(t,e,n)}getValueAt(t,e){return this.getPVAt(t,e)}getPVAt(t,e){if(q.ENABLED&&q.PV!=null)return q.PV;const n=this.getPointData(t,e);if(n!=null)return n;const s=4,i=.5,a=N.PV_BASE_SCALE;let u=0,h=0;for(let l=0;l<s;l++){const o=Math.pow(2,l),c=Math.pow(i,l);h+=c,u+=this.noise2D(t/a*o,e/a*o)*c}return u/=h,this.setPointData(t,e,u),u}static getType(t){return t<=Pt.NoiseRange.Valley.max?"Valley":t<=Pt.NoiseRange.Low.max?"Low":t<=Pt.NoiseRange.Plateau.max?"Plateau":t<=Pt.NoiseRange.Mid.max?"Mid":t<=Pt.NoiseRange.High.max?"High":"Peak"}};let xt=Pt;m(xt,"NoiseRange",{Valley:{min:-1,max:-.7},Low:{min:-.7,max:-.4},Plateau:{min:-.4,max:-.1},Mid:{min:-.1,max:.4},High:{min:.4,max:.8},Peak:{min:.8,max:1}});class Ps extends Rs{constructor(e,n,s){super(e);m(this,"SOLID",1);m(this,"AIR",-1);m(this,"erosionMap");m(this,"pvMap");this.erosionMap=n,this.pvMap=s}setValueAt(e,n,s,i){return this.setPointData(e,n,s,i)}getValueAt(e,n,s){return this.getDensityAt(e,n,s)}getDensityAt(e,n,s){const{AIR:i,SOLID:a}=this;if(n<N.MIN_DENSITY_HEIGHT)return a;if(n>N.MAX_DENSITY_HEIGHT)return i;const u=1,h=1;return this.noise3D(e/u,n/u,s/u)+h}getScaleFactorAt(e,n,s){return n<N.LARGE_CAVES_HEIGHT?256:36}getSquashingFactorAt(e,n,s){const i=this.erosionMap.getValueAt(e,s),a=this.pvMap.getValueAt(e,s),u=St.getType(i),h=a>=xt.NoiseRange.Mid.min;switch(u){case"VeryLow":return h?.6:.8;case"Low":return h?.8:.9;case"MidLow":return .9;default:return 1}}}function Q(r,t,e){return Math.round(r+(t-r)*e)}function Ls(r){return Math.random()<=r}function ye(r,t,e){return r>=t&&r<=e}class Ds extends jt{constructor(e,n,s,i){super(e);m(this,"continentalMap");m(this,"erosionMap");m(this,"pvMap");this.continentalMap=n,this.erosionMap=s,this.pvMap=i}setValueAt(e,n,s){return this.setPointData(e,n,s)}getValueAt(e,n){return this.getSurfaceHeightAt(e,n)}getSurfaceHeightAt(e,n){const s=this.getPointData(e,n);if(s!=null)return s;const i=this.getContinentalness(e,n),a=this.getBaseHeight(i),u=this.getErosion(e,n),h=this.getErosionFactor(u),l=this.getPV(e,n),o=this.getPvHeight(l,h),c=a+o;return this.setPointData(e,n,c),c}getBaseHeight(e){const n=rt.getType(e);if(n==="Ocean")return N.MIN_CONTINENTALNESS_HEIGHT;if(n==="Coast"){const s=rt.NoiseRange.Coast.min,i=rt.NoiseRange.Coast.max,a=(e-s)/(i-s);return Q(N.SEA_LEVEL,N.SEA_LEVEL+2,a)}if(n==="Near_Inland"||n==="Inland"){const s=rt.NoiseRange.Near_Inland.min,i=rt.NoiseRange.Inland.max,a=(e-s)/(i-s);return Q(N.SEA_LEVEL+2,N.SEA_LEVEL+15,a)}if(n==="Far_Inland"){const s=rt.NoiseRange.Far_Inland.min,i=rt.NoiseRange.Far_Inland.max,a=(e-s)/(i-s);return Q(N.SEA_LEVEL+15,N.MAX_CONTINENTALNESS_HEIGHT,a)}return N.MAX_CONTINENTALNESS_HEIGHT}getErosionFactor(e){const n=N.MIN_EROSION,s=N.MAX_EROSION,i=Math.floor(s*(1/2)),a=n+6,u=a*2,h=u*2,l=St.getType(e),{min:o,max:c}=St.NoiseRange[l],d=(e-o)/(c-o),f=(c-e)/(c-o);switch(l){case"Flat":return Q(n,a,f);case"FlatSpike":return Q(a,i,f);case"MidLow":return i;case"MidSpike":return Q(a,i,d);case"Mid":return Q(a,u,f);case"Low":return Q(u,h,f);case"VeryLow":return Q(h,s,f)}}getPvHeight(e,n){const s=Math.round(-n*.6666666666666666),i=Math.round(-n/4),a=n,u=Math.round(a*(1/2)),h=xt.getType(e),{min:l,max:o}=xt.NoiseRange[h],c=(e-l)/(o-l);switch(h){case"Valley":return s;case"Low":return Q(s,i,c);case"Plateau":return Q(i,i+2,c);case"Mid":return Q(i+2,u,c);case"High":return Q(u,a,c);case"Peak":return a}}getContinentalness(e,n){return this.continentalMap.getValueAt(e,n)}getErosion(e,n){return this.erosionMap.getValueAt(e,n)}getPV(e,n){return this.pvMap.getValueAt(e,n)}}class Fs extends Be{constructor(e,n,s,i,a,u){super(e);m(this,"continentalMap");m(this,"erosionMap");m(this,"pvMap");m(this,"heightMap");m(this,"densityMap");this.continentalMap=n,this.erosionMap=s,this.pvMap=i,this.heightMap=a,this.densityMap=u}getSurfaceHeightAt(e,n){return Math.min(22,this.heightMap.getValueAt(e,n))}getContinentalnessAt(e,n){return Math.min(22,this.continentalMap.getValueAt(e,n))}getErosionAt(e,n){return this.erosionMap.getValueAt(e,n)}getPVAt(e,n){return this.pvMap.getValueAt(e,n)}getDensityAt(e,n,s){return this.densityMap.getValueAt(e,n,s)}getHeightMap(){return this.heightMap}}var ee=(r=>(r[r.EMPTY=0]="EMPTY",r[r.TRUNK=1]="TRUNK",r[r.LEAF=2]="LEAF",r))(ee||{});class Ut{static encode(t){let e=0;return e=this.setType(e,t.type),e=this.setTrunkHeight(e,t.trunkHeight),e=this.setTrunkSurfaceY(e,t.trunkSurfaceY),e=this.setTrunkDistance(e,t.trunkDistance),e}static decode(t){return{type:this.getType(t),trunkHeight:this.getTrunkHeight(t),trunkSurfaceY:this.getTrunkSurfaceY(t),trunkDistance:this.getTrunkDistance(t)}}static getType(t){return(t&this.TYPE_MASK)>>14}static setType(t,e){return t|=e<<14&this.TYPE_MASK}static getTrunkHeight(t){return(t&this.TRUNK_HEIGHT_MASK)>>10}static setTrunkHeight(t,e){return t|=e<<10&this.TRUNK_HEIGHT_MASK}static getTrunkSurfaceY(t){return(t&this.TRUNK_SURFACE_HEIGHT_MASK)>>2}static setTrunkSurfaceY(t,e){return t|=e<<2&this.TRUNK_SURFACE_HEIGHT_MASK}static getTrunkDistance(t){return t&this.TRUNK_DISTANCE_MASK}static setTrunkDistance(t,e){return t|=e&this.TRUNK_DISTANCE_MASK}}m(Ut,"TYPE_MASK",49152),m(Ut,"TRUNK_HEIGHT_MASK",15360),m(Ut,"TRUNK_SURFACE_HEIGHT_MASK",1020),m(Ut,"TRUNK_DISTANCE_MASK",3);class ne extends jt{constructor(e){super(e);m(this,"enabled");this.enabled=v.TREE_GENERATION_ENABLED}shouldSpawnTreeLeafAt(e,n,s){if(!this.enabled)return!1;const i=this.getTreeMapValueAt(e,s);if(i==null)return!1;const{type:a,trunkDistance:u,trunkHeight:h,trunkSurfaceY:l}=Ut.decode(i),o=l+h,c=n-o;if(a===ee.TRUNK){if(c===2)return Ls(.5);if(c===1)return!0}return!!(a===ee.LEAF&&(u===2&&ye(c,-1,0)||u===1&&ye(c,-1,1)))}shouldSpawnTreeTrunkAt(e,n,s,i){if(!this.enabled)return!1;const a=this.getTreeMapTypeAt(e,s);return n<i||n>i+gt.TRUNK_HEIGHT||a==null?!1:a===ee.TRUNK}getTreeMapTypeAt(e,n){const s=this.getTreeMapValueAt(e,n);return s!=null?Ut.getType(s):null}getTreeMapValueAt(e,n){return this.getPointData(e,n)}static getTreeSeedAt(e,n,s){return`${e}_${n}_${s}`}setValueAt(e,n,s){return this.setPointData(e,n,s)}getValueAt(e,n){return this.getPointData(e,n)??ee.EMPTY}}m(ne,"MAP_SIZE",ot.WIDTH+gt.RADIUS*2);class Hs extends nt{constructor(t){super(t)}getTerrainMap(){const{seed:t}=this,e=new rt(nt.getContinentalMapSeed(t)),n=new St(nt.getErosionMapSeed(t)),s=new xt(nt.getPvMapSeed(t)),i=new Ds(nt.getHeightMapSeed(t),e,n,s),a=new Ps(nt.getDensityMapSeed(t),n,s);return new Fs(t,e,n,s,i,a)}getTreeMapFromBuffer(t,e){const{x:n,z:s}=ot.getChunkOriginPosition(t),i=new ne(this.seed),a=new Map,u=n-gt.RADIUS,h=s-gt.RADIUS;for(let l=0;l<e.length;l++){const o=Math.floor(l/ne.MAP_SIZE)+u,c=l%ne.MAP_SIZE+h,d=ne.computeKey(o,c);a.set(d,e[l])}return i.setMapData(a),i}}class zn{constructor(t){m(this,"terrainMap");this.terrainMap=t}getSurfaceHeightAt(t,e){return this.terrainMap.getSurfaceHeightAt(t,e)}getContinentalTypeAt(t,e){const n=this.terrainMap.getContinentalnessAt(t,e);return rt.getType(n)}getPvTypeAt(t,e){const n=this.terrainMap.getPVAt(t,e);return xt.getType(n)}getErosionTypeAt(t,e){const n=this.terrainMap.getErosionAt(t,e);return St.getType(n)}}class Gs extends zn{constructor(e,n){super(e);m(this,"treeMap");this.treeMap=n}generateBlock(e,n,s){if(!(Math.abs(e-0)<100&&Math.abs(s-0)<100)||n<18)return null;const o=this.getSurfaceHeightAt(e,s);return n<o?null:this.shouldSpawnWater(e,n,s)?G.WATER:this.treeMap.shouldSpawnTreeTrunkAt(e,n,s,o)?G.OAK_LOG:this.treeMap.shouldSpawnTreeLeafAt(e,n,s)?G.OAK_LEAVES:this.shouldSpawnCloud(e,n,s)?G.CLOUD:G.AIR}shouldSpawnWater(e,n,s){return n<N.SEA_LEVEL}shouldSpawnCloud(e,n,s){const i=Math.floor(Math.random()*6)+1,a=n>N.CLOUD_LEVEL&&n<=N.CLOUD_LEVEL+1,u=Math.ceil(e/N.CLOUD_WIDTH)%i===0&&Math.ceil(s/N.CLOUD_DEPTH)%i===0;return a&&u}}var Ve={},Bs={get exports(){return Ve},set exports(r){Ve=r}};(function(r){(function(t){function e(l){function o(c,d,f){this.x=c,this.y=d,this.z=f}o.prototype.dot2=function(c,d){return this.x*c+this.y*d},o.prototype.dot3=function(c,d,f){return this.x*c+this.y*d+this.z*f},this.grad3=[new o(1,1,0),new o(-1,1,0),new o(1,-1,0),new o(-1,-1,0),new o(1,0,1),new o(-1,0,1),new o(1,0,-1),new o(-1,0,-1),new o(0,1,1),new o(0,-1,1),new o(0,1,-1),new o(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.seed(l||0)}e.prototype.seed=function(l){l>0&&l<1&&(l*=65536),l=Math.floor(l),l<256&&(l|=l<<8);for(var o=this.p,c=0;c<256;c++){var d;c&1?d=o[c]^l&255:d=o[c]^l>>8&255;var f=this.perm,p=this.gradP;f[c]=f[c+256]=d,p[c]=p[c+256]=this.grad3[d%12]}};var n=.5*(Math.sqrt(3)-1),s=(3-Math.sqrt(3))/6,i=1/3,a=1/6;e.prototype.simplex2=function(l,o){var c,d,f,p=(l+o)*n,T=Math.floor(l+p),M=Math.floor(o+p),E=(T+M)*s,b=l-T+E,y=o-M+E,w,S;b>y?(w=1,S=0):(w=0,S=1);var _=b-w+s,A=y-S+s,k=b-1+2*s,g=y-1+2*s;T&=255,M&=255;var x=this.perm,I=this.gradP,C=I[T+x[M]],z=I[T+w+x[M+S]],O=I[T+1+x[M+1]],R=.5-b*b-y*y;R<0?c=0:(R*=R,c=R*R*C.dot2(b,y));var B=.5-_*_-A*A;B<0?d=0:(B*=B,d=B*B*z.dot2(_,A));var W=.5-k*k-g*g;return W<0?f=0:(W*=W,f=W*W*O.dot2(k,g)),70*(c+d+f)},e.prototype.simplex3=function(l,o,c){var d,f,p,T,M=(l+o+c)*i,E=Math.floor(l+M),b=Math.floor(o+M),y=Math.floor(c+M),w=(E+b+y)*a,S=l-E+w,_=o-b+w,A=c-y+w,k,g,x,I,C,z;S>=_?_>=A?(k=1,g=0,x=0,I=1,C=1,z=0):S>=A?(k=1,g=0,x=0,I=1,C=0,z=1):(k=0,g=0,x=1,I=1,C=0,z=1):_<A?(k=0,g=0,x=1,I=0,C=1,z=1):S<A?(k=0,g=1,x=0,I=0,C=1,z=1):(k=0,g=1,x=0,I=1,C=1,z=0);var O=S-k+a,R=_-g+a,B=A-x+a,W=S-I+2*a,J=_-C+2*a,j=A-z+2*a,$=S-1+3*a,wt=_-1+3*a,Tt=A-1+3*a;E&=255,b&=255,y&=255;var X=this.perm,Y=this.gradP,ct=Y[E+X[b+X[y]]],ut=Y[E+k+X[b+g+X[y+x]]],pt=Y[E+I+X[b+C+X[y+z]]],lt=Y[E+1+X[b+1+X[y+1]]],Z=.5-S*S-_*_-A*A;Z<0?d=0:(Z*=Z,d=Z*Z*ct.dot3(S,_,A));var H=.5-O*O-R*R-B*B;H<0?f=0:(H*=H,f=H*H*ut.dot3(O,R,B));var It=.5-W*W-J*J-j*j;It<0?p=0:(It*=It,p=It*It*pt.dot3(W,J,j));var Lt=.5-$*$-wt*wt-Tt*Tt;return Lt<0?T=0:(Lt*=Lt,T=Lt*Lt*lt.dot3($,wt,Tt)),32*(d+f+p+T)};function u(l){return l*l*l*(l*(l*6-15)+10)}function h(l,o,c){return(1-c)*l+c*o}e.prototype.perlin2=function(l,o){var c=Math.floor(l),d=Math.floor(o);l=l-c,o=o-d,c=c&255,d=d&255;var f=this.perm,p=this.gradP,T=p[c+f[d]].dot2(l,o),M=p[c+f[d+1]].dot2(l,o-1),E=p[c+1+f[d]].dot2(l-1,o),b=p[c+1+f[d+1]].dot2(l-1,o-1),y=u(l);return h(h(T,E,y),h(M,b,y),u(o))},e.prototype.perlin3=function(l,o,c){var d=Math.floor(l),f=Math.floor(o),p=Math.floor(c);l=l-d,o=o-f,c=c-p,d=d&255,f=f&255,p=p&255;var T=this.perm,M=this.gradP,E=M[d+T[f+T[p]]].dot3(l,o,c),b=M[d+T[f+T[p+1]]].dot3(l,o,c-1),y=M[d+T[f+1+T[p]]].dot3(l,o-1,c),w=M[d+T[f+1+T[p+1]]].dot3(l,o-1,c-1),S=M[d+1+T[f+T[p]]].dot3(l-1,o,c),_=M[d+1+T[f+T[p+1]]].dot3(l-1,o,c-1),A=M[d+1+T[f+1+T[p]]].dot3(l-1,o-1,c),k=M[d+1+T[f+1+T[p+1]]].dot3(l-1,o-1,c-1),g=u(l),x=u(o),I=u(c);return h(h(h(E,S,g),h(b,_,g),I),h(h(y,A,g),h(w,k,g),I),x)},t.Noise=e})(r.exports)})(Bs);class On extends zn{constructor(t){super(t)}generateBlock(t,e,n){const h=Math.abs(t-0)<100&&Math.abs(n-0)<100;if(!h||e<18||h&&e>18)return G.AIR;const l=this.getSurfaceHeightAt(t,n);this.terrainMap.getDensityAt(t,e,n);const o=Math.abs(e-l);switch(this.getDepthLevel(e,o)){case"Surface":return this.getSurfaceBlockType(t,e,n);case"Subsurface":return this.getSubSurfaceBlockType(t,e,n);case"Mid":return this.getMidBlockType(t,e,n,o);default:return G.STONE}}getMidBlockType(t,e,n,s){return G.STONE}getSurfaceBlockType(t,e,n){return this.shouldSpawnSnow(t,e,n)?G.GRASS_SNOW:this.shouldSpawnSand(t,e,n)?G.SAND:e<N.SEA_LEVEL-1?G.DIRT:this.shouldSpawnSurfaceStone(t,e,n)?G.STONE:G.GRASS}getSubSurfaceBlockType(t,e,n){return this.shouldSpawnSurfaceStone(t,e,n)?G.STONE:G.DIRT}shouldSpawnSand(t,e,n){const s=this.getContinentalTypeAt(t,n);return e<=N.SAND_LEVEL&&(s==="Coast"||s==="Ocean")}shouldSpawnSurfaceStone(t,e,n){const s=this.getPvTypeAt(t,n),i=this.getContinentalTypeAt(t,n),a=this.getErosionTypeAt(t,n),u=i==="Far_Inland",h=i==="Inland",l=a==="Flat",o=a==="VeryLow"||a==="Low",c=a==="VeryLow",d=s==="Valley",f=s==="Valley"||s==="Low";return u&&c&&f||u&&o&&d||(h||u)&&l&&f}shouldSpawnCoal(t,e,n,s){const i=this.terrainMap.getDensityAt(t,e,n),a=ye(i,.05,.07);return ye(s,5,20)&&a}shouldSpawnSnow(t,e,n){const i=this.getContinentalTypeAt(t,n)==="Far_Inland",a=e>=N.SNOW_LEVEL;return i&&a}getDepthLevel(t,e){return e<=1?"Surface":e<=3?"Subsurface":t<=N.BEDROCK_LEVEL?"BedRock":t<=N.MIN_SURFACE_HEIGHT-5?"Deep":"Mid"}}m(On,"noise",new Ve.Noise(1));var Rn=(r=>(r[r.TERRAIN=0]="TERRAIN",r[r.FEATURES=1]="FEATURES",r))(Rn||{});class Ws{constructor(t,e){m(this,"terrainGenerator");m(this,"featuresGenerator");this.terrainGenerator=new On(t),this.featuresGenerator=new Gs(t,e)}getBlockGenerator(t){switch(t){case 0:return this.terrainGenerator;case 1:return this.featuresGenerator}}}class Vs{constructor(t){m(this,"DEFAULT_BLOCK_COLOR_RGBA",[1,1,1,1]);m(this,"AO_INTENSITY_LEVEL",[0,.2,.3,.4]);m(this,"terrainMap");this.terrainMap=t}buildChunkGeometry(t,e){const{x:n,y:s,z:i}=e,a=[],u=[],h=[],l=[],o=[],c=[],d=[],f=[],p=[],T=[];for(let M=0;M<ot.HEIGHT;++M){const E=s+M;for(let b=0;b<ot.WIDTH;++b){const y=i+b;for(let w=0;w<ot.WIDTH;++w){const S=n+w,_={x:S,y:E,z:y},A=t.getBlock(_),k=Et.isVisibleBlock(A==null?void 0:A.type);if(A&&k){const g=A.isTransparent,x=A.type===G.WATER;if(x&&this.canSkipWaterBlockRendering(E))continue;const I=g?c:a,C=g?d:u,z=g?f:h,O=g?p:l,R=g?T:o;for(const B of Et.getBlockFaces()){if(x&&B!=="top")continue;const{normal:W,vertices:J}=Et.getBlockFaceGeometry(B),j={x:S+W[0],y:E+W[1],z:y+W[2]},$=t.getBlock(j);if(v.TERRAIN_OPTIMIZATION_ENABLED&&!$&&this.canCullEdgeBlockFace(_,B,j))continue;if(!$||$.isTransparent&&$.type!==G.CLOUD){const Y=I.length/3;for(const{pos:ct,uv:ut,ao:pt}of J){const lt=S+ct[0],Z=E+ct[1],H=y+ct[2];I.push(lt,Z,H),C.push(...W);const It=Et.getBlockUVCoordinates(A.type,B,[ut[0],ut[1]]);O.push(It.u,It.v);const Lt=this.calculateVertexColor({x:lt,y:Z,z:H},A,pt,t);R.push(...Lt)}z.push(Y,Y+1,Y+2,Y+2,Y+1,Y+3)}}}}}}return{solid:{positions:a,normals:u,indices:h,uvs:l,colors:o},transparent:{positions:c,normals:d,indices:f,uvs:p,colors:T}}}canCullEdgeBlockFace(t,e,n){const{terrainMap:s}=this,{x:i,y:a,z:u}=t,{x:h,y:l,z:o}=n,c=s.getSurfaceHeightAt(h,o);if(!(a<c-(e==="top"?1:0)))return!1;const f=s.getDensityAt(i,a,u),p=s.getDensityAt(h,l,o);return Math.sign(f)===Math.sign(p)}calculateVertexColor(t,e,n,s){const i=Et.getBlockColor(e.type)??this.DEFAULT_BLOCK_COLOR_RGBA,a=this.computeVertexAO(t,n,s);return[i[0]-a,i[1]-a,i[2]-a,i[3]]}computeVertexAO(t,{corner:e,side1:n,side2:s},i){let a=0;for(const u of[e,n,s])this.isSideOccluded(t,u,i)&&(a+=1);return this.AO_INTENSITY_LEVEL[a]}isSideOccluded({x:t,y:e,z:n},s,i){const{terrainMap:a}=this,[u,h,l]=s,o=i.getBlock({x:t+u,y:e+h,z:n+l});if(o&&!o.isTransparent)return!0;if(!o){const c=Math.floor(t+u),d=Math.floor(e+h),f=Math.floor(n+l),p=a.getSurfaceHeightAt(c,f),T=a.getDensityAt(c,d,f),M=Math.sign(T)>0,E=Math.sign(h)>0,b=Math.sign(h)<0,y=e<p,w=Math.abs(e-p)===0;if(M)return E&&y||b&&w}return!1}canSkipWaterBlockRendering(t){return t!==N.SEA_LEVEL-1}static extractBufferGeometryDataFromGeometry(t){var u,h;const e=Array.from(t.getAttribute("position").array),n=Array.from(t.getAttribute("normal").array),s=Array.from(t.getAttribute("uv").array),i=Array.from(((u=t.getAttribute("color"))==null?void 0:u.array)??[]),a=Array.from(((h=t.index)==null?void 0:h.array)??[]);return{positions:e,normals:n,uvs:s,indices:a,colors:i}}}function js(r,t,e){const n=new ot(r),s=new Hs(t),i=s.getTerrainMap(),a=s.getTreeMapFromBuffer(r,new Uint16Array(e)),h=new Ws(i,a).getBlockGenerator(Rn.TERRAIN);n.decorateChunk(h);const l=n.getBlocks(),o=new Vs(i),{solid:c,transparent:d}=o.buildChunkGeometry(n,n.getWorldOriginPosition());return{solidGeometry:c,transparentGeometry:d,blocksBuffer:rs(l.buffer)}}ss(js)})();
