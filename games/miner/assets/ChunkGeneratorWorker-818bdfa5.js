var Ws=Object.defineProperty;var Ys=(L,it,At)=>it in L?Ws(L,it,{enumerable:!0,configurable:!0,writable:!0,value:At}):L[it]=At;var p=(L,it,At)=>(Ys(L,typeof it!="symbol"?it+"":it,At),At);(function(){"use strict";var L=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function it(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function At(r){if(r.__esModule)return r;var t=r.default;if(typeof t=="function"){var e=function n(){if(this instanceof n){var s=[null];s.push.apply(s,arguments);var i=Function.bind.apply(t,s);return new i}return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),e}var Ye={},tt={},Ct={};Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.DefaultSerializer=Ct.extendSerializer=void 0;function Pn(r,t){const e=r.deserialize.bind(r),n=r.serialize.bind(r);return{deserialize(s){return t.deserialize(s,e)},serialize(s){return t.serialize(s,n)}}}Ct.extendSerializer=Pn;const $e={deserialize(r){return Object.assign(Error(r.message),{name:r.name,stack:r.stack})},serialize(r){return{__error_marker:"$$error",message:r.message,name:r.name,stack:r.stack}}},Ln=r=>r&&typeof r=="object"&&"__error_marker"in r&&r.__error_marker==="$$error";Ct.DefaultSerializer={deserialize(r){return Ln(r)?$e.deserialize(r):r},serialize(r){return r instanceof Error?$e.serialize(r):r}},Object.defineProperty(tt,"__esModule",{value:!0}),tt.serialize=tt.deserialize=tt.registerSerializer=void 0;const Ke=Ct;let re=Ke.DefaultSerializer;function Dn(r){re=Ke.extendSerializer(re,r)}tt.registerSerializer=Dn;function Fn(r){return re.deserialize(r)}tt.deserialize=Fn;function Hn(r){return re.serialize(r)}tt.serialize=Hn;var Xe={},ht={},Dt={};Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.getBundleURL=Dt.getBaseURL=void 0;let be;function Bn(){return be||(be=Gn()),be}Dt.getBundleURL=Bn;function Gn(){try{throw new Error}catch(r){const t=(""+r.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(t)return Ze(t[0])}return"/"}function Ze(r){return(""+r).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)?\/[^/]+(?:\?.*)?$/,"$1")+"/"}Dt.getBaseURL=Ze,Object.defineProperty(ht,"__esModule",{value:!0}),ht.isWorkerRuntime=ht.getWorkerImplementation=ht.defaultPoolSize=void 0;const qe=Dt;ht.defaultPoolSize=typeof navigator<"u"&&navigator.hardwareConcurrency?navigator.hardwareConcurrency:4;const Qe=r=>/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(r);function Je(r){const t=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(t)}function Vn(){if(typeof Worker>"u")return class{constructor(){throw Error("No web worker implementation available. You might have tried to spawn a worker within a worker in a browser that doesn't support workers in workers.")}};class r extends Worker{constructor(n,s){var i,a;typeof n=="string"&&s&&s._baseURL?n=new URL(n,s._baseURL):typeof n=="string"&&!Qe(n)&&qe.getBundleURL().match(/^file:\/\//i)&&(n=new URL(n,qe.getBundleURL().replace(/\/[^\/]+$/,"/")),(!((i=s==null?void 0:s.CORSWorkaround)!==null&&i!==void 0)||i)&&(n=Je(`importScripts(${JSON.stringify(n)});`))),typeof n=="string"&&Qe(n)&&(!((a=s==null?void 0:s.CORSWorkaround)!==null&&a!==void 0)||a)&&(n=Je(`importScripts(${JSON.stringify(n)});`)),super(n,s)}}class t extends r{constructor(n,s){const i=window.URL.createObjectURL(n);super(i,s)}static fromText(n,s){const i=new window.Blob([n],{type:"text/javascript"});return new t(i,s)}}return{blob:t,default:r}}let Ee;function jn(){return Ee||(Ee=Vn()),Ee}ht.getWorkerImplementation=jn;function Un(){const r=typeof self<"u"&&typeof Window<"u"&&self instanceof Window;return!!(typeof self<"u"&&self.postMessage&&!r)}ht.isWorkerRuntime=Un;var tn={},Ft={},Wn={get exports(){return Ft},set exports(r){Ft=r}},xe,en;function Yn(){if(en)return xe;en=1;var r=1e3,t=r*60,e=t*60,n=e*24,s=n*7,i=n*365.25;xe=function(o,c){c=c||{};var f=typeof o;if(f==="string"&&o.length>0)return a(o);if(f==="number"&&isFinite(o))return c.long?h(o):u(o);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(o))};function a(o){if(o=String(o),!(o.length>100)){var c=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(o);if(c){var f=parseFloat(c[1]),d=(c[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"yrs":case"yr":case"y":return f*i;case"weeks":case"week":case"w":return f*s;case"days":case"day":case"d":return f*n;case"hours":case"hour":case"hrs":case"hr":case"h":return f*e;case"minutes":case"minute":case"mins":case"min":case"m":return f*t;case"seconds":case"second":case"secs":case"sec":case"s":return f*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function u(o){var c=Math.abs(o);return c>=n?Math.round(o/n)+"d":c>=e?Math.round(o/e)+"h":c>=t?Math.round(o/t)+"m":c>=r?Math.round(o/r)+"s":o+"ms"}function h(o){var c=Math.abs(o);return c>=n?l(o,c,n,"day"):c>=e?l(o,c,e,"hour"):c>=t?l(o,c,t,"minute"):c>=r?l(o,c,r,"second"):o+" ms"}function l(o,c,f,d){var y=c>=f*1.5;return Math.round(o/f)+" "+d+(y?"s":"")}return xe}function $n(r){e.debug=e,e.default=e,e.coerce=h,e.disable=i,e.enable=s,e.enabled=a,e.humanize=Yn(),e.destroy=l,Object.keys(r).forEach(o=>{e[o]=r[o]}),e.names=[],e.skips=[],e.formatters={};function t(o){let c=0;for(let f=0;f<o.length;f++)c=(c<<5)-c+o.charCodeAt(f),c|=0;return e.colors[Math.abs(c)%e.colors.length]}e.selectColor=t;function e(o){let c,f=null,d,y;function T(...w){if(!T.enabled)return;const E=T,b=Number(new Date),g=b-(c||b);E.diff=g,E.prev=c,E.curr=b,c=b,w[0]=e.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");let S=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,(_,A)=>{if(_==="%%")return"%";S++;const k=e.formatters[A];if(typeof k=="function"){const m=w[S];_=k.call(E,m),w.splice(S,1),S--}return _}),e.formatArgs.call(E,w),(E.log||e.log).apply(E,w)}return T.namespace=o,T.useColors=e.useColors(),T.color=e.selectColor(o),T.extend=n,T.destroy=e.destroy,Object.defineProperty(T,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(d!==e.namespaces&&(d=e.namespaces,y=e.enabled(o)),y),set:w=>{f=w}}),typeof e.init=="function"&&e.init(T),T}function n(o,c){const f=e(this.namespace+(typeof c>"u"?":":c)+o);return f.log=this.log,f}function s(o){e.save(o),e.namespaces=o,e.names=[],e.skips=[];let c;const f=(typeof o=="string"?o:"").split(/[\s,]+/),d=f.length;for(c=0;c<d;c++)f[c]&&(o=f[c].replace(/\*/g,".*?"),o[0]==="-"?e.skips.push(new RegExp("^"+o.slice(1)+"$")):e.names.push(new RegExp("^"+o+"$")))}function i(){const o=[...e.names.map(u),...e.skips.map(u).map(c=>"-"+c)].join(",");return e.enable(""),o}function a(o){if(o[o.length-1]==="*")return!0;let c,f;for(c=0,f=e.skips.length;c<f;c++)if(e.skips[c].test(o))return!1;for(c=0,f=e.names.length;c<f;c++)if(e.names[c].test(o))return!0;return!1}function u(o){return o.toString().substring(2,o.toString().length-2).replace(/\.\*\?$/,"*")}function h(o){return o instanceof Error?o.stack||o.message:o}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var Kn=$n;(function(r,t){t.formatArgs=n,t.save=s,t.load=i,t.useColors=e,t.storage=a(),t.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;h.splice(1,0,l,"color: inherit");let o=0,c=0;h[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(o++,f==="%c"&&(c=o))}),h.splice(c,0,l)}t.log=console.debug||console.log||(()=>{});function s(h){try{h?t.storage.setItem("debug",h):t.storage.removeItem("debug")}catch{}}function i(){let h;try{h=t.storage.getItem("debug")}catch{}return!h&&typeof process<"u"&&"env"in process&&(h={}.DEBUG),h}function a(){try{return localStorage}catch{}}r.exports=Kn(t);const{formatters:u}=r.exports;u.j=function(h){try{return JSON.stringify(h)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}})(Wn,Ft);var Xn=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})};class se{constructor(t){this._baseObserver=t,this._pendingPromises=new Set}complete(){Promise.all(this._pendingPromises).then(()=>this._baseObserver.complete()).catch(t=>this._baseObserver.error(t))}error(t){this._baseObserver.error(t)}schedule(t){const e=Promise.all(this._pendingPromises),n=[],s=a=>n.push(a),i=Promise.resolve().then(()=>Xn(this,void 0,void 0,function*(){yield e,yield t(s),this._pendingPromises.delete(i);for(const a of n)this._baseObserver.next(a)})).catch(a=>{this._pendingPromises.delete(i),this._baseObserver.error(a)});this._pendingPromises.add(i)}}const nn=()=>typeof Symbol=="function",$t=r=>nn()&&!!Symbol[r],Me=r=>$t(r)?Symbol[r]:"@@"+r;$t("asyncIterator")||(Symbol.asyncIterator=Symbol.asyncIterator||Symbol.for("Symbol.asyncIterator"));const Zn=Me("iterator"),we=Me("observable"),rn=Me("species");function ie(r,t){const e=r[t];if(e!=null){if(typeof e!="function")throw new TypeError(e+" is not a function");return e}}function Kt(r){let t=r.constructor;return t!==void 0&&(t=t[rn],t===null&&(t=void 0)),t!==void 0?t:et}function qn(r){return r instanceof et}function Ht(r){Ht.log?Ht.log(r):setTimeout(()=>{throw r},0)}function oe(r){Promise.resolve().then(()=>{try{r()}catch(t){Ht(t)}})}function sn(r){const t=r._cleanup;if(t!==void 0&&(r._cleanup=void 0,!!t))try{if(typeof t=="function")t();else{const e=ie(t,"unsubscribe");e&&e.call(t)}}catch(e){Ht(e)}}function Se(r){r._observer=void 0,r._queue=void 0,r._state="closed"}function Qn(r){const t=r._queue;if(t){r._queue=void 0,r._state="ready";for(const e of t)if(on(r,e.type,e.value),r._state==="closed")break}}function on(r,t,e){r._state="running";const n=r._observer;try{const s=n?ie(n,t):void 0;switch(t){case"next":s&&s.call(n,e);break;case"error":if(Se(r),s)s.call(n,e);else throw e;break;case"complete":Se(r),s&&s.call(n);break}}catch(s){Ht(s)}r._state==="closed"?sn(r):r._state==="running"&&(r._state="ready")}function Te(r,t,e){if(r._state!=="closed"){if(r._state==="buffering"){r._queue=r._queue||[],r._queue.push({type:t,value:e});return}if(r._state!=="ready"){r._state="buffering",r._queue=[{type:t,value:e}],oe(()=>Qn(r));return}on(r,t,e)}}class Jn{constructor(t,e){this._cleanup=void 0,this._observer=t,this._queue=void 0,this._state="initializing";const n=new tr(this);try{this._cleanup=e.call(void 0,n)}catch(s){n.error(s)}this._state==="initializing"&&(this._state="ready")}get closed(){return this._state==="closed"}unsubscribe(){this._state!=="closed"&&(Se(this),sn(this))}}class tr{constructor(t){this._subscription=t}get closed(){return this._subscription._state==="closed"}next(t){Te(this._subscription,"next",t)}error(t){Te(this._subscription,"error",t)}complete(){Te(this._subscription,"complete")}}class et{constructor(t){if(!(this instanceof et))throw new TypeError("Observable cannot be called as a function");if(typeof t!="function")throw new TypeError("Observable initializer must be a function");this._subscriber=t}subscribe(t,e,n){return(typeof t!="object"||t===null)&&(t={next:t,error:e,complete:n}),new Jn(t,this._subscriber)}pipe(t,...e){let n=this;for(const s of[t,...e])n=s(n);return n}tap(t,e,n){const s=typeof t!="object"||t===null?{next:t,error:e,complete:n}:t;return new et(i=>this.subscribe({next(a){s.next&&s.next(a),i.next(a)},error(a){s.error&&s.error(a),i.error(a)},complete(){s.complete&&s.complete(),i.complete()},start(a){s.start&&s.start(a)}}))}forEach(t){return new Promise((e,n)=>{if(typeof t!="function"){n(new TypeError(t+" is not a function"));return}function s(){i.unsubscribe(),e(void 0)}const i=this.subscribe({next(a){try{t(a,s)}catch(u){n(u),i.unsubscribe()}},error(a){n(a)},complete(){e(void 0)}})})}map(t){if(typeof t!="function")throw new TypeError(t+" is not a function");const e=Kt(this);return new e(n=>this.subscribe({next(s){let i=s;try{i=t(s)}catch(a){return n.error(a)}n.next(i)},error(s){n.error(s)},complete(){n.complete()}}))}filter(t){if(typeof t!="function")throw new TypeError(t+" is not a function");const e=Kt(this);return new e(n=>this.subscribe({next(s){try{if(!t(s))return}catch(i){return n.error(i)}n.next(s)},error(s){n.error(s)},complete(){n.complete()}}))}reduce(t,e){if(typeof t!="function")throw new TypeError(t+" is not a function");const n=Kt(this),s=arguments.length>1;let i=!1,a=e;return new n(u=>this.subscribe({next(h){const l=!i;if(i=!0,!l||s)try{a=t(a,h)}catch(o){return u.error(o)}else a=h},error(h){u.error(h)},complete(){if(!i&&!s)return u.error(new TypeError("Cannot reduce an empty sequence"));u.next(a),u.complete()}}))}concat(...t){const e=Kt(this);return new e(n=>{let s,i=0;function a(u){s=u.subscribe({next(h){n.next(h)},error(h){n.error(h)},complete(){i===t.length?(s=void 0,n.complete()):a(e.from(t[i++]))}})}return a(this),()=>{s&&(s.unsubscribe(),s=void 0)}})}flatMap(t){if(typeof t!="function")throw new TypeError(t+" is not a function");const e=Kt(this);return new e(n=>{const s=[],i=this.subscribe({next(u){let h;if(t)try{h=t(u)}catch(o){return n.error(o)}else h=u;const l=e.from(h).subscribe({next(o){n.next(o)},error(o){n.error(o)},complete(){const o=s.indexOf(l);o>=0&&s.splice(o,1),a()}});s.push(l)},error(u){n.error(u)},complete(){a()}});function a(){i.closed&&s.length===0&&n.complete()}return()=>{s.forEach(u=>u.unsubscribe()),i.unsubscribe()}})}[we](){return this}static from(t){const e=typeof this=="function"?this:et;if(t==null)throw new TypeError(t+" is not an object");const n=ie(t,we);if(n){const s=n.call(t);if(Object(s)!==s)throw new TypeError(s+" is not an object");return qn(s)&&s.constructor===e?s:new e(i=>s.subscribe(i))}if($t("iterator")){const s=ie(t,Zn);if(s)return new e(i=>{oe(()=>{if(!i.closed){for(const a of s.call(t))if(i.next(a),i.closed)return;i.complete()}})})}if(Array.isArray(t))return new e(s=>{oe(()=>{if(!s.closed){for(const i of t)if(s.next(i),s.closed)return;s.complete()}})});throw new TypeError(t+" is not observable")}static of(...t){const e=typeof this=="function"?this:et;return new e(n=>{oe(()=>{if(!n.closed){for(const s of t)if(n.next(s),n.closed)return;n.complete()}})})}static get[rn](){return this}}nn()&&Object.defineProperty(et,Symbol("extensions"),{value:{symbol:we,hostReportError:Ht},configurable:!0});var Nt=et;function kt(r){typeof r=="function"?r():r&&typeof r.unsubscribe=="function"&&r.unsubscribe()}var er=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})};function nr(r){return t=>new Nt(e=>{const n=new se(e),s=t.subscribe({complete(){n.complete()},error(i){n.error(i)},next(i){n.schedule(a=>er(this,void 0,void 0,function*(){(yield r(i))&&a(i)}))}});return()=>kt(s)})}function rr(r){return r&&$t("asyncIterator")&&r[Symbol.asyncIterator]}function sr(r){return r&&$t("iterator")&&r[Symbol.iterator]}var ir=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})},or=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=r[Symbol.asyncIterator],e;return t?t.call(r):(r=typeof __values=="function"?__values(r):r[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(i){e[i]=r[i]&&function(a){return new Promise(function(u,h){a=r[i](a),s(u,h,a.done,a.value)})}}function s(i,a,u,h){Promise.resolve(h).then(function(l){i({value:l,done:u})},a)}};function ar(r){return t=>new Nt(e=>{const n=new se(e),s=t.subscribe({complete(){n.complete()},error(i){n.error(i)},next(i){n.schedule(a=>ir(this,void 0,void 0,function*(){var u,h;const l=yield r(i);if(sr(l)||rr(l))try{for(var o=or(l),c;c=yield o.next(),!c.done;){const f=c.value;a(f)}}catch(f){u={error:f}}finally{try{c&&!c.done&&(h=o.return)&&(yield h.call(o))}finally{if(u)throw u.error}}else l.map(f=>a(f))}))}});return()=>kt(s)})}function cr(r){return new et(t=>{let e=0;const n=setInterval(()=>{t.next(e++)},r);return()=>clearInterval(n)})}var ur=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})};function lr(r){return t=>new Nt(e=>{const n=new se(e),s=t.subscribe({complete(){n.complete()},error(i){n.error(i)},next(i){n.schedule(a=>ur(this,void 0,void 0,function*(){const u=yield r(i);a(u)}))}});return()=>kt(s)})}function hr(...r){return r.length===0?et.from([]):new et(t=>{let e=0;const n=r.map(i=>i.subscribe({error(a){t.error(a),s()},next(a){t.next(a)},complete(){++e===r.length&&(t.complete(),s())}})),s=()=>{n.forEach(i=>kt(i))};return s})}class fr extends Nt{constructor(){super(t=>(this._observers.add(t),()=>this._observers.delete(t))),this._observers=new Set}next(t){for(const e of this._observers)e.next(t)}error(t){for(const e of this._observers)e.error(t)}complete(){for(const t of this._observers)t.complete()}}var an=fr;function dr(r){const t=new an;let e,n=0;return new Nt(s=>{e||(e=r.subscribe(t));const i=t.subscribe(s);return n++,()=>{n--,i.unsubscribe(),n===0&&(kt(e),e=void 0)}})}var mr=function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})};function pr(r,t){return e=>new Nt(n=>{let s,i=0;const a=new se(n),u=e.subscribe({complete(){a.complete()},error(h){a.error(h)},next(h){a.schedule(l=>mr(this,void 0,void 0,function*(){s=yield r(i===0?typeof t>"u"?h:t:s,h,i++),l(s)}))}});return()=>kt(u)})}var yr=Object.freeze({__proto__:null,Observable:Nt,Subject:an,filter:nr,flatMap:ar,interval:cr,map:lr,merge:hr,multicast:dr,scan:pr,unsubscribe:kt}),ae=At(yr),ce={};Object.defineProperty(ce,"__esModule",{value:!0}),ce.allSettled=void 0;function _r(r){return Promise.all(r.map(t=>{const e=i=>({status:"fulfilled",value:i}),n=i=>({status:"rejected",reason:i}),s=Promise.resolve(t);try{return s.then(e,n)}catch(i){return Promise.reject(i)}}))}ce.allSettled=_r;var cn={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.PoolEventType=void 0,function(t){t.initialized="initialized",t.taskCanceled="taskCanceled",t.taskCompleted="taskCompleted",t.taskFailed="taskFailed",t.taskQueued="taskQueued",t.taskQueueDrained="taskQueueDrained",t.taskStart="taskStart",t.terminated="terminated"}(r.PoolEventType||(r.PoolEventType={}))})(cn);var Xt={},K={};Object.defineProperty(K,"__esModule",{value:!0}),K.$worker=K.$transferable=K.$terminate=K.$events=K.$errors=void 0,K.$errors=Symbol("thread.errors"),K.$events=Symbol("thread.events"),K.$terminate=Symbol("thread.terminate"),K.$transferable=Symbol("thread.transferable"),K.$worker=Symbol("thread.worker"),Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.Thread=void 0;const Ie=K;function un(r){throw Error(r)}Xt.Thread={errors(r){return r[Ie.$errors]||un("Error observable not found. Make sure to pass a thread instance as returned by the spawn() promise.")},events(r){return r[Ie.$events]||un("Events observable not found. Make sure to pass a thread instance as returned by the spawn() promise.")},terminate(r){return r[Ie.$terminate]()}},function(r){var t=L&&L.__awaiter||function(E,b,g,S){function x(_){return _ instanceof g?_:new g(function(A){A(_)})}return new(g||(g=Promise))(function(_,A){function k(I){try{M(S.next(I))}catch(N){A(N)}}function m(I){try{M(S.throw(I))}catch(N){A(N)}}function M(I){I.done?_(I.value):x(I.value).then(k,m)}M((S=S.apply(E,b||[])).next())})},e=L&&L.__importDefault||function(E){return E&&E.__esModule?E:{default:E}};Object.defineProperty(r,"__esModule",{value:!0}),r.Pool=r.Thread=r.PoolEventType=void 0;const n=e(Ft),s=ae,i=ce,a=ht,u=cn;Object.defineProperty(r,"PoolEventType",{enumerable:!0,get:function(){return u.PoolEventType}});const h=Xt;Object.defineProperty(r,"Thread",{enumerable:!0,get:function(){return h.Thread}});let l=1;function o(E){const b=[];for(let g=0;g<E;g++)b.push(g);return b}function c(E){return new Promise(b=>setTimeout(b,E))}function f(E,b){return E.reduce((g,S)=>[...g,...b(S)],[])}function d(E){return E.replace(/\W/g," ").trim().replace(/\s+/g,"-")}function y(E,b){return o(b).map(()=>({init:E(),runningTasks:[]}))}class T{constructor(b,g){this.eventSubject=new s.Subject,this.initErrors=[],this.isClosing=!1,this.nextTaskID=1,this.taskQueue=[];const S=typeof g=="number"?{size:g}:g||{},{size:x=a.defaultPoolSize}=S;this.debug=n.default(`threads:pool:${d(S.name||String(l++))}`),this.options=S,this.workers=y(b,x),this.eventObservable=s.multicast(s.Observable.from(this.eventSubject)),Promise.all(this.workers.map(_=>_.init)).then(()=>this.eventSubject.next({type:u.PoolEventType.initialized,size:this.workers.length}),_=>{this.debug("Error while initializing pool worker:",_),this.eventSubject.error(_),this.initErrors.push(_)})}findIdlingWorker(){const{concurrency:b=1}=this.options;return this.workers.find(g=>g.runningTasks.length<b)}runPoolTask(b,g){return t(this,void 0,void 0,function*(){const S=this.workers.indexOf(b)+1;this.debug(`Running task #${g.id} on worker #${S}...`),this.eventSubject.next({type:u.PoolEventType.taskStart,taskID:g.id,workerID:S});try{const x=yield g.run(yield b.init);this.debug(`Task #${g.id} completed successfully`),this.eventSubject.next({type:u.PoolEventType.taskCompleted,returnValue:x,taskID:g.id,workerID:S})}catch(x){this.debug(`Task #${g.id} failed`),this.eventSubject.next({type:u.PoolEventType.taskFailed,taskID:g.id,error:x,workerID:S})}})}run(b,g){return t(this,void 0,void 0,function*(){const S=(()=>t(this,void 0,void 0,function*(){const x=()=>{b.runningTasks=b.runningTasks.filter(_=>_!==S)};yield c(0);try{yield this.runPoolTask(b,g)}finally{x(),this.isClosing||this.scheduleWork()}}))();b.runningTasks.push(S)})}scheduleWork(){this.debug("Attempt de-queueing a task in order to run it...");const b=this.findIdlingWorker();if(!b)return;const g=this.taskQueue.shift();if(!g){this.debug("Task queue is empty"),this.eventSubject.next({type:u.PoolEventType.taskQueueDrained});return}this.run(b,g)}taskCompletion(b){return new Promise((g,S)=>{const x=this.events().subscribe(_=>{_.type===u.PoolEventType.taskCompleted&&_.taskID===b?(x.unsubscribe(),g(_.returnValue)):_.type===u.PoolEventType.taskFailed&&_.taskID===b?(x.unsubscribe(),S(_.error)):_.type===u.PoolEventType.terminated&&(x.unsubscribe(),S(Error("Pool has been terminated before task was run.")))})})}settled(b=!1){return t(this,void 0,void 0,function*(){const g=()=>f(this.workers,_=>_.runningTasks),S=[],x=this.eventObservable.subscribe(_=>{_.type===u.PoolEventType.taskFailed&&S.push(_.error)});return this.initErrors.length>0?Promise.reject(this.initErrors[0]):b&&this.taskQueue.length===0?(yield i.allSettled(g()),S):(yield new Promise((_,A)=>{const k=this.eventObservable.subscribe({next(m){m.type===u.PoolEventType.taskQueueDrained&&(k.unsubscribe(),_(void 0))},error:A})}),yield i.allSettled(g()),x.unsubscribe(),S)})}completed(b=!1){return t(this,void 0,void 0,function*(){const g=this.settled(b),S=new Promise((_,A)=>{const k=this.eventObservable.subscribe({next(m){m.type===u.PoolEventType.taskQueueDrained?(k.unsubscribe(),_(g)):m.type===u.PoolEventType.taskFailed&&(k.unsubscribe(),A(m.error))},error:A})}),x=yield Promise.race([g,S]);if(x.length>0)throw x[0]})}events(){return this.eventObservable}queue(b){const{maxQueuedJobs:g=1/0}=this.options;if(this.isClosing)throw Error("Cannot schedule pool tasks after terminate() has been called.");if(this.initErrors.length>0)throw this.initErrors[0];const S=this.nextTaskID++,x=this.taskCompletion(S);x.catch(A=>{this.debug(`Task #${S} errored:`,A)});const _={id:S,run:b,cancel:()=>{this.taskQueue.indexOf(_)!==-1&&(this.taskQueue=this.taskQueue.filter(A=>A!==_),this.eventSubject.next({type:u.PoolEventType.taskCanceled,taskID:_.id}))},then:x.then.bind(x)};if(this.taskQueue.length>=g)throw Error(`Maximum number of pool tasks queued. Refusing to queue another one.
This usually happens for one of two reasons: We are either at peak workload right now or some tasks just won't finish, thus blocking the pool.`);return this.debug(`Queueing task #${_.id}...`),this.taskQueue.push(_),this.eventSubject.next({type:u.PoolEventType.taskQueued,taskID:_.id}),this.scheduleWork(),_}terminate(b){return t(this,void 0,void 0,function*(){this.isClosing=!0,b||(yield this.completed(!0)),this.eventSubject.next({type:u.PoolEventType.terminated,remainingQueue:[...this.taskQueue]}),this.eventSubject.complete(),yield Promise.all(this.workers.map(g=>t(this,void 0,void 0,function*(){return h.Thread.terminate(yield g.init)})))})}}T.EventType=u.PoolEventType;function w(E,b){return new T(E,b)}w.EventType=u.PoolEventType,r.Pool=w}(tn);var ue={},le={};Object.defineProperty(le,"__esModule",{value:!0}),le.createPromiseWithResolver=void 0;const gr=()=>{};function br(){let r=!1,t,e=gr;return[new Promise(i=>{r?i(t):e=i}),i=>{r=!0,t=i,e(t)}]}le.createPromiseWithResolver=br;var ln={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WorkerEventType=void 0,function(t){t.internalError="internalError",t.message="message",t.termination="termination"}(r.WorkerEventType||(r.WorkerEventType={}))})(ln);var Bt={},he={};Object.defineProperty(he,"__esModule",{value:!0}),he.ObservablePromise=void 0;const Er=ae,xr=()=>{},Mr=r=>r,hn=r=>Promise.resolve().then(r);function wr(r){throw r}function Sr(r){return r&&typeof r.then=="function"}class Ae extends Er.Observable{constructor(t){super(e=>{const n=this,s=Object.assign(Object.assign({},e),{complete(){e.complete(),n.onCompletion()},error(i){e.error(i),n.onError(i)},next(i){e.next(i),n.onNext(i)}});try{return this.initHasRun=!0,t(s)}catch(i){s.error(i)}}),this.initHasRun=!1,this.fulfillmentCallbacks=[],this.rejectionCallbacks=[],this.firstValueSet=!1,this.state="pending"}onNext(t){this.firstValueSet||(this.firstValue=t,this.firstValueSet=!0)}onError(t){this.state="rejected",this.rejection=t;for(const e of this.rejectionCallbacks)hn(()=>e(t))}onCompletion(){this.state="fulfilled";for(const t of this.fulfillmentCallbacks)hn(()=>t(this.firstValue))}then(t,e){const n=t||Mr,s=e||wr;let i=!1;return new Promise((a,u)=>{const h=o=>{if(!i){i=!0;try{a(s(o))}catch(c){u(c)}}},l=o=>{try{a(n(o))}catch(c){h(c)}};if(this.initHasRun||this.subscribe({error:h}),this.state==="fulfilled")return a(n(this.firstValue));if(this.state==="rejected")return i=!0,a(s(this.rejection));this.fulfillmentCallbacks.push(l),this.rejectionCallbacks.push(h)})}catch(t){return this.then(void 0,t)}finally(t){const e=t||xr;return this.then(n=>(e(),n),()=>e())}static from(t){return Sr(t)?new Ae(e=>{const n=i=>{e.next(i),e.complete()},s=i=>{e.error(i)};t.then(n,s)}):super.from(t)}}he.ObservablePromise=Ae;var ft={};Object.defineProperty(ft,"__esModule",{value:!0}),ft.Transfer=ft.isTransferDescriptor=void 0;const fn=K;function Tr(r){return!(!r||typeof r!="object")}function Ir(r){return r&&typeof r=="object"&&r[fn.$transferable]}ft.isTransferDescriptor=Ir;function Ar(r,t){if(!t){if(!Tr(r))throw Error();t=[r]}return{[fn.$transferable]:!0,send:r,transferables:t}}ft.Transfer=Ar;var Ce={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WorkerMessageType=r.MasterMessageType=void 0,function(t){t.cancel="cancel",t.run="run"}(r.MasterMessageType||(r.MasterMessageType={})),function(t){t.error="error",t.init="init",t.result="result",t.running="running",t.uncaughtError="uncaughtError"}(r.WorkerMessageType||(r.WorkerMessageType={}))})(Ce);var Cr=L&&L.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.createProxyModule=Bt.createProxyFunction=void 0;const Nr=Cr(Ft),dn=ae,Zt=tt,mn=he,kr=ft,qt=Ce,pn=Nr.default("threads:master:messages");let vr=1;const zr=r=>Array.from(new Set(r)),Or=r=>r&&r.type===qt.WorkerMessageType.error,Rr=r=>r&&r.type===qt.WorkerMessageType.result,Pr=r=>r&&r.type===qt.WorkerMessageType.running;function Lr(r,t){return new dn.Observable(e=>{let n;const s=i=>{if(pn("Message from worker:",i.data),!(!i.data||i.data.uid!==t)){if(Pr(i.data))n=i.data.resultType;else if(Rr(i.data))n==="promise"?(typeof i.data.payload<"u"&&e.next(Zt.deserialize(i.data.payload)),e.complete(),r.removeEventListener("message",s)):(i.data.payload&&e.next(Zt.deserialize(i.data.payload)),i.data.complete&&(e.complete(),r.removeEventListener("message",s)));else if(Or(i.data)){const a=Zt.deserialize(i.data.error);e.error(a),r.removeEventListener("message",s)}}};return r.addEventListener("message",s),()=>{if(n==="observable"||!n){const i={type:qt.MasterMessageType.cancel,uid:t};r.postMessage(i)}r.removeEventListener("message",s)}})}function Dr(r){if(r.length===0)return{args:[],transferables:[]};const t=[],e=[];for(const n of r)kr.isTransferDescriptor(n)?(t.push(Zt.serialize(n.send)),e.push(...n.transferables)):t.push(Zt.serialize(n));return{args:t,transferables:e.length===0?e:zr(e)}}function yn(r,t){return(...e)=>{const n=vr++,{args:s,transferables:i}=Dr(e),a={type:qt.MasterMessageType.run,uid:n,method:t,args:s};pn("Sending command to run function to worker:",a);try{r.postMessage(a,i)}catch(u){return mn.ObservablePromise.from(Promise.reject(u))}return mn.ObservablePromise.from(dn.multicast(Lr(r,n)))}}Bt.createProxyFunction=yn;function Fr(r,t){const e={};for(const n of t)e[n]=yn(r,n);return e}Bt.createProxyModule=Fr;var Ne=L&&L.__awaiter||function(r,t,e,n){function s(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function u(o){try{l(n.next(o))}catch(c){a(c)}}function h(o){try{l(n.throw(o))}catch(c){a(c)}}function l(o){o.done?i(o.value):s(o.value).then(u,h)}l((n=n.apply(r,t||[])).next())})},Hr=L&&L.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ue,"__esModule",{value:!0}),ue.spawn=void 0;const ke=Hr(Ft),Br=ae,Gr=tt,Vr=le,fe=K,de=ln,_n=Bt,jr=ke.default("threads:master:messages"),Ur=ke.default("threads:master:spawn"),gn=ke.default("threads:master:thread-utils"),Wr=r=>r&&r.type==="init",Yr=r=>r&&r.type==="uncaughtError",$r=typeof process<"u"&&{}.THREADS_WORKER_INIT_TIMEOUT?Number.parseInt({}.THREADS_WORKER_INIT_TIMEOUT,10):1e4;function Kr(r,t,e){return Ne(this,void 0,void 0,function*(){let n;const s=new Promise((a,u)=>{n=setTimeout(()=>u(Error(e)),t)}),i=yield Promise.race([r,s]);return clearTimeout(n),i})}function Xr(r){return new Promise((t,e)=>{const n=s=>{jr("Message from worker before finishing initialization:",s.data),Wr(s.data)?(r.removeEventListener("message",n),t(s.data)):Yr(s.data)&&(r.removeEventListener("message",n),e(Gr.deserialize(s.data.error)))};r.addEventListener("message",n)})}function Zr(r,t){return new Br.Observable(e=>{const n=i=>{const a={type:de.WorkerEventType.message,data:i.data};e.next(a)},s=i=>{gn("Unhandled promise rejection event in thread:",i);const a={type:de.WorkerEventType.internalError,error:Error(i.reason)};e.next(a)};r.addEventListener("message",n),r.addEventListener("unhandledrejection",s),t.then(()=>{const i={type:de.WorkerEventType.termination};r.removeEventListener("message",n),r.removeEventListener("unhandledrejection",s),e.next(i),e.complete()})})}function qr(r){const[t,e]=Vr.createPromiseWithResolver();return{terminate:()=>Ne(this,void 0,void 0,function*(){gn("Terminating worker"),yield r.terminate(),e()}),termination:t}}function bn(r,t,e,n){const s=e.filter(i=>i.type===de.WorkerEventType.internalError).map(i=>i.error);return Object.assign(r,{[fe.$errors]:s,[fe.$events]:e,[fe.$terminate]:n,[fe.$worker]:t})}function Qr(r,t){return Ne(this,void 0,void 0,function*(){Ur("Initializing new thread");const e=t&&t.timeout?t.timeout:$r,s=(yield Kr(Xr(r),e,`Timeout: Did not receive an init message from worker after ${e}ms. Make sure the worker calls expose().`)).exposed,{termination:i,terminate:a}=qr(r),u=Zr(r,i);if(s.type==="function"){const h=_n.createProxyFunction(r);return bn(h,r,u,a)}else if(s.type==="module"){const h=_n.createProxyModule(r,s.methods);return bn(h,r,u,a)}else{const h=s.type;throw Error(`Worker init message states unexpected type of expose(): ${h}`)}})}ue.spawn=Qr,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.Worker=r.BlobWorker=r.isWorkerRuntime=r.Thread=r.spawn=r.Pool=void 0;const t=ht;Object.defineProperty(r,"isWorkerRuntime",{enumerable:!0,get:function(){return t.isWorkerRuntime}});var e=tn;Object.defineProperty(r,"Pool",{enumerable:!0,get:function(){return e.Pool}});var n=ue;Object.defineProperty(r,"spawn",{enumerable:!0,get:function(){return n.spawn}});var s=Xt;Object.defineProperty(r,"Thread",{enumerable:!0,get:function(){return s.Thread}}),r.BlobWorker=t.getWorkerImplementation().blob,r.Worker=t.getWorkerImplementation().default}(Xe);var ve={},Jr=r=>r?typeof Symbol.observable=="symbol"&&typeof r[Symbol.observable]=="function"?r===r[Symbol.observable]():typeof r["@@observable"]=="function"?r===r["@@observable"]():!1:!1,ze={};Object.defineProperty(ze,"__esModule",{value:!0});const ts=function(){const t=typeof self<"u"&&typeof Window<"u"&&self instanceof Window;return!!(typeof self<"u"&&self.postMessage&&!t)},es=function(t,e){self.postMessage(t,e)},ns=function(t){const e=s=>{t(s.data)},n=()=>{self.removeEventListener("message",e)};return self.addEventListener("message",e),n};ze.default={isWorkerRuntime:ts,postMessageToMaster:es,subscribeToMasterMessages:ns},function(r){var t=L&&L.__awaiter||function(m,M,I,N){function z(O){return O instanceof I?O:new I(function(R){R(O)})}return new(I||(I=Promise))(function(O,R){function G(U){try{J(N.next(U))}catch(Y){R(Y)}}function V(U){try{J(N.throw(U))}catch(Y){R(Y)}}function J(U){U.done?O(U.value):z(U.value).then(G,V)}J((N=N.apply(m,M||[])).next())})},e=L&&L.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};Object.defineProperty(r,"__esModule",{value:!0}),r.expose=r.isWorkerRuntime=r.Transfer=r.registerSerializer=void 0;const n=e(Jr),s=tt,i=ft,a=Ce,u=e(ze);var h=tt;Object.defineProperty(r,"registerSerializer",{enumerable:!0,get:function(){return h.registerSerializer}});var l=ft;Object.defineProperty(r,"Transfer",{enumerable:!0,get:function(){return l.Transfer}}),r.isWorkerRuntime=u.default.isWorkerRuntime;let o=!1;const c=new Map,f=m=>m&&m.type===a.MasterMessageType.cancel,d=m=>m&&m.type===a.MasterMessageType.run,y=m=>n.default(m)||T(m);function T(m){return m&&typeof m=="object"&&typeof m.subscribe=="function"}function w(m){return i.isTransferDescriptor(m)?{payload:m.send,transferables:m.transferables}:{payload:m,transferables:void 0}}function E(){const m={type:a.WorkerMessageType.init,exposed:{type:"function"}};u.default.postMessageToMaster(m)}function b(m){const M={type:a.WorkerMessageType.init,exposed:{type:"module",methods:m}};u.default.postMessageToMaster(M)}function g(m,M){const{payload:I,transferables:N}=w(M),z={type:a.WorkerMessageType.error,uid:m,error:s.serialize(I)};u.default.postMessageToMaster(z,N)}function S(m,M,I){const{payload:N,transferables:z}=w(I),O={type:a.WorkerMessageType.result,uid:m,complete:M?!0:void 0,payload:N};u.default.postMessageToMaster(O,z)}function x(m,M){const I={type:a.WorkerMessageType.running,uid:m,resultType:M};u.default.postMessageToMaster(I)}function _(m){try{const M={type:a.WorkerMessageType.uncaughtError,error:s.serialize(m)};u.default.postMessageToMaster(M)}catch(M){console.error(`Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.
Latest error:`,M,`
Original error:`,m)}}function A(m,M,I){return t(this,void 0,void 0,function*(){let N;try{N=M(...I)}catch(O){return g(m,O)}const z=y(N)?"observable":"promise";if(x(m,z),y(N)){const O=N.subscribe(R=>S(m,!1,s.serialize(R)),R=>{g(m,s.serialize(R)),c.delete(m)},()=>{S(m,!0),c.delete(m)});c.set(m,O)}else try{const O=yield N;S(m,!0,s.serialize(O))}catch(O){g(m,s.serialize(O))}})}function k(m){if(!u.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(o)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(o=!0,typeof m=="function")u.default.subscribeToMasterMessages(M=>{d(M)&&!M.method&&A(M.uid,m,M.args.map(s.deserialize))}),E();else if(typeof m=="object"&&m){u.default.subscribeToMasterMessages(I=>{d(I)&&I.method&&A(I.uid,m[I.method],I.args.map(s.deserialize))});const M=Object.keys(m).filter(I=>typeof m[I]=="function");b(M)}else throw Error(`Invalid argument passed to expose(). Expected a function or an object, got: ${m}`);u.default.subscribeToMasterMessages(M=>{if(f(M)){const I=M.uid,N=c.get(I);N&&(N.unsubscribe(),c.delete(I))}})}r.expose=k,typeof self<"u"&&typeof self.addEventListener=="function"&&u.default.isWorkerRuntime()&&(self.addEventListener("error",m=>{setTimeout(()=>_(m.error||m),250)}),self.addEventListener("unhandledrejection",m=>{const M=m.reason;M&&typeof M.message=="string"&&setTimeout(()=>_(M),250)})),typeof process<"u"&&typeof process.on=="function"&&u.default.isWorkerRuntime()&&(process.on("uncaughtException",m=>{setTimeout(()=>_(m),250)}),process.on("unhandledRejection",m=>{m&&typeof m.message=="string"&&setTimeout(()=>_(m),250)}))}(ve);var Oe=it(ve);(function(r){var t=L&&L.__createBinding||(Object.create?function(u,h,l,o){o===void 0&&(o=l),Object.defineProperty(u,o,{enumerable:!0,get:function(){return h[l]}})}:function(u,h,l,o){o===void 0&&(o=l),u[o]=h[l]}),e=L&&L.__exportStar||function(u,h){for(var l in u)l!=="default"&&!Object.prototype.hasOwnProperty.call(h,l)&&t(h,u,l)};Object.defineProperty(r,"__esModule",{value:!0}),r.Transfer=r.DefaultSerializer=r.expose=r.registerSerializer=void 0;var n=tt;Object.defineProperty(r,"registerSerializer",{enumerable:!0,get:function(){return n.registerSerializer}}),e(Xe,r);var s=ve;Object.defineProperty(r,"expose",{enumerable:!0,get:function(){return s.expose}});var i=Ct;Object.defineProperty(r,"DefaultSerializer",{enumerable:!0,get:function(){return i.DefaultSerializer}});var a=ft;Object.defineProperty(r,"Transfer",{enumerable:!0,get:function(){return a.Transfer}})})(Ye);var _t=it(Ye);_t.registerSerializer,_t.spawn,_t.BlobWorker,_t.DefaultSerializer,_t.Pool,_t.Thread;const rs=_t.Transfer;_t.Worker;const ss=Oe.expose;Oe.registerSerializer,Oe.Transfer;/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const En="148",W=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let xn=1234567;const Mn=Math.PI/180,wn=180/Math.PI;function is(){const r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(W[r&255]+W[r>>8&255]+W[r>>16&255]+W[r>>24&255]+"-"+W[t&255]+W[t>>8&255]+"-"+W[t>>16&15|64]+W[t>>24&255]+"-"+W[e&63|128]+W[e>>8&255]+"-"+W[e>>16&255]+W[e>>24&255]+W[n&255]+W[n>>8&255]+W[n>>16&255]+W[n>>24&255]).toLowerCase()}function Re(r,t,e){return Math.max(t,Math.min(e,r))}function Sn(r,t){return(r%t+t)%t}function os(r,t,e,n,s){return n+(r-t)*(s-n)/(e-t)}function as(r,t,e){return r!==t?(e-r)/(t-r):0}function Tn(r,t,e){return(1-e)*r+e*t}function cs(r,t,e,n){return Tn(r,t,1-Math.exp(-e*n))}function us(r,t=1){return t-Math.abs(Sn(r,t*2)-t)}function ls(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*(3-2*r))}function hs(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*r*(r*(r*6-15)+10))}function fs(r,t){return r+Math.floor(Math.random()*(t-r+1))}function ds(r,t){return r+Math.random()*(t-r)}function ms(r){return r*(.5-Math.random())}function ps(r){r!==void 0&&(xn=r);let t=xn+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function ys(r){return r*Mn}function _s(r){return r*wn}function gs(r){return(r&r-1)===0&&r!==0}function bs(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Es(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function xs(r,t,e,n,s){const i=Math.cos,a=Math.sin,u=i(e/2),h=a(e/2),l=i((t+n)/2),o=a((t+n)/2),c=i((t-n)/2),f=a((t-n)/2),d=i((n-t)/2),y=a((n-t)/2);switch(s){case"XYX":r.set(u*o,h*c,h*f,u*l);break;case"YZY":r.set(h*f,u*o,h*c,u*l);break;case"ZXZ":r.set(h*c,h*f,u*o,u*l);break;case"XZX":r.set(u*o,h*y,h*d,u*l);break;case"YXY":r.set(h*d,u*o,h*y,u*l);break;case"ZYZ":r.set(h*y,h*d,u*o,u*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Ms(r,t){switch(t.constructor){case Float32Array:return r;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function ws(r,t){switch(t.constructor){case Float32Array:return r;case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}var Pe=Object.freeze({__proto__:null,DEG2RAD:Mn,RAD2DEG:wn,generateUUID:is,clamp:Re,euclideanModulo:Sn,mapLinear:os,inverseLerp:as,lerp:Tn,damp:cs,pingpong:us,smoothstep:ls,smootherstep:hs,randInt:fs,randFloat:ds,randFloatSpread:ms,seededRandom:ps,degToRad:ys,radToDeg:_s,isPowerOfTwo:gs,ceilPowerOfTwo:bs,floorPowerOfTwo:Es,setQuaternionFromProperEuler:xs,normalize:ws,denormalize:Ms});class Ss{constructor(t=0,e=0,n=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=s}static slerpFlat(t,e,n,s,i,a,u){let h=n[s+0],l=n[s+1],o=n[s+2],c=n[s+3];const f=i[a+0],d=i[a+1],y=i[a+2],T=i[a+3];if(u===0){t[e+0]=h,t[e+1]=l,t[e+2]=o,t[e+3]=c;return}if(u===1){t[e+0]=f,t[e+1]=d,t[e+2]=y,t[e+3]=T;return}if(c!==T||h!==f||l!==d||o!==y){let w=1-u;const E=h*f+l*d+o*y+c*T,b=E>=0?1:-1,g=1-E*E;if(g>Number.EPSILON){const x=Math.sqrt(g),_=Math.atan2(x,E*b);w=Math.sin(w*_)/x,u=Math.sin(u*_)/x}const S=u*b;if(h=h*w+f*S,l=l*w+d*S,o=o*w+y*S,c=c*w+T*S,w===1-u){const x=1/Math.sqrt(h*h+l*l+o*o+c*c);h*=x,l*=x,o*=x,c*=x}}t[e]=h,t[e+1]=l,t[e+2]=o,t[e+3]=c}static multiplyQuaternionsFlat(t,e,n,s,i,a){const u=n[s],h=n[s+1],l=n[s+2],o=n[s+3],c=i[a],f=i[a+1],d=i[a+2],y=i[a+3];return t[e]=u*y+o*c+h*d-l*f,t[e+1]=h*y+o*f+l*c-u*d,t[e+2]=l*y+o*d+u*f-h*c,t[e+3]=o*y-u*c-h*f-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,s){return this._x=t,this._y=e,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const n=t._x,s=t._y,i=t._z,a=t._order,u=Math.cos,h=Math.sin,l=u(n/2),o=u(s/2),c=u(i/2),f=h(n/2),d=h(s/2),y=h(i/2);switch(a){case"XYZ":this._x=f*o*c+l*d*y,this._y=l*d*c-f*o*y,this._z=l*o*y+f*d*c,this._w=l*o*c-f*d*y;break;case"YXZ":this._x=f*o*c+l*d*y,this._y=l*d*c-f*o*y,this._z=l*o*y-f*d*c,this._w=l*o*c+f*d*y;break;case"ZXY":this._x=f*o*c-l*d*y,this._y=l*d*c+f*o*y,this._z=l*o*y+f*d*c,this._w=l*o*c-f*d*y;break;case"ZYX":this._x=f*o*c-l*d*y,this._y=l*d*c+f*o*y,this._z=l*o*y-f*d*c,this._w=l*o*c+f*d*y;break;case"YZX":this._x=f*o*c+l*d*y,this._y=l*d*c+f*o*y,this._z=l*o*y-f*d*c,this._w=l*o*c-f*d*y;break;case"XZY":this._x=f*o*c-l*d*y,this._y=l*d*c-f*o*y,this._z=l*o*y+f*d*c,this._w=l*o*c+f*d*y;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,s=Math.sin(n);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],s=e[4],i=e[8],a=e[1],u=e[5],h=e[9],l=e[2],o=e[6],c=e[10],f=n+u+c;if(f>0){const d=.5/Math.sqrt(f+1);this._w=.25/d,this._x=(o-h)*d,this._y=(i-l)*d,this._z=(a-s)*d}else if(n>u&&n>c){const d=2*Math.sqrt(1+n-u-c);this._w=(o-h)/d,this._x=.25*d,this._y=(s+a)/d,this._z=(i+l)/d}else if(u>c){const d=2*Math.sqrt(1+u-n-c);this._w=(i-l)/d,this._x=(s+a)/d,this._y=.25*d,this._z=(h+o)/d}else{const d=2*Math.sqrt(1+c-n-u);this._w=(a-s)/d,this._x=(i+l)/d,this._y=(h+o)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Re(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(n===0)return this;const s=Math.min(1,e/n);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,s=t._y,i=t._z,a=t._w,u=e._x,h=e._y,l=e._z,o=e._w;return this._x=n*o+a*u+s*l-i*h,this._y=s*o+a*h+i*u-n*l,this._z=i*o+a*l+n*h-s*u,this._w=a*o-n*u-s*h-i*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const n=this._x,s=this._y,i=this._z,a=this._w;let u=a*t._w+n*t._x+s*t._y+i*t._z;if(u<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,u=-u):this.copy(t),u>=1)return this._w=a,this._x=n,this._y=s,this._z=i,this;const h=1-u*u;if(h<=Number.EPSILON){const d=1-e;return this._w=d*a+e*this._w,this._x=d*n+e*this._x,this._y=d*s+e*this._y,this._z=d*i+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(h),o=Math.atan2(l,u),c=Math.sin((1-e)*o)/l,f=Math.sin(e*o)/l;return this._w=a*c+this._w*f,this._x=n*c+this._x*f,this._y=s*c+this._y*f,this._z=i*c+this._z*f,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),s=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(e*Math.cos(s),n*Math.sin(i),n*Math.cos(i),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class P{constructor(t=0,e=0,n=0){P.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(In.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(In.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,s=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*s,this.y=i[1]*e+i[4]*n+i[7]*s,this.z=i[2]*e+i[5]*n+i[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,s=this.z,i=t.elements,a=1/(i[3]*e+i[7]*n+i[11]*s+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*s+i[12])*a,this.y=(i[1]*e+i[5]*n+i[9]*s+i[13])*a,this.z=(i[2]*e+i[6]*n+i[10]*s+i[14])*a,this}applyQuaternion(t){const e=this.x,n=this.y,s=this.z,i=t.x,a=t.y,u=t.z,h=t.w,l=h*e+a*s-u*n,o=h*n+u*e-i*s,c=h*s+i*n-a*e,f=-i*e-a*n-u*s;return this.x=l*h+f*-i+o*-u-c*-a,this.y=o*h+f*-a+c*-i-l*-u,this.z=c*h+f*-u+l*-a-o*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,s=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*s,this.y=i[1]*e+i[5]*n+i[9]*s,this.z=i[2]*e+i[6]*n+i[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,s=t.y,i=t.z,a=e.x,u=e.y,h=e.z;return this.x=s*h-i*u,this.y=i*a-n*h,this.z=n*u-s*a,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Le.copy(this).projectOnVector(t),this.sub(Le)}reflect(t){return this.sub(Le.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Re(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,s=this.z-t.z;return e*e+n*n+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const s=Math.sin(e)*t;return this.x=s*Math.sin(n),this.y=Math.cos(e)*t,this.z=s*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Le=new P,In=new Ss;class An{constructor(t=new P(1/0,1/0,1/0),e=new P(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,s=1/0,i=-1/0,a=-1/0,u=-1/0;for(let h=0,l=t.length;h<l;h+=3){const o=t[h],c=t[h+1],f=t[h+2];o<e&&(e=o),c<n&&(n=c),f<s&&(s=f),o>i&&(i=o),c>a&&(a=c),f>u&&(u=f)}return this.min.set(e,n,s),this.max.set(i,a,u),this}setFromBufferAttribute(t){let e=1/0,n=1/0,s=1/0,i=-1/0,a=-1/0,u=-1/0;for(let h=0,l=t.count;h<l;h++){const o=t.getX(h),c=t.getY(h),f=t.getZ(h);o<e&&(e=o),c<n&&(n=c),f<s&&(s=f),o>i&&(i=o),c>a&&(a=c),f>u&&(u=f)}return this.min.set(e,n,s),this.max.set(i,a,u),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=vt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(n!==void 0)if(e&&n.attributes!=null&&n.attributes.position!==void 0){const i=n.attributes.position;for(let a=0,u=i.count;a<u;a++)vt.fromBufferAttribute(i,a).applyMatrix4(t.matrixWorld),this.expandByPoint(vt)}else n.boundingBox===null&&n.computeBoundingBox(),De.copy(n.boundingBox),De.applyMatrix4(t.matrixWorld),this.union(De);const s=t.children;for(let i=0,a=s.length;i<a;i++)this.expandByObject(s[i],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,vt),vt.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Qt),me.subVectors(this.max,Qt),Gt.subVectors(t.a,Qt),Vt.subVectors(t.b,Qt),jt.subVectors(t.c,Qt),gt.subVectors(Vt,Gt),bt.subVectors(jt,Vt),zt.subVectors(Gt,jt);let e=[0,-gt.z,gt.y,0,-bt.z,bt.y,0,-zt.z,zt.y,gt.z,0,-gt.x,bt.z,0,-bt.x,zt.z,0,-zt.x,-gt.y,gt.x,0,-bt.y,bt.x,0,-zt.y,zt.x,0];return!Fe(e,Gt,Vt,jt,me)||(e=[1,0,0,0,1,0,0,0,1],!Fe(e,Gt,Vt,jt,me))?!1:(pe.crossVectors(gt,bt),e=[pe.x,pe.y,pe.z],Fe(e,Gt,Vt,jt,me))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return vt.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(vt).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(dt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),dt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),dt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),dt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),dt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),dt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),dt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),dt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(dt),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const dt=[new P,new P,new P,new P,new P,new P,new P,new P],vt=new P,De=new An,Gt=new P,Vt=new P,jt=new P,gt=new P,bt=new P,zt=new P,Qt=new P,me=new P,pe=new P,Ot=new P;function Fe(r,t,e,n,s){for(let i=0,a=r.length-3;i<=a;i+=3){Ot.fromArray(r,i);const u=s.x*Math.abs(Ot.x)+s.y*Math.abs(Ot.y)+s.z*Math.abs(Ot.z),h=t.dot(Ot),l=e.dot(Ot),o=n.dot(Ot);if(Math.max(-Math.max(h,l,o),Math.min(h,l,o))>u)return!1}return!0}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:En}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=En);const D=class{static getList(t){return t?t.split(",").map(e=>e.trim()):[]}static getBoolean(t,e){return t?t==="true":e}static getNumber(t){return parseFloat(t)}static getOptionalNumber(t){if(t)return parseFloat(t)}};let v=D;p(v,"LOG_LEVELS",D.getList({}.VITE_LOG_LEVELS)),p(v,"LOG_KEYS",D.getList({}.VITE_LOG_KEYS)),p(v,"JUMP_START",D.getBoolean({}.VITE_JUMP_START,!0)),p(v,"FOG_ENABLED",D.getBoolean({}.VITE_FOG_ENABLED,!0)),p(v,"EDITING_ENABLED",D.getBoolean({}.VITE_EDITING_ENABLED,!0)),p(v,"SHOW_INITIAL_TERRAIN_GENERATION",D.getBoolean({}.VITE_SHOW_INITIAL_TERRAIN_GENERATION,!1)),p(v,"SHOW_DEBUG_INFO",D.getBoolean({}.VITE_SHOW_DEBUG_UI,!1)),p(v,"SHOW_WINDOW_CLOSE_ALERT",D.getBoolean({}.VITE_SHOW_WINDOW_CLOSE_ALERT,!0)),p(v,"PLAYER_DEFAULT_PHYSICS_MODE",{}.VITE_PLAYER_DEFAULT_PHYSICS_MODE),p(v,"PLAYER_SHOW_BOUNDING_BOX",D.getBoolean({}.VITE_PLAYER_SHOW_BOUNDING_BOX,!1)),p(v,"CHUNK_WIDTH",D.getNumber({}.VITE_TERRAIN_CHUNK_WIDTH||20)),p(v,"CHUNK_HEIGHT",D.getNumber({}.VITE_TERRAIN_CHUNK_HEIGHT||6)),p(v,"CUSTOM_SEED",{}.VITE_CUSTOM_SEED||"map2"),p(v,"TERRAIN_GENERATION_ENABLED",D.getBoolean({}.VITE_TERRAIN_GENERATION_ENABLED,!0)),p(v,"TERRAIN_OPTIMIZATION_ENABLED",D.getBoolean({}.VITE_TERRAIN_OPTIMIZATION_ENABLED,!0)),p(v,"TREE_GENERATION_ENABLED",D.getBoolean({}.VITE_TREE_GENERATION_ENABLED,!0)),p(v,"DEFAULT_HORIZONTAL_RENDER_DISTANCE_IN_CHUNKS",D.getNumber({}.VITE_DEFAULT_HORIZONTAL_RENDER_DISTANCE_IN_CHUNKS)),p(v,"TOP_RENDER_DISTANCE_IN_CHUNKS",D.getNumber({}.VITE_TOP_RENDER_DISTANCE_IN_CHUNKS||8)),p(v,"BOTTOM_RENDER_DISTANCE_IN_CHUNKS",D.getNumber({}.VITE_BOTTOM_RENDER_DISTANCE_IN_CHUNKS||4)),p(v,"TESTING_MAP_ENABLED",D.getBoolean({}.VITE_TESTING_MAP_ENABLED,!1)),p(v,"TESTING_MAP_EROSION",D.getOptionalNumber({}.VITE_TESTING_MAP_EROSION)),p(v,"TESTING_MAP_CONTINENTALNESS",D.getOptionalNumber({}.VITE_TESTING_MAP_CONTINENTALNESS)),p(v,"TESTING_MAP_PV",D.getOptionalNumber({}.VITE_TESTING_MAP_PV)),p(v,"STARTING_INVENTORY_ITEMS",D.getList({}.VITE_STARTING_INVENTORY_ITEMS).map(t=>Number(t))),p(v,"STARTING_HOTBAR_ITEMS",D.getList({}.VITE_STARTING_HOTBAR_ITEMS).map(t=>Number(t)));const Ue=class{static debug(t,...e){}static info(t,...e){}static warn(t){}static error(t){}static shouldLog(t,...e){const n=Ue.LOG_LEVELS.includes(t);return e.some(i=>this.LOG_KEYS.includes(i))&&n}};let j=Ue;p(j,"LOG_LEVELS",v.LOG_LEVELS??["silent"]),p(j,"LOG_KEYS",v.LOG_KEYS),p(j,"GAME_LOOP_KEY","gameloop"),p(j,"SCENE_KEY","scene"),p(j,"AUDIO_KEY","audio"),p(j,"DATA_KEY","data"),p(j,"INPUT_KEY","input"),p(j,"MAP_KEY","map"),p(j,"COLLISION_KEY","collision"),p(j,"PLAYER_KEY","player"),p(j,"TERRAIN_KEY","terrain"),p(j,"CHUNK_KEY","chunk"),p(j,"INIT_KEY","init"),p(j,"LOADING_KEY","load"),p(j,"DISPOSE_KEY","dispose");const Rt={left:[-1,0,0],right:[1,0,0],top:[0,1,0],bottom:[0,-1,0],front:[0,0,1],back:[0,0,-1]},Cn={left:{normal:Rt.left,vertices:[{pos:[0,1,0],uv:[0,1],ao:{corner:[-.5,-.5,.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}},{pos:[0,0,0],uv:[0,0],ao:{corner:[-.5,-.5,.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}},{pos:[0,1,1],uv:[1,1],ao:{corner:[-.5,.5,-.5],side1:[-.5,.5,.5],side2:[-.5,-.5,.5]}},{pos:[0,0,1],uv:[1,0],ao:{corner:[-.5,-.5,-.5],side1:[-.5,.5,.5],side2:[-.5,-.5,.5]}}]},right:{normal:Rt.right,vertices:[{pos:[1,1,1],uv:[0,1],ao:{corner:[.5,.5,-.5],side1:[.5,.5,.5],side2:[.5,-.5,.5]}},{pos:[1,0,1],uv:[0,0],ao:{corner:[.5,-.5,-.5],side1:[.5,.5,.5],side2:[.5,-.5,.5]}},{pos:[1,1,0],uv:[1,1],ao:{corner:[.5,.5,.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}},{pos:[1,0,0],uv:[1,0],ao:{corner:[.5,-.5,.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}}]},top:{normal:Rt.top,vertices:[{pos:[0,1,1],uv:[1,1],ao:{corner:[-.5,.5,.5],side1:[.5,.5,.5],side2:[-.5,.5,-.5]}},{pos:[1,1,1],uv:[0,1],ao:{corner:[.5,.5,.5],side1:[-.5,.5,.5],side2:[.5,.5,-.5]}},{pos:[0,1,0],uv:[1,0],ao:{corner:[-.5,.5,-.5],side1:[.5,.5,-.5],side2:[-.5,.5,.5]}},{pos:[1,1,0],uv:[0,0],ao:{corner:[.5,.5,-.5],side1:[-.5,.5,-.5],side2:[.5,.5,.5]}}]},bottom:{normal:Rt.bottom,vertices:[{pos:[1,0,1],uv:[1,0],ao:{corner:[.5,-.5,.5],side1:[-.5,-.5,.5],side2:[.5,-.5,-.5]}},{pos:[0,0,1],uv:[0,0],ao:{corner:[-.5,-.5,.5],side1:[.5,-.5,.5],side2:[-.5,-.5,.5]}},{pos:[1,0,0],uv:[1,1],ao:{corner:[.5,-.5,-.5],side1:[.5,-.5,.5],side2:[-.5,-.5,-.5]}},{pos:[0,0,0],uv:[0,1],ao:{corner:[-.5,-.5,-.5],side1:[.5,-.5,-.5],side2:[-.5,-.5,.5]}}]},front:{normal:Rt.front,vertices:[{pos:[0,0,1],uv:[0,0],ao:{corner:[.5,-.5,.5],side1:[-.5,.5,.5],side2:[-.5,-.5,.5]}},{pos:[1,0,1],uv:[1,0],ao:{corner:[-.5,-.5,.5],side1:[.5,.5,.5],side2:[.5,-.5,.5]}},{pos:[0,1,1],uv:[0,1],ao:{corner:[.5,.5,.5],side1:[-.5,-.5,.5],side2:[-.5,.5,.5]}},{pos:[1,1,1],uv:[1,1],ao:{corner:[-.5,.5,.5],side1:[.5,-.5,.5],side2:[.5,.5,.5]}}]},back:{normal:Rt.back,vertices:[{pos:[1,0,0],uv:[0,0],ao:{corner:[-.5,-.5,-.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}},{pos:[0,0,0],uv:[1,0],ao:{corner:[.5,-.5,-.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}},{pos:[1,1,0],uv:[0,1],ao:{corner:[-.5,.5,-.5],side1:[.5,.5,-.5],side2:[.5,-.5,-.5]}},{pos:[0,1,0],uv:[1,1],ao:{corner:[.5,.5,-.5],side1:[-.5,.5,-.5],side2:[-.5,-.5,-.5]}}]}},Nn=16,Ts=128,Is=128;var B=(r=>(r[r.AIR=0]="AIR",r[r.CLOUD=1]="CLOUD",r[r.STONE=2]="STONE",r[r.COBBLESTONE=3]="COBBLESTONE",r[r.DIRT=4]="DIRT",r[r.GRASS=5]="GRASS",r[r.GRASS_SNOW=6]="GRASS_SNOW",r[r.WATER=7]="WATER",r[r.SAND=8]="SAND",r[r.GLASS=9]="GLASS",r[r.OAK_LOG=10]="OAK_LOG",r[r.OAK_LEAVES=11]="OAK_LEAVES",r[r.PLANKS=12]="PLANKS",r[r.COAL_ORE=13]="COAL_ORE",r))(B||{});const ye={[0]:{name:"_air",isTransparent:!0,isSolid:!1,icon:{row:-1,col:-1},texture:{top:{row:-1,col:-1},bottom:{row:-1,col:-1},side:{row:-1,col:-1}}},[1]:{name:"cloud",isTransparent:!0,isSolid:!1,icon:{row:-1,col:-1},texture:{top:{row:2,col:5},bottom:{row:2,col:5},side:{row:2,col:5}},color:[1,1,1,.4]},[2]:{name:"Stone",isTransparent:!1,isSolid:!0,drop:3,icon:{row:18,col:12},texture:{top:{row:0,col:5},bottom:{row:0,col:5},side:{row:0,col:5}}},[3]:{name:"Cobblestone",isTransparent:!1,isSolid:!0,drop:3,icon:{row:8,col:31},texture:{top:{row:0,col:4},bottom:{row:0,col:4},side:{row:0,col:4}}},[5]:{name:"Grass",isTransparent:!1,isSolid:!0,drop:4,icon:{row:16,col:27},texture:{top:{row:0,col:1},bottom:{row:0,col:2},side:{row:0,col:0}}},[6]:{name:"Snow",isTransparent:!1,isSolid:!0,drop:4,icon:{row:13,col:18},texture:{top:{row:2,col:5},bottom:{row:0,col:2},side:{row:2,col:4}}},[4]:{name:"Dirt",isTransparent:!1,isSolid:!0,drop:4,icon:{row:13,col:18},texture:{top:{row:0,col:2},bottom:{row:0,col:2},side:{row:0,col:2}}},[10]:{name:"Oak_Log",isTransparent:!1,isSolid:!0,drop:10,icon:{row:25,col:9},texture:{top:{row:1,col:2},bottom:{row:1,col:2},side:{row:1,col:3}}},[11]:{name:"Oak_Leaves",isTransparent:!0,isSolid:!0,icon:{row:25,col:8},texture:{top:{row:1,col:5},bottom:{row:1,col:5},side:{row:1,col:5}}},[12]:{name:"Planks",isTransparent:!1,isSolid:!0,drop:12,icon:{row:25,col:10},texture:{top:{row:1,col:4},bottom:{row:1,col:4},side:{row:1,col:4}}},[8]:{name:"Sand",isTransparent:!1,isSolid:!0,drop:8,icon:{row:32,col:6},texture:{top:{row:1,col:6},bottom:{row:1,col:6},side:{row:1,col:6}}},[7]:{name:"Water",isTransparent:!0,isSolid:!1,icon:{row:37,col:28},texture:{side:{row:1,col:7},top:{row:1,col:7},bottom:{row:1,col:7}}},[9]:{name:"Glass",isTransparent:!0,isSolid:!0,icon:{row:15,col:26},texture:{side:{row:2,col:0},top:{row:2,col:0},bottom:{row:2,col:0}}},[13]:{name:"Coal_Ore",isTransparent:!1,isSolid:!0,drop:13,icon:{row:8,col:25},texture:{side:{row:0,col:6},top:{row:0,col:6},bottom:{row:0,col:6}}}},As={top:"top",bottom:"bottom",left:"side",right:"side",front:"side",back:"side"},Cs=[[0,0,0],[0,1,0],[0,-1,0],[-1,0,0],[-1,1,0],[-1,-1,0],[1,0,0],[1,1,0],[1,-1,0],[0,0,1],[0,1,1],[0,-1,1],[-1,0,1],[-1,1,1],[-1,-1,1],[1,0,1],[1,1,1],[1,-1,1],[0,0,-1],[0,1,-1],[0,-1,-1],[-1,0,-1],[-1,1,-1],[-1,-1,-1],[1,0,-1],[1,1,-1],[1,-1,-1]],pt=class{static isVisibleBlock(t){return t!=null&&t!==B.AIR}static getBlockFaces(){return Object.keys(Cn)}static getBlockFaceGeometry(t){return Cn[t]}static getNeighbourBlockOffsets(){return Cs}static getBlockMetadata(t){return ye[t]}static getBlockColor(t){return ye[t].color}static getBlockUVCoordinates(t,e,[n,s]){const i=As[e],{row:a,col:u}=ye[t].texture[i];return{u:(u+n)*Nn/Ts,v:1-(a+1-s)*Nn/Is}}static getBlockFaceFromNormal(t){for(const[e,n]of Object.entries(Rt))if(new P().fromArray(n).equals(t))return e;return null}static getBlockBoundingBoxFromPosition(t){return pt.getBlockBoundingBox(pt.getBlockOriginFromPosition(t))}static getBlockBoundingBox(t){return new An(t,t.clone().addScalar(pt.SIZE))}static getBlockOriginFromPosition(t){return new P(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}static toBlockCenterCoord(t){return Math.floor(t/pt.SIZE)*pt.SIZE+pt.SIZE/2}static getBlockNormalFromPosition(t,e){const n=new P(t.x+.5,t.y+.5,t.z+.5),s=Math.abs(e.x-n.x),i=Math.abs(e.y-n.y),a=Math.abs(e.z-n.z),u=new P;return s>i&&s>a?u.set(e.x>n.x?1:-1,0,0):i>a?u.set(0,e.y>n.y?1:-1,0):u.set(0,0,e.z>n.z?1:-1),u}static raycast(t,e,n){let s=e.x-t.x,i=e.y-t.y,a=e.z-t.z;const u=s*s+i*i+a*a,h=Math.sqrt(u);s/=h,i/=h,a/=h;let l=0,o=Math.floor(t.x),c=Math.floor(t.y),f=Math.floor(t.z);const d=s>0?1:-1,y=i>0?1:-1,T=a>0?1:-1,w=Math.abs(1/s),E=Math.abs(1/i),b=Math.abs(1/a),g=d>0?o+1-t.x:t.x-o,S=y>0?c+1-t.y:t.y-c,x=T>0?f+1-t.z:t.z-f;let _=w<1/0?w*g:1/0,A=E<1/0?E*S:1/0,k=b<1/0?b*x:1/0,m=-1;for(;l<=h;){const M=n.getBlock({x:o,y:c,z:f});if(pt.isVisibleBlock(M==null?void 0:M.type))return{position:[t.x+l*s,t.y+l*i,t.z+l*a],normal:[m===0?-d:0,m===1?-y:0,m===2?-T:0],block:M};const N=Math.min(_,A,k);N===_?(o+=d,l=_,_+=w,m=0):N===A?(c+=y,l=A,A+=E,m=1):(f+=T,l=k,k+=b,m=2)}return null}};let Et=pt;p(Et,"SIZE",1);const F=class{constructor(t,e){p(this,"chunkId");p(this,"worldOriginPosition");p(this,"blocks");p(this,"isDirt");this.chunkId=t,this.worldOriginPosition=F.getChunkOriginPosition(t),this.isDirt=!1,this.blocks=e??new Uint8Array(F.HEIGHT*F.WIDTH*F.WIDTH)}getBlock(t){if(!this.isBlockInChunk(t))return null;const e=this.computeBlockIndex(t),n=this.blocks[e];return{type:n,...ye[n]}}setBlock(t,e){if(!this.isBlockInChunk(t))return;const n=this.computeBlockIndex(t);this.blocks[n]=e}isBlockInChunk(t){return F.getChunkIdFromPosition(t)===this.chunkId}decorateChunk(t){const{x:e,y:n,z:s}=this.getWorldOriginPosition(),i=e+F.WIDTH,a=n+F.HEIGHT,u=s+F.WIDTH,h=new Map;for(let l=n;l<a;l++)for(let o=s;o<u;o++)for(let c=e;c<i;c++){const f={x:c,y:l,z:o},d=t.generateBlock(c,l,o);d&&this.setBlock(f,d)}h.forEach((l,o)=>{for(let c=18;c<=l.y;c++)this.setBlock({x:l.x,y:c,z:l.z},B.OAK_LOG)})}computeBlockIndex({x:t,y:e,z:n}){const[s,i,a]=this.getBlockLocalCoordinates(t,e,n);return i*F.WIDTH*F.WIDTH+a*F.WIDTH+s}getBlockLocalCoordinates(t,e,n){const s=Pe.euclideanModulo(t,F.WIDTH)|0,i=Pe.euclideanModulo(e,F.HEIGHT)|0,a=Pe.euclideanModulo(n,F.WIDTH)|0;return[s,i,a]}static buildChunkId({x:t,y:e,z:n}){return`${t},${e},${n}`}static chunkIdAsCoordinate(t){const e=t.match(/^([^,]+),([^,]+),(.+)$/);if(!e)throw new Error("Invalid chunkId");const[n,s,i,a]=e;return{x:Number(s),y:Number(i),z:Number(a)}}static getChunkIdFromPosition({x:t,y:e,z:n}){const s=Math.floor(t/F.WIDTH),i=Math.floor(e/F.HEIGHT),a=Math.floor(n/F.WIDTH);return F.buildChunkId({x:s,y:i,z:a})}static getChunkOriginPosition(t){const{x:e,y:n,z:s}=F.chunkIdAsCoordinate(t),i=e*F.WIDTH,a=n*F.HEIGHT,u=s*F.WIDTH;return{x:i,y:a,z:u}}markAsDirt(){this.isDirt=!0}isDirty(){return this.isDirt}getId(){return this.chunkId}getWorldOriginPosition(){return this.worldOriginPosition}getBlocks(){return this.blocks}_debug(){j.debug(JSON.stringify(this.blocks),j.TERRAIN_KEY)}};let ot=F;p(ot,"WIDTH",v.CHUNK_WIDTH),p(ot,"HEIGHT",v.CHUNK_HEIGHT);const We=class{};let mt=We;p(mt,"RADIUS",2),p(mt,"TRUNK_HEIGHT",2),p(mt,"MAX_HEIGHT",We.TRUNK_HEIGHT+2);class nt{constructor(t){p(this,"seed");this.seed=t}getSeed(){return this.seed}}p(nt,"getContinentalMapSeed",t=>t+"_continental"),p(nt,"getErosionMapSeed",t=>t+"_erosion"),p(nt,"getPvMapSeed",t=>t+"_pv"),p(nt,"getHeightMapSeed",t=>t+"_height"),p(nt,"getDensityMapSeed",t=>t+"_density"),p(nt,"getTreeMapSeed",t=>t+"_tree");const st=class{static generateSeed(){return Math.random().toString(36).substring(2,15)}};let C=st;p(C,"ORIGIN",new P(0,0,0)),p(C,"CONTINENTALNESS_NOISE_SCALE",2500),p(C,"EROSION_NOISE_SCALE",1024),p(C,"PV_BASE_SCALE",180),p(C,"DENSITY_NOISE_SCALE",12),p(C,"MAX_WORLD_HEIGHT",v.TOP_RENDER_DISTANCE_IN_CHUNKS*v.CHUNK_HEIGHT),p(C,"MIN_WORLD_HEIGHT",v.BOTTOM_RENDER_DISTANCE_IN_CHUNKS*-v.CHUNK_HEIGHT),p(C,"MIN_EROSION",0),p(C,"MAX_EROSION",8),p(C,"MIN_CONTINENTALNESS_HEIGHT",0),p(C,"MAX_CONTINENTALNESS_HEIGHT",25),p(C,"MIN_DENSITY_HEIGHT",st.MIN_CONTINENTALNESS_HEIGHT-40),p(C,"MAX_DENSITY_HEIGHT",st.MAX_WORLD_HEIGHT),p(C,"LARGE_CAVES_HEIGHT",0),p(C,"MAX_SURFACE_HEIGHT",st.MAX_CONTINENTALNESS_HEIGHT+st.MAX_EROSION),p(C,"MIN_SURFACE_HEIGHT",st.MIN_CONTINENTALNESS_HEIGHT-st.MAX_EROSION),p(C,"CLOUD_LEVEL",st.MAX_SURFACE_HEIGHT-25),p(C,"SNOW_LEVEL",st.MAX_CONTINENTALNESS_HEIGHT),p(C,"SEA_LEVEL",st.MIN_CONTINENTALNESS_HEIGHT+15),p(C,"SAND_LEVEL",st.SEA_LEVEL+6),p(C,"BEDROCK_LEVEL",0),p(C,"CLOUD_WIDTH",10),p(C,"CLOUD_DEPTH",5);const Ns=.5*(Math.sqrt(3)-1),Jt=(3-Math.sqrt(3))/6,ks=1/3,at=1/6,te=r=>Math.floor(r)|0,kn=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),He=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function vs(r=Math.random){const t=vn(r),e=new Float64Array(t).map(s=>kn[s%12*2]),n=new Float64Array(t).map(s=>kn[s%12*2+1]);return function(i,a){let u=0,h=0,l=0;const o=(i+a)*Ns,c=te(i+o),f=te(a+o),d=(c+f)*Jt,y=c-d,T=f-d,w=i-y,E=a-T;let b,g;w>E?(b=1,g=0):(b=0,g=1);const S=w-b+Jt,x=E-g+Jt,_=w-1+2*Jt,A=E-1+2*Jt,k=c&255,m=f&255;let M=.5-w*w-E*E;if(M>=0){const z=k+t[m],O=e[z],R=n[z];M*=M,u=M*M*(O*w+R*E)}let I=.5-S*S-x*x;if(I>=0){const z=k+b+t[m+g],O=e[z],R=n[z];I*=I,h=I*I*(O*S+R*x)}let N=.5-_*_-A*A;if(N>=0){const z=k+1+t[m+1],O=e[z],R=n[z];N*=N,l=N*N*(O*_+R*A)}return 70*(u+h+l)}}function zs(r=Math.random){const t=vn(r),e=new Float64Array(t).map(i=>He[i%12*3]),n=new Float64Array(t).map(i=>He[i%12*3+1]),s=new Float64Array(t).map(i=>He[i%12*3+2]);return function(a,u,h){let l,o,c,f;const d=(a+u+h)*ks,y=te(a+d),T=te(u+d),w=te(h+d),E=(y+T+w)*at,b=y-E,g=T-E,S=w-E,x=a-b,_=u-g,A=h-S;let k,m,M,I,N,z;x>=_?_>=A?(k=1,m=0,M=0,I=1,N=1,z=0):x>=A?(k=1,m=0,M=0,I=1,N=0,z=1):(k=0,m=0,M=1,I=1,N=0,z=1):_<A?(k=0,m=0,M=1,I=0,N=1,z=1):x<A?(k=0,m=1,M=0,I=0,N=1,z=1):(k=0,m=1,M=0,I=1,N=1,z=0);const O=x-k+at,R=_-m+at,G=A-M+at,V=x-I+2*at,J=_-N+2*at,U=A-z+2*at,Y=x-1+3*at,St=_-1+3*at,Tt=A-1+3*at,X=y&255,$=T&255,ct=w&255;let ut=.6-x*x-_*_-A*A;if(ut<0)l=0;else{const H=X+t[$+t[ct]];ut*=ut,l=ut*ut*(e[H]*x+n[H]*_+s[H]*A)}let yt=.6-O*O-R*R-G*G;if(yt<0)o=0;else{const H=X+k+t[$+m+t[ct+M]];yt*=yt,o=yt*yt*(e[H]*O+n[H]*R+s[H]*G)}let lt=.6-V*V-J*J-U*U;if(lt<0)c=0;else{const H=X+I+t[$+N+t[ct+z]];lt*=lt,c=lt*lt*(e[H]*V+n[H]*J+s[H]*U)}let Z=.6-Y*Y-St*St-Tt*Tt;if(Z<0)f=0;else{const H=X+1+t[$+1+t[ct+1]];Z*=Z,f=Z*Z*(e[H]*Y+n[H]*St+s[H]*Tt)}return 32*(l+o+c+f)}}function vn(r){const e=new Uint8Array(512);for(let n=0;n<512/2;n++)e[n]=n;for(let n=0;n<512/2-1;n++){const s=n+~~(r()*(256-n)),i=e[n];e[n]=e[s],e[s]=i}for(let n=256;n<512;n++)e[n]=e[n-256];return e}var Be={},Os={get exports(){return Be},set exports(r){Be=r}};(function(r,t){(function(e,n){r.exports=n()})(L,function(){return e.importState=function(s){var i=new e;return i.importState(s),i},e;function e(){return function(s){var i=0,a=0,u=0,h=1;s.length==0&&(s=[+new Date]);var l=n();i=l(" "),a=l(" "),u=l(" ");for(var o=0;o<s.length;o++)i-=l(s[o]),i<0&&(i+=1),a-=l(s[o]),a<0&&(a+=1),u-=l(s[o]),u<0&&(u+=1);l=null;var c=function(){var f=2091639*i+h*23283064365386963e-26;return i=a,a=u,u=f-(h=f|0)};return c.next=c,c.uint32=function(){return c()*4294967296},c.fract53=function(){return c()+(c()*2097152|0)*11102230246251565e-32},c.version="Alea 0.9",c.args=s,c.exportState=function(){return[i,a,u,h]},c.importState=function(f){i=+f[0]||0,a=+f[1]||0,u=+f[2]||0,h=+f[3]||0},c}(Array.prototype.slice.call(arguments))}function n(){var s=4022871197,i=function(a){a=a.toString();for(var u=0;u<a.length;u++){s+=a.charCodeAt(u);var h=.02519603282416938*s;s=h>>>0,h-=s,h*=s,s=h>>>0,h-=s,s+=h*4294967296}return(s>>>0)*23283064365386963e-26};return i.version="Mash 0.9",i}})})(Os);class Ge{constructor(t){p(this,"seed");p(this,"prng");this.seed=t,this.prng=Be(t)}getSeed(){return this.seed}}class Ut extends Ge{constructor(e){super(e);p(this,"data");this.data=new Map}getMapData(){return this.data}setMapData(e){this.data=e}getPointData(e,n){const s=Ut.computeKey(e,n);return this.data.get(s)}setPointData(e,n,s){const i=Ut.computeKey(e,n);return this.data.set(i,s),s}static computeKey(e,n){return`${Math.floor(e)}_${Math.floor(n)}`}}class Ve extends Ut{constructor(e){super(e);p(this,"noise2D");this.noise2D=vs(this.prng)}}class q{}p(q,"ENABLED",v.TESTING_MAP_ENABLED),p(q,"CONTINENTALNESS",v.TESTING_MAP_CONTINENTALNESS),p(q,"EROSION",v.TESTING_MAP_EROSION),p(q,"PV",v.TESTING_MAP_PV);const Yt=class extends Ve{constructor(t){super(t)}setValueAt(t,e,n){return this.setPointData(t,e,n)}getValueAt(t,e){return this.getContinentalnessAt(t,e)}getContinentalnessAt(t,e){if(q.ENABLED&&q.CONTINENTALNESS!=null)return q.CONTINENTALNESS;const n=this.getPointData(t,e);if(n!=null)return n;const s=this.noise2D(t/C.CONTINENTALNESS_NOISE_SCALE,e/C.CONTINENTALNESS_NOISE_SCALE);return this.setPointData(t,e,s),s}static getType(t){return t<=Yt.NoiseRange.Ocean.max?"Ocean":t<=Yt.NoiseRange.Coast.max?"Coast":t<=Yt.NoiseRange.Near_Inland.max?"Near_Inland":t<=Yt.NoiseRange.Inland.max?"Inland":"Far_Inland"}};let rt=Yt;p(rt,"NoiseRange",{Ocean:{min:-1,max:-.7},Coast:{min:-.7,max:-.4},Near_Inland:{min:-.4,max:0},Inland:{min:0,max:.6},Far_Inland:{min:.6,max:1}});class _e extends Ge{constructor(e){super(e);p(this,"data");this.data=new Map}getMapData(){return this.data}setMapData(e){this.data=e}getPointData(e,n,s){const i=_e.computeKey(e,n,s);return this.data.get(i)}setPointData(e,n,s,i){const a=_e.computeKey(e,n,s);return this.data.set(a,i),i}static computeKey(e,n,s){return`${Math.floor(e)}_${Math.floor(n)}_${Math.floor(s)}`}}class Rs extends _e{constructor(e){super(e);p(this,"noise3D");this.noise3D=zs(this.prng)}}const wt=class extends Ve{constructor(t){super(t)}setValueAt(t,e,n){return this.setPointData(t,e,n)}getValueAt(t,e){return this.getErosionAt(t,e)}getErosionAt(t,e){if(q.ENABLED&&q.EROSION!=null)return q.EROSION;const n=this.getPointData(t,e);if(n!=null)return n;const s=this.noise2D(t/C.EROSION_NOISE_SCALE,e/C.EROSION_NOISE_SCALE);return this.setPointData(t,e,s),s}static getType(t){return t<=wt.NoiseRange.VeryLow.max?"VeryLow":t<=wt.NoiseRange.Low.max?"Low":t<=wt.NoiseRange.Mid.max?"Mid":t<=wt.NoiseRange.MidSpike.max?"MidSpike":t<=wt.NoiseRange.MidLow.max?"MidLow":t<=wt.NoiseRange.FlatSpike.max?"FlatSpike":"Flat"}};let xt=wt;p(xt,"NoiseRange",{VeryLow:{min:-1,max:-.5},Low:{min:-.5,max:-.1},Mid:{min:-.1,max:.3},MidSpike:{min:.3,max:.4},MidLow:{min:.4,max:.7},FlatSpike:{min:.7,max:.8},Flat:{min:.8,max:1}});const Pt=class extends Ve{constructor(t){super(t)}setValueAt(t,e,n){return this.setPointData(t,e,n)}getValueAt(t,e){return this.getPVAt(t,e)}getPVAt(t,e){if(q.ENABLED&&q.PV!=null)return q.PV;const n=this.getPointData(t,e);if(n!=null)return n;const s=4,i=.5,a=C.PV_BASE_SCALE;let u=0,h=0;for(let l=0;l<s;l++){const o=Math.pow(2,l),c=Math.pow(i,l);h+=c,u+=this.noise2D(t/a*o,e/a*o)*c}return u/=h,this.setPointData(t,e,u),u}static getType(t){return t<=Pt.NoiseRange.Valley.max?"Valley":t<=Pt.NoiseRange.Low.max?"Low":t<=Pt.NoiseRange.Plateau.max?"Plateau":t<=Pt.NoiseRange.Mid.max?"Mid":t<=Pt.NoiseRange.High.max?"High":"Peak"}};let Mt=Pt;p(Mt,"NoiseRange",{Valley:{min:-1,max:-.7},Low:{min:-.7,max:-.4},Plateau:{min:-.4,max:-.1},Mid:{min:-.1,max:.4},High:{min:.4,max:.8},Peak:{min:.8,max:1}});class Ps extends Rs{constructor(e,n,s){super(e);p(this,"SOLID",1);p(this,"AIR",-1);p(this,"erosionMap");p(this,"pvMap");this.erosionMap=n,this.pvMap=s}setValueAt(e,n,s,i){return this.setPointData(e,n,s,i)}getValueAt(e,n,s){return this.getDensityAt(e,n,s)}getDensityAt(e,n,s){const{AIR:i,SOLID:a}=this;if(n<C.MIN_DENSITY_HEIGHT)return a;if(n>C.MAX_DENSITY_HEIGHT)return i;const u=1,h=1;return this.noise3D(e/u,n/u,s/u)+h}getScaleFactorAt(e,n,s){return n<C.LARGE_CAVES_HEIGHT?256:36}getSquashingFactorAt(e,n,s){const i=this.erosionMap.getValueAt(e,s),a=this.pvMap.getValueAt(e,s),u=xt.getType(i),h=a>=Mt.NoiseRange.Mid.min;switch(u){case"VeryLow":return h?.6:.8;case"Low":return h?.8:.9;case"MidLow":return .9;default:return 1}}}function Q(r,t,e){return Math.round(r+(t-r)*e)}function Ls(r){return Math.random()<=r}function ge(r,t,e){return r>=t&&r<=e}class Ds extends Ut{constructor(e,n,s,i){super(e);p(this,"continentalMap");p(this,"erosionMap");p(this,"pvMap");this.continentalMap=n,this.erosionMap=s,this.pvMap=i}setValueAt(e,n,s){return this.setPointData(e,n,s)}getValueAt(e,n){return this.getSurfaceHeightAt(e,n)}getSurfaceHeightAt(e,n){const s=this.getPointData(e,n);if(s!=null)return s;const i=this.getContinentalness(e,n),a=this.getBaseHeight(i),u=this.getErosion(e,n),h=this.getErosionFactor(u),l=this.getPV(e,n),o=this.getPvHeight(l,h),c=a+o;return this.setPointData(e,n,c),c}getBaseHeight(e){const n=rt.getType(e);if(n==="Ocean")return C.MIN_CONTINENTALNESS_HEIGHT;if(n==="Coast"){const s=rt.NoiseRange.Coast.min,i=rt.NoiseRange.Coast.max,a=(e-s)/(i-s);return Q(C.SEA_LEVEL,C.SEA_LEVEL+2,a)}if(n==="Near_Inland"||n==="Inland"){const s=rt.NoiseRange.Near_Inland.min,i=rt.NoiseRange.Inland.max,a=(e-s)/(i-s);return Q(C.SEA_LEVEL+2,C.SEA_LEVEL+15,a)}if(n==="Far_Inland"){const s=rt.NoiseRange.Far_Inland.min,i=rt.NoiseRange.Far_Inland.max,a=(e-s)/(i-s);return Q(C.SEA_LEVEL+15,C.MAX_CONTINENTALNESS_HEIGHT,a)}return C.MAX_CONTINENTALNESS_HEIGHT}getErosionFactor(e){const n=C.MIN_EROSION,s=C.MAX_EROSION,i=Math.floor(s*(1/2)),a=n+6,u=a*2,h=u*2,l=xt.getType(e),{min:o,max:c}=xt.NoiseRange[l],f=(e-o)/(c-o),d=(c-e)/(c-o);switch(l){case"Flat":return Q(n,a,d);case"FlatSpike":return Q(a,i,d);case"MidLow":return i;case"MidSpike":return Q(a,i,f);case"Mid":return Q(a,u,d);case"Low":return Q(u,h,d);case"VeryLow":return Q(h,s,d)}}getPvHeight(e,n){const s=Math.round(-n*.6666666666666666),i=Math.round(-n/4),a=n,u=Math.round(a*(1/2)),h=Mt.getType(e),{min:l,max:o}=Mt.NoiseRange[h],c=(e-l)/(o-l);switch(h){case"Valley":return s;case"Low":return Q(s,i,c);case"Plateau":return Q(i,i+2,c);case"Mid":return Q(i+2,u,c);case"High":return Q(u,a,c);case"Peak":return a}}getContinentalness(e,n){return this.continentalMap.getValueAt(e,n)}getErosion(e,n){return this.erosionMap.getValueAt(e,n)}getPV(e,n){return this.pvMap.getValueAt(e,n)}}class Fs extends Ge{constructor(e,n,s,i,a,u){super(e);p(this,"continentalMap");p(this,"erosionMap");p(this,"pvMap");p(this,"heightMap");p(this,"densityMap");this.continentalMap=n,this.erosionMap=s,this.pvMap=i,this.heightMap=a,this.densityMap=u}getSurfaceHeightAt(e,n){return Math.floor(this.heightMap.getValueAt(e,n)*.25)}getContinentalnessAt(e,n){return this.continentalMap.getValueAt(e,n)}getErosionAt(e,n){return this.erosionMap.getValueAt(e,n)}getPVAt(e,n){return this.pvMap.getValueAt(e,n)}getDensityAt(e,n,s){return this.densityMap.getValueAt(e,n,s)}getHeightMap(){return this.heightMap}}var ee=(r=>(r[r.EMPTY=0]="EMPTY",r[r.TRUNK=1]="TRUNK",r[r.LEAF=2]="LEAF",r))(ee||{});class Wt{static encode(t){let e=0;return e=this.setType(e,t.type),e=this.setTrunkHeight(e,t.trunkHeight),e=this.setTrunkSurfaceY(e,t.trunkSurfaceY),e=this.setTrunkDistance(e,t.trunkDistance),e}static decode(t){return{type:this.getType(t),trunkHeight:this.getTrunkHeight(t),trunkSurfaceY:this.getTrunkSurfaceY(t),trunkDistance:this.getTrunkDistance(t)}}static getType(t){return(t&this.TYPE_MASK)>>14}static setType(t,e){return t|=e<<14&this.TYPE_MASK}static getTrunkHeight(t){return(t&this.TRUNK_HEIGHT_MASK)>>10}static setTrunkHeight(t,e){return t|=e<<10&this.TRUNK_HEIGHT_MASK}static getTrunkSurfaceY(t){return(t&this.TRUNK_SURFACE_HEIGHT_MASK)>>2}static setTrunkSurfaceY(t,e){return t|=e<<2&this.TRUNK_SURFACE_HEIGHT_MASK}static getTrunkDistance(t){return t&this.TRUNK_DISTANCE_MASK}static setTrunkDistance(t,e){return t|=e&this.TRUNK_DISTANCE_MASK}}p(Wt,"TYPE_MASK",49152),p(Wt,"TRUNK_HEIGHT_MASK",15360),p(Wt,"TRUNK_SURFACE_HEIGHT_MASK",1020),p(Wt,"TRUNK_DISTANCE_MASK",3);class ne extends Ut{constructor(e){super(e);p(this,"enabled");this.enabled=v.TREE_GENERATION_ENABLED}shouldSpawnTreeLeafAt(e,n,s){if(!this.enabled)return!1;const i=this.getTreeMapValueAt(e,s);if(i==null)return!1;const{type:a,trunkDistance:u,trunkHeight:h,trunkSurfaceY:l}=Wt.decode(i),o=l+h,c=n-o;if(a===ee.TRUNK){if(c===2)return Ls(.5);if(c===1)return!0}return!!(a===ee.LEAF&&(u===2&&ge(c,-1,0)||u===1&&ge(c,-1,1)))}shouldSpawnTreeTrunkAt(e,n,s,i){if(!this.enabled)return!1;const a=this.getTreeMapTypeAt(e,s);return n<i||n>i+mt.TRUNK_HEIGHT||a==null?!1:a===ee.TRUNK}getTreeMapTypeAt(e,n){const s=this.getTreeMapValueAt(e,n);return s!=null?Wt.getType(s):null}getTreeMapValueAt(e,n){return this.getPointData(e,n)}static getTreeSeedAt(e,n,s){return`${e}_${n}_${s}`}setValueAt(e,n,s){return this.setPointData(e,n,s)}getValueAt(e,n){return this.getPointData(e,n)??ee.EMPTY}}p(ne,"MAP_SIZE",ot.WIDTH+mt.RADIUS*2);class Hs extends nt{constructor(t){super(t)}getTerrainMap(){const{seed:t}=this,e=new rt(nt.getContinentalMapSeed(t)),n=new xt(nt.getErosionMapSeed(t)),s=new Mt(nt.getPvMapSeed(t)),i=new Ds(nt.getHeightMapSeed(t),e,n,s),a=new Ps(nt.getDensityMapSeed(t),n,s);return new Fs(t,e,n,s,i,a)}getTreeMapFromBuffer(t,e){const{x:n,z:s}=ot.getChunkOriginPosition(t),i=new ne(this.seed),a=new Map,u=n-mt.RADIUS,h=s-mt.RADIUS;for(let l=0;l<e.length;l++){const o=Math.floor(l/ne.MAP_SIZE)+u,c=l%ne.MAP_SIZE+h,f=ne.computeKey(o,c);a.set(f,e[l])}return i.setMapData(a),i}}class zn{constructor(t){p(this,"terrainMap");this.terrainMap=t}getSurfaceHeightAt(t,e){return this.terrainMap.getSurfaceHeightAt(t,e)}getContinentalTypeAt(t,e){const n=this.terrainMap.getContinentalnessAt(t,e);return rt.getType(n)}getPvTypeAt(t,e){const n=this.terrainMap.getPVAt(t,e);return Mt.getType(n)}getErosionTypeAt(t,e){const n=this.terrainMap.getErosionAt(t,e);return xt.getType(n)}}class Bs extends zn{constructor(e,n){super(e);p(this,"treeMap");this.treeMap=n}generateBlock(e,n,s){if(!(Math.abs(e-0)<100&&Math.abs(s-0)<100))return null;const o=this.getSurfaceHeightAt(e,s);return n<o?null:this.shouldSpawnWater(e,n,s)?B.WATER:this.treeMap.shouldSpawnTreeTrunkAt(e,n,s,o)?B.OAK_LOG:this.treeMap.shouldSpawnTreeLeafAt(e,n,s)?B.OAK_LEAVES:this.shouldSpawnCloud(e,n,s)?B.CLOUD:B.AIR}shouldSpawnWater(e,n,s){return n<C.SEA_LEVEL}shouldSpawnCloud(e,n,s){const i=Math.floor(Math.random()*6)+1,a=n>C.CLOUD_LEVEL&&n<=C.CLOUD_LEVEL+1,u=Math.ceil(e/C.CLOUD_WIDTH)%i===0&&Math.ceil(s/C.CLOUD_DEPTH)%i===0;return a&&u}}var je={},Gs={get exports(){return je},set exports(r){je=r}};(function(r){(function(t){function e(l){function o(c,f,d){this.x=c,this.y=f,this.z=d}o.prototype.dot2=function(c,f){return this.x*c+this.y*f},o.prototype.dot3=function(c,f,d){return this.x*c+this.y*f+this.z*d},this.grad3=[new o(1,1,0),new o(-1,1,0),new o(1,-1,0),new o(-1,-1,0),new o(1,0,1),new o(-1,0,1),new o(1,0,-1),new o(-1,0,-1),new o(0,1,1),new o(0,-1,1),new o(0,1,-1),new o(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.seed(l||0)}e.prototype.seed=function(l){l>0&&l<1&&(l*=65536),l=Math.floor(l),l<256&&(l|=l<<8);for(var o=this.p,c=0;c<256;c++){var f;c&1?f=o[c]^l&255:f=o[c]^l>>8&255;var d=this.perm,y=this.gradP;d[c]=d[c+256]=f,y[c]=y[c+256]=this.grad3[f%12]}};var n=.5*(Math.sqrt(3)-1),s=(3-Math.sqrt(3))/6,i=1/3,a=1/6;e.prototype.simplex2=function(l,o){var c,f,d,y=(l+o)*n,T=Math.floor(l+y),w=Math.floor(o+y),E=(T+w)*s,b=l-T+E,g=o-w+E,S,x;b>g?(S=1,x=0):(S=0,x=1);var _=b-S+s,A=g-x+s,k=b-1+2*s,m=g-1+2*s;T&=255,w&=255;var M=this.perm,I=this.gradP,N=I[T+M[w]],z=I[T+S+M[w+x]],O=I[T+1+M[w+1]],R=.5-b*b-g*g;R<0?c=0:(R*=R,c=R*R*N.dot2(b,g));var G=.5-_*_-A*A;G<0?f=0:(G*=G,f=G*G*z.dot2(_,A));var V=.5-k*k-m*m;return V<0?d=0:(V*=V,d=V*V*O.dot2(k,m)),70*(c+f+d)},e.prototype.simplex3=function(l,o,c){var f,d,y,T,w=(l+o+c)*i,E=Math.floor(l+w),b=Math.floor(o+w),g=Math.floor(c+w),S=(E+b+g)*a,x=l-E+S,_=o-b+S,A=c-g+S,k,m,M,I,N,z;x>=_?_>=A?(k=1,m=0,M=0,I=1,N=1,z=0):x>=A?(k=1,m=0,M=0,I=1,N=0,z=1):(k=0,m=0,M=1,I=1,N=0,z=1):_<A?(k=0,m=0,M=1,I=0,N=1,z=1):x<A?(k=0,m=1,M=0,I=0,N=1,z=1):(k=0,m=1,M=0,I=1,N=1,z=0);var O=x-k+a,R=_-m+a,G=A-M+a,V=x-I+2*a,J=_-N+2*a,U=A-z+2*a,Y=x-1+3*a,St=_-1+3*a,Tt=A-1+3*a;E&=255,b&=255,g&=255;var X=this.perm,$=this.gradP,ct=$[E+X[b+X[g]]],ut=$[E+k+X[b+m+X[g+M]]],yt=$[E+I+X[b+N+X[g+z]]],lt=$[E+1+X[b+1+X[g+1]]],Z=.5-x*x-_*_-A*A;Z<0?f=0:(Z*=Z,f=Z*Z*ct.dot3(x,_,A));var H=.5-O*O-R*R-G*G;H<0?d=0:(H*=H,d=H*H*ut.dot3(O,R,G));var It=.5-V*V-J*J-U*U;It<0?y=0:(It*=It,y=It*It*yt.dot3(V,J,U));var Lt=.5-Y*Y-St*St-Tt*Tt;return Lt<0?T=0:(Lt*=Lt,T=Lt*Lt*lt.dot3(Y,St,Tt)),32*(f+d+y+T)};function u(l){return l*l*l*(l*(l*6-15)+10)}function h(l,o,c){return(1-c)*l+c*o}e.prototype.perlin2=function(l,o){var c=Math.floor(l),f=Math.floor(o);l=l-c,o=o-f,c=c&255,f=f&255;var d=this.perm,y=this.gradP,T=y[c+d[f]].dot2(l,o),w=y[c+d[f+1]].dot2(l,o-1),E=y[c+1+d[f]].dot2(l-1,o),b=y[c+1+d[f+1]].dot2(l-1,o-1),g=u(l);return h(h(T,E,g),h(w,b,g),u(o))},e.prototype.perlin3=function(l,o,c){var f=Math.floor(l),d=Math.floor(o),y=Math.floor(c);l=l-f,o=o-d,c=c-y,f=f&255,d=d&255,y=y&255;var T=this.perm,w=this.gradP,E=w[f+T[d+T[y]]].dot3(l,o,c),b=w[f+T[d+T[y+1]]].dot3(l,o,c-1),g=w[f+T[d+1+T[y]]].dot3(l,o-1,c),S=w[f+T[d+1+T[y+1]]].dot3(l,o-1,c-1),x=w[f+1+T[d+T[y]]].dot3(l-1,o,c),_=w[f+1+T[d+T[y+1]]].dot3(l-1,o,c-1),A=w[f+1+T[d+1+T[y]]].dot3(l-1,o-1,c),k=w[f+1+T[d+1+T[y+1]]].dot3(l-1,o-1,c-1),m=u(l),M=u(o),I=u(c);return h(h(h(E,x,m),h(b,_,m),I),h(h(g,A,m),h(S,k,m),I),M)},t.Noise=e})(r.exports)})(Gs);class On extends zn{constructor(t){super(t)}generateBlock(t,e,n){if(Math.hypot(t-0,n-0)>100)return B.AIR;const u=this.getSurfaceHeightAt(t,n);if(this.terrainMap.getDensityAt(t,e,n)<0||e>=u)return B.AIR;const l=Math.abs(e-u);switch(this.getDepthLevel(e,l)){case"Surface":return this.getSurfaceBlockType(t,e,n);case"Subsurface":return this.getSubSurfaceBlockType(t,e,n);case"Mid":return this.getMidBlockType(t,e,n,l);default:return B.STONE}}getMidBlockType(t,e,n,s){return B.STONE}getSurfaceBlockType(t,e,n){return this.shouldSpawnSnow(t,e,n)?B.GRASS_SNOW:this.shouldSpawnSand(t,e,n)?B.SAND:e<C.SEA_LEVEL-1?B.DIRT:this.shouldSpawnSurfaceStone(t,e,n)?B.STONE:B.GRASS}getSubSurfaceBlockType(t,e,n){return this.shouldSpawnSurfaceStone(t,e,n)?B.STONE:B.DIRT}shouldSpawnSand(t,e,n){const s=this.getContinentalTypeAt(t,n);return e<=C.SAND_LEVEL&&(s==="Coast"||s==="Ocean")}shouldSpawnSurfaceStone(t,e,n){const s=this.getPvTypeAt(t,n),i=this.getContinentalTypeAt(t,n),a=this.getErosionTypeAt(t,n),u=i==="Far_Inland",h=i==="Inland",l=a==="Flat",o=a==="VeryLow"||a==="Low",c=a==="VeryLow",f=s==="Valley",d=s==="Valley"||s==="Low";return u&&c&&d||u&&o&&f||(h||u)&&l&&d}shouldSpawnCoal(t,e,n,s){const i=this.terrainMap.getDensityAt(t,e,n),a=ge(i,.05,.07);return ge(s,5,20)&&a}shouldSpawnSnow(t,e,n){const i=this.getContinentalTypeAt(t,n)==="Far_Inland",a=e>=C.SNOW_LEVEL;return i&&a}getDepthLevel(t,e){return e<=1?"Surface":e<=3?"Subsurface":t<=C.BEDROCK_LEVEL?"BedRock":t<=C.MIN_SURFACE_HEIGHT-5?"Deep":"Mid"}}p(On,"noise",new je.Noise(1));var Rn=(r=>(r[r.TERRAIN=0]="TERRAIN",r[r.FEATURES=1]="FEATURES",r))(Rn||{});class Vs{constructor(t,e){p(this,"terrainGenerator");p(this,"featuresGenerator");this.terrainGenerator=new On(t),this.featuresGenerator=new Bs(t,e)}getBlockGenerator(t){switch(t){case 0:return this.terrainGenerator;case 1:return this.featuresGenerator}}}class js{constructor(t){p(this,"DEFAULT_BLOCK_COLOR_RGBA",[1,1,1,1]);p(this,"AO_INTENSITY_LEVEL",[0,.2,.3,.4]);p(this,"terrainMap");this.terrainMap=t}buildChunkGeometry(t,e){const{x:n,y:s,z:i}=e,a=[],u=[],h=[],l=[],o=[],c=[],f=[],d=[],y=[],T=[];for(let w=0;w<ot.HEIGHT;++w){const E=s+w;for(let b=0;b<ot.WIDTH;++b){const g=i+b;for(let S=0;S<ot.WIDTH;++S){const x=n+S,_={x,y:E,z:g},A=t.getBlock(_),k=Et.isVisibleBlock(A==null?void 0:A.type);if(A&&k){const m=A.isTransparent,M=A.type===B.WATER;if(M&&this.canSkipWaterBlockRendering(E))continue;const I=m?c:a,N=m?f:u,z=m?d:h,O=m?y:l,R=m?T:o;for(const G of Et.getBlockFaces()){if(M&&G!=="top")continue;const{normal:V,vertices:J}=Et.getBlockFaceGeometry(G),U={x:x+V[0],y:E+V[1],z:g+V[2]},Y=t.getBlock(U);if(v.TERRAIN_OPTIMIZATION_ENABLED&&!Y&&this.canCullEdgeBlockFace(_,G,U))continue;if(!Y||Y.isTransparent&&Y.type!==B.CLOUD){const $=I.length/3;for(const{pos:ct,uv:ut,ao:yt}of J){const lt=x+ct[0],Z=E+ct[1],H=g+ct[2];I.push(lt,Z,H),N.push(...V);const It=Et.getBlockUVCoordinates(A.type,G,[ut[0],ut[1]]);O.push(It.u,It.v);const Lt=this.calculateVertexColor({x:lt,y:Z,z:H},A,yt,t);R.push(...Lt)}z.push($,$+1,$+2,$+2,$+1,$+3)}}}}}}return{solid:{positions:a,normals:u,indices:h,uvs:l,colors:o},transparent:{positions:c,normals:f,indices:d,uvs:y,colors:T}}}canCullEdgeBlockFace(t,e,n){const{terrainMap:s}=this,{x:i,y:a,z:u}=t,{x:h,y:l,z:o}=n,c=s.getSurfaceHeightAt(h,o);if(!(a<c-(e==="top"?1:0)))return!1;const d=s.getDensityAt(i,a,u),y=s.getDensityAt(h,l,o);return Math.sign(d)===Math.sign(y)}calculateVertexColor(t,e,n,s){const i=Et.getBlockColor(e.type)??this.DEFAULT_BLOCK_COLOR_RGBA,a=this.computeVertexAO(t,n,s);return[i[0]-a,i[1]-a,i[2]-a,i[3]]}computeVertexAO(t,{corner:e,side1:n,side2:s},i){let a=0;for(const u of[e,n,s])this.isSideOccluded(t,u,i)&&(a+=1);return this.AO_INTENSITY_LEVEL[a]}isSideOccluded({x:t,y:e,z:n},s,i){const{terrainMap:a}=this,[u,h,l]=s,o=i.getBlock({x:t+u,y:e+h,z:n+l});if(o&&!o.isTransparent)return!0;if(!o){const c=Math.floor(t+u),f=Math.floor(e+h),d=Math.floor(n+l),y=a.getSurfaceHeightAt(c,d),T=a.getDensityAt(c,f,d),w=Math.sign(T)>0,E=Math.sign(h)>0,b=Math.sign(h)<0,g=e<y,S=Math.abs(e-y)===0;if(w)return E&&g||b&&S}return!1}canSkipWaterBlockRendering(t){return t!==C.SEA_LEVEL-1}static extractBufferGeometryDataFromGeometry(t){var u,h;const e=Array.from(t.getAttribute("position").array),n=Array.from(t.getAttribute("normal").array),s=Array.from(t.getAttribute("uv").array),i=Array.from(((u=t.getAttribute("color"))==null?void 0:u.array)??[]),a=Array.from(((h=t.index)==null?void 0:h.array)??[]);return{positions:e,normals:n,uvs:s,indices:a,colors:i}}}function Us(r,t,e){const n=new ot(r),s=new Hs(t),i=s.getTerrainMap(),a=s.getTreeMapFromBuffer(r,new Uint16Array(e)),h=new Vs(i,a).getBlockGenerator(Rn.TERRAIN);n.decorateChunk(h);const l=n.getBlocks(),o=new js(i),{solid:c,transparent:f}=o.buildChunkGeometry(n,n.getWorldOriginPosition());return{solidGeometry:c,transparentGeometry:f,blocksBuffer:rs(l.buffer)}}ss(Us)})();
